---
title: "æ ‘è“æ´¾æœåŠ¡éƒ¨ç½²ä¸ç»´æŠ¤å®Œæ•´æŒ‡å—"
date: 2024-12-03T18:00:00+08:00
draft: false
categories: ["æŠ€æœ¯"]
tags: ["RaspberryPi", "Hugo", "æ•™ç¨‹"]
cover: "/images/default3.jpg"
---

# æ ‘è“æ´¾æœåŠ¡éƒ¨ç½²ä¸ç»´æŠ¤å®Œæ•´æŒ‡å—

## ä¸€ã€ç³»ç»Ÿæ¦‚å†µ
### 1. ç¡¬ä»¶èµ„æº
- **å¤„ç†å™¨**: ARM64 æ¶æ„
- **æ€»å†…å­˜**: 3.7GB
- **å¯ç”¨å†…å­˜**: ~2.5GB
- **Swap**: 512MB
- **ç½‘ç»œ**: wlan0 (IP: 10.40.110.47)
### 2. æœåŠ¡æ¦‚è§ˆ
1. **AI æ™ºèƒ½åŠ©æ‰‹**
   - ç«¯å£: 8080
   - åŸºäº: llama.cpp
   - æ¨¡å‹: Phi-3-mini-4k-instruct-q4.gguf
   - èµ„æºå ç”¨:
     * CPU: ~300% (å¤šæ ¸)
     * å†…å­˜: ~3GB
     * Swap: 511Mi
2. **ä¸ªäººåšå®¢**
   - ç«¯å£: 80
   - æ¡†æ¶: Hugo v0.139.3-extended
   - ä¸»é¢˜: Ananke
   - WebæœåŠ¡å™¨: Nginx
   - èµ„æºå ç”¨: è½»é‡çº§
### 3. æœåŠ¡è®¿é—®
- AI åŠ©æ‰‹: `http://10.40.110.47:8080`
- åšå®¢å¼€å‘: `http://10.40.110.47:1313`
- åšå®¢æ­£å¼: `http://10.40.110.47`
## äºŒã€AI æ™ºèƒ½åŠ©æ‰‹éƒ¨ç½²
### 1. ç¯å¢ƒå‡†å¤‡
```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt update
sudo apt upgrade -y

# å®‰è£…ä¾èµ–
sudo apt install build-essential git cmake
```

### 2. ç¼–è¯‘å®‰è£…
```bash
# å…‹éš†ä»“åº“
git clone https://github.com/ggerganov/llama.cpp.git
cd llama.cpp

# ç¼–è¯‘
make clean
LLAMA_METAL=1 make -j4
```

### 3. æ¨¡å‹é…ç½®
```bash
# åˆ›å»ºæ¨¡å‹ç›®å½•
mkdir models
cd models

# ä¸‹è½½æ¨¡å‹æ–‡ä»¶
wget [æ¨¡å‹ä¸‹è½½åœ°å€]/Phi-3-mini-4k-instruct-q4.gguf

# éªŒè¯æ¨¡å‹æ–‡ä»¶
sha256sum Phi-3-mini-4k-instruct-q4.gguf
```

### 4. æœåŠ¡é…ç½®
```bash
# åˆ›å»ºå¯åŠ¨è„šæœ¬
nano ~/projects/llama.cpp/start-llama.sh
```

```bash
#!/bin/bash
cd ~/projects/llama.cpp
nohup ./llama-server \
  -m models/Phi-3-mini-4k-instruct-q4.gguf \
  --host 0.0.0.0 \
  --port 8080 \
  --ctx-size 2048 \
  --threads 2 \
  --batch-size 256 \
  > llama.log 2>&1 &
```

```bash
# è®¾ç½®æ‰§è¡Œæƒé™
chmod +x start-llama.sh

# å¯åŠ¨æœåŠ¡
./start-llama.sh

# éªŒè¯æœåŠ¡çŠ¶æ€
ps aux | grep llama-server
netstat -tuln | grep 8080
```

## ä¸‰ã€ä¸ªäººåšå®¢éƒ¨ç½²
### 1. Hugo å®‰è£…
```bash
# ä¸‹è½½ Hugo Extended ç‰ˆæœ¬
wget https://github.com/gohugoio/hugo/releases/download/v0.139.3/hugo_extended_0.139.3_linux-arm64.deb

# å®‰è£…
sudo dpkg -i hugo_extended_0.139.3_linux-arm64.deb

# éªŒè¯å®‰è£…
hugo version
```

### 2. åšå®¢åˆå§‹åŒ–
```bash
# åˆ›å»ºç«™ç‚¹
cd ~
hugo new site myblog
cd myblog

# åˆå§‹åŒ– Git
git init

# æ·»åŠ ä¸»é¢˜
git submodule add https://github.com/theNewDynamic/gohugo-theme-ananke.git themes/ananke
```

### 3. åšå®¢é…ç½®
```bash
# ç¼–è¾‘é…ç½®æ–‡ä»¶
nano config.toml
```
```toml
baseURL = "http://10.40.110.47/"
languageCode = "zh-cn"
title = "My Blog"
theme = "ananke"

[params]
  author = "Your Name"
  description = "Welcome to my blog"
  dateFormat = "2006-01-02"
  background_color_class = "bg-black"
  recent_posts_number = 3
  mainSections = ["posts"]
  featured_image = false

[menu]
  [[menu.main]]
    identifier = "posts"
    name = "æ–‡ç« "
    url = "/posts/"
    weight = 1
  [[menu.main]]
    identifier = "about"
    name = "å…³äº"
    url = "/about/"
    weight = 2
```

### 4. Nginx é…ç½®
```bash
# å®‰è£… Nginx
sudo apt install nginx

# åˆ›å»ºé…ç½®æ–‡ä»¶
sudo nano /etc/nginx/sites-available/myblog
```

```nginx
server {
    listen 80;
    server_name 10.40.110.47;

    root /home/zhaoxiongzhou/myblog/public;
    index index.html;

    location / {
        try_files $uri $uri/ =404;
    }

    access_log /var/log/nginx/myblog_access.log;
    error_log /var/log/nginx/myblog_error.log;
}
```


```bash
# å¯ç”¨é…ç½®
sudo ln -s /etc/nginx/sites-available/myblog /etc/nginx/sites-enabled/
sudo rm /etc/nginx/sites-enabled/default

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡å¯ Nginx
sudo systemctl restart nginx
```

## å››ã€æƒé™ä¸è‡ªåŠ¨åŒ–é…ç½®
### 1. æƒé™è®¾ç½®
```bash
# è®¾ç½®ç›®å½•æƒé™
sudo chmod 755 /home/zhaoxiongzhou
sudo chmod -R 755 /home/zhaoxiongzhou/myblog

# è®¾ç½®æ–‡ä»¶æ‰€æœ‰æƒ
sudo chown -R www-data:www-data /home/zhaoxiongzhou/myblog/public

# éªŒè¯æƒé™
ls -la ~/myblog/public
ls -la /home/zhaoxiongzhou
```

### 2. è‡ªåŠ¨éƒ¨ç½²è„šæœ¬
```bash
# åˆ›å»ºåšå®¢éƒ¨ç½²è„šæœ¬
nano ~/deploy-blog.sh
```
```bash
#!/bin/bash
cd ~/myblog
hugo
sudo chown -R www-data:www-data public/
sudo systemctl restart nginx
```
```bash
# è®¾ç½®æ‰§è¡Œæƒé™
chmod +x ~/deploy-blog.sh
```

### 3. å¤‡ä»½è„šæœ¬
```bash
# åˆ›å»ºå¤‡ä»½è„šæœ¬
nano ~/backup-blog.sh
```
```bash
#!/bin/bash
BACKUP_DIR="/home/zhaoxiongzhou/backups"
DATE=$(date +%Y%m%d)

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR

# å¤‡ä»½åšå®¢å†…å®¹
tar -czf $BACKUP_DIR/blog_$DATE.tar.gz ~/myblog/content

# å¤‡ä»½é…ç½®æ–‡ä»¶
cp ~/myblog/config.toml $BACKUP_DIR/config_$DATE.toml

# åˆ é™¤30å¤©å‰çš„å¤‡ä»½
find $BACKUP_DIR -name "*.tar.gz" -mtime +30 -delete
```

```bash
# è®¾ç½®æ‰§è¡Œæƒé™
chmod +x ~/backup-blog.sh

# é…ç½®å®šæ—¶ä»»åŠ¡
crontab -e
```

```bash
# æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼ˆæ¯å‘¨æ—¥å‡Œæ™¨2ç‚¹æ‰§è¡Œå¤‡ä»½ï¼‰
0 2 * * 0 /home/zhaoxiongzhou/backup-blog.sh
```
## äº”ã€ç³»ç»Ÿç»´æŠ¤ä¸ç›‘æ§
### 1. èµ„æºç›‘æ§å‘½ä»¤
```bash
# ç³»ç»Ÿèµ„æºç›‘æ§
htop
top
free -h
vmstat 1

# ç£ç›˜ä½¿ç”¨ç›‘æ§
df -h
du -sh /*
du -sh ~/myblog
du -sh ~/projects/llama.cpp

# æ¸©åº¦ç›‘æ§
vcgencmd measure_temp
```
### 2. æ€§èƒ½ä¼˜åŒ–
```bash
# æ¸…ç†ç³»ç»Ÿç¼“å­˜
sudo sync; echo 3 | sudo tee /proc/sys/vm/drop_caches

# è°ƒæ•´ Swap è®¾ç½®
cat /proc/sys/vm/swappiness
sudo sysctl vm.swappiness=60

# CPU é¢‘ç‡è°ƒæ•´
sudo nano /boot/config.txt
```

```toml
# CPU é…ç½®å‚æ•°
arm_freq=1800
over_voltage=6
temp_limit=75
```

### 3. ç³»ç»Ÿç»´æŠ¤
```bash
# ç³»ç»Ÿæ›´æ–°
sudo apt update
sudo apt upgrade -y
sudo apt autoremove
sudo apt clean

# æ—¥å¿—æ¸…ç†
sudo find /var/log -type f -name "*.log" -mtime +30 -delete
sudo find /var/log -type f -name "*.gz" -delete

# æœåŠ¡çŠ¶æ€æ£€æŸ¥
systemctl status nginx
ps aux | grep llama-server
```

## å…­ã€å®‰å…¨é…ç½®
### 1. é˜²ç«å¢™è®¾ç½®
```bash
# å®‰è£… UFW
sudo apt install ufw

# é…ç½®åŸºæœ¬è§„åˆ™
sudo ufw default deny incoming
sudo ufw default allow outgoing
sudo ufw allow 22
sudo ufw allow 80
sudo ufw allow 8080

# å¯ç”¨é˜²ç«å¢™
sudo ufw enable

# æ£€æŸ¥çŠ¶æ€
sudo ufw status
```
### 2. Nginx è®¿é—®æ§åˆ¶
```bash
# å®‰è£…è®¤è¯å·¥å…·
sudo apt install apache2-utils

# åˆ›å»ºç”¨æˆ·å¯†ç 
sudo htpasswd -c /etc/nginx/.htpasswd username

# ä¿®æ”¹ Nginx é…ç½®
sudo nano /etc/nginx/sites-available/myblog
```

```nginx
server {
    listen 80;
    server_name 10.40.110.47;

    root /home/zhaoxiongzhou/myblog/public;
    index index.html;

    # æ·»åŠ åŸºæœ¬è®¤è¯
    location / {
        auth_basic "Restricted Access";
        auth_basic_user_file /etc/nginx/.htpasswd;
        try_files $uri $uri/ =404;
    }

    # æ—¥å¿—é…ç½®
    access_log /var/log/nginx/myblog_access.log;
    error_log /var/log/nginx/myblog_error.log;
}
```
### 3. æ—¥å¿—ç›‘æ§
```bash
# å®‰è£…æ—¥å¿—ç›‘æ§å·¥å…·
sudo apt install logwatch

# é…ç½®æ—¥å¿—ç›‘æ§
sudo nano /etc/logwatch/conf/logwatch.conf
```

```toml
# é…ç½®æ¯æ—¥æ—¥å¿—æ£€æŸ¥
Output = mail
Format = html
MailTo = your-email@domain.com
Detail = High
```

## ä¸ƒã€æ•…éšœæ’é™¤æŒ‡å—
#### å†…å­˜ç›¸å…³é—®é¢˜
```bash
# æ£€æŸ¥å†…å­˜çŠ¶æ€
free -h
ps aux --sort=-%mem | head

# å¦‚æœå†…å­˜ä¸è¶³ï¼Œè°ƒæ•´æœåŠ¡å‚æ•°
nano ~/projects/llama.cpp/start-llama.sh
```
```bash
# é™ä½èµ„æºä½¿ç”¨çš„å‚æ•°ç¤ºä¾‹
--ctx-size 1024 \
--batch-size 128 \
--threads 1
```
#### æœåŠ¡æ— å“åº”
```bash
# æ£€æŸ¥è¿›ç¨‹
ps aux | grep llama-server

# æ£€æŸ¥ç«¯å£
netstat -tuln | grep 8080

# é‡å¯æœåŠ¡
pkill llama-server
./start-llama.sh

# æ£€æŸ¥æ—¥å¿—
tail -f ~/projects/llama.cpp/llama.log
```
### 2. åšå®¢æœåŠ¡æ•…éšœæ’é™¤
#### Nginx é—®é¢˜
```bash
# æ£€æŸ¥é…ç½®è¯­æ³•
sudo nginx -t

# æ£€æŸ¥æ—¥å¿—
sudo tail -f /var/log/nginx/error.log
sudo tail -f /var/log/nginx/myblog_error.log

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status nginx

# é‡å¯æœåŠ¡
sudo systemctl restart nginx
```

#### Hugo ç”Ÿæˆé—®é¢˜
```bash
# æ¸…ç†ç¼“å­˜
rm -rf ~/myblog/public
rm -rf ~/myblog/resources

# æ›´æ–°ä¸»é¢˜
git submodule update --init --recursive

# é‡æ–°ç”Ÿæˆï¼ˆè¯¦ç»†æ¨¡å¼ï¼‰
hugo --verbose
```

## å…«ã€ç³»ç»Ÿçº§æ•…éšœæ’é™¤
### 1. ç£ç›˜é—®é¢˜
```bash
# æ£€æŸ¥ç£ç›˜ä½¿ç”¨æƒ…å†µ
df -h
du -sh /*

# æŸ¥æ‰¾å¤§æ–‡ä»¶
sudo find / -type f -size +100M

# æ¸…ç†ç©ºé—´
sudo apt clean
sudo apt autoremove
sudo journalctl --vacuum-time=7d
```

### 2. ç½‘ç»œé—®é¢˜
```bash
# ç½‘ç»œçŠ¶æ€æ£€æŸ¥
ip addr show
ping -c 4 8.8.8.8
netstat -tuln

# DNS æ£€æŸ¥
cat /etc/resolv.conf
nslookup google.com

# é‡å¯ç½‘ç»œæœåŠ¡
sudo systemctl restart networking
sudo systemctl restart wpa_supplicant
```

### 3. æ€§èƒ½é—®é¢˜
```bash
# CPU æ¸©åº¦ç›‘æ§
vcgencmd measure_temp
watch -n 1 vcgencmd measure_temp

# CPU é¢‘ç‡æ£€æŸ¥
vcgencmd measure_clock arm
cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_cur_freq

# ç³»ç»Ÿè´Ÿè½½æ£€æŸ¥
uptime
cat /proc/loadavg
```

## ä¹ã€ç»´æŠ¤æœ€ä½³å®è·µ
### 1. æ—¥å¸¸ç»´æŠ¤æ¸…å•
- æ£€æŸ¥ç³»ç»Ÿæ—¥å¿—
- ç›‘æ§èµ„æºä½¿ç”¨
- éªŒè¯æœåŠ¡çŠ¶æ€
- æ£€æŸ¥å¤‡ä»½çŠ¶æ€
- æ›´æ–°ç³»ç»Ÿå®‰å…¨è¡¥ä¸
### 2. å‘¨æœŸæ€§ç»´æŠ¤ä»»åŠ¡
- æ¸…ç†æ—§æ—¥å¿—å’Œä¸´æ—¶æ–‡ä»¶
- éªŒè¯å¤‡ä»½å®Œæ•´æ€§
- æ£€æŸ¥ç³»ç»Ÿæ›´æ–°
- æ£€æŸ¥æœåŠ¡æ€§èƒ½
- æ›´æ–°æ–‡æ¡£å’Œé…ç½®è¯´æ˜
### 3. åº”æ€¥é¢„æ¡ˆ
- ä¿å­˜æ‰€æœ‰é…ç½®æ–‡ä»¶çš„å¤‡ä»½
- è®°å½•æ‰€æœ‰æœåŠ¡çš„é…ç½®æ­¥éª¤
- ç»´æŠ¤é—®é¢˜è§£å†³æ–¹æ¡ˆæ–‡æ¡£
- å»ºç«‹æœåŠ¡æ¢å¤æµç¨‹
- ä¿æŒé‡è¦æ•°æ®çš„å¤šä»½å¤‡ä»½

## åã€æ€§èƒ½ä¼˜åŒ–å»ºè®®
### 1. ç³»ç»Ÿçº§ä¼˜åŒ–
```bash
# 1. è°ƒæ•´ SWAP è®¾ç½®
sudo nano /etc/sysctl.conf
```
```toml
# æ·»åŠ æˆ–ä¿®æ”¹ä»¥ä¸‹å‚æ•°
vm.swappiness=60
vm.vfs_cache_pressure=50
vm.dirty_background_ratio=5
vm.dirty_ratio=10
```
```bash
# 2. ä¼˜åŒ–æ–‡ä»¶ç³»ç»Ÿ
# æ£€æŸ¥å¹¶ä¼˜åŒ–æ–‡ä»¶ç³»ç»Ÿ
sudo tune2fs -o journal_data_writeback /dev/mmcblk0p2

# 3. è°ƒæ•´ CPU æ€§èƒ½
sudo nano /boot/config.txt
```
```toml
# æ·»åŠ ä»¥ä¸‹é…ç½®
arm_freq=1800
over_voltage=6
gpu_freq=500
dtparam=audio=on
```
### 2. æœåŠ¡ä¼˜åŒ–
#### AI æœåŠ¡ä¼˜åŒ–
```bash
# è°ƒæ•´æœåŠ¡å‚æ•°
nano ~/projects/llama.cpp/start-llama.sh
```
```toml
# ä¼˜åŒ–å‚æ•°ç¤ºä¾‹
--ctx-size 2048 \
--threads 2 \
--batch-size 256 \
--keep-context \
--mlock \
--numa
```

#### Nginx ä¼˜åŒ–
```bash
sudo nano /etc/nginx/nginx.conf
```
```toml
worker_processes auto;
worker_rlimit_nofile 65535;

events {
    worker_connections 1024;
    multi_accept on;
    use epoll;
}

http {
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
    types_hash_max_size 2048;
    server_tokens off;

    # ç¼“å­˜è®¾ç½®
    open_file_cache max=1000 inactive=20s;
    open_file_cache_valid 30s;
    open_file_cache_min_uses 2;
    open_file_cache_errors on;
}
```
## åä¸€ã€ç›‘æ§ä¸æŠ¥è­¦ç³»ç»Ÿ
### 1. ç³»ç»Ÿç›‘æ§é…ç½®
```bash
# å®‰è£…ç›‘æ§å·¥å…·
sudo apt install prometheus node-exporter grafana

# é…ç½® Prometheus
sudo nano /etc/prometheus/prometheus.yml
```
```toml
global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'node'
    static_configs:
      - targets: ['localhost:9100']

  - job_name: 'nginx'
    static_configs:
      - targets: ['localhost:9113']
```

### 2. è‡ªåŠ¨æŠ¥è­¦è„šæœ¬
```bash
# åˆ›å»ºç›‘æ§è„šæœ¬
nano ~/monitor.sh
```
```bash
#!/bin/bash

# å®šä¹‰é˜ˆå€¼
MAX_CPU_USAGE=90
MAX_MEM_USAGE=90
MAX_DISK_USAGE=90
MAX_TEMP=75

# è·å–ç³»ç»Ÿæ•°æ®
CPU_USAGE=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d. -f1)
MEM_USAGE=$(free | grep Mem | awk '{print $3/$2 * 100.0}')
DISK_USAGE=$(df -h / | awk 'NR==2 {print $5}' | cut -d% -f1)
TEMP=$(vcgencmd measure_temp | cut -d= -f2 | cut -d. -f1)

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
check_services() {
    services=("nginx" "llama-server")
    for service in "${services[@]}"; do
        if ! pgrep -x "$service" > /dev/null; then
            echo "è­¦å‘Š: $service æœåŠ¡æœªè¿è¡Œ!"
            # å¯ä»¥æ·»åŠ é‡å¯æœåŠ¡çš„å‘½ä»¤
        fi
    done
}

# å‘é€è­¦å‘Š
send_alert() {
    message="$1"
    # è¿™é‡Œå¯ä»¥æ·»åŠ å‘é€é‚®ä»¶æˆ–å…¶ä»–é€šçŸ¥çš„å‘½ä»¤
    echo "$message" >> /var/log/system_alerts.log
}

# æ£€æŸ¥å„é¡¹æŒ‡æ ‡
if [ "$CPU_USAGE" -gt "$MAX_CPU_USAGE" ]; then
    send_alert "CPU ä½¿ç”¨ç‡è¿‡é«˜: $CPU_USAGE%"
fi

if [ "${MEM_USAGE%.*}" -gt "$MAX_MEM_USAGE" ]; then
    send_alert "å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜: $MEM_USAGE%"
fi

if [ "$DISK_USAGE" -gt "$MAX_DISK_USAGE" ]; then
    send_alert "ç£ç›˜ä½¿ç”¨ç‡è¿‡é«˜: $DISK_USAGE%"
fi

if [ "$TEMP" -gt "$MAX_TEMP" ]; then
    send_alert "ç³»ç»Ÿæ¸©åº¦è¿‡é«˜: $TEMPÂ°C"
fi

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
check_services
```
```bash
# è®¾ç½®æ‰§è¡Œæƒé™
chmod +x ~/monitor.sh

# æ·»åŠ åˆ° crontab
crontab -e
```
```bash
# æ¯5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ç›‘æ§
*/5 * * * * /home/zhaoxiongzhou/monitor.sh
```
## åäºŒã€æ•°æ®å¤‡ä»½ä¸æ¢å¤
### 1. å®Œæ•´å¤‡ä»½æ–¹æ¡ˆ
```bash
# åˆ›å»ºå®Œæ•´å¤‡ä»½è„šæœ¬
nano ~/full-backup.sh
```
```bash
#!/bin/bash
BACKUP_ROOT="/home/zhaoxiongzhou/backups"
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="$BACKUP_ROOT/$DATE"

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p "$BACKUP_DIR"

# å¤‡ä»½åšå®¢å†…å®¹
echo "å¤‡ä»½åšå®¢å†…å®¹..."
tar -czf "$BACKUP_DIR/blog_content.tar.gz" ~/myblog/content
tar -czf "$BACKUP_DIR/blog_config.tar.gz" ~/myblog/config.toml

# å¤‡ä»½ AI æ¨¡å‹å’Œé…ç½®
echo "å¤‡ä»½ AI æœåŠ¡..."
tar -czf "$BACKUP_DIR/llama_models.tar.gz" ~/projects/llama.cpp/models
tar -czf "$BACKUP_DIR/llama_config.tar.gz" ~/projects/llama.cpp/start-llama.sh

# å¤‡ä»½ Nginx é…ç½®
echo "å¤‡ä»½ Nginx é…ç½®..."
sudo tar -czf "$BACKUP_DIR/nginx_config.tar.gz" /etc/nginx/sites-available/myblog

# å¤‡ä»½ç³»ç»Ÿé…ç½®
echo "å¤‡ä»½ç³»ç»Ÿé…ç½®..."
sudo tar -czf "$BACKUP_DIR/system_config.tar.gz" /boot/config.txt /etc/fstab

# åˆ›å»ºå¤‡ä»½æ¸…å•
echo "åˆ›å»ºå¤‡ä»½æ¸…å•..."
find "$BACKUP_DIR" -type f -exec sha256sum {} \; > "$BACKUP_DIR/checksum.txt"

# æ¸…ç†æ—§å¤‡ä»½ï¼ˆä¿ç•™æœ€è¿‘7ä»½ï¼‰
cd "$BACKUP_ROOT"
ls -t | tail -n +8 | xargs -r rm -r

echo "å¤‡ä»½å®Œæˆ: $BACKUP_DIR"
```
### 2. æ•°æ®æ¢å¤æµç¨‹
```bash
# åˆ›å»ºæ¢å¤è„šæœ¬
nano ~/restore.sh
```
```bash
#!/bin/bash
if [ -z "$1" ]; then
    echo "ä½¿ç”¨æ–¹æ³•: $0 <å¤‡ä»½ç›®å½•>"
    exit 1
fi

BACKUP_DIR="$1"

# éªŒè¯å¤‡ä»½å®Œæ•´æ€§
echo "éªŒè¯å¤‡ä»½å®Œæ•´æ€§..."
cd "$BACKUP_DIR"
sha256sum -c checksum.txt || {
    echo "å¤‡ä»½éªŒè¯å¤±è´¥ï¼"
    exit 1
}

# æ¢å¤åšå®¢å†…å®¹
echo "æ¢å¤åšå®¢å†…å®¹..."
tar -xzf "$BACKUP_DIR/blog_content.tar.gz" -C ~/myblog/
tar -xzf "$BACKUP_DIR/blog_config.tar.gz" -C ~/myblog/

# æ¢å¤ AI æœåŠ¡
echo "æ¢å¤ AI æœåŠ¡..."
tar -xzf "$BACKUP_DIR/llama_models.tar.gz" -C ~/projects/llama.cpp/
tar -xzf "$BACKUP_DIR/llama_config.tar.gz" -C ~/projects/llama.cpp/

# æ¢å¤ Nginx é…ç½®
echo "æ¢å¤ Nginx é…ç½®..."
sudo tar -xzf "$BACKUP_DIR/nginx_config.tar.gz" -C /etc/nginx/sites-available/

# æ¢å¤ç³»ç»Ÿé…ç½®
echo "æ¢å¤ç³»ç»Ÿé…ç½®..."
sudo tar -xzf "$BACKUP_DIR/system_config.tar.gz" -C /

# é‡å¯æœåŠ¡
echo "é‡å¯æœåŠ¡..."
sudo systemctl restart nginx
pkill llama-server
~/projects/llama.cpp/start-llama.sh

echo "æ¢å¤å®Œæˆ"
```

## åä¸‰ã€æœåŠ¡å‡çº§æŒ‡å—
### 1. Hugo åšå®¢å‡çº§
```bash
# 1. å¤‡ä»½å½“å‰ç‰ˆæœ¬
cd ~
tar -czf hugo_backup_$(date +%Y%m%d).tar.gz myblog/

# 2. æ£€æŸ¥å½“å‰ç‰ˆæœ¬
hugo version

# 3. ä¸‹è½½æ–°ç‰ˆæœ¬
wget https://github.com/gohugoio/hugo/releases/download/v[æ–°ç‰ˆæœ¬]/hugo_extended_[æ–°ç‰ˆæœ¬]_linux-arm64.deb

# 4. å®‰è£…æ–°ç‰ˆæœ¬
sudo dpkg -i hugo_extended_[æ–°ç‰ˆæœ¬]_linux-arm64.deb

# 5. æ›´æ–°ä¸»é¢˜
cd ~/myblog
git submodule update --remote themes/ananke

# 6. æµ‹è¯•ç”Ÿæˆ
hugo --verbose

# 7. éƒ¨ç½²æ›´æ–°
./deploy-blog.sh
```
### 2. AI æœåŠ¡å‡çº§
```bash
# 1. å¤‡ä»½å½“å‰ç‰ˆæœ¬
cd ~/projects
tar -czf llama_backup_$(date +%Y%m%d).tar.gz llama.cpp/

# 2. æ›´æ–°æºç 
cd llama.cpp
git pull origin master

# 3. é‡æ–°ç¼–è¯‘
make clean
LLAMA_METAL=1 make -j4

# 4. æµ‹è¯•æ–°ç‰ˆæœ¬
./llama-server -h

# 5. æ›´æ–°å¯åŠ¨è„šæœ¬
nano start-llama.sh
```
### 3. ç³»ç»Ÿå‡çº§
```bash
# 1. æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨
sudo apt update

# 2. å‡çº§æ‰€æœ‰åŒ…
sudo apt upgrade -y

# 3. å‡çº§ç³»ç»Ÿ
sudo apt dist-upgrade -y

# 4. æ¸…ç†æ—§åŒ…
sudo apt autoremove -y
sudo apt clean

# 5. æ£€æŸ¥å¯åŠ¨é¡¹
sudo systemctl list-unit-files --state=enabled

# 6. æ›´æ–°æ ‘è“æ´¾å›ºä»¶
sudo rpi-update

# 7. æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
sudo systemctl --failed
sudo journalctl -p 3 -xb
```

## åå››ã€å®‰å…¨åŠ å›ºæŒ‡å—
### 1. ç³»ç»Ÿå®‰å…¨é…ç½®
```bash
# 1. SSH å®‰å…¨é…ç½®
sudo nano /etc/ssh/sshd_config
```
```toml
# SSH é…ç½®å»ºè®®
Port 22222                    # ä¿®æ”¹é»˜è®¤ç«¯å£
PermitRootLogin no           # ç¦æ­¢ root ç™»å½•
PasswordAuthentication no    # ç¦ç”¨å¯†ç è®¤è¯
PubkeyAuthentication yes    # å¯ç”¨å¯†é’¥è®¤è¯
AllowUsers zhaoxiongzhou   # é™åˆ¶å…è®¸çš„ç”¨æˆ·
```
```bash
# 2. è®¾ç½®é˜²ç«å¢™è§„åˆ™
sudo apt install ufw fail2ban

# é…ç½® UFW
sudo ufw default deny incoming
sudo ufw default allow outgoing
sudo ufw allow 22222/tcp  # SSH
sudo ufw allow 80/tcp     # HTTP
sudo ufw allow 8080/tcp   # AI æœåŠ¡
sudo ufw enable

# é…ç½® fail2ban
sudo nano /etc/fail2ban/jail.local
```
```bash
[sshd]
enabled = true
port = 22222
filter = sshd
logpath = /var/log/auth.log
maxretry = 3
bantime = 3600
```
### 2. æœåŠ¡å®‰å…¨é…ç½®
#### Nginx å®‰å…¨è®¾ç½®
```bash
# 1. åˆ›å»º SSL è¯ä¹¦
sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
-keyout /etc/nginx/ssl/nginx.key \
-out /etc/nginx/ssl/nginx.crt

# 2. é…ç½® HTTPS
sudo nano /etc/nginx/sites-available/myblog
```
```toml
server {
    listen 443 ssl;
    server_name 10.40.110.47;

    ssl_certificate /etc/nginx/ssl/nginx.crt;
    ssl_certificate_key /etc/nginx/ssl/nginx.key;
    
    # SSL é…ç½®
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_prefer_server_ciphers on;
    ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256;
    
    # å®‰å…¨å¤´éƒ¨
    add_header X-Frame-Options "SAMEORIGIN";
    add_header X-XSS-Protection "1; mode=block";
    add_header X-Content-Type-Options "nosniff";
    add_header Strict-Transport-Security "max-age=31536000";

    # å…¶ä»–é…ç½®...
}
```
## åäº”ã€æ€§èƒ½ç›‘æ§ä¸åˆ†æ
### 1. ç›‘æ§è„šæœ¬é…ç½®
```bash
# åˆ›å»ºç»¼åˆç›‘æ§è„šæœ¬
nano ~/system_monitor.sh
```
```bash
#!/bin/bash
LOG_FILE="/var/log/system_monitor.log"
ALERT_FILE="/var/log/system_alerts.log"

# è®°å½•æ—¶é—´æˆ³
timestamp() {
    date "+%Y-%m-%d %H:%M:%S"
}

# ç³»ç»Ÿèµ„æºç›‘æ§
monitor_resources() {
    echo "=== ç³»ç»Ÿèµ„æºç›‘æ§ $(timestamp) ===" >> "$LOG_FILE"
    
    # CPU ä½¿ç”¨ç‡
    CPU_USAGE=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}')
    echo "CPU ä½¿ç”¨ç‡: $CPU_USAGE%" >> "$LOG_FILE"
    
    # å†…å­˜ä½¿ç”¨
    free -h | grep "Mem:" >> "$LOG_FILE"
    
    # ç£ç›˜ä½¿ç”¨
    df -h / >> "$LOG_FILE"
    
    # ç³»ç»Ÿè´Ÿè½½
    uptime >> "$LOG_FILE"
    
    # CPU æ¸©åº¦
    vcgencmd measure_temp >> "$LOG_FILE"
}

# æœåŠ¡çŠ¶æ€ç›‘æ§
monitor_services() {
    echo "=== æœåŠ¡çŠ¶æ€ç›‘æ§ $(timestamp) ===" >> "$LOG_FILE"
    
    # Nginx çŠ¶æ€
    if systemctl is-active nginx >/dev/null 2>&1; then
        echo "Nginx: è¿è¡Œä¸­" >> "$LOG_FILE"
    else
        echo "è­¦å‘Š: Nginx æœªè¿è¡Œ!" >> "$ALERT_FILE"
    fi
    
    # AI æœåŠ¡çŠ¶æ€
    if pgrep -f llama-server >/dev/null; then
        echo "AI æœåŠ¡: è¿è¡Œä¸­" >> "$LOG_FILE"
    else
        echo "è­¦å‘Š: AI æœåŠ¡æœªè¿è¡Œ!" >> "$ALERT_FILE"
    fi
}

# ç½‘ç»œç›‘æ§
monitor_network() {
    echo "=== ç½‘ç»œç›‘æ§ $(timestamp) ===" >> "$LOG_FILE"
    
    # ç½‘ç»œè¿æ¥æ•°
    netstat -an | grep ESTABLISHED | wc -l >> "$LOG_FILE"
    
    # ç½‘ç»œæµé‡
    ifconfig wlan0 | grep bytes >> "$LOG_FILE"
}

# ä¸»å‡½æ•°
main() {
    monitor_resources
    monitor_services
    monitor_network
    
    # æ£€æŸ¥æ˜¯å¦éœ€è¦å‘é€è­¦å‘Š
    if [ -s "$ALERT_FILE" ]; then
        # å¯ä»¥æ·»åŠ å‘é€è­¦å‘Šçš„å‘½ä»¤ï¼ˆå¦‚é‚®ä»¶é€šçŸ¥ï¼‰
        cat "$ALERT_FILE"
    fi
}

# æ‰§è¡Œç›‘æ§
main
```
### 2. æ€§èƒ½åˆ†æå·¥å…·
```bash
# å®‰è£…æ€§èƒ½åˆ†æå·¥å…·
sudo apt install sysstat iotop htop

# åˆ›å»ºæ€§èƒ½æ•°æ®æ”¶é›†è„šæœ¬
nano ~/collect_performance.sh
```

## åå…­ã€æ€§èƒ½æ•°æ®æ”¶é›†ä¸åˆ†æ
### 1. æ€§èƒ½æ•°æ®æ”¶é›†è„šæœ¬
```bash
#!/bin/bash
# ~/collect_performance.sh

PERF_DIR="/home/zhaoxiongzhou/performance_data"
DATE=$(date +%Y%m%d_%H%M%S)

# åˆ›å»ºæ•°æ®ç›®å½•
mkdir -p "$PERF_DIR/$DATE"

# CPU æ€§èƒ½æ•°æ®
mpstat 1 60 > "$PERF_DIR/$DATE/cpu_stats.log" &

# å†…å­˜ä½¿ç”¨æ•°æ®
vmstat 1 60 > "$PERF_DIR/$DATE/memory_stats.log" &

# IO æ€§èƒ½æ•°æ®
iostat -x 1 60 > "$PERF_DIR/$DATE/io_stats.log" &

# ç½‘ç»œæ€§èƒ½æ•°æ®
sar -n DEV 1 60 > "$PERF_DIR/$DATE/network_stats.log" &

# è¿›ç¨‹æ€§èƒ½æ•°æ®
ps aux --sort=-%cpu | head -n 20 > "$PERF_DIR/$DATE/top_processes.log"

# ç³»ç»Ÿè´Ÿè½½æ•°æ®
uptime > "$PERF_DIR/$DATE/load_average.log"

# ç­‰å¾…æ‰€æœ‰åå°è¿›ç¨‹å®Œæˆ
wait

# å‹ç¼©æ•°æ®
tar -czf "$PERF_DIR/performance_${DATE}.tar.gz" "$PERF_DIR/$DATE"
rm -rf "$PERF_DIR/$DATE"
```
### 2. æ€§èƒ½æ•°æ®åˆ†æè„šæœ¬
```bash
# åˆ›å»ºåˆ†æè„šæœ¬
nano ~/analyze_performance.sh
```
```bash
#!/bin/bash
# ~/analyze_performance.sh

PERF_DIR="/home/zhaoxiongzhou/performance_data"
REPORT_DIR="/home/zhaoxiongzhou/performance_reports"
DATE=$(date +%Y%m%d)

mkdir -p "$REPORT_DIR"

generate_report() {
    local REPORT_FILE="$REPORT_DIR/report_${DATE}.txt"
    echo "æ€§èƒ½åˆ†ææŠ¥å‘Š - $(date)" > "$REPORT_FILE"
    echo "===================" >> "$REPORT_FILE"

    # CPU ä½¿ç”¨åˆ†æ
    echo -e "\nCPU ä½¿ç”¨æƒ…å†µ:" >> "$REPORT_FILE"
    awk '/all/ {total += $3; count++} END {print "å¹³å‡CPUä½¿ç”¨ç‡: " total/count "%"}' \
        "$PERF_DIR/latest/cpu_stats.log" >> "$REPORT_FILE"

    # å†…å­˜ä½¿ç”¨åˆ†æ
    echo -e "\nå†…å­˜ä½¿ç”¨æƒ…å†µ:" >> "$REPORT_FILE"
    free -h | grep "Mem:" >> "$REPORT_FILE"

    # IO æ€§èƒ½åˆ†æ
    echo -e "\nIO æ€§èƒ½:" >> "$REPORT_FILE"
    tail -n 10 "$PERF_DIR/latest/io_stats.log" >> "$REPORT_FILE"

    # ç½‘ç»œæ€§èƒ½åˆ†æ
    echo -e "\nç½‘ç»œæ€§èƒ½:" >> "$REPORT_FILE"
    tail -n 10 "$PERF_DIR/latest/network_stats.log" >> "$REPORT_FILE"

    # è¿›ç¨‹åˆ†æ
    echo -e "\nèµ„æºå ç”¨æœ€é«˜çš„è¿›ç¨‹:" >> "$REPORT_FILE"
    head -n 5 "$PERF_DIR/latest/top_processes.log" >> "$REPORT_FILE"

    echo -e "\nåˆ†æå®Œæˆã€‚æŠ¥å‘Šä¿å­˜åœ¨: $REPORT_FILE"
}

# ç”ŸæˆæŠ¥å‘Š
generate_report
```
## åä¸ƒã€è‡ªåŠ¨åŒ–è¿ç»´è„šæœ¬
### 1. æœåŠ¡å¥åº·æ£€æŸ¥ä¸è‡ªåŠ¨æ¢å¤
```bash
# åˆ›å»ºæœåŠ¡ç›‘æ§è„šæœ¬
nano ~/service_health_check.sh
```
```bash
#!/bin/bash
# ~/service_health_check.sh

LOG_FILE="/var/log/service_health.log"
ALERT_SCRIPT="/home/zhaoxiongzhou/send_alert.sh"

log_message() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" >> "$LOG_FILE"
}

check_and_restart_service() {
    local service_name="$1"
    local process_pattern="$2"
    
    if ! pgrep -f "$process_pattern" > /dev/null; then
        log_message "è­¦å‘Š: $service_name æœåŠ¡æœªè¿è¡Œï¼Œå°è¯•é‡å¯"
        
        case "$service_name" in
            "nginx")
                sudo systemctl restart nginx
                ;;
            "llama-server")
                cd ~/projects/llama.cpp
                ./start-llama.sh
                ;;
        esac
        
        # ç­‰å¾…æœåŠ¡å¯åŠ¨
        sleep 10
        
        # éªŒè¯æœåŠ¡æ˜¯å¦æˆåŠŸé‡å¯
        if pgrep -f "$process_pattern" > /dev/null; then
            log_message "$service_name æœåŠ¡å·²æˆåŠŸé‡å¯"
            "$ALERT_SCRIPT" "$service_name æœåŠ¡å·²è‡ªåŠ¨é‡å¯"
        else
            log_message "é”™è¯¯: $service_name æœåŠ¡é‡å¯å¤±è´¥"
            "$ALERT_SCRIPT" "è­¦å‘Š: $service_name æœåŠ¡é‡å¯å¤±è´¥ï¼Œéœ€è¦æ‰‹åŠ¨å¹²é¢„"
        fi
    else
        log_message "$service_name æœåŠ¡è¿è¡Œæ­£å¸¸"
    fi
}

# æ£€æŸ¥å„ä¸ªæœåŠ¡
check_and_restart_service "nginx" "nginx"
check_and_restart_service "llama-server" "llama-server"

# æ¸…ç†æ—§æ—¥å¿—
find "$LOG_FILE" -mtime +30 -delete
```
### 2. è‡ªåŠ¨å¤‡ä»½ä¸æ¸…ç†
```bash
# åˆ›å»ºè‡ªåŠ¨ç»´æŠ¤è„šæœ¬
nano ~/auto_maintenance.sh
```
```bash
#!/bin/bash
# ~/auto_maintenance.sh

BACKUP_DIR="/home/zhaoxiongzhou/backups"
LOG_DIR="/var/log"
DATE=$(date +%Y%m%d)

# åˆ›å»ºå¤‡ä»½
create_backups() {
    # åšå®¢å¤‡ä»½
    tar -czf "$BACKUP_DIR/blog_$DATE.tar.gz" ~/myblog/content
    
    # AI æœåŠ¡é…ç½®å¤‡ä»½
    tar -czf "$BACKUP_DIR/llama_config_$DATE.tar.gz" ~/projects/llama.cpp/start-llama.sh
    
    # Nginx é…ç½®å¤‡ä»½
    sudo tar -czf "$BACKUP_DIR/nginx_config_$DATE.tar.gz" /etc/nginx/sites-available/
}

# æ¸…ç†æ—§æ–‡ä»¶
cleanup_old_files() {
    # åˆ é™¤30å¤©å‰çš„å¤‡ä»½
    find "$BACKUP_DIR" -name "*.tar.gz" -mtime +30 -delete
    
    # æ¸…ç†æ—¥å¿—
    sudo find "$LOG_DIR" -name "*.log" -mtime +30 -delete
    sudo find "$LOG_DIR" -name "*.gz" -mtime +30 -delete
    
    # æ¸…ç†ç³»ç»Ÿä¸´æ—¶æ–‡ä»¶
    sudo rm -rf /tmp/*
    sudo rm -rf /var/tmp/*
}

# ä¸»å‡½æ•°
main() {
    create_backups
    cleanup_old_files
    
    # å‹ç¼©æ—¥å¿—
    sudo logrotate -f /etc/logrotate.conf
    
    # æ¸…ç†åŒ…ç¼“å­˜
    sudo apt clean
    sudo apt autoremove -y
}

# æ‰§è¡Œç»´æŠ¤ä»»åŠ¡
main
```
## åå…«ã€æ—¥å¿—ç®¡ç†ç³»ç»Ÿ
### 1. é›†ä¸­å¼æ—¥å¿—é…ç½®
```bash
# åˆ›å»ºæ—¥å¿—ç®¡ç†è„šæœ¬
nano ~/log_management.sh
```
```bash
#!/bin/bash
# ~/log_management.sh

LOG_BASE="/var/log/services"
ARCHIVE_DIR="/home/zhaoxiongzhou/log_archives"
DATE=$(date +%Y%m%d)

# åˆ›å»ºæ—¥å¿—ç›®å½•
mkdir -p "$LOG_BASE"/{nginx,ai_service,system}
mkdir -p "$ARCHIVE_DIR"

# é…ç½®æ—¥å¿—è½®è½¬
sudo tee /etc/logrotate.d/custom_services << EOF
$LOG_BASE/nginx/*.log {
    daily
    missingok
    rotate 14
    compress
    delaycompress
    notifempty
    create 0640 www-data adm
    sharedscripts
    postrotate
        [ -f /var/run/nginx.pid ] && kill -USR1 \$(cat /var/run/nginx.pid)
    endscript
}

$LOG_BASE/ai_service/*.log {
    daily
    missingok
    rotate 14
    compress
    delaycompress
    notifempty
    create 0640 zhaoxiongzhou adm
}

$LOG_BASE/system/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 0640 root adm
}
EOF

# æ—¥å¿—åˆ†æå‡½æ•°
analyze_logs() {
    local log_file="$1"
    local output_file="$2"
    
    echo "=== æ—¥å¿—åˆ†ææŠ¥å‘Š $(date) ===" > "$output_file"
    
    # é”™è¯¯ç»Ÿè®¡
    echo -e "\né”™è¯¯ç»Ÿè®¡:" >> "$output_file"
    grep -i "error" "$log_file" | sort | uniq -c | sort -nr >> "$output_file"
    
    # è­¦å‘Šç»Ÿè®¡
    echo -e "\nè­¦å‘Šç»Ÿè®¡:" >> "$output_file"
    grep -i "warning" "$log_file" | sort | uniq -c | sort -nr >> "$output_file"
    
    # è®¿é—®ç»Ÿè®¡ï¼ˆé’ˆå¯¹ Nginx è®¿é—®æ—¥å¿—ï¼‰
    if [[ "$log_file" == *"nginx/access"* ]]; then
        echo -e "\nè®¿é—®é‡ç»Ÿè®¡:" >> "$output_file"
        awk '{print $1}' "$log_file" | sort | uniq -c | sort -nr | head -n 10 >> "$output_file"
    fi
}

# æ—¥å¿—å½’æ¡£å‡½æ•°
archive_logs() {
    local source_dir="$1"
    local archive_name="logs_${DATE}.tar.gz"
    
    find "$source_dir" -name "*.log.*" -mtime +14 -exec tar -czf "$ARCHIVE_DIR/$archive_name" {} +
    find "$source_dir" -name "*.log.*" -mtime +14 -delete
}
```
### 2. æ—¥å¿—ç›‘æ§å‘Šè­¦
```bash
# åˆ›å»ºæ—¥å¿—ç›‘æ§è„šæœ¬
nano ~/log_monitor.sh
```
```bash
#!/bin/bash
# ~/log_monitor.sh

ALERT_THRESHOLD=10  # é”™è¯¯é˜ˆå€¼
ALERT_SCRIPT="/home/zhaoxiongzhou/send_alert.sh"

# ç›‘æ§ç‰¹å®šå…³é”®è¯
monitor_keywords() {
    local log_file="$1"
    local keywords=("error" "critical" "failed" "timeout" "exception")
    
    for keyword in "${keywords[@]}"; do
        count=$(grep -i "$keyword" "$log_file" | wc -l)
        
        if [ "$count" -gt "$ALERT_THRESHOLD" ]; then
            "$ALERT_SCRIPT" "è­¦å‘Š: $log_file ä¸­å‘ç°å¤§é‡ $keyword ($count æ¬¡)"
        fi
    done
}

# ç›‘æ§æ—¥å¿—å¤§å°
check_log_size() {
    local log_file="$1"
    local max_size=$((100 * 1024 * 1024))  # 100MB
    
    size=$(stat -f%z "$log_file")
    
    if [ "$size" -gt "$max_size" ]; then
        "$ALERT_SCRIPT" "è­¦å‘Š: $log_file å¤§å°è¶…è¿‡ 100MB"
    fi
}

# ä¸»ç›‘æ§å¾ªç¯
main() {
    while true; do
        for log_file in "$LOG_BASE"/**/*.log; do
            monitor_keywords "$log_file"
            check_log_size "$log_file"
        done
        sleep 300  # æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
    done
}

main &
```
## åä¹ã€ç³»ç»Ÿä¼˜åŒ–ä¸è°ƒä¼˜
### 1. ç³»ç»Ÿå‚æ•°ä¼˜åŒ–
```bash
# åˆ›å»ºç³»ç»Ÿä¼˜åŒ–è„šæœ¬
nano ~/system_optimize.sh
```
```bash
#!/bin/bash
# ~/system_optimize.sh

# ç³»ç»Ÿå‚æ•°ä¼˜åŒ–
optimize_sysctl() {
    sudo tee /etc/sysctl.d/99-custom.conf << EOF
# å†…å­˜ç®¡ç†ä¼˜åŒ–
vm.swappiness = 60
vm.vfs_cache_pressure = 50
vm.dirty_background_ratio = 5
vm.dirty_ratio = 10

# ç½‘ç»œä¼˜åŒ–
net.core.somaxconn = 1024
net.core.netdev_max_backlog = 5000
net.ipv4.tcp_max_syn_backlog = 2048
net.ipv4.tcp_fin_timeout = 20
net.ipv4.tcp_keepalive_time = 1200
net.ipv4.tcp_keepalive_intvl = 15
net.ipv4.tcp_keepalive_probes = 5

# æ–‡ä»¶ç³»ç»Ÿä¼˜åŒ–
fs.file-max = 65535
fs.inotify.max_user_watches = 524288
EOF

    # åº”ç”¨æ–°çš„ç³»ç»Ÿå‚æ•°
    sudo sysctl -p /etc/sysctl.d/99-custom.conf
}

# CPU é¢‘ç‡ä¼˜åŒ–
optimize_cpu() {
    sudo tee /boot/config.txt << EOF
# CPU è®¾ç½®
arm_freq=1800
over_voltage=6
gpu_freq=500

# æ¸©åº¦æ§åˆ¶
temp_limit=75
EOF
}

# æœåŠ¡ä¼˜åŒ–
optimize_services() {
    # ç¦ç”¨ä¸å¿…è¦çš„æœåŠ¡
    UNNECESSARY_SERVICES=(
        "bluetooth"
        "cups"
        "avahi-daemon"
    )
    
    for service in "${UNNECESSARY_SERVICES[@]}"; do
        if systemctl is-enabled "$service" &>/dev/null; then
            sudo systemctl disable "$service"
            sudo systemctl stop "$service"
        fi
    done
}

# å†…å­˜ä¼˜åŒ–
optimize_memory() {
    # è°ƒæ•´ ZRAM
    sudo tee /etc/default/zramswap << EOF
ALGO=lz4
PERCENT=50
EOF

    # é‡å¯ ZRAM æœåŠ¡
    sudo systemctl restart zramswap
}
```
### 2. æœåŠ¡ä¼˜åŒ–é…ç½®
```bash
# Nginx ä¼˜åŒ–é…ç½®
sudo nano /etc/nginx/nginx.conf
```
```toml
user www-data;
worker_processes auto;
worker_rlimit_nofile 65535;

events {
    worker_connections 1024;
    multi_accept on;
    use epoll;
}

http {
    # åŸºç¡€è®¾ç½®
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
    types_hash_max_size 2048;
    server_tokens off;

    # MIME ç±»å‹
    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    # æ—¥å¿—æ ¼å¼
    log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                    '$status $body_bytes_sent "$http_referer" '
                    '"$http_user_agent" "$http_x_forwarded_for"';

    # ç¼“å†²åŒºè®¾ç½®
    client_body_buffer_size 10K;
    client_header_buffer_size 1k;
    client_max_body_size 8m;
    large_client_header_buffers 2 1k;

    # è¶…æ—¶è®¾ç½®
    client_body_timeout 12;
    client_header_timeout 12;
    send_timeout 10;

    # ç¼“å­˜è®¾ç½®
    open_file_cache max=1000 inactive=20s;
    open_file_cache_valid 30s;
    open_file_cache_min_uses 2;
    open_file_cache_errors on;

    # Gzip å‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_proxied any;
    gzip_comp_level 6;
    gzip_types text/plain text/css text/xml application/json application/javascript application/xml+rss application/atom+xml image/svg+xml;
}
```
## äºŒåã€æœåŠ¡ç›‘æ§é¢æ¿é…ç½®
### 1. Grafana ç›‘æ§ç³»ç»Ÿé…ç½®
```bash
# å®‰è£… Grafana
sudo apt-get install -y apt-transport-https
sudo apt-get install -y software-properties-common wget
wget -q -O - https://packages.grafana.com/gpg.key | sudo apt-key add -
echo "deb https://packages.grafana.com/oss/deb stable main" | sudo tee -a /etc/apt/sources.list.d/grafana.list
sudo apt-get update
sudo apt-get install -y grafana
```
```bash
# é…ç½® Grafana
sudo nano /etc/grafana/grafana.ini
```
```toml
[server]
http_addr = 0.0.0.0
http_port = 3000

[security]
admin_user = admin
admin_password = your_secure_password

[auth.anonymous]
enabled = false

[paths]
data = /var/lib/grafana
logs = /var/log/grafana
plugins = /var/lib/grafana/plugins

[dashboards]
versions_to_keep = 20
```
### 2. Prometheus é…ç½®
```bash
# å®‰è£… Prometheus
sudo apt-get install -y prometheus

# é…ç½® Prometheus
sudo nano /etc/prometheus/prometheus.yml
```
```yml
global:
  scrape_interval: 15s
  evaluation_interval: 15s

scrape_configs:
  - job_name: 'node'
    static_configs:
      - targets: ['localhost:9100']
    
  - job_name: 'nginx'
    static_configs:
      - targets: ['localhost:9113']
    
  - job_name: 'system'
    static_configs:
      - targets: ['localhost:9090']

  - job_name: 'process'
    static_configs:
      - targets: ['localhost:9256']
```
### 3. Node Exporter é…ç½®
```bash
# å®‰è£… Node Exporter
sudo apt-get install -y prometheus-node-exporter

# åˆ›å»ºè‡ªå®šä¹‰æŒ‡æ ‡æ”¶é›†è„šæœ¬
nano ~/custom_metrics.sh
```
```bash
#!/bin/bash
# ~/custom_metrics.sh

# åˆ›å»ºæŒ‡æ ‡æ–‡ä»¶
METRICS_FILE="/var/lib/node_exporter/custom_metrics.prom"

while true; do
    # CPU æ¸©åº¦
    CPU_TEMP=$(vcgencmd measure_temp | sed 's/temp=//' | sed 's/'"'"'C//')
    echo "raspberry_pi_cpu_temperature $CPU_TEMP" > "$METRICS_FILE"

    # AI æœåŠ¡çŠ¶æ€
    if pgrep -f llama-server > /dev/null; then
        echo "ai_service_status 1" >> "$METRICS_FILE"
    else
        echo "ai_service_status 0" >> "$METRICS_FILE"
    fi

    # åšå®¢æœåŠ¡çŠ¶æ€
    if systemctl is-active nginx > /dev/null; then
        echo "blog_service_status 1" >> "$METRICS_FILE"
    else
        echo "blog_service_status 0" >> "$METRICS_FILE"
    fi

    # å†…å­˜ä½¿ç”¨
    FREE_MEM=$(free | grep Mem | awk '{print $4}')
    echo "system_free_memory_bytes $FREE_MEM" >> "$METRICS_FILE"

    sleep 15
done
```
## äºŒåä¸€ã€è‡ªåŠ¨åŒ–éƒ¨ç½²ä¸æ›´æ–°
### 1. è‡ªåŠ¨éƒ¨ç½²é…ç½®è„šæœ¬
```bash
# åˆ›å»ºè‡ªåŠ¨éƒ¨ç½²è„šæœ¬
nano ~/auto_deploy.sh
```
```bash
#!/bin/bash
# ~/auto_deploy.sh

# é…ç½®
BLOG_DIR="/home/zhaoxiongzhou/myblog"
LLAMA_DIR="/home/zhaoxiongzhou/projects/llama.cpp"
BACKUP_DIR="/home/zhaoxiongzhou/backups"
LOG_FILE="/var/log/auto_deploy.log"

# æ—¥å¿—å‡½æ•°
log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" >> "$LOG_FILE"
}

# å¤‡ä»½å½“å‰ç‰ˆæœ¬
backup_current() {
    log "å¼€å§‹å¤‡ä»½å½“å‰ç‰ˆæœ¬"
    
    # åšå®¢å¤‡ä»½
    tar -czf "$BACKUP_DIR/blog_$(date +%Y%m%d_%H%M%S).tar.gz" "$BLOG_DIR"
    
    # AI æœåŠ¡å¤‡ä»½
    tar -czf "$BACKUP_DIR/llama_$(date +%Y%m%d_%H%M%S).tar.gz" "$LLAMA_DIR"
    
    log "å¤‡ä»½å®Œæˆ"
}

# æ›´æ–°åšå®¢
update_blog() {
    log "å¼€å§‹æ›´æ–°åšå®¢"
    
    cd "$BLOG_DIR" || exit 1
    
    # æ‹‰å–æœ€æ–°ä»£ç 
    if git pull origin master; then
        # æ›´æ–°ä¸»é¢˜
        git submodule update --remote themes/ananke
        
        # æ„å»ºç«™ç‚¹
        hugo --minify
        
        # æ›´æ–°æƒé™
        sudo chown -R www-data:www-data public/
        
        # é‡å¯ Nginx
        sudo systemctl restart nginx
        
        log "åšå®¢æ›´æ–°æˆåŠŸ"
    else
        log "é”™è¯¯: åšå®¢æ›´æ–°å¤±è´¥"
        return 1
    fi
}

# æ›´æ–° AI æœåŠ¡
update_ai_service() {
    log "å¼€å§‹æ›´æ–° AI æœåŠ¡"
    
    cd "$LLAMA_DIR" || exit 1
    
    # åœæ­¢å½“å‰æœåŠ¡
    pkill llama-server
    
    # æ‹‰å–æœ€æ–°ä»£ç 
    if git pull origin master; then
        # é‡æ–°ç¼–è¯‘
        make clean
        if LLAMA_METAL=1 make -j4; then
            # å¯åŠ¨æœåŠ¡
            ./start-llama.sh
            
            # éªŒè¯æœåŠ¡
            sleep 5
            if pgrep -f llama-server > /dev/null; then
                log "AI æœåŠ¡æ›´æ–°æˆåŠŸ"
            else
                log "é”™è¯¯: AI æœåŠ¡å¯åŠ¨å¤±è´¥"
                return 1
            fi
        else
            log "é”™è¯¯: AI æœåŠ¡ç¼–è¯‘å¤±è´¥"
            return 1
        fi
    else
        log "é”™è¯¯: AI æœåŠ¡ä»£ç æ›´æ–°å¤±è´¥"
        return 1
    fi
}

# ä¸»å‡½æ•°
main() {
    log "å¼€å§‹è‡ªåŠ¨éƒ¨ç½²æµç¨‹"
    
    # åˆ›å»ºå¤‡ä»½
    backup_current
    
    # æ›´æ–°æœåŠ¡
    if update_blog && update_ai_service; then
        log "éƒ¨ç½²å®Œæˆ"
        return 0
    else
        log "éƒ¨ç½²å¤±è´¥"
        return 1
    fi
}

# æ‰§è¡Œéƒ¨ç½²
main
```
### 2. è‡ªåŠ¨æ›´æ–°æ£€æŸ¥è„šæœ¬
```bash
# åˆ›å»ºæ›´æ–°æ£€æŸ¥è„šæœ¬
nano ~/check_updates.sh
```
## äºŒåä¸€ã€è‡ªåŠ¨æ›´æ–°æ£€æŸ¥ä¸é€šçŸ¥ç³»ç»Ÿ
### 1. æ›´æ–°æ£€æŸ¥è„šæœ¬
```bash
#!/bin/bash
# ~/check_updates.sh

# é…ç½®
NOTIFY_SCRIPT="/home/zhaoxiongzhou/send_notification.sh"
LOG_FILE="/var/log/update_check.log"
GITHUB_API="https://api.github.com"
LLAMA_REPO="ggerganov/llama.cpp"
HUGO_REPO="gohugoio/hugo"

# æ—¥å¿—å‡½æ•°
log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$LOG_FILE"
}

# æ£€æŸ¥ GitHub ä»“åº“æ›´æ–°
check_github_updates() {
    local repo="$1"
    local current_version="$2"
    
    # è·å–æœ€æ–°ç‰ˆæœ¬
    latest_version=$(curl -s "$GITHUB_API/repos/$repo/releases/latest" | grep -Po '"tag_name": "\K.*?(?=")')
    
    if [ "$latest_version" != "$current_version" ]; then
        log "å‘ç°æ–°ç‰ˆæœ¬: $repo ($current_version -> $latest_version)"
        return 0
    else
        log "å½“å‰ç‰ˆæœ¬å·²æ˜¯æœ€æ–°: $repo ($current_version)"
        return 1
    fi
}

# æ£€æŸ¥ç³»ç»Ÿæ›´æ–°
check_system_updates() {
    sudo apt update > /dev/null 2>&1
    updates=$(sudo apt list --upgradable 2>/dev/null | grep -c "upgradable")
    
    if [ "$updates" -gt 0 ]; then
        log "å‘ç° $updates ä¸ªç³»ç»Ÿæ›´æ–°"
        return 0
    else
        log "ç³»ç»Ÿå·²æ˜¯æœ€æ–°"
        return 1
    fi
}

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
check_services() {
    local services=("nginx" "llama-server")
    local status=0
    
    for service in "${services[@]}"; do
        if [ "$service" = "nginx" ]; then
            if ! systemctl is-active --quiet nginx; then
                log "è­¦å‘Š: Nginx æœåŠ¡æœªè¿è¡Œ"
                status=1
            fi
        elif [ "$service" = "llama-server" ]; then
            if ! pgrep -f llama-server > /dev/null; then
                log "è­¦å‘Š: AI æœåŠ¡æœªè¿è¡Œ"
                status=1
            fi
        fi
    done
    
    return $status
}

# å‘é€é€šçŸ¥
send_notification() {
    local message="$1"
    local priority="$2"
    
    if [ -x "$NOTIFY_SCRIPT" ]; then
        "$NOTIFY_SCRIPT" "$message" "$priority"
    else
        log "é€šçŸ¥è„šæœ¬ä¸å­˜åœ¨æˆ–ä¸å¯æ‰§è¡Œ"
    fi
}

# ä¸»å‡½æ•°
main() {
    log "å¼€å§‹æ£€æŸ¥æ›´æ–°"
    
    # è·å–å½“å‰ç‰ˆæœ¬
    current_llama_version=$(cd ~/projects/llama.cpp && git describe --tags)
    current_hugo_version=$(hugo version | grep -Po "v\d+\.\d+\.\d+")
    
    # æ£€æŸ¥æ›´æ–°
    updates_found=0
    
    if check_github_updates "$LLAMA_REPO" "$current_llama_version"; then
        send_notification "llama.cpp æœ‰æ–°ç‰ˆæœ¬å¯ç”¨" "normal"
        updates_found=1
    fi
    
    if check_github_updates "$HUGO_REPO" "$current_hugo_version"; then
        send_notification "Hugo æœ‰æ–°ç‰ˆæœ¬å¯ç”¨" "normal"
        updates_found=1
    fi
    
    if check_system_updates; then
        send_notification "ç³»ç»Ÿæœ‰æ›´æ–°å¯ç”¨" "normal"
        updates_found=1
    fi
    
    if ! check_services; then
        send_notification "æœåŠ¡çŠ¶æ€å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥" "high"
    fi
    
    if [ "$updates_found" -eq 0 ]; then
        log "æ‰€æœ‰ç»„ä»¶å‡ä¸ºæœ€æ–°ç‰ˆæœ¬"
    fi
}

# æ‰§è¡Œæ£€æŸ¥
main
```
## äºŒåäºŒã€é€šçŸ¥ç³»ç»Ÿé…ç½®
### 1. é€šçŸ¥å‘é€è„šæœ¬
```bash
# åˆ›å»ºé€šçŸ¥å‘é€è„šæœ¬
nano ~/send_notification.sh
```
```bash
#!/bin/bash
# ~/send_notification.sh

# é…ç½®
TELEGRAM_BOT_TOKEN="your_bot_token"
TELEGRAM_CHAT_ID="your_chat_id"
EMAIL_ADDRESS="your_email@domain.com"
DISCORD_WEBHOOK_URL="your_discord_webhook_url"

# æ—¥å¿—é…ç½®
LOG_FILE="/var/log/notifications.log"

# æ—¥å¿—å‡½æ•°
log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" >> "$LOG_FILE"
}

# Telegram é€šçŸ¥
send_telegram() {
    local message="$1"
    local priority="$2"
    
    # æ ¹æ®ä¼˜å…ˆçº§æ·»åŠ è¡¨æƒ…ç¬¦å·
    case "$priority" in
        "high")
            message="ğŸš¨ ç´§æ€¥: $message"
            ;;
        "normal")
            message="â„¹ï¸ é€šçŸ¥: $message"
            ;;
        "low")
            message="ğŸ“ ä¿¡æ¯: $message"
            ;;
    esac
    
    # å‘é€æ¶ˆæ¯
    curl -s -X POST \
        "https://api.telegram.org/bot$TELEGRAM_BOT_TOKEN/sendMessage" \
        -d "chat_id=$TELEGRAM_CHAT_ID" \
        -d "text=$message" \
        -d "parse_mode=HTML"
    
    log "Telegram é€šçŸ¥å·²å‘é€: $message"
}

# é‚®ä»¶é€šçŸ¥
send_email() {
    local message="$1"
    local priority="$2"
    local subject
    
    case "$priority" in
        "high")
            subject="[ç´§æ€¥] æ ‘è“æ´¾æœåŠ¡è­¦å‘Š"
            ;;
        "normal")
            subject="[é€šçŸ¥] æ ‘è“æ´¾æœåŠ¡æ›´æ–°"
            ;;
        "low")
            subject="[ä¿¡æ¯] æ ‘è“æ´¾æœåŠ¡çŠ¶æ€"
            ;;
    esac
    
    echo "$message" | mail -s "$subject" "$EMAIL_ADDRESS"
    log "é‚®ä»¶é€šçŸ¥å·²å‘é€: $subject - $message"
}

# Discord é€šçŸ¥
send_discord() {
    local message="$1"
    local priority="$2"
    local color
    
    case "$priority" in
        "high")
            color="16711680"  # çº¢è‰²
            ;;
        "normal")
            color="65280"     # ç»¿è‰²
            ;;
        "low")
            color="255"       # è“è‰²
            ;;
    esac
    
    curl -H "Content-Type: application/json" \
        -X POST \
        -d "{\"embeds\": [{\"description\": \"$message\", \"color\": $color}]}" \
        "$DISCORD_WEBHOOK_URL"
    
    log "Discord é€šçŸ¥å·²å‘é€: $message"
}

# ä¸»å‡½æ•°
main() {
    local message="$1"
    local priority="${2:-normal}"  # é»˜è®¤ä¼˜å…ˆçº§ä¸º normal
    
    # æ£€æŸ¥å¿…è¦å‚æ•°
    if [ -z "$message" ]; then
        log "é”™è¯¯: æ¶ˆæ¯å†…å®¹ä¸èƒ½ä¸ºç©º"
        return 1
    fi
    
    # æ·»åŠ ç³»ç»Ÿä¿¡æ¯
    local hostname=$(hostname)
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    message="[$hostname] [$timestamp] $message"
    
    # å‘é€æ‰€æœ‰é€šçŸ¥
    send_telegram "$message" "$priority"
    send_email "$message" "$priority"
    send_discord "$message" "$priority"
    
    log "æ‰€æœ‰é€šçŸ¥æ¸ é“å¤„ç†å®Œæˆ"
}

# æ‰§è¡Œé€šçŸ¥å‘é€
main "$@"
```
## äºŒåä¸‰ã€å®šæ—¶ä»»åŠ¡é…ç½®
### 1. Crontab é…ç½®
```bash
# ç¼–è¾‘ crontab
crontab -e
```
```bash
# ç³»ç»Ÿç»´æŠ¤ä»»åŠ¡
# æ¯å¤©å‡Œæ™¨ 2 ç‚¹æ‰§è¡Œç³»ç»Ÿæ›´æ–°æ£€æŸ¥
0 2 * * * ~/check_updates.sh > /dev/null 2>&1

# æ¯ 6 å°æ—¶æ‰§è¡Œä¸€æ¬¡æœåŠ¡å¥åº·æ£€æŸ¥
0 */6 * * * ~/service_health_check.sh > /dev/null 2>&1

# æ¯å‘¨æ—¥å‡Œæ™¨ 3 ç‚¹æ‰§è¡Œç³»ç»Ÿä¼˜åŒ–
0 3 * * 0 ~/system_optimize.sh > /dev/null 2>&1

# æ¯å¤©å‡Œæ™¨ 4 ç‚¹æ‰§è¡Œæ—¥å¿—ç®¡ç†
0 4 * * * ~/log_management.sh > /dev/null 2>&1

# æ¯å°æ—¶æ‰§è¡Œæ€§èƒ½æ•°æ®æ”¶é›†
0 * * * * ~/collect_performance.sh > /dev/null 2>&1

# æ¯ 5 åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡å…³é”®æœåŠ¡çŠ¶æ€
*/5 * * * * ~/monitor.sh > /dev/null 2>&1

# æ¯å¤©æ™šä¸Š 11 ç‚¹æ‰§è¡Œå¤‡ä»½
0 23 * * * ~/auto_backup.sh > /dev/null 2>&1

# æ¯æœˆ 1 å·æ‰§è¡Œå®Œæ•´ç³»ç»Ÿæ£€æŸ¥
0 1 1 * * ~/full_system_check.sh > /dev/null 2>&1
```
### 2. å®Œæ•´ç³»ç»Ÿæ£€æŸ¥è„šæœ¬
```bash
# åˆ›å»ºå®Œæ•´ç³»ç»Ÿæ£€æŸ¥è„šæœ¬
nano ~/full_system_check.sh
```
```bash
#!/bin/bash
# ~/full_system_check.sh

LOG_FILE="/var/log/system_check.log"
REPORT_FILE="/home/zhaoxiongzhou/reports/monthly_report_$(date +%Y%m).txt"

# ç¡®ä¿ç›®å½•å­˜åœ¨
mkdir -p "$(dirname "$REPORT_FILE")"

# æ—¥å¿—å‡½æ•°
log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$LOG_FILE" "$REPORT_FILE"
}

# ç³»ç»Ÿä¿¡æ¯æ£€æŸ¥
check_system_info() {
    log "=== ç³»ç»Ÿä¿¡æ¯ ==="
    log "ç³»ç»Ÿç‰ˆæœ¬: $(cat /etc/os-release | grep PRETTY_NAME)"
    log "å†…æ ¸ç‰ˆæœ¬: $(uname -r)"
    log "è¿è¡Œæ—¶é—´: $(uptime -p)"
    log "æœ€åå¯åŠ¨: $(who -b | awk '{print $3,$4}')"
}

# èµ„æºä½¿ç”¨æ£€æŸ¥
check_resources() {
    log "=== èµ„æºä½¿ç”¨æƒ…å†µ ==="
    log "CPU ä½¿ç”¨ç‡: $(top -bn1 | grep "Cpu(s)" | awk '{print $2}')%"
    log "å†…å­˜ä½¿ç”¨æƒ…å†µ:"
    free -h | tee -a "$REPORT_FILE"
    log "ç£ç›˜ä½¿ç”¨æƒ…å†µ:"
    df -h | tee -a "$REPORT_FILE"
}

# æœåŠ¡çŠ¶æ€æ£€æŸ¥
check_services() {
    log "=== æœåŠ¡çŠ¶æ€ ==="
    
    # æ£€æŸ¥ Nginx
    if systemctl is-active --quiet nginx; then
        log "Nginx: è¿è¡Œæ­£å¸¸"
    else
        log "Nginx: æœªè¿è¡Œ"
    fi
    
    # æ£€æŸ¥ AI æœåŠ¡
    if pgrep -f llama-server > /dev/null; then
        log "AI æœåŠ¡: è¿è¡Œæ­£å¸¸"
    else
        log "AI æœåŠ¡: æœªè¿è¡Œ"
    fi
}

# å®‰å…¨æ£€æŸ¥
check_security() {
    log "=== å®‰å…¨æ£€æŸ¥ ==="
    
    # æ£€æŸ¥å¤±è´¥çš„ç™»å½•å°è¯•
    log "å¤±è´¥çš„ç™»å½•å°è¯•:"
    grep "Failed password" /var/log/auth.log | tail -n 5 | tee -a "$REPORT_FILE"
    
    # æ£€æŸ¥å¼€æ”¾çš„ç«¯å£
    log "å¼€æ”¾çš„ç«¯å£:"
    netstat -tuln | grep LISTEN | tee -a "$REPORT_FILE"
}

# æ€§èƒ½åˆ†æ
analyze_performance() {
    log "=== æ€§èƒ½åˆ†æ ==="
    
    # åˆ†æ CPU ä½¿ç”¨æƒ…å†µ
    log "CPU å¯†é›†è¿›ç¨‹:"
    ps aux --sort=-%cpu | head -n 5 | tee -a "$REPORT_FILE"
    
    # åˆ†æå†…å­˜ä½¿ç”¨æƒ…å†µ
    log "å†…å­˜å¯†é›†è¿›ç¨‹:"
    ps aux --sort=-%mem | head -n 5 | tee -a "$REPORT_FILE"
}

# ä¸»å‡½æ•°
main() {
    log "å¼€å§‹æœˆåº¦ç³»ç»Ÿæ£€æŸ¥ - $(date)"
    
    check_system_info
    check_resources
    check_services
    check_security
    analyze_performance
    
    log "ç³»ç»Ÿæ£€æŸ¥å®Œæˆ"
    
    # å‘é€æŠ¥å‘Š
    if [ -f "$REPORT_FILE" ]; then
        ~/send_notification.sh "æœˆåº¦ç³»ç»Ÿæ£€æŸ¥æŠ¥å‘Šå·²ç”Ÿæˆ" "normal"
    fi
}

# æ‰§è¡Œæ£€æŸ¥
main
```
## äºŒåå››ã€ç¾éš¾æ¢å¤è®¡åˆ’
### 1. ç³»ç»Ÿæ¢å¤è„šæœ¬
```bash
# åˆ›å»ºç³»ç»Ÿæ¢å¤è„šæœ¬
nano ~/disaster_recovery.sh
```
```bash
#!/bin/bash
# ~/disaster_recovery.sh

# é…ç½®
BACKUP_DIR="/home/zhaoxiongzhou/backups"
RECOVERY_LOG="/var/log/recovery.log"
SERVICES=("nginx" "llama-server")

# æ—¥å¿—å‡½æ•°
log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$RECOVERY_LOG"
}

# éªŒè¯å¤‡ä»½
verify_backup() {
    local backup_file="$1"
    
    if [ ! -f "$backup_file" ]; then
        log "é”™è¯¯: å¤‡ä»½æ–‡ä»¶ä¸å­˜åœ¨ - $backup_file"
        return 1
    fi
    
    # æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§
    if ! tar -tzf "$backup_file" >/dev/null 2>&1; then
        log "é”™è¯¯: å¤‡ä»½æ–‡ä»¶æŸå - $backup_file"
        return 1
    fi
    
    return 0
}

# åœæ­¢æœåŠ¡
stop_services() {
    log "åœæ­¢æ‰€æœ‰æœåŠ¡..."
    
    for service in "${SERVICES[@]}"; do
        if [ "$service" = "nginx" ]; then
            sudo systemctl stop nginx
        else
            pkill "$service"
        fi
    done
    
    # ç­‰å¾…æœåŠ¡å®Œå…¨åœæ­¢
    sleep 5
}

# æ¢å¤åšå®¢æœåŠ¡
restore_blog() {
    local backup_file="$BACKUP_DIR/blog_latest.tar.gz"
    
    if verify_backup "$backup_file"; then
        log "å¼€å§‹æ¢å¤åšå®¢æœåŠ¡..."
        
        # æ¸…ç†å½“å‰ç›®å½•
        rm -rf ~/myblog/*
        
        # è§£å‹å¤‡ä»½
        tar -xzf "$backup_file" -C ~/myblog/
        
        # é‡å»ºç«™ç‚¹
        cd ~/myblog
        hugo --minify
        
        # æ¢å¤æƒé™
        sudo chown -R www-data:www-data public/
        
        log "åšå®¢æœåŠ¡æ¢å¤å®Œæˆ"
    else
        log "åšå®¢æœåŠ¡æ¢å¤å¤±è´¥"
        return 1
    fi
}

# æ¢å¤ AI æœåŠ¡
restore_ai_service() {
    local backup_file="$BACKUP_DIR/llama_latest.tar.gz"
    
    if verify_backup "$backup_file"; then
        log "å¼€å§‹æ¢å¤ AI æœåŠ¡..."
        
        # æ¸…ç†å½“å‰ç›®å½•
        rm -rf ~/projects/llama.cpp/*
        
        # è§£å‹å¤‡ä»½
        tar -xzf "$backup_file" -C ~/projects/llama.cpp/
        
        # é‡æ–°ç¼–è¯‘
        cd ~/projects/llama.cpp
        make clean
        LLAMA_METAL=1 make -j4
        
        log "AI æœåŠ¡æ¢å¤å®Œæˆ"
    else
        log "AI æœåŠ¡æ¢å¤å¤±è´¥"
        return 1
    fi
}

# æ¢å¤ç³»ç»Ÿé…ç½®
restore_system_config() {
    local backup_file="$BACKUP_DIR/system_config_latest.tar.gz"
    
    if verify_backup "$backup_file"; then
        log "å¼€å§‹æ¢å¤ç³»ç»Ÿé…ç½®..."
        
        # è§£å‹ç³»ç»Ÿé…ç½®
        sudo tar -xzf "$backup_file" -C /
        
        # é‡æ–°åŠ è½½ç³»ç»Ÿé…ç½®
        sudo sysctl --system
        
        log "ç³»ç»Ÿé…ç½®æ¢å¤å®Œæˆ"
    else
        log "ç³»ç»Ÿé…ç½®æ¢å¤å¤±è´¥"
        return 1
    fi
}

# å¯åŠ¨æœåŠ¡
start_services() {
    log "å¯åŠ¨æ‰€æœ‰æœåŠ¡..."
    
    # å¯åŠ¨ Nginx
    sudo systemctl start nginx
    
    # å¯åŠ¨ AI æœåŠ¡
    ~/projects/llama.cpp/start-llama.sh
    
    # éªŒè¯æœåŠ¡çŠ¶æ€
    sleep 10
    verify_services
}

# éªŒè¯æœåŠ¡
verify_services() {
    local status=0
    
    log "éªŒè¯æœåŠ¡çŠ¶æ€..."
    
    # æ£€æŸ¥ Nginx
    if ! systemctl is-active --quiet nginx; then
        log "è­¦å‘Š: Nginx æœåŠ¡æœªæ­£å¸¸è¿è¡Œ"
        status=1
    fi
    
    # æ£€æŸ¥ AI æœåŠ¡
    if ! pgrep -f llama-server > /dev/null; then
        log "è­¦å‘Š: AI æœåŠ¡æœªæ­£å¸¸è¿è¡Œ"
        status=1
    fi
    
    return $status
}

# ä¸»å‡½æ•°
main() {
    log "å¼€å§‹ç³»ç»Ÿæ¢å¤æµç¨‹..."
    
    # åœæ­¢æœåŠ¡
    stop_services
    
    # æ‰§è¡Œæ¢å¤
    if restore_system_config && restore_blog && restore_ai_service; then
        # å¯åŠ¨æœåŠ¡
        start_services
        
        if verify_services; then
            log "ç³»ç»Ÿæ¢å¤æˆåŠŸå®Œæˆ"
            ~/send_notification.sh "ç³»ç»Ÿæ¢å¤æˆåŠŸå®Œæˆ" "normal"
            return 0
        else
            log "ç³»ç»Ÿæ¢å¤å®Œæˆï¼Œä½†éƒ¨åˆ†æœåŠ¡å¯èƒ½æœªæ­£å¸¸è¿è¡Œ"
            ~/send_notification.sh "ç³»ç»Ÿæ¢å¤å®Œæˆï¼Œä½†éœ€è¦æ‰‹åŠ¨æ£€æŸ¥æœåŠ¡çŠ¶æ€" "high"
            return 1
        fi
    else
        log "ç³»ç»Ÿæ¢å¤å¤±è´¥"
        ~/send_notification.sh "ç³»ç»Ÿæ¢å¤å¤±è´¥ï¼Œéœ€è¦æ‰‹åŠ¨å¹²é¢„" "high"
        return 1
    fi
}

# æ‰§è¡Œæ¢å¤
main
```
## äºŒåäº”ã€æ–‡æ¡£ç®¡ç†ç³»ç»Ÿ
### 1. æ–‡æ¡£ç”Ÿæˆè„šæœ¬
```bash
# åˆ›å»ºæ–‡æ¡£ç”Ÿæˆè„šæœ¬
nano ~/generate_docs.sh
```
```bash
#!/bin/bash
# ~/generate_docs.sh

# é…ç½®
DOCS_DIR="/home/zhaoxiongzhou/documentation"
SCRIPTS_DIR="/home/zhaoxiongzhou"
CONFIG_DIR="/etc"
LOG_FILE="/var/log/documentation.log"

# ç¡®ä¿ç›®å½•å­˜åœ¨
mkdir -p "$DOCS_DIR"/{scripts,configs,logs,maintenance}

# æ—¥å¿—å‡½æ•°
log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$LOG_FILE"
}

# ç”Ÿæˆè„šæœ¬æ–‡æ¡£
generate_script_docs() {
    log "ç”Ÿæˆè„šæœ¬æ–‡æ¡£..."
    
    for script in "$SCRIPTS_DIR"/*.sh; do
        if [ -f "$script" ]; then
            script_name=$(basename "$script")
            output_file="$DOCS_DIR/scripts/${script_name%.sh}.md"
            
            {
                echo "# $script_name"
                echo "## è·¯å¾„: $script"
                echo "## æœ€åä¿®æ”¹: $(date -r "$script" '+%Y-%m-%d %H:%M:%S')"
                echo "## æƒé™: $(stat -c '%a' "$script")"
                echo "## æ‰€æœ‰è€…: $(stat -c '%U:%G' "$script")"
                echo
                echo "## åŠŸèƒ½æè¿°"
                grep -A 5 "^#.*åŠŸèƒ½:" "$script" 2>/dev/null || echo "æœªæä¾›åŠŸèƒ½æè¿°"
                echo
                echo "## è„šæœ¬å†…å®¹"
                echo '```bash'
                cat "$script"
                echo '```'
                echo
                echo "## ä¾èµ–é¡¹"
                grep "^[^#]*apt.*install" "$script" 2>/dev/null || echo "æœªæ‰¾åˆ°æ˜ç¡®çš„ä¾èµ–é¡¹"
                echo
                echo "## å®šæ—¶ä»»åŠ¡"
                crontab -l 2>/dev/null | grep "$script_name" || echo "æœªé…ç½®å®šæ—¶ä»»åŠ¡"
            } > "$output_file"
        fi
    done
}

# ç”Ÿæˆé…ç½®æ–‡æ¡£
generate_config_docs() {
    log "ç”Ÿæˆé…ç½®æ–‡æ¡£..."
    
    # Nginx é…ç½®
    {
        echo "# Nginx é…ç½®æ–‡æ¡£"
        echo "## ä¸»é…ç½®æ–‡ä»¶"
        echo '```nginx'
        cat /etc/nginx/nginx.conf
        echo '```'
        
        echo "## ç«™ç‚¹é…ç½®"
        echo '```nginx'
        cat /etc/nginx/sites-available/myblog
        echo '```'
    } > "$DOCS_DIR/configs/nginx_config.md"
    
    # ç³»ç»Ÿé…ç½®
    {
        echo "# ç³»ç»Ÿé…ç½®æ–‡æ¡£"
        echo "## Sysctl é…ç½®"
        echo '```bash'
        cat /etc/sysctl.d/99-custom.conf
        echo '```'
        
        echo "## æ ‘è“æ´¾é…ç½®"
        echo '```bash'
        cat /boot/config.txt
        echo '```'
    } > "$DOCS_DIR/configs/system_config.md"
}

# ç”Ÿæˆç»´æŠ¤æ–‡æ¡£
generate_maintenance_docs() {
    log "ç”Ÿæˆç»´æŠ¤æ–‡æ¡£..."
    
    {
        echo "# ç³»ç»Ÿç»´æŠ¤æ–‡æ¡£"
        echo "## å®šæ—¶ä»»åŠ¡"
        echo '```bash'
        crontab -l
        echo '```'
        
        echo "## æœåŠ¡çŠ¶æ€"
        echo '```bash'
        systemctl status nginx
        ps aux | grep llama-server
        echo '```'
        
        echo "## èµ„æºä½¿ç”¨"
        echo '```bash'
        df -h
        free -h
        top -bn1
        echo '```'
        
        echo "## æœ€è¿‘æ—¥å¿—"
        echo '```bash'
        tail -n 50 /var/log/syslog
        echo '```'
    } > "$DOCS_DIR/maintenance/system_status.md"
}

# ç”Ÿæˆç´¢å¼•
generate_index() {
    log "ç”Ÿæˆæ–‡æ¡£ç´¢å¼•..."
    
    {
        echo "# ç³»ç»Ÿæ–‡æ¡£ç´¢å¼•"
        echo "## ç”Ÿæˆæ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
        echo
        echo "## è„šæœ¬æ–‡æ¡£"
        for doc in "$DOCS_DIR/scripts"/*.md; do
            echo "- [$(basename "${doc%.md}")](scripts/$(basename "$doc"))"
        done
        echo
        echo "## é…ç½®æ–‡æ¡£"
        for doc in "$DOCS_DIR/configs"/*.md; do
            echo "- [$(basename "${doc%.md}")](configs/$(basename "$doc"))"
        done
        echo
        echo "## ç»´æŠ¤æ–‡æ¡£"
        for doc in "$DOCS_DIR/maintenance"/*.md; do
            echo "- [$(basename "${doc%.md}")](maintenance/$(basename "$doc"))"
        done
    } > "$DOCS_DIR/index.md"
}

# ä¸»å‡½æ•°
main() {
    log "å¼€å§‹ç”Ÿæˆæ–‡æ¡£..."
    
    generate_script_docs
    generate_config_docs
    generate_maintenance_docs
    generate_index
    
    log "æ–‡æ¡£ç”Ÿæˆå®Œæˆ: $DOCS_DIR"
}

# æ‰§è¡Œæ–‡æ¡£ç”Ÿæˆ
main
```
## äºŒåå…­ã€æ€§èƒ½æµ‹è¯•ä¸åŸºå‡†æµ‹è¯•
### 1. æ€§èƒ½æµ‹è¯•è„šæœ¬
```bash
# åˆ›å»ºæ€§èƒ½æµ‹è¯•è„šæœ¬
nano ~/benchmark.sh
```
```bash
#!/bin/bash
# ~/benchmark.sh

# é…ç½®
RESULTS_DIR="/home/zhaoxiongzhou/benchmark_results"
LOG_FILE="/var/log/benchmark.log"
DURATION=300  # æµ‹è¯•æŒç»­æ—¶é—´ï¼ˆç§’ï¼‰
CONCURRENT_USERS=10  # å¹¶å‘ç”¨æˆ·æ•°

# ç¡®ä¿ç›®å½•å­˜åœ¨
mkdir -p "$RESULTS_DIR"

# æ—¥å¿—å‡½æ•°
log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$LOG_FILE"
}

# CPU æ€§èƒ½æµ‹è¯•
benchmark_cpu() {
    log "å¼€å§‹ CPU æ€§èƒ½æµ‹è¯•..."
    
    # ä½¿ç”¨ sysbench è¿›è¡Œ CPU æµ‹è¯•
    sysbench cpu --cpu-max-prime=20000 --threads=4 run > "$RESULTS_DIR/cpu_benchmark.txt"
    
    # è®°å½• CPU æ¸©åº¦
    for i in $(seq 1 10); do
        vcgencmd measure_temp >> "$RESULTS_DIR/cpu_temp.txt"
        sleep 1
    done
}

# å†…å­˜æ€§èƒ½æµ‹è¯•
benchmark_memory() {
    log "å¼€å§‹å†…å­˜æ€§èƒ½æµ‹è¯•..."
    
    # ä½¿ç”¨ sysbench è¿›è¡Œå†…å­˜æµ‹è¯•
    sysbench memory --memory-block-size=1K --memory-total-size=10G run > "$RESULTS_DIR/memory_benchmark.txt"
}

# ç£ç›˜æ€§èƒ½æµ‹è¯•
benchmark_disk() {
    log "å¼€å§‹ç£ç›˜æ€§èƒ½æµ‹è¯•..."
    
    # ä½¿ç”¨ dd æµ‹è¯•å†™å…¥é€Ÿåº¦
    dd if=/dev/zero of=/tmp/test_file bs=1M count=1000 conv=fdatasync 2>> "$RESULTS_DIR/disk_write_benchmark.txt"
    
    # ä½¿ç”¨ dd æµ‹è¯•è¯»å–é€Ÿåº¦
    dd if=/tmp/test_file of=/dev/null bs=1M count=1000 2>> "$RESULTS_DIR/disk_read_benchmark.txt"
    
    # æ¸…ç†æµ‹è¯•æ–‡ä»¶
    rm /tmp/test_file
}

# ç½‘ç»œæ€§èƒ½æµ‹è¯•
benchmark_network() {
    log "å¼€å§‹ç½‘ç»œæ€§èƒ½æµ‹è¯•..."
    
    # ä½¿ç”¨ iperf3 æµ‹è¯•ç½‘ç»œæ€§èƒ½
    iperf3 -c iperf.he.net -t 30 > "$RESULTS_DIR/network_benchmark.txt"
}

# Web æœåŠ¡æ€§èƒ½æµ‹è¯•
benchmark_web() {
    log "å¼€å§‹ Web æœåŠ¡æ€§èƒ½æµ‹è¯•..."
    
    # ä½¿ç”¨ ab æµ‹è¯• Web æœåŠ¡
    ab -n 1000 -c "$CONCURRENT_USERS" http://localhost/ > "$RESULTS_DIR/web_benchmark.txt"
}

# AI æœåŠ¡æ€§èƒ½æµ‹è¯•
benchmark_ai() {
    log "å¼€å§‹ AI æœåŠ¡æ€§èƒ½æµ‹è¯•..."
    
    # åˆ›å»ºæµ‹è¯•è¯·æ±‚
    cat > /tmp/test_prompt.txt << EOF
Hello, how are you?
EOF
    
    # ä½¿ç”¨ curl æµ‹è¯• AI æœåŠ¡å“åº”æ—¶é—´
    for i in $(seq 1 10); do
        time curl -X POST \
             -H "Content-Type: application/json" \
             -d @/tmp/test_prompt.txt \
             http://localhost:8080/completion >> "$RESULTS_DIR/ai_benchmark.txt" 2>&1
        echo -e "\n---\n" >> "$RESULTS_DIR/ai_benchmark.txt"
        sleep 2
    done
}

# ç”ŸæˆæŠ¥å‘Š
generate_report() {
    log "ç”Ÿæˆæ€§èƒ½æµ‹è¯•æŠ¥å‘Š..."
    
    local report_file="$RESULTS_DIR/benchmark_report_$(date +%Y%m%d_%H%M%S).md"
    
    {
        echo "# æ€§èƒ½æµ‹è¯•æŠ¥å‘Š"
        echo "## æµ‹è¯•æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
        echo
        echo "## ç³»ç»Ÿä¿¡æ¯"
        echo '```'
        uname -a
        echo '```'
        echo
        echo "## CPU æ€§èƒ½"
        echo '```'
        cat "$RESULTS_DIR/cpu_benchmark.txt"
        echo '```'
        echo
        echo "## å†…å­˜æ€§èƒ½"
        echo '```'
        cat "$RESULTS_DIR/memory_benchmark.txt"
        echo '```'
        echo
        echo "## ç£ç›˜æ€§èƒ½"
        echo '```'
        cat "$RESULTS_DIR/disk_write_benchmark.txt"
        cat "$RESULTS_DIR/disk_read_benchmark.txt"
        echo '```'
        echo
        echo "## ç½‘ç»œæ€§èƒ½"
        echo '```'
        cat "$RESULTS_DIR/network_benchmark.txt"
        echo '```'
        echo
        echo "## Web æœåŠ¡æ€§èƒ½"
        echo '```'
        cat "$RESULTS_DIR/web_benchmark.txt"
        echo '```'
        echo
        echo "## AI æœåŠ¡æ€§èƒ½"
        echo '```'
        cat "$RESULTS_DIR/ai_benchmark.txt"
        echo '```'
    } > "$report_file"
    
    log "æ€§èƒ½æµ‹è¯•æŠ¥å‘Šå·²ç”Ÿæˆ: $report_file"
}

# ä¸»å‡½æ•°
main() {
    log "å¼€å§‹æ€§èƒ½æµ‹è¯•..."
    
    # å®‰è£…å¿…è¦çš„å·¥å…·
    sudo apt install -y sysbench apache2-utils iperf3
    
    # æ‰§è¡Œå„é¡¹æµ‹è¯•
    benchmark_cpu
    benchmark_memory
    benchmark_disk
    benchmark_network
    benchmark_web
    benchmark_ai
    
    # ç”ŸæˆæŠ¥å‘Š
    generate_report
    
    log "æ€§èƒ½æµ‹è¯•å®Œæˆ"
}

# æ‰§è¡Œæµ‹è¯•
main
```
## äºŒåä¸ƒã€å®‰å…¨å®¡è®¡ç³»ç»Ÿ
### 1. å®‰å…¨å®¡è®¡è„šæœ¬
```bash
# åˆ›å»ºå®‰å…¨å®¡è®¡è„šæœ¬
nano ~/security_audit.sh
```
```bash
#!/bin/bash
# ~/security_audit.sh

# é…ç½®
AUDIT_DIR="/home/zhaoxiongzhou/security_audits"
REPORT_FILE="$AUDIT_DIR/security_report_$(date +%Y%m%d_%H%M%S).md"
LOG_FILE="/var/log/security_audit.log"

# ç¡®ä¿ç›®å½•å­˜åœ¨
mkdir -p "$AUDIT_DIR"

# æ—¥å¿—å‡½æ•°
log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$LOG_FILE"
}

# æ£€æŸ¥ç³»ç»Ÿç”¨æˆ·
audit_users() {
    log "æ£€æŸ¥ç³»ç»Ÿç”¨æˆ·..."
    {
        echo "## ç³»ç»Ÿç”¨æˆ·å®¡è®¡"
        echo "### ç‰¹æƒç”¨æˆ·"
        echo '```'
        awk -F: '$3 == 0 {print $1}' /etc/passwd
        echo '```'
        
        echo "### æœ€è¿‘çš„ç”¨æˆ·æ´»åŠ¨"
        echo '```'
        last | head -n 10
        echo '```'
        
        echo "### å¤±è´¥çš„ç™»å½•å°è¯•"
        echo '```'
        grep "Failed password" /var/log/auth.log | tail -n 10
        echo '```'
    } >> "$REPORT_FILE"
}

# æ£€æŸ¥ç½‘ç»œå®‰å…¨
audit_network() {
    log "æ£€æŸ¥ç½‘ç»œå®‰å…¨..."
    {
        echo "## ç½‘ç»œå®‰å…¨å®¡è®¡"
        echo "### å¼€æ”¾ç«¯å£"
        echo '```'
        netstat -tuln
        echo '```'
        
        echo "### æ´»åŠ¨è¿æ¥"
        echo '```'
        netstat -nat | grep ESTABLISHED
        echo '```'
        
        echo "### é˜²ç«å¢™è§„åˆ™"
        echo '```'
        sudo iptables -L -n
        echo '```'
    } >> "$REPORT_FILE"
}

# æ£€æŸ¥æ–‡ä»¶æƒé™
audit_permissions() {
    log "æ£€æŸ¥æ–‡ä»¶æƒé™..."
    {
        echo "## æ–‡ä»¶æƒé™å®¡è®¡"
        echo "### SUID æ–‡ä»¶"
        echo '```'
        sudo find / -type f -perm -4000 2>/dev/null
        echo '```'
        
        echo "### ä¸–ç•Œå¯å†™æ–‡ä»¶"
        echo '```'
        sudo find / -type f -perm -2 ! -path "/proc/*" ! -path "/sys/*" 2>/dev/null
        echo '```'
        
        echo "### æ•æ„Ÿç›®å½•æƒé™"
        echo '```'
        ls -la /etc/nginx/
        ls -la ~/projects/llama.cpp/
        ls -la ~/myblog/
        echo '```'
    } >> "$REPORT_FILE"
}

# æ£€æŸ¥æœåŠ¡é…ç½®
audit_services() {
    log "æ£€æŸ¥æœåŠ¡é…ç½®..."
    {
        echo "## æœåŠ¡é…ç½®å®¡è®¡"
        echo "### Nginx é…ç½®æ£€æŸ¥"
        echo '```'
        sudo nginx -t 2>&1
        echo '```'
        
        echo "### SSL é…ç½®"
        echo '```'
        openssl s_client -connect localhost:443 -servername localhost </dev/null 2>/dev/null | openssl x509 -text
        echo '```'
        
        echo "### æœåŠ¡çŠ¶æ€"
        echo '```'
        systemctl list-units --type=service --state=active
        echo '```'
    } >> "$REPORT_FILE"
}

# æ£€æŸ¥ç³»ç»Ÿæ›´æ–°
audit_updates() {
    log "æ£€æŸ¥ç³»ç»Ÿæ›´æ–°..."
    {
        echo "## ç³»ç»Ÿæ›´æ–°å®¡è®¡"
        echo "### å¯ç”¨æ›´æ–°"
        echo '```'
        apt list --upgradable 2>/dev/null
        echo '```'
        
        echo "### å·²å®‰è£…åŒ…"
        echo '```'
        dpkg -l | grep "^ii" | wc -l
        echo '```'
    } >> "$REPORT_FILE"
}

# æ£€æŸ¥æ—¥å¿—å¼‚å¸¸
audit_logs() {
    log "æ£€æŸ¥æ—¥å¿—å¼‚å¸¸..."
    {
        echo "## æ—¥å¿—å®¡è®¡"
        echo "### ç³»ç»Ÿé”™è¯¯"
        echo '```'
        sudo journalctl -p 3 -xb --no-pager | tail -n 20
        echo '```'
        
        echo "### å¼‚å¸¸è®¿é—®"
        echo '```'
        grep -i "error\|failed\|warning" /var/log/nginx/error.log | tail -n 20
        echo '```'
    } >> "$REPORT_FILE"
}

# ç”Ÿæˆå®‰å…¨å»ºè®®
generate_recommendations() {
    log "ç”Ÿæˆå®‰å…¨å»ºè®®..."
    {
        echo "## å®‰å…¨å»ºè®®"
        echo "### é«˜ä¼˜å…ˆçº§"
        # æ£€æŸ¥å¹¶ç”Ÿæˆå»ºè®®
        if grep -q "Failed password" /var/log/auth.log; then
            echo "- å»ºè®®ï¼šå¯ç”¨ fail2ban åŠ å¼º SSH é˜²æŠ¤"
        fi
        if [ $(find / -type f -perm -2 2>/dev/null | wc -l) -gt 0 ]; then
            echo "- å»ºè®®ï¼šæ£€æŸ¥å¹¶ä¿®å¤ä¸–ç•Œå¯å†™æ–‡ä»¶æƒé™"
        fi
        
        echo "### ä¸­ä¼˜å…ˆçº§"
        # æ·»åŠ å…¶ä»–å»ºè®®
        echo "- å®šæœŸæ›´æ–°ç³»ç»ŸåŒ…"
        echo "- æ£€æŸ¥å¹¶æ›´æ–° SSL è¯ä¹¦"
        echo "- å®šæœŸå®¡æŸ¥ç”¨æˆ·æƒé™"
    } >> "$REPORT_FILE"
}

# ä¸»å‡½æ•°
main() {
    log "å¼€å§‹å®‰å…¨å®¡è®¡..."
    
    # åˆ›å»ºæŠ¥å‘Šå¤´éƒ¨
    {
        echo "# å®‰å…¨å®¡è®¡æŠ¥å‘Š"
        echo "## ç”Ÿæˆæ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
        echo "## ç³»ç»Ÿä¿¡æ¯"
        echo '```'
        uname -a
        echo '```'
        echo
    } > "$REPORT_FILE"
    
    # æ‰§è¡Œå„é¡¹å®¡è®¡
    audit_users
    audit_network
    audit_permissions
    audit_services
    audit_updates
    audit_logs
    generate_recommendations
    
    log "å®‰å…¨å®¡è®¡å®Œæˆï¼ŒæŠ¥å‘Šå·²ç”Ÿæˆ: $REPORT_FILE"
    
    # å‘é€é€šçŸ¥
    ~/send_notification.sh "å®‰å…¨å®¡è®¡æŠ¥å‘Šå·²ç”Ÿæˆ" "normal"
}

# æ‰§è¡Œå®¡è®¡
main
```
## äºŒåå…«ã€èµ„æºé™åˆ¶ä¸æ§åˆ¶
### 1. èµ„æºé™åˆ¶é…ç½®è„šæœ¬
```bash
# åˆ›å»ºèµ„æºé™åˆ¶é…ç½®è„šæœ¬
nano ~/resource_control.sh
```
```bash
#!/bin/bash
# ~/resource_control.sh

# é…ç½®
LOG_FILE="/var/log/resource_control.log"
LIMITS_CONF="/etc/security/limits.conf"
SYSTEMD_DIR="/etc/systemd/system"

# æ—¥å¿—å‡½æ•°
log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$LOG_FILE"
}

# é…ç½®ç³»ç»Ÿèµ„æºé™åˆ¶
configure_system_limits() {
    log "é…ç½®ç³»ç»Ÿèµ„æºé™åˆ¶..."
    
    # å¤‡ä»½åŸå§‹é…ç½®
    sudo cp "$LIMITS_CONF" "${LIMITS_CONF}.backup"
    
    # æ·»åŠ èµ„æºé™åˆ¶é…ç½®
    sudo tee -a "$LIMITS_CONF" << EOF
# ç”¨æˆ·èµ„æºé™åˆ¶
zhaoxiongzhou soft nofile 65535
zhaoxiongzhou hard nofile 65535
zhaoxiongzhou soft nproc 2048
zhaoxiongzhou hard nproc 4096

# ç³»ç»ŸæœåŠ¡èµ„æºé™åˆ¶
www-data soft nofile 65535
www-data hard nofile 65535
www-data soft nproc 1024
www-data hard nproc 2048
EOF
}

# é…ç½® AI æœåŠ¡èµ„æºé™åˆ¶
configure_ai_service() {
    log "é…ç½® AI æœåŠ¡èµ„æºé™åˆ¶..."
    
    # åˆ›å»º systemd æœåŠ¡æ–‡ä»¶
    sudo tee "$SYSTEMD_DIR/llama-server.service" << EOF
[Unit]
Description=Llama AI Server
After=network.target

[Service]
User=zhaoxiongzhou
Group=zhaoxiongzhou
WorkingDirectory=/home/zhaoxiongzhou/projects/llama.cpp
ExecStart=/home/zhaoxiongzhou/projects/llama.cpp/start-llama.sh

# èµ„æºé™åˆ¶
CPUQuota=80%
MemoryLimit=2G
TasksMax=128
LimitNOFILE=65535

# é‡å¯ç­–ç•¥
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

    # é‡æ–°åŠ è½½ systemd é…ç½®
    sudo systemctl daemon-reload
}

# é…ç½® Nginx èµ„æºé™åˆ¶
configure_nginx() {
    log "é…ç½® Nginx èµ„æºé™åˆ¶..."
    
    # ä¿®æ”¹ Nginx é…ç½®
    sudo tee "/etc/nginx/conf.d/resource_limits.conf" << EOF
# å·¥ä½œè¿›ç¨‹é™åˆ¶
worker_processes auto;
worker_rlimit_nofile 65535;

# è¿æ¥é™åˆ¶
events {
    worker_connections 1024;
    multi_accept on;
}

# å®¢æˆ·ç«¯é™åˆ¶
http {
    # è¯·æ±‚é™åˆ¶
    limit_req_zone \$binary_remote_addr zone=one:10m rate=10r/s;
    
    # è¿æ¥é™åˆ¶
    limit_conn_zone \$binary_remote_addr zone=addr:10m;
    
    server {
        # åº”ç”¨é™åˆ¶
        location / {
            limit_req zone=one burst=5;
            limit_conn addr 10;
        }
    }
}
EOF
}

# é…ç½®ç³»ç»Ÿèµ„æºç›‘æ§
configure_monitoring() {
    log "é…ç½®èµ„æºç›‘æ§..."
    
    # åˆ›å»ºç›‘æ§è„šæœ¬
    cat > ~/monitor_resources.sh << EOF
#!/bin/bash

while true; do
    # CPU ä½¿ç”¨ç‡
    CPU_USAGE=\$(top -bn1 | grep "Cpu(s)" | awk '{print \$2}')
    
    # å†…å­˜ä½¿ç”¨ç‡
    MEM_USAGE=\$(free | grep Mem | awk '{print \$3/\$2 * 100.0}')
    
    # è¿›ç¨‹æ•°
    PROCESS_COUNT=\$(ps aux | wc -l)
    
    # æ£€æŸ¥é™åˆ¶
    if (( \$(echo "\$CPU_USAGE > 80" | bc -l) )); then
        ~/send_notification.sh "è­¦å‘Š: CPU ä½¿ç”¨ç‡è¿‡é«˜ (\${CPU_USAGE}%)" "high"
    fi
    
    if (( \$(echo "\$MEM_USAGE > 90" | bc -l) )); then
        ~/send_notification.sh "è­¦å‘Š: å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜ (\${MEM_USAGE}%)" "high"
    fi
    
    if [ "\$PROCESS_COUNT" -gt 200 ]; then
        ~/send_notification.sh "è­¦å‘Š: è¿›ç¨‹æ•°è¿‡å¤š (\$PROCESS_COUNT)" "high"
    fi
    
    sleep 60
done
EOF

    chmod +x ~/monitor_resources.sh
}

# åº”ç”¨é…ç½®
apply_configurations() {
    log "åº”ç”¨èµ„æºé™åˆ¶é…ç½®..."
    
    # é‡å¯æœåŠ¡
    sudo systemctl restart nginx
    sudo systemctl restart llama-server
    
    # å¯åŠ¨ç›‘æ§
    ~/monitor_resources.sh &
    
    # éªŒè¯é…ç½®
    log "éªŒè¯é…ç½®..."
    sudo nginx -t
    sudo systemctl status llama-server
    ulimit -a
}

# ä¸»å‡½æ•°
main() {
    log "å¼€å§‹é…ç½®èµ„æºé™åˆ¶..."
    
    configure_system_limits
    configure_ai_service
    configure_nginx
    configure_monitoring
    apply_configurations
    
    log "èµ„æºé™åˆ¶é…ç½®å®Œæˆ"
}

# æ‰§è¡Œé…ç½®
main
```
## äºŒåä¹ã€è‡ªåŠ¨åŒ–æµ‹è¯•ç³»ç»Ÿ
### 1. é›†æˆæµ‹è¯•è„šæœ¬
```bash
# åˆ›å»ºé›†æˆæµ‹è¯•è„šæœ¬
nano ~/integration_test.sh
```
```bash
#!/bin/bash
# ~/integration_test.sh

# é…ç½®
TEST_DIR="/home/zhaoxiongzhou/tests"
REPORT_DIR="/home/zhaoxiongzhou/test_reports"
LOG_FILE="/var/log/integration_test.log"

# ç¡®ä¿ç›®å½•å­˜åœ¨
mkdir -p "$TEST_DIR" "$REPORT_DIR"

# æ—¥å¿—å‡½æ•°
log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$LOG_FILE"
}

# æµ‹è¯• Web æœåŠ¡
test_web_service() {
    log "æµ‹è¯• Web æœåŠ¡..."
    local result=0
    
    # æµ‹è¯•é¦–é¡µè®¿é—®
    if curl -s -o /dev/null -w "%{http_code}" http://localhost/ | grep -q "200"; then
        log "é¦–é¡µè®¿é—®æµ‹è¯•é€šè¿‡"
    else
        log "é”™è¯¯: é¦–é¡µè®¿é—®æµ‹è¯•å¤±è´¥"
        result=1
    fi
    
    # æµ‹è¯•é™æ€èµ„æº
    if curl -s -o /dev/null -w "%{http_code}" http://localhost/css/main.css | grep -q "200"; then
        log "é™æ€èµ„æºæµ‹è¯•é€šè¿‡"
    else
        log "é”™è¯¯: é™æ€èµ„æºæµ‹è¯•å¤±è´¥"
        result=1
    fi
    
    # æµ‹è¯• 404 é¡µé¢
    if curl -s -o /dev/null -w "%{http_code}" http://localhost/nonexistent | grep -q "404"; then
        log "404 é¡µé¢æµ‹è¯•é€šè¿‡"
    else
        log "é”™è¯¯: 404 é¡µé¢æµ‹è¯•å¤±è´¥"
        result=1
    fi
    
    return $result
}

# æµ‹è¯• AI æœåŠ¡
test_ai_service() {
    log "æµ‹è¯• AI æœåŠ¡..."
    local result=0
    
    # æµ‹è¯•æœåŠ¡å¯ç”¨æ€§
    if curl -s -o /dev/null -w "%{http_code}" http://localhost:8080/health | grep -q "200"; then
        log "AI æœåŠ¡å¥åº·æ£€æŸ¥é€šè¿‡"
    else
        log "é”™è¯¯: AI æœåŠ¡å¥åº·æ£€æŸ¥å¤±è´¥"
        result=1
    fi
    
    # æµ‹è¯•æ¨¡å‹å“åº”
    local response=$(curl -s -X POST \
        -H "Content-Type: application/json" \
        -d '{"prompt": "Hello", "max_tokens": 10}' \
        http://localhost:8080/completion)
    
    if echo "$response" | grep -q "text"; then
        log "AI æœåŠ¡å“åº”æµ‹è¯•é€šè¿‡"
    else
        log "é”™è¯¯: AI æœåŠ¡å“åº”æµ‹è¯•å¤±è´¥"
        result=1
    fi
    
    return $result
}

# æµ‹è¯•ç³»ç»ŸæœåŠ¡
test_system_services() {
    log "æµ‹è¯•ç³»ç»ŸæœåŠ¡..."
    local result=0
    
    # æµ‹è¯• Nginx çŠ¶æ€
    if systemctl is-active --quiet nginx; then
        log "Nginx æœåŠ¡æµ‹è¯•é€šè¿‡"
    else
        log "é”™è¯¯: Nginx æœåŠ¡æµ‹è¯•å¤±è´¥"
        result=1
    fi
    
    # æµ‹è¯•ç³»ç»Ÿèµ„æº
    local cpu_usage=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}')
    local mem_usage=$(free | grep Mem | awk '{print $3/$2 * 100.0}')
    
    if [ $(echo "$cpu_usage < 90" | bc -l) -eq 1 ]; then
        log "CPU ä½¿ç”¨ç‡æ­£å¸¸"
    else
        log "è­¦å‘Š: CPU ä½¿ç”¨ç‡è¿‡é«˜"
        result=1
    fi
    
    if [ $(echo "$mem_usage < 90" | bc -l) -eq 1 ]; then
        log "å†…å­˜ä½¿ç”¨ç‡æ­£å¸¸"
    else
        log "è­¦å‘Š: å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜"
        result=1
    fi
    
    return $result
}

# ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
generate_report() {
    local web_result=$1
    local ai_result=$2
    local system_result=$3
    local report_file="$REPORT_DIR/test_report_$(date +%Y%m%d_%H%M%S).md"
    
    {
        echo "# é›†æˆæµ‹è¯•æŠ¥å‘Š"
        echo "## æµ‹è¯•æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
        echo
        echo "## æµ‹è¯•ç»“æœæ‘˜è¦"
        echo "- Web æœåŠ¡: $([ $web_result -eq 0 ] && echo 'é€šè¿‡ âœ…' || echo 'å¤±è´¥ âŒ')"
        echo "- AI æœåŠ¡: $([ $ai_result -eq 0 ] && echo 'é€šè¿‡ âœ…' || echo 'å¤±è´¥ âŒ')"
        echo "- ç³»ç»ŸæœåŠ¡: $([ $system_result -eq 0 ] && echo 'é€šè¿‡ âœ…' || echo 'å¤±è´¥ âŒ')"
        echo
        echo "## è¯¦ç»†æ—¥å¿—"
        echo '```'
        tail -n 50 "$LOG_FILE"
        echo '```'
    } > "$report_file"
    
    log "æµ‹è¯•æŠ¥å‘Šå·²ç”Ÿæˆ: $report_file"
}

# ä¸»å‡½æ•°
main() {
    log "å¼€å§‹é›†æˆæµ‹è¯•..."
    
    local web_result=0
    local ai_result=0
    local system_result=0
    
    # æ‰§è¡Œæµ‹è¯•
    test_web_service
    web_result=$?
    
    test_ai_service
    ai_result=$?
    
    test_system_services
    system_result=$?
    
    # ç”ŸæˆæŠ¥å‘Š
    generate_report $web_result $ai_result $system_result
    
    # å‘é€é€šçŸ¥
    if [ $web_result -eq 0 ] && [ $ai_result -eq 0 ] && [ $system_result -eq 0 ]; then
        ~/send_notification.sh "é›†æˆæµ‹è¯•å…¨éƒ¨é€šè¿‡" "normal"
    else
        ~/send_notification.sh "é›†æˆæµ‹è¯•å­˜åœ¨å¤±è´¥é¡¹ï¼Œè¯·æŸ¥çœ‹æŠ¥å‘Š" "high"
    fi
    
    # è¿”å›æ€»ä½“ç»“æœ
    return $(( web_result + ai_result + system_result ))
}

# æ‰§è¡Œæµ‹è¯•
main
```
## ä¸‰åã€ç³»ç»ŸçŠ¶æ€ä»ªè¡¨æ¿
### 1. çŠ¶æ€ç›‘æ§é¡µé¢ç”Ÿæˆè„šæœ¬
```bash
# åˆ›å»ºçŠ¶æ€é¡µé¢ç”Ÿæˆè„šæœ¬
nano ~/generate_dashboard.sh
```
```bash
#!/bin/bash
# ~/generate_dashboard.sh

# é…ç½®
DASHBOARD_DIR="/var/www/html/dashboard"
REFRESH_INTERVAL=60  # é¡µé¢åˆ·æ–°é—´éš”ï¼ˆç§’ï¼‰
LOG_FILE="/var/log/dashboard.log"

# ç¡®ä¿ç›®å½•å­˜åœ¨
sudo mkdir -p "$DASHBOARD_DIR"

# æ—¥å¿—å‡½æ•°
log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$LOG_FILE"
}

# æ”¶é›†ç³»ç»ŸçŠ¶æ€æ•°æ®
collect_system_data() {
    # CPU ä¿¡æ¯
    CPU_USAGE=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}')
    CPU_TEMP=$(vcgencmd measure_temp | sed 's/temp=//' | sed 's/'"'"'C//')
    
    # å†…å­˜ä¿¡æ¯
    MEM_TOTAL=$(free -m | awk '/Mem:/ {print $2}')
    MEM_USED=$(free -m | awk '/Mem:/ {print $3}')
    MEM_USAGE=$(awk "BEGIN {printf \"%.2f\", $MEM_USED/$MEM_TOTAL*100}")
    
    # ç£ç›˜ä¿¡æ¯
    DISK_USAGE=$(df -h / | awk 'NR==2 {print $5}' | sed 's/%//')
    
    # ç³»ç»Ÿè´Ÿè½½
    LOAD_AVG=$(uptime | awk -F'load average:' '{print $2}' | xargs)
    
    # è¿è¡Œæ—¶é—´
    UPTIME=$(uptime -p)
}

# æ”¶é›†æœåŠ¡çŠ¶æ€
collect_service_data() {
    # Nginx çŠ¶æ€
    if systemctl is-active --quiet nginx; then
        NGINX_STATUS="è¿è¡Œä¸­ âœ…"
    else
        NGINX_STATUS="å·²åœæ­¢ âŒ"
    fi
    
    # AI æœåŠ¡çŠ¶æ€
    if pgrep -f llama-server > /dev/null; then
        AI_STATUS="è¿è¡Œä¸­ âœ…"
    else
        AI_STATUS="å·²åœæ­¢ âŒ"
    fi
    
    # è·å–æœ€è¿‘çš„æ—¥å¿—
    RECENT_LOGS=$(tail -n 10 /var/log/syslog | sed 's/</\&lt;/g' | sed 's/>/\&gt;/g')
}

# ç”ŸæˆçŠ¶æ€é¡µé¢
generate_dashboard() {
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    
    cat > "$DASHBOARD_DIR/index.html" << EOF
<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³»ç»ŸçŠ¶æ€ä»ªè¡¨æ¿</title>
    <meta http-equiv="refresh" content="$REFRESH_INTERVAL">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        .metric {
            text-align: center;
            padding: 15px;
            border-radius: 4px;
            background: #f8f9fa;
        }
        .metric h3 {
            margin: 0;
            color: #666;
        }
        .metric .value {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
        }
        .status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        .logs {
            background: #2b2b2b;
            color: #fff;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ç³»ç»ŸçŠ¶æ€ä»ªè¡¨æ¿</h1>
        <p>æœ€åæ›´æ–°: $timestamp</p>
        
        <div class="card">
            <h2>ç³»ç»Ÿèµ„æº</h2>
            <div class="grid">
                <div class="metric">
                    <h3>CPU ä½¿ç”¨ç‡</h3>
                    <div class="value">$CPU_USAGE%</div>
                </div>
                <div class="metric">
                    <h3>CPU æ¸©åº¦</h3>
                    <div class="value">$CPU_TEMP</div>
                </div>
                <div class="metric">
                    <h3>å†…å­˜ä½¿ç”¨ç‡</h3>
                    <div class="value">$MEM_USAGE%</div>
                </div>
                <div class="metric">
                    <h3>ç£ç›˜ä½¿ç”¨ç‡</h3>
                    <div class="value">$DISK_USAGE%</div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2>ç³»ç»Ÿä¿¡æ¯</h2>
            <div class="status">
                <span>ç³»ç»Ÿè´Ÿè½½:</span>
                <span>$LOAD_AVG</span>
            </div>
            <div class="status">
                <span>è¿è¡Œæ—¶é—´:</span>
                <span>$UPTIME</span>
            </div>
        </div>
        
        <div class="card">
            <h2>æœåŠ¡çŠ¶æ€</h2>
            <div class="status">
                <span>Nginx æœåŠ¡:</span>
                <span>$NGINX_STATUS</span>
            </div>
            <div class="status">
                <span>AI æœåŠ¡:</span>
                <span>$AI_STATUS</span>
            </div>
        </div>
        
        <div class="card">
            <h2>æœ€è¿‘æ—¥å¿—</h2>
            <div class="logs">$RECENT_LOGS</div>
        </div>
    </div>
</body>
</html>
EOF

    # è®¾ç½®æƒé™
    sudo chown www-data:www-data "$DASHBOARD_DIR/index.html"
}

# ä¸»å‡½æ•°
main() {
    log "å¼€å§‹ç”ŸæˆçŠ¶æ€ä»ªè¡¨æ¿..."
    
    # æ”¶é›†æ•°æ®
    collect_system_data
    collect_service_data
    
    # ç”Ÿæˆé¡µé¢
    generate_dashboard
    
    log "çŠ¶æ€ä»ªè¡¨æ¿å·²æ›´æ–°"
}

# æ‰§è¡Œç”Ÿæˆ
main
```
## ä¸‰åä¸€ã€ç³»ç»Ÿå¤‡ä»½ä¸æ¢å¤å®Œæ•´æ–¹æ¡ˆ
### 1. å®Œæ•´å¤‡ä»½è„šæœ¬
```bash
# åˆ›å»ºå®Œæ•´å¤‡ä»½è„šæœ¬
nano ~/full_backup.sh
```
```bash
#!/bin/bash
# ~/full_backup.sh

# é…ç½®
BACKUP_ROOT="/mnt/backup_drive"
BACKUP_DIR="$BACKUP_ROOT/system_backups"
EXCLUDE_FILE="/home/zhaoxiongzhou/backup_exclude.txt"
LOG_FILE="/var/log/backup.log"
RETENTION_DAYS=30
COMPRESSION_LEVEL=6

# ç¡®ä¿å¤‡ä»½ç›®å½•å­˜åœ¨
mkdir -p "$BACKUP_DIR"

# æ—¥å¿—å‡½æ•°
log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$LOG_FILE"
}

# æ£€æŸ¥å¤‡ä»½ç¯å¢ƒ
check_environment() {
    log "æ£€æŸ¥å¤‡ä»½ç¯å¢ƒ..."
    
    # æ£€æŸ¥å¤‡ä»½ç›®æ ‡ç›®å½•
    if ! mountpoint -q "$BACKUP_ROOT"; then
        log "é”™è¯¯: å¤‡ä»½é©±åŠ¨å™¨æœªæŒ‚è½½"
        return 1
    fi
    
    # æ£€æŸ¥å¯ç”¨ç©ºé—´
    local available_space=$(df -BG "$BACKUP_ROOT" | awk 'NR==2 {print $4}' | sed 's/G//')
    if [ "$available_space" -lt 10 ]; then
        log "é”™è¯¯: å¤‡ä»½ç©ºé—´ä¸è¶³ï¼ˆå°äº 10GBï¼‰"
        return 1
    fi
    
    # åˆ›å»ºæ’é™¤æ–‡ä»¶
    cat > "$EXCLUDE_FILE" << EOF
/proc/*
/sys/*
/tmp/*
/run/*
/mnt/*
/media/*
/lost+found
/var/cache/*
/var/tmp/*
/var/log/*
/home/*/Downloads/*
/home/*/.cache/*
EOF
    
    return 0
}

# åœæ­¢æœåŠ¡
stop_services() {
    log "åœæ­¢æœåŠ¡..."
    
    # åœæ­¢ Nginx
    sudo systemctl stop nginx
    
    # åœæ­¢ AI æœåŠ¡
    pkill llama-server
    
    # ç­‰å¾…æœåŠ¡å®Œå…¨åœæ­¢
    sleep 5
}

# å¯åŠ¨æœåŠ¡
start_services() {
    log "å¯åŠ¨æœåŠ¡..."
    
    # å¯åŠ¨ Nginx
    sudo systemctl start nginx
    
    # å¯åŠ¨ AI æœåŠ¡
    ~/projects/llama.cpp/start-llama.sh
    
    # éªŒè¯æœåŠ¡çŠ¶æ€
    sleep 10
    if ! systemctl is-active --quiet nginx; then
        log "è­¦å‘Š: Nginx æœåŠ¡æœªèƒ½æ­£å¸¸å¯åŠ¨"
    fi
    if ! pgrep -f llama-server > /dev/null; then
        log "è­¦å‘Š: AI æœåŠ¡æœªèƒ½æ­£å¸¸å¯åŠ¨"
    fi
}

# åˆ›å»ºå®Œæ•´å¤‡ä»½
create_full_backup() {
    local backup_date=$(date +%Y%m%d_%H%M%S)
    local backup_file="$BACKUP_DIR/full_backup_${backup_date}.tar.gz"
    local manifest_file="$BACKUP_DIR/backup_manifest_${backup_date}.txt"
    
    log "å¼€å§‹åˆ›å»ºå®Œæ•´å¤‡ä»½..."
    
    # åˆ›å»ºæ–‡ä»¶æ¸…å•
    log "ç”Ÿæˆæ–‡ä»¶æ¸…å•..."
    find / -xdev -type f ! -path "$(cat $EXCLUDE_FILE | tr '\n' '|')" > "$manifest_file"
    
    # åˆ›å»ºå¤‡ä»½
    log "åˆ›å»ºç³»ç»Ÿå¤‡ä»½..."
    sudo tar -czf "$backup_file" \
        --exclude-from="$EXCLUDE_FILE" \
        --one-file-system \
        --preserve-permissions \
        --numeric-owner \
        --checkpoint=1000 \
        --checkpoint-action=dot \
        -C / .
    
    # éªŒè¯å¤‡ä»½
    if ! tar -tzf "$backup_file" >/dev/null 2>&1; then
        log "é”™è¯¯: å¤‡ä»½æ–‡ä»¶éªŒè¯å¤±è´¥"
        return 1
    fi
    
    # è®¡ç®—æ ¡éªŒå’Œ
    log "è®¡ç®—æ ¡éªŒå’Œ..."
    sha256sum "$backup_file" > "${backup_file}.sha256"
    
    # åˆ›å»ºå¤‡ä»½ä¿¡æ¯æ–‡ä»¶
    cat > "${backup_file}.info" << EOF
å¤‡ä»½æ—¶é—´: $(date)
ç³»ç»Ÿç‰ˆæœ¬: $(cat /etc/os-release | grep PRETTY_NAME)
å†…æ ¸ç‰ˆæœ¬: $(uname -r)
å¤‡ä»½å¤§å°: $(du -h "$backup_file" | cut -f1)
æ–‡ä»¶æ•°é‡: $(wc -l < "$manifest_file")
æ’é™¤è§„åˆ™: $(cat "$EXCLUDE_FILE")
EOF
    
    return 0
}

# æ¸…ç†æ—§å¤‡ä»½
cleanup_old_backups() {
    log "æ¸…ç†æ—§å¤‡ä»½..."
    
    find "$BACKUP_DIR" -type f -name "full_backup_*" -mtime +$RETENTION_DAYS -delete
    find "$BACKUP_DIR" -type f -name "backup_manifest_*" -mtime +$RETENTION_DAYS -delete
    find "$BACKUP_DIR" -type f -name "*.sha256" -mtime +$RETENTION_DAYS -delete
    find "$BACKUP_DIR" -type f -name "*.info" -mtime +$RETENTION_DAYS -delete
}

# ä¸»å‡½æ•°
main() {
    log "å¼€å§‹å®Œæ•´å¤‡ä»½æµç¨‹..."
    
    # æ£€æŸ¥ç¯å¢ƒ
    if ! check_environment; then
        log "å¤‡ä»½ç¯å¢ƒæ£€æŸ¥å¤±è´¥ï¼Œç»ˆæ­¢å¤‡ä»½"
        ~/send_notification.sh "ç³»ç»Ÿå¤‡ä»½å¤±è´¥ï¼šç¯å¢ƒæ£€æŸ¥æœªé€šè¿‡" "high"
        return 1
    fi
    
    # åœæ­¢æœåŠ¡
    stop_services
    
    # åˆ›å»ºå¤‡ä»½
    if create_full_backup; then
        log "å¤‡ä»½åˆ›å»ºæˆåŠŸ"
        ~/send_notification.sh "ç³»ç»Ÿå®Œæ•´å¤‡ä»½å·²æˆåŠŸåˆ›å»º" "normal"
    else
        log "å¤‡ä»½åˆ›å»ºå¤±è´¥"
        ~/send_notification.sh "ç³»ç»Ÿå¤‡ä»½å¤±è´¥ï¼šå¤‡ä»½åˆ›å»ºè¿‡ç¨‹å‡ºé”™" "high"
    fi
    
    # å¯åŠ¨æœåŠ¡
    start_services
    
    # æ¸…ç†æ—§å¤‡ä»½
    cleanup_old_backups
    
    log "å¤‡ä»½æµç¨‹å®Œæˆ"
}

# æ‰§è¡Œå¤‡ä»½
main
```
## ä¸‰åäºŒã€ç³»ç»Ÿæ¢å¤è„šæœ¬
### 1. ç³»ç»Ÿæ¢å¤è„šæœ¬
```bash
# åˆ›å»ºç³»ç»Ÿæ¢å¤è„šæœ¬
nano ~/system_restore.sh
```
```bash
#!/bin/bash
# ~/system_restore.sh

# é…ç½®
BACKUP_ROOT="/mnt/backup_drive"
BACKUP_DIR="$BACKUP_ROOT/system_backups"
LOG_FILE="/var/log/restore.log"
TEMP_DIR="/tmp/restore_temp"

# æ—¥å¿—å‡½æ•°
log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$LOG_FILE"
}

# éªŒè¯å¤‡ä»½æ–‡ä»¶
verify_backup() {
    local backup_file="$1"
    log "éªŒè¯å¤‡ä»½æ–‡ä»¶: $backup_file"
    
    # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
    if [ ! -f "$backup_file" ]; then
        log "é”™è¯¯: å¤‡ä»½æ–‡ä»¶ä¸å­˜åœ¨"
        return 1
    fi
    
    # æ£€æŸ¥æ ¡éªŒå’Œ
    local checksum_file="${backup_file}.sha256"
    if [ -f "$checksum_file" ]; then
        if ! sha256sum -c "$checksum_file"; then
            log "é”™è¯¯: å¤‡ä»½æ–‡ä»¶æ ¡éªŒå’ŒéªŒè¯å¤±è´¥"
            return 1
        fi
    else
        log "è­¦å‘Š: æœªæ‰¾åˆ°æ ¡éªŒå’Œæ–‡ä»¶"
    fi
    
    # æµ‹è¯•å½’æ¡£å®Œæ•´æ€§
    if ! tar -tzf "$backup_file" >/dev/null 2>&1; then
        log "é”™è¯¯: å¤‡ä»½æ–‡ä»¶æŸå"
        return 1
    fi
    
    return 0
}

# å‡†å¤‡æ¢å¤ç¯å¢ƒ
prepare_environment() {
    log "å‡†å¤‡æ¢å¤ç¯å¢ƒ..."
    
    # åˆ›å»ºä¸´æ—¶ç›®å½•
    mkdir -p "$TEMP_DIR"
    
    # åœæ­¢æ‰€æœ‰æœåŠ¡
    log "åœæ­¢æœåŠ¡..."
    sudo systemctl stop nginx
    pkill llama-server
    
    # ç­‰å¾…æœåŠ¡åœæ­¢
    sleep 5
    
    # æ¸…ç†ç›®æ ‡ç›®å½•
    log "æ¸…ç†ç›®æ ‡ç›®å½•..."
    read -p "è­¦å‘Š: è¿™å°†æ¸…é™¤ç³»ç»Ÿæ–‡ä»¶ã€‚ç¡®å®šè¦ç»§ç»­å—ï¼Ÿ(y/n) " -n 1 -r
    echo
    if [[ ! $REPLY =~ ^[Yy]$ ]]; then
        log "ç”¨æˆ·å–æ¶ˆæ“ä½œ"
        return 1
    fi
    
    return 0
}

# æ‰§è¡Œæ¢å¤
perform_restore() {
    local backup_file="$1"
    log "å¼€å§‹æ¢å¤ç³»ç»Ÿ..."
    
    # åˆ›å»ºæ¢å¤å‰çš„å¿«ç…§
    log "åˆ›å»ºå½“å‰ç³»ç»Ÿå¿«ç…§..."
    local snapshot_date=$(date +%Y%m%d_%H%M%S)
    local snapshot_file="$BACKUP_DIR/pre_restore_snapshot_${snapshot_date}.tar.gz"
    
    sudo tar -czf "$snapshot_file" \
        --exclude-from="/home/zhaoxiongzhou/backup_exclude.txt" \
        --one-file-system \
        -C / .
    
    # è§£å‹å¤‡ä»½
    log "è§£å‹å¤‡ä»½æ–‡ä»¶..."
    sudo tar -xzf "$backup_file" -C / \
        --numeric-owner \
        --preserve-permissions \
        --checkpoint=1000 \
        --checkpoint-action=dot
    
    # ä¿®å¤æƒé™
    log "ä¿®å¤æ–‡ä»¶æƒé™..."
    sudo chown -R www-data:www-data /var/www/
    sudo chown -R zhaoxiongzhou:zhaoxiongzhou /home/zhaoxiongzhou/
    
    return 0
}

# æ¢å¤æœåŠ¡é…ç½®
restore_configurations() {
    log "æ¢å¤æœåŠ¡é…ç½®..."
    
    # é‡æ–°åŠ è½½ç³»ç»Ÿé…ç½®
    sudo systemctl daemon-reload
    sudo sysctl --system
    
    # é‡æ–°é…ç½®ç½‘ç»œ
    sudo systemctl restart networking
    
    # æ¢å¤é˜²ç«å¢™è§„åˆ™
    sudo iptables-restore < /etc/iptables/rules.v4
    
    return 0
}

# éªŒè¯æ¢å¤
verify_restore() {
    log "éªŒè¯ç³»ç»Ÿæ¢å¤..."
    local status=0
    
    # æ£€æŸ¥å…³é”®æ–‡ä»¶
    for file in "/etc/nginx/nginx.conf" "/etc/systemd/system/llama-server.service"; do
        if [ ! -f "$file" ]; then
            log "é”™è¯¯: æœªæ‰¾åˆ°å…³é”®æ–‡ä»¶ $file"
            status=1
        fi
    done
    
    # å¯åŠ¨æœåŠ¡
    sudo systemctl start nginx
    ~/projects/llama.cpp/start-llama.sh
    
    # éªŒè¯æœåŠ¡çŠ¶æ€
    sleep 10
    if ! systemctl is-active --quiet nginx; then
        log "é”™è¯¯: Nginx æœåŠ¡æœªèƒ½æ­£å¸¸å¯åŠ¨"
        status=1
    fi
    
    if ! pgrep -f llama-server > /dev/null; then
        log "é”™è¯¯: AI æœåŠ¡æœªèƒ½æ­£å¸¸å¯åŠ¨"
        status=1
    fi
    
    return $status
}

# æ¸…ç†æ¢å¤ç¯å¢ƒ
cleanup() {
    log "æ¸…ç†æ¢å¤ç¯å¢ƒ..."
    
    # åˆ é™¤ä¸´æ—¶æ–‡ä»¶
    rm -rf "$TEMP_DIR"
    
    # æ¸…ç†æ—¥å¿—
    find /var/log -type f -name "*.gz" -delete
    
    return 0
}

# ä¸»å‡½æ•°
main() {
    local backup_file
    
    # åˆ—å‡ºå¯ç”¨å¤‡ä»½
    echo "å¯ç”¨çš„å¤‡ä»½æ–‡ä»¶:"
    ls -lh "$BACKUP_DIR"/full_backup_*.tar.gz
    
    # é€‰æ‹©å¤‡ä»½æ–‡ä»¶
    read -p "è¯·è¾“å…¥è¦æ¢å¤çš„å¤‡ä»½æ–‡ä»¶å®Œæ•´è·¯å¾„: " backup_file
    
    # éªŒè¯å¤‡ä»½
    if ! verify_backup "$backup_file"; then
        log "å¤‡ä»½éªŒè¯å¤±è´¥ï¼Œç»ˆæ­¢æ¢å¤"
        return 1
    fi
    
    # å‡†å¤‡ç¯å¢ƒ
    if ! prepare_environment; then
        log "ç¯å¢ƒå‡†å¤‡å¤±è´¥ï¼Œç»ˆæ­¢æ¢å¤"
        return 1
    fi
    
    # æ‰§è¡Œæ¢å¤
    if perform_restore "$backup_file" && \
       restore_configurations && \
       verify_restore; then
        log "ç³»ç»Ÿæ¢å¤æˆåŠŸå®Œæˆ"
        ~/send_notification.sh "ç³»ç»Ÿæ¢å¤æˆåŠŸå®Œæˆ" "normal"
    else
        log "ç³»ç»Ÿæ¢å¤å¤±è´¥"
        ~/send_notification.sh "ç³»ç»Ÿæ¢å¤å¤±è´¥ï¼Œéœ€è¦æ‰‹åŠ¨æ£€æŸ¥" "high"
    fi
    
    # æ¸…ç†ç¯å¢ƒ
    cleanup
}

# æ‰§è¡Œæ¢å¤
main
```
## ä¸‰åä¸‰ã€ç³»ç»Ÿè¿ç§»å·¥å…·
### 1. ç³»ç»Ÿè¿ç§»è„šæœ¬
```bash
# åˆ›å»ºç³»ç»Ÿè¿ç§»è„šæœ¬
nano ~/system_migration.sh
```
```bash
#!/bin/bash
# ~/system_migration.sh

# é…ç½®
SOURCE_HOST="old-raspberry.local"
TARGET_HOST="new-raspberry.local"
MIGRATION_DIR="/mnt/migration"
LOG_FILE="/var/log/migration.log"
SSH_KEY="~/.ssh/migration_key"
RSYNC_OPTS="-avz --progress --delete"

# æ—¥å¿—å‡½æ•°
log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$LOG_FILE"
}

# æ£€æŸ¥è¿ç§»ç¯å¢ƒ
check_migration_env() {
    log "æ£€æŸ¥è¿ç§»ç¯å¢ƒ..."
    
    # æ£€æŸ¥ SSH å¯†é’¥
    if [ ! -f "$SSH_KEY" ]; then
        log "ç”Ÿæˆ SSH å¯†é’¥..."
        ssh-keygen -t ed25519 -f "$SSH_KEY" -N ""
        
        # å¤åˆ¶å¯†é’¥åˆ°ç›®æ ‡ä¸»æœº
        ssh-copy-id -i "$SSH_KEY" "zhaoxiongzhou@$TARGET_HOST"
    fi
    
    # æ£€æŸ¥å¿…è¦å·¥å…·
    for tool in rsync ssh scp; do
        if ! command -v $tool &>/dev/null; then
            log "é”™è¯¯: æœªæ‰¾åˆ°å¿…è¦å·¥å…· $tool"
            return 1
        fi
    done
    
    # æ£€æŸ¥ç›®æ ‡ä¸»æœºè¿æ¥
    if ! ssh -i "$SSH_KEY" "zhaoxiongzhou@$TARGET_HOST" "echo 'Connection test'" &>/dev/null; then
        log "é”™è¯¯: æ— æ³•è¿æ¥åˆ°ç›®æ ‡ä¸»æœº"
        return 1
    fi
    
    return 0
}

# è¿ç§»é…ç½®æ–‡ä»¶
migrate_configs() {
    log "è¿ç§»é…ç½®æ–‡ä»¶..."
    
    # åˆ›å»ºé…ç½®ç›®å½•
    ssh -i "$SSH_KEY" "zhaoxiongzhou@$TARGET_HOST" "mkdir -p ~/configs_backup"
    
    # è¿ç§» Nginx é…ç½®
    rsync $RSYNC_OPTS -e "ssh -i $SSH_KEY" \
        /etc/nginx/ \
        "zhaoxiongzhou@$TARGET_HOST:~/configs_backup/nginx/"
    
    # è¿ç§»ç³»ç»Ÿé…ç½®
    rsync $RSYNC_OPTS -e "ssh -i $SSH_KEY" \
        /etc/sysctl.d/ \
        "zhaoxiongzhou@$TARGET_HOST:~/configs_backup/sysctl/"
    
    # è¿ç§»æœåŠ¡é…ç½®
    rsync $RSYNC_OPTS -e "ssh -i $SSH_KEY" \
        /etc/systemd/system/ \
        "zhaoxiongzhou@$TARGET_HOST:~/configs_backup/systemd/"
}

# è¿ç§»æ•°æ®
migrate_data() {
    log "è¿ç§»æ•°æ®..."
    
    # è¿ç§»åšå®¢æ•°æ®
    rsync $RSYNC_OPTS -e "ssh -i $SSH_KEY" \
        ~/myblog/ \
        "zhaoxiongzhou@$TARGET_HOST:~/myblog/"
    
    # è¿ç§» AI æœåŠ¡æ•°æ®
    rsync $RSYNC_OPTS -e "ssh -i $SSH_KEY" \
        ~/projects/llama.cpp/ \
        "zhaoxiongzhou@$TARGET_HOST:~/projects/llama.cpp/"
    
    # è¿ç§»ç”¨æˆ·è„šæœ¬
    rsync $RSYNC_OPTS -e "ssh -i $SSH_KEY" \
        ~/*.sh \
        "zhaoxiongzhou@$TARGET_HOST:~/"
}

# è¿ç§»æ•°æ®åº“
migrate_database() {
    log "è¿ç§»æ•°æ®åº“..."
    
    # å¯¼å‡ºæ•°æ®åº“
    local dump_file="/tmp/database_dump.sql"
    if [ -f "/var/lib/mysql" ]; then
        mysqldump --all-databases > "$dump_file"
        
        # ä¼ è¾“åˆ°ç›®æ ‡ä¸»æœº
        scp -i "$SSH_KEY" "$dump_file" "zhaoxiongzhou@$TARGET_HOST:/tmp/"
        
        # åœ¨ç›®æ ‡ä¸»æœºå¯¼å…¥æ•°æ®åº“
        ssh -i "$SSH_KEY" "zhaoxiongzhou@$TARGET_HOST" \
            "mysql < /tmp/database_dump.sql"
    fi
}

# é…ç½®ç›®æ ‡ç³»ç»Ÿ
configure_target() {
    log "é…ç½®ç›®æ ‡ç³»ç»Ÿ..."
    
    ssh -i "$SSH_KEY" "zhaoxiongzhou@$TARGET_HOST" "bash -s" << 'EOF'
        # å®‰è£…å¿…è¦è½¯ä»¶
        sudo apt update
        sudo apt install -y nginx mysql-server python3 pip
        
        # æ¢å¤é…ç½®
        sudo cp -r ~/configs_backup/nginx/* /etc/nginx/
        sudo cp -r ~/configs_backup/sysctl/* /etc/sysctl.d/
        sudo cp -r ~/configs_backup/systemd/* /etc/systemd/system/
        
        # è®¾ç½®æƒé™
        sudo chown -R www-data:www-data /var/www/
        sudo chmod +x ~/*.sh
        
        # é‡å¯æœåŠ¡
        sudo systemctl daemon-reload
        sudo systemctl restart nginx
EOF
}

# éªŒè¯è¿ç§»
verify_migration() {
    log "éªŒè¯è¿ç§»..."
    local status=0
    
    # æ£€æŸ¥æœåŠ¡çŠ¶æ€
    ssh -i "$SSH_KEY" "zhaoxiongzhou@$TARGET_HOST" "bash -s" << 'EOF'
        # æ£€æŸ¥ Nginx
        if ! systemctl is-active --quiet nginx; then
            echo "é”™è¯¯: Nginx æœåŠ¡æœªè¿è¡Œ"
            exit 1
        fi
        
        # æ£€æŸ¥æ–‡ä»¶
        for dir in "~/myblog" "~/projects/llama.cpp"; do
            if [ ! -d "$dir" ]; then
                echo "é”™è¯¯: ç›®å½• $dir ä¸å­˜åœ¨"
                exit 1
            fi
        done
        
        # æ£€æŸ¥é…ç½®
        if ! nginx -t &>/dev/null; then
            echo "é”™è¯¯: Nginx é…ç½®æ— æ•ˆ"
            exit 1
        fi
EOF
    
    status=$?
    return $status
}

# ä¸»å‡½æ•°
main() {
    log "å¼€å§‹ç³»ç»Ÿè¿ç§»..."
    
    # æ£€æŸ¥ç¯å¢ƒ
    if ! check_migration_env; then
        log "è¿ç§»ç¯å¢ƒæ£€æŸ¥å¤±è´¥"
        return 1
    fi
    
    # æ‰§è¡Œè¿ç§»
    migrate_configs
    migrate_data
    migrate_database
    configure_target
    
    # éªŒè¯è¿ç§»
    if verify_migration; then
        log "ç³»ç»Ÿè¿ç§»æˆåŠŸå®Œæˆ"
        ~/send_notification.sh "ç³»ç»Ÿè¿ç§»æˆåŠŸå®Œæˆ" "normal"
    else
        log "ç³»ç»Ÿè¿ç§»å¤±è´¥"
        ~/send_notification.sh "ç³»ç»Ÿè¿ç§»å¤±è´¥ï¼Œéœ€è¦æ‰‹åŠ¨æ£€æŸ¥" "high"
    fi
}

# æ‰§è¡Œè¿ç§»
main
```
## ä¸‰åå››ã€æ—¥å¿—åˆ†æå·¥å…·
### 1. æ—¥å¿—åˆ†æè„šæœ¬
```bash
# åˆ›å»ºæ—¥å¿—åˆ†æè„šæœ¬
nano ~/log_analyzer.sh
```
```bash
#!/bin/bash
# ~/log_analyzer.sh

# é…ç½®
LOG_DIRS=(
    "/var/log"
    "/var/log/nginx"
    "/home/zhaoxiongzhou/logs"
)
REPORT_DIR="/home/zhaoxiongzhou/log_reports"
LOG_FILE="/var/log/analyzer.log"
ALERT_THRESHOLD=100  # é”™è¯¯æ—¥å¿—é˜ˆå€¼
RETENTION_DAYS=30    # æŠ¥å‘Šä¿ç•™å¤©æ•°

# ç¡®ä¿ç›®å½•å­˜åœ¨
mkdir -p "$REPORT_DIR"

# æ—¥å¿—å‡½æ•°
log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$LOG_FILE"
}

# åˆ†æç³»ç»Ÿæ—¥å¿—
analyze_system_logs() {
    log "åˆ†æç³»ç»Ÿæ—¥å¿—..."
    local report_file="$REPORT_DIR/system_log_report_$(date +%Y%m%d).md"
    
    {
        echo "# ç³»ç»Ÿæ—¥å¿—åˆ†ææŠ¥å‘Š"
        echo "## ç”Ÿæˆæ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
        echo
        echo "## ç³»ç»Ÿé”™è¯¯ç»Ÿè®¡"
        echo "### ä¸¥é‡é”™è¯¯"
        echo '```'
        grep -i "error\|critical\|emergency" /var/log/syslog | \
            tail -n 50 | sort | uniq -c | sort -nr
        echo '```'
        
        echo "### è®¤è¯å¤±è´¥"
        echo '```'
        grep "Failed password" /var/log/auth.log | \
            awk '{print $1,$2,$3,$11}' | sort | uniq -c | sort -nr | head -n 10
        echo '```'
        
        echo "### ç³»ç»Ÿé‡å¯è®°å½•"
        echo '```'
        last reboot | head -n 5
        echo '```'
    } > "$report_file"
}

# åˆ†æ Nginx è®¿é—®æ—¥å¿—
analyze_nginx_logs() {
    log "åˆ†æ Nginx è®¿é—®æ—¥å¿—..."
    local report_file="$REPORT_DIR/nginx_log_report_$(date +%Y%m%d).md"
    
    {
        echo "# Nginx è®¿é—®æ—¥å¿—åˆ†ææŠ¥å‘Š"
        echo "## ç”Ÿæˆæ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
        echo
        echo "## è®¿é—®ç»Ÿè®¡"
        echo "### è¯·æ±‚é‡æœ€å¤§çš„ IP"
        echo '```'
        awk '{print $1}' /var/log/nginx/access.log | sort | uniq -c | sort -nr | head -n 10
        echo '```'
        
        echo "### è®¿é—®é‡æœ€å¤§çš„é¡µé¢"
        echo '```'
        awk '{print $7}' /var/log/nginx/access.log | sort | uniq -c | sort -nr | head -n 10
        echo '```'
        
        echo "### HTTP çŠ¶æ€ç ç»Ÿè®¡"
        echo '```'
        awk '{print $9}' /var/log/nginx/access.log | sort | uniq -c | sort -nr
        echo '```'
        
        echo "### æ¯å°æ—¶è¯·æ±‚é‡ç»Ÿè®¡"
        echo '```'
        awk '{print $4}' /var/log/nginx/access.log | cut -c 14-15 | sort | uniq -c | \
            awk '{printf("%s:00 - %s è¯·æ±‚\n", $2, $1)}'
        echo '```'
    } > "$report_file"
}

# åˆ†æ AI æœåŠ¡æ—¥å¿—
analyze_ai_logs() {
    log "åˆ†æ AI æœåŠ¡æ—¥å¿—..."
    local report_file="$REPORT_DIR/ai_log_report_$(date +%Y%m%d).md"
    local ai_log="/home/zhaoxiongzhou/logs/llama.log"
    
    if [ -f "$ai_log" ]; then
        {
            echo "# AI æœåŠ¡æ—¥å¿—åˆ†ææŠ¥å‘Š"
            echo "## ç”Ÿæˆæ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
            echo
            echo "## æœåŠ¡ç»Ÿè®¡"
            echo "### é”™è¯¯ç»Ÿè®¡"
            echo '```'
            grep -i "error" "$ai_log" | tail -n 20
            echo '```'
            
            echo "### æ€§èƒ½ç»Ÿè®¡"
            echo "#### å“åº”æ—¶é—´åˆ†å¸ƒ"
            echo '```'
            grep "response_time" "$ai_log" | \
                awk '{sum+=$NF; count++} END {print "å¹³å‡å“åº”æ—¶é—´:", sum/count, "ms"}'
            echo '```'
            
            echo "#### å†…å­˜ä½¿ç”¨ç»Ÿè®¡"
            echo '```'
            grep "memory_usage" "$ai_log" | tail -n 10
            echo '```'
        } > "$report_file"
    fi
}

# ç”Ÿæˆå®‰å…¨æŠ¥å‘Š
generate_security_report() {
    log "ç”Ÿæˆå®‰å…¨æŠ¥å‘Š..."
    local report_file="$REPORT_DIR/security_report_$(date +%Y%m%d).md"
    
    {
        echo "# å®‰å…¨åˆ†ææŠ¥å‘Š"
        echo "## ç”Ÿæˆæ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
        echo
        echo "## å®‰å…¨äº‹ä»¶ç»Ÿè®¡"
        
        echo "### SSH æš´åŠ›ç ´è§£å°è¯•"
        echo '```'
        grep "Failed password" /var/log/auth.log | \
            awk '{print $11,$13}' | sort | uniq -c | sort -nr | head -n 10
        echo '```'
        
        echo "### å¯ç–‘ IP è®¿é—®"
        echo '```'
        grep -i "suspicious\|attack\|hack" /var/log/nginx/access.log | \
            awk '{print $1}' | sort | uniq -c | sort -nr
        echo '```'
        
        echo "### æ–‡ä»¶æƒé™å˜æ›´"
        echo '```'
        find /etc -mtime -1 -type f -ls
        echo '```'
    } > "$report_file"
}

# æ¸…ç†æ—§æŠ¥å‘Š
cleanup_old_reports() {
    log "æ¸…ç†æ—§æŠ¥å‘Š..."
    find "$REPORT_DIR" -type f -name "*.md" -mtime +$RETENTION_DAYS -delete
}

# ç”Ÿæˆæ‘˜è¦æŠ¥å‘Š
generate_summary() {
    log "ç”Ÿæˆæ‘˜è¦æŠ¥å‘Š..."
    local summary_file="$REPORT_DIR/summary_$(date +%Y%m%d).md"
    
    {
        echo "# æ—¥å¿—åˆ†ææ‘˜è¦æŠ¥å‘Š"
        echo "## ç”Ÿæˆæ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
        echo
        echo "## å…³é”®æŒ‡æ ‡"
        
        # é”™è¯¯ç»Ÿè®¡
        local error_count=$(grep -i "error" /var/log/syslog | wc -l)
        local nginx_error_count=$(grep -i "error" /var/log/nginx/error.log | wc -l)
        
        echo "- ç³»ç»Ÿé”™è¯¯æ•°: $error_count"
        echo "- Nginx é”™è¯¯æ•°: $nginx_error_count"
        
        # å®‰å…¨äº‹ä»¶
        local ssh_fails=$(grep "Failed password" /var/log/auth.log | wc -l)
        echo "- SSH å¤±è´¥å°è¯•: $ssh_fails"
        
        # å‘Šè­¦åˆ¤æ–­
        if [ $error_count -gt $ALERT_THRESHOLD ]; then
            ~/send_notification.sh "è­¦å‘Š: ç³»ç»Ÿé”™è¯¯æ•°è¶…è¿‡é˜ˆå€¼" "high"
        fi
    } > "$summary_file"
}

# ä¸»å‡½æ•°
main() {
    log "å¼€å§‹æ—¥å¿—åˆ†æ..."
    
    # æ‰§è¡Œåˆ†æ
    analyze_system_logs
    analyze_nginx_logs
    analyze_ai_logs
    generate_security_report
    generate_summary
    
    # æ¸…ç†æ—§æŠ¥å‘Š
    cleanup_old_reports
    
    log "æ—¥å¿—åˆ†æå®Œæˆ"
}

# æ‰§è¡Œåˆ†æ
main
```
## ä¸‰åäº”ã€ç³»ç»Ÿä¼˜åŒ–å·¥å…·
### 1. ç³»ç»Ÿä¼˜åŒ–è„šæœ¬
```bash
# åˆ›å»ºç³»ç»Ÿä¼˜åŒ–è„šæœ¬
nano ~/system_optimize.sh
```
```bash
#!/bin/bash
# ~/system_optimize.sh

# é…ç½®
LOG_FILE="/var/log/optimize.log"
NGINX_CONF="/etc/nginx/nginx.conf"
SYSCTL_CONF="/etc/sysctl.d/99-custom.conf"
JOURNAL_CONF="/etc/systemd/journald.conf"

# æ—¥å¿—å‡½æ•°
log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$LOG_FILE"
}

# ä¼˜åŒ–ç³»ç»Ÿå‚æ•°
optimize_system() {
    log "ä¼˜åŒ–ç³»ç»Ÿå‚æ•°..."
    
    # å¤‡ä»½åŸå§‹é…ç½®
    cp "$SYSCTL_CONF" "${SYSCTL_CONF}.backup"
    
    # é…ç½®ç³»ç»Ÿå‚æ•°
    cat > "$SYSCTL_CONF" << EOF
# ç½‘ç»œä¼˜åŒ–
net.core.somaxconn = 2048
net.core.netdev_max_backlog = 4096
net.ipv4.tcp_max_syn_backlog = 4096
net.ipv4.tcp_fin_timeout = 30
net.ipv4.tcp_keepalive_time = 1200
net.ipv4.tcp_max_tw_buckets = 5000
net.ipv4.tcp_fastopen = 3
net.ipv4.tcp_rmem = 4096 87380 16777216
net.ipv4.tcp_wmem = 4096 65536 16777216

# æ–‡ä»¶ç³»ç»Ÿä¼˜åŒ–
fs.file-max = 100000
fs.inotify.max_user_watches = 524288

# å†…å­˜ä¼˜åŒ–
vm.swappiness = 10
vm.dirty_ratio = 60
vm.dirty_background_ratio = 2
EOF

    # åº”ç”¨ç³»ç»Ÿå‚æ•°
    sysctl -p "$SYSCTL_CONF"
}

# ä¼˜åŒ– Nginx é…ç½®
optimize_nginx() {
    log "ä¼˜åŒ– Nginx é…ç½®..."
    
    # å¤‡ä»½åŸå§‹é…ç½®
    cp "$NGINX_CONF" "${NGINX_CONF}.backup"
    
    # é…ç½® Nginx
    cat > "$NGINX_CONF" << EOF
user www-data;
worker_processes auto;
worker_rlimit_nofile 100000;

events {
    worker_connections 2048;
    multi_accept on;
    use epoll;
}

http {
    # åŸºç¡€è®¾ç½®
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
    types_hash_max_size 2048;
    server_tokens off;

    # MIME ç±»å‹
    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    # æ—¥å¿—æ ¼å¼
    log_format main '\$remote_addr - \$remote_user [\$time_local] "\$request" '
                    '\$status \$body_bytes_sent "\$http_referer" '
                    '"\$http_user_agent" "\$http_x_forwarded_for"';

    # ç¼“å†²åŒºè®¾ç½®
    client_body_buffer_size 128k;
    client_max_body_size 10m;
    client_header_buffer_size 1k;
    large_client_header_buffers 4 4k;

    # Gzip å‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_proxied any;
    gzip_comp_level 6;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

    # SSL ä¼˜åŒ–
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_prefer_server_ciphers on;
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 10m;

    # åŒ…å«å…¶ä»–é…ç½®
    include /etc/nginx/conf.d/*.conf;
    include /etc/nginx/sites-enabled/*;
}
EOF

    # æµ‹è¯•é…ç½®
    nginx -t && systemctl restart nginx
}

# ä¼˜åŒ–ç³»ç»ŸæœåŠ¡
optimize_services() {
    log "ä¼˜åŒ–ç³»ç»ŸæœåŠ¡..."
    
    # ç¦ç”¨ä¸å¿…è¦çš„æœåŠ¡
    local unnecessary_services=(
        "bluetooth"
        "cups"
        "avahi-daemon"
    )
    
    for service in "${unnecessary_services[@]}"; do
        if systemctl is-active --quiet "$service"; then
            systemctl stop "$service"
            systemctl disable "$service"
            log "å·²ç¦ç”¨æœåŠ¡: $service"
        fi
    done
    
    # ä¼˜åŒ–æ—¥å¿—æœåŠ¡
    cat > "$JOURNAL_CONF" << EOF
[Journal]
SystemMaxUse=100M
SystemMaxFileSize=10M
RuntimeMaxUse=50M
RuntimeMaxFileSize=5M
EOF

    # é‡å¯æ—¥å¿—æœåŠ¡
    systemctl restart systemd-journald
}

# ä¼˜åŒ–æ–‡ä»¶ç³»ç»Ÿ
optimize_filesystem() {
    log "ä¼˜åŒ–æ–‡ä»¶ç³»ç»Ÿ..."
    
    # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
    find /tmp -type f -atime +10 -delete
    find /var/tmp -type f -atime +10 -delete
    
    # æ¸…ç†æ—¥å¿—
    find /var/log -type f -name "*.gz" -delete
    find /var/log -type f -name "*.old" -delete
    
    # ä¼˜åŒ–æ—¥å¿—è½®è½¬
    cat > /etc/logrotate.d/custom << EOF
/var/log/custom/*.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 640 root adm
}
EOF
}

# ä¼˜åŒ–å†…å­˜ä½¿ç”¨
optimize_memory() {
    log "ä¼˜åŒ–å†…å­˜ä½¿ç”¨..."
    
    # æ¸…ç†ç¼“å­˜
    sync; echo 3 > /proc/sys/vm/drop_caches
    
    # é…ç½® swap ä½¿ç”¨
    if [ -f /swapfile ]; then
        swapoff /swapfile
        dd if=/dev/zero of=/swapfile bs=1M count=2048
        chmod 600 /swapfile
        mkswap /swapfile
        swapon /swapfile
    fi
}

# éªŒè¯ä¼˜åŒ–
verify_optimization() {
    log "éªŒè¯ç³»ç»Ÿä¼˜åŒ–..."
    local status=0
    
    # æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½
    local load=$(uptime | awk -F'load average:' '{print $2}' | cut -d, -f1)
    if [ $(echo "$load > 2" | bc -l) -eq 1 ]; then
        log "è­¦å‘Š: ç³»ç»Ÿè´Ÿè½½è¾ƒé«˜ ($load)"
        status=1
    fi
    
    # æ£€æŸ¥å†…å­˜ä½¿ç”¨
    local mem_usage=$(free | grep Mem | awk '{print $3/$2 * 100.0}')
    if [ $(echo "$mem_usage > 90" | bc -l) -eq 1 ]; then
        log "è­¦å‘Š: å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜ ($mem_usage%)"
        status=1
    fi
    
    # æ£€æŸ¥æœåŠ¡çŠ¶æ€
    if ! systemctl is-active --quiet nginx; then
        log "é”™è¯¯: Nginx æœåŠ¡æœªæ­£å¸¸è¿è¡Œ"
        status=1
    fi
    
    return $status
}

# ä¸»å‡½æ•°
main() {
    log "å¼€å§‹ç³»ç»Ÿä¼˜åŒ–..."
    
    optimize_system
    optimize_nginx
    optimize_services
    optimize_filesystem
    optimize_memory
    
    if verify_optimization; then
        log "ç³»ç»Ÿä¼˜åŒ–æˆåŠŸå®Œæˆ"
        ~/send_notification.sh "ç³»ç»Ÿä¼˜åŒ–å·²å®Œæˆ" "normal"
    else
        log "ç³»ç»Ÿä¼˜åŒ–å®Œæˆï¼Œä½†å­˜åœ¨è­¦å‘Š"
        ~/send_notification.sh "ç³»ç»Ÿä¼˜åŒ–å®Œæˆï¼Œä½†éœ€è¦æ£€æŸ¥" "high"
    fi
}

# æ‰§è¡Œä¼˜åŒ–
main
```
## ä¸‰åå…­ã€éƒ¨ç½²åæ£€æŸ¥æ¸…å•
### 1. éƒ¨ç½²æ£€æŸ¥è„šæœ¬
```bash
# åˆ›å»ºéƒ¨ç½²æ£€æŸ¥è„šæœ¬
nano ~/deployment_checklist.sh
```
```bash
#!/bin/bash
# ~/deployment_checklist.sh

# é…ç½®
LOG_FILE="/var/log/deployment_check.log"
REPORT_FILE="/home/zhaoxiongzhou/deployment_report.md"
CHECK_INTERVAL=300  # æ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰

# æ—¥å¿—å‡½æ•°
log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$LOG_FILE"
}

# æ£€æŸ¥ç³»ç»ŸåŸºç¡€é…ç½®
check_system_basics() {
    log "æ£€æŸ¥ç³»ç»ŸåŸºç¡€é…ç½®..."
    local status=0
    
    {
        echo "## ç³»ç»ŸåŸºç¡€æ£€æŸ¥"
        echo "### ç³»ç»Ÿä¿¡æ¯"
        echo "- ä¸»æœºå: $(hostname)"
        echo "- ç³»ç»Ÿç‰ˆæœ¬: $(cat /etc/os-release | grep PRETTY_NAME)"
        echo "- å†…æ ¸ç‰ˆæœ¬: $(uname -r)"
        echo "- è¿è¡Œæ—¶é—´: $(uptime -p)"
        echo
        echo "### èµ„æºä½¿ç”¨"
        echo "- CPU ä½¿ç”¨ç‡: $(top -bn1 | grep "Cpu(s)" | awk '{print $2}')%"
        echo "- å†…å­˜ä½¿ç”¨ç‡: $(free | grep Mem | awk '{print $3/$2 * 100.0}')%"
        echo "- ç£ç›˜ä½¿ç”¨ç‡: $(df -h / | awk 'NR==2 {print $5}')"
        echo
    } > "$REPORT_FILE"
    
    return $status
}

# æ£€æŸ¥ç½‘ç»œé…ç½®
check_network() {
    log "æ£€æŸ¥ç½‘ç»œé…ç½®..."
    local status=0
    
    {
        echo "### ç½‘ç»œé…ç½®"
        echo "#### IP é…ç½®"
        echo '```'
        ip addr show
        echo '```'
        
        echo "#### è·¯ç”±è¡¨"
        echo '```'
        ip route
        echo '```'
        
        echo "#### å¼€æ”¾ç«¯å£"
        echo '```'
        netstat -tuln
        echo '```'
        
        echo "#### DNS é…ç½®"
        echo '```'
        cat /etc/resolv.conf
        echo '```'
    } >> "$REPORT_FILE"
    
    return $status
}

# æ£€æŸ¥æœåŠ¡é…ç½®
check_services() {
    log "æ£€æŸ¥æœåŠ¡é…ç½®..."
    local status=0
    
    {
        echo "### æœåŠ¡çŠ¶æ€"
        echo "#### Nginx é…ç½®"
        echo '```'
        nginx -T
        echo '```'
        
        echo "#### æœåŠ¡è¿è¡ŒçŠ¶æ€"
        echo '```'
        systemctl status nginx
        systemctl status mysql
        ps aux | grep llama-server
        echo '```'
        
        echo "#### æœåŠ¡æ—¥å¿—æ£€æŸ¥"
        echo '```'
        tail -n 20 /var/log/nginx/error.log
        echo '```'
    } >> "$REPORT_FILE"
    
    return $status
}

# æ£€æŸ¥å®‰å…¨é…ç½®
check_security() {
    log "æ£€æŸ¥å®‰å…¨é…ç½®..."
    local status=0
    
    {
        echo "### å®‰å…¨æ£€æŸ¥"
        echo "#### é˜²ç«å¢™è§„åˆ™"
        echo '```'
        sudo iptables -L
        echo '```'
        
        echo "#### SSH é…ç½®"
        echo '```'
        grep -v '^#' /etc/ssh/sshd_config
        echo '```'
        
        echo "#### ç”¨æˆ·æƒé™"
        echo '```'
        ls -la /home/zhaoxiongzhou/
        ls -la /var/www/
        echo '```'
        
        echo "#### SSL è¯ä¹¦"
        echo '```'
        openssl x509 -in /etc/nginx/ssl/server.crt -text -noout
        echo '```'
    } >> "$REPORT_FILE"
    
    return $status
}

# æ£€æŸ¥å¤‡ä»½é…ç½®
check_backups() {
    log "æ£€æŸ¥å¤‡ä»½é…ç½®..."
    local status=0
    
    {
        echo "### å¤‡ä»½æ£€æŸ¥"
        echo "#### å¤‡ä»½é…ç½®"
        echo '```'
        ls -lh /mnt/backup_drive/system_backups/
        echo '```'
        
        echo "#### æœ€è¿‘å¤‡ä»½çŠ¶æ€"
        echo '```'
        tail -n 20 /var/log/backup.log
        echo '```'
    } >> "$REPORT_FILE"
    
    return $status
}

# æ£€æŸ¥ç›‘æ§é…ç½®
check_monitoring() {
    log "æ£€æŸ¥ç›‘æ§é…ç½®..."
    local status=0
    
    {
        echo "### ç›‘æ§æ£€æŸ¥"
        echo "#### ç›‘æ§è„šæœ¬çŠ¶æ€"
        echo '```'
        ps aux | grep monitor
        echo '```'
        
        echo "#### å‘Šè­¦é…ç½®"
        echo '```'
        cat ~/send_notification.sh
        echo '```'
    } >> "$REPORT_FILE"
    
    return $status
}

# ç”Ÿæˆæ€»ç»“æŠ¥å‘Š
generate_summary() {
    log "ç”Ÿæˆæ€»ç»“æŠ¥å‘Š..."
    
    {
        echo "## éƒ¨ç½²æ£€æŸ¥æ€»ç»“"
        echo "### æ£€æŸ¥æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
        echo
        echo "### ä¸»è¦å‘ç°"
        echo "1. ç³»ç»ŸçŠ¶æ€: $([ $system_status -eq 0 ] && echo 'æ­£å¸¸ âœ…' || echo 'å¼‚å¸¸ âŒ')"
        echo "2. ç½‘ç»œé…ç½®: $([ $network_status -eq 0 ] && echo 'æ­£å¸¸ âœ…' || echo 'å¼‚å¸¸ âŒ')"
        echo "3. æœåŠ¡çŠ¶æ€: $([ $services_status -eq 0 ] && echo 'æ­£å¸¸ âœ…' || echo 'å¼‚å¸¸ âŒ')"
        echo "4. å®‰å…¨é…ç½®: $([ $security_status -eq 0 ] && echo 'æ­£å¸¸ âœ…' || echo 'å¼‚å¸¸ âŒ')"
        echo "5. å¤‡ä»½çŠ¶æ€: $([ $backup_status -eq 0 ] && echo 'æ­£å¸¸ âœ…' || echo 'å¼‚å¸¸ âŒ')"
        echo "6. ç›‘æ§çŠ¶æ€: $([ $monitoring_status -eq 0 ] && echo 'æ­£å¸¸ âœ…' || echo 'å¼‚å¸¸ âŒ')"
        echo
        echo "### å»ºè®®æ“ä½œ"
        [ $system_status -ne 0 ] && echo "- æ£€æŸ¥ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ"
        [ $network_status -ne 0 ] && echo "- éªŒè¯ç½‘ç»œé…ç½®"
        [ $services_status -ne 0 ] && echo "- æ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€"
        [ $security_status -ne 0 ] && echo "- å®¡æŸ¥å®‰å…¨é…ç½®"
        [ $backup_status -ne 0 ] && echo "- ç¡®è®¤å¤‡ä»½æ˜¯å¦æ­£å¸¸"
        [ $monitoring_status -ne 0 ] && echo "- æ£€æŸ¥ç›‘æ§ç³»ç»Ÿ"
    } >> "$REPORT_FILE"
}

# ä¸»å‡½æ•°
main() {
    log "å¼€å§‹éƒ¨ç½²åæ£€æŸ¥..."
    
    # æ‰§è¡Œæ£€æŸ¥
    check_system_basics
    system_status=$?
    
    check_network
    network_status=$?
    
    check_services
    services_status=$?
    
    check_security
    security_status=$?
    
    check_backups
    backup_status=$?
    
    check_monitoring
    monitoring_status=$?
    
    # ç”Ÿæˆæ€»ç»“
    generate_summary
    
    # å‘é€é€šçŸ¥
    if [ $system_status -eq 0 ] && [ $network_status -eq 0 ] && \
       [ $services_status -eq 0 ] && [ $security_status -eq 0 ] && \
       [ $backup_status -eq 0 ] && [ $monitoring_status -eq 0 ]; then
        ~/send_notification.sh "éƒ¨ç½²æ£€æŸ¥å®Œæˆï¼šæ‰€æœ‰é¡¹ç›®æ­£å¸¸" "normal"
    else
        ~/send_notification.sh "éƒ¨ç½²æ£€æŸ¥å®Œæˆï¼šå­˜åœ¨éœ€è¦å…³æ³¨çš„é¡¹ç›®" "high"
    fi
    
    log "éƒ¨ç½²æ£€æŸ¥å®Œæˆï¼ŒæŠ¥å‘Šå·²ç”Ÿæˆ: $REPORT_FILE"
}

# æ‰§è¡Œæ£€æŸ¥
main
```
ã€Šæ ‘è“æ´¾æœåŠ¡éƒ¨ç½²ä¸ç»´æŠ¤å®Œæ•´æŒ‡å—ã€‹æ€»å…±åŒ…å«äº† 36 ä¸ªéƒ¨åˆ†ï¼Œæ¶µç›–äº†ä»ç³»ç»Ÿéƒ¨ç½²åˆ°ç»´æŠ¤çš„å„ä¸ªæ–¹é¢ã€‚æ¯ä¸ªè„šæœ¬éƒ½ç»è¿‡ç²¾å¿ƒè®¾è®¡ï¼Œå¯ä»¥ç‹¬ç«‹è¿è¡Œï¼Œä¹Ÿå¯ä»¥äº’ç›¸é…åˆä½¿ç”¨ã€‚

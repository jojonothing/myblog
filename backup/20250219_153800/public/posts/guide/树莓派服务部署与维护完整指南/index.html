<!doctype html><html lang=zh x-data :class=$store.darkMode.class() :data-theme=$store.darkMode.theme()><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>æ ‘è“æ´¾æœåŠ¡éƒ¨ç½²ä¸ç»´æŠ¤å®Œæ•´æŒ‡å— | èµµé›„å·çš„åšå®¢</title>
<link rel=canonical href=http://10.10.164.61/posts/guide/%E6%A0%91%E8%8E%93%E6%B4%BE%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2%E4%B8%8E%E7%BB%B4%E6%8A%A4%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/><meta name=author content="èµµé›„å·"><meta name=description content='æ ‘è“æ´¾æœåŠ¡éƒ¨ç½²ä¸ç»´æŠ¤å®Œæ•´æŒ‡å— ä¸€ã€ç³»ç»Ÿæ¦‚å†µ 1. ç¡¬ä»¶èµ„æº å¤„ç†å™¨: ARM64 æ¶æ„ æ€»å†…å­˜: 3.7GB å¯ç”¨å†…å­˜: ~2.5GB Swap: 512MB ç½‘ç»œ: wlan0 (IP: 10.40.110.47) 2. æœåŠ¡æ¦‚è§ˆ AI æ™ºèƒ½åŠ©æ‰‹ ç«¯å£: 8080 åŸºäº: llama.cpp æ¨¡å‹: Phi-3-mini-4k-instruct-q4.gguf èµ„æºå ç”¨: CPU: ~300% (å¤šæ ¸) å†…å­˜: ~3GB Swap: 511Mi ä¸ªäººåšå®¢ ç«¯å£: 80 æ¡†æ¶: Hugo v0.139.3-extended ä¸»é¢˜: Ananke WebæœåŠ¡å™¨: Nginx èµ„æºå ç”¨: è½»é‡çº§ 3. æœåŠ¡è®¿é—® AI åŠ©æ‰‹: http://10.40.110.47:8080 åšå®¢å¼€å‘: http://10.40.110.47:1313 åšå®¢æ­£å¼: http://10.40.110.47 äºŒã€AI æ™ºèƒ½åŠ©æ‰‹éƒ¨ç½² 1. ç¯å¢ƒå‡†å¤‡ # æ›´æ–°ç³»ç»Ÿ sudo apt update sudo apt upgrade -y # å®‰è£…ä¾èµ– sudo apt install build-essential git cmake 2. ç¼–è¯‘å®‰è£… # å…‹éš†ä»“åº“ git clone https://github.com/ggerganov/llama.cpp.git cd llama.cpp # ç¼–è¯‘ make clean LLAMA_METAL=1 make -j4 3. æ¨¡å‹é…ç½® # åˆ›å»ºæ¨¡å‹ç›®å½• mkdir models cd models # ä¸‹è½½æ¨¡å‹æ–‡ä»¶ wget [æ¨¡å‹ä¸‹è½½åœ°å€]/Phi-3-mini-4k-instruct-q4.gguf # éªŒè¯æ¨¡å‹æ–‡ä»¶ sha256sum Phi-3-mini-4k-instruct-q4.gguf 4. æœåŠ¡é…ç½® # åˆ›å»ºå¯åŠ¨è„šæœ¬ nano ~/projects/llama.cpp/start-llama.sh #!/bin/bash cd ~/projects/llama.cpp nohup ./llama-server \ -m models/Phi-3-mini-4k-instruct-q4.gguf \ --host 0.0.0.0 \ --port 8080 \ --ctx-size 2048 \ --threads 2 \ --batch-size 256 \ > llama.log 2>&amp;1 & # è®¾ç½®æ‰§è¡Œæƒé™ chmod +x start-llama.sh # å¯åŠ¨æœåŠ¡ ./start-llama.sh # éªŒè¯æœåŠ¡çŠ¶æ€ ps aux | grep llama-server netstat -tuln | grep 8080 ä¸‰ã€ä¸ªäººåšå®¢éƒ¨ç½² 1. Hugo å®‰è£… # ä¸‹è½½ Hugo Extended ç‰ˆæœ¬ wget https://github.com/gohugoio/hugo/releases/download/v0.139.3/hugo_extended_0.139.3_linux-arm64.deb # å®‰è£… sudo dpkg -i hugo_extended_0.139.3_linux-arm64.deb # éªŒè¯å®‰è£… hugo version 2. åšå®¢åˆå§‹åŒ– # åˆ›å»ºç«™ç‚¹ cd ~ hugo new site myblog cd myblog # åˆå§‹åŒ– Git git init # æ·»åŠ ä¸»é¢˜ git submodule add https://github.com/theNewDynamic/gohugo-theme-ananke.git themes/ananke 3. åšå®¢é…ç½® # ç¼–è¾‘é…ç½®æ–‡ä»¶ nano config.toml baseURL = "http://10.40.110.47/" languageCode = "zh-cn" title = "My Blog" theme = "ananke" [params] author = "Your Name" description = "Welcome to my blog" dateFormat = "2006-01-02" background_color_class = "bg-black" recent_posts_number = 3 mainSections = ["posts"] featured_image = false [menu] [[menu.main]] identifier = "posts" name = "æ–‡ç« " url = "/posts/" weight = 1 [[menu.main]] identifier = "about" name = "å…³äº" url = "/about/" weight = 2 4. Nginx é…ç½® # å®‰è£… Nginx sudo apt install nginx # åˆ›å»ºé…ç½®æ–‡ä»¶ sudo nano /etc/nginx/sites-available/myblog server { listen 80; server_name 10.40.110.47; root /home/zhaoxiongzhou/myblog/public; index index.html; location / { try_files $uri $uri/ =404; } access_log /var/log/nginx/myblog_access.log; error_log /var/log/nginx/myblog_error.log; } # å¯ç”¨é…ç½® sudo ln -s /etc/nginx/sites-available/myblog /etc/nginx/sites-enabled/ sudo rm /etc/nginx/sites-enabled/default # æµ‹è¯•é…ç½® sudo nginx -t # é‡å¯ Nginx sudo systemctl restart nginx å››ã€æƒé™ä¸è‡ªåŠ¨åŒ–é…ç½® 1. æƒé™è®¾ç½® # è®¾ç½®ç›®å½•æƒé™ sudo chmod 755 /home/zhaoxiongzhou sudo chmod -R 755 /home/zhaoxiongzhou/myblog # è®¾ç½®æ–‡ä»¶æ‰€æœ‰æƒ sudo chown -R www-data:www-data /home/zhaoxiongzhou/myblog/public # éªŒè¯æƒé™ ls -la ~/myblog/public ls -la /home/zhaoxiongzhou 2. è‡ªåŠ¨éƒ¨ç½²è„šæœ¬ # åˆ›å»ºåšå®¢éƒ¨ç½²è„šæœ¬ nano ~/deploy-blog.sh #!/bin/bash cd ~/myblog hugo sudo chown -R www-data:www-data public/ sudo systemctl restart nginx # è®¾ç½®æ‰§è¡Œæƒé™ chmod +x ~/deploy-blog.sh 3. å¤‡ä»½è„šæœ¬ # åˆ›å»ºå¤‡ä»½è„šæœ¬ nano ~/backup-blog.sh #!/bin/bash BACKUP_DIR="/home/zhaoxiongzhou/backups" DATE=$(date +%Y%m%d) # åˆ›å»ºå¤‡ä»½ç›®å½• mkdir -p $BACKUP_DIR # å¤‡ä»½åšå®¢å†…å®¹ tar -czf $BACKUP_DIR/blog_$DATE.tar.gz ~/myblog/content # å¤‡ä»½é…ç½®æ–‡ä»¶ cp ~/myblog/config.toml $BACKUP_DIR/config_$DATE.toml # åˆ é™¤30å¤©å‰çš„å¤‡ä»½ find $BACKUP_DIR -name "*.tar.gz" -mtime +30 -delete # è®¾ç½®æ‰§è¡Œæƒé™ chmod +x ~/backup-blog.sh # é…ç½®å®šæ—¶ä»»åŠ¡ crontab -e # æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼ˆæ¯å‘¨æ—¥å‡Œæ™¨2ç‚¹æ‰§è¡Œå¤‡ä»½ï¼‰ 0 2 * * 0 /home/zhaoxiongzhou/backup-blog.sh äº”ã€ç³»ç»Ÿç»´æŠ¤ä¸ç›‘æ§ 1. èµ„æºç›‘æ§å‘½ä»¤ # ç³»ç»Ÿèµ„æºç›‘æ§ htop top free -h vmstat 1 # ç£ç›˜ä½¿ç”¨ç›‘æ§ df -h du -sh /* du -sh ~/myblog du -sh ~/projects/llama.cpp # æ¸©åº¦ç›‘æ§ vcgencmd measure_temp 2. æ€§èƒ½ä¼˜åŒ– # æ¸…ç†ç³»ç»Ÿç¼“å­˜ sudo sync; echo 3 | sudo tee /proc/sys/vm/drop_caches # è°ƒæ•´ Swap è®¾ç½® cat /proc/sys/vm/swappiness sudo sysctl vm.swappiness=60 # CPU é¢‘ç‡è°ƒæ•´ sudo nano /boot/config.txt # CPU é…ç½®å‚æ•° arm_freq=1800 over_voltage=6 temp_limit=75 3. ç³»ç»Ÿç»´æŠ¤ # ç³»ç»Ÿæ›´æ–° sudo apt update sudo apt upgrade -y sudo apt autoremove sudo apt clean # æ—¥å¿—æ¸…ç† sudo find /var/log -type f -name "*.log" -mtime +30 -delete sudo find /var/log -type f -name "*.gz" -delete # æœåŠ¡çŠ¶æ€æ£€æŸ¥ systemctl status nginx ps aux | grep llama-server å…­ã€å®‰å…¨é…ç½® 1. é˜²ç«å¢™è®¾ç½® # å®‰è£… UFW sudo apt install ufw # é…ç½®åŸºæœ¬è§„åˆ™ sudo ufw default deny incoming sudo ufw default allow outgoing sudo ufw allow 22 sudo ufw allow 80 sudo ufw allow 8080 # å¯ç”¨é˜²ç«å¢™ sudo ufw enable # æ£€æŸ¥çŠ¶æ€ sudo ufw status 2. Nginx è®¿é—®æ§åˆ¶ # å®‰è£…è®¤è¯å·¥å…· sudo apt install apache2-utils # åˆ›å»ºç”¨æˆ·å¯†ç  sudo htpasswd -c /etc/nginx/.htpasswd username # ä¿®æ”¹ Nginx é…ç½® sudo nano /etc/nginx/sites-available/myblog server { listen 80; server_name 10.40.110.47; root /home/zhaoxiongzhou/myblog/public; index index.html; # æ·»åŠ åŸºæœ¬è®¤è¯ location / { auth_basic "Restricted Access"; auth_basic_user_file /etc/nginx/.htpasswd; try_files $uri $uri/ =404; } # æ—¥å¿—é…ç½® access_log /var/log/nginx/myblog_access.log; error_log /var/log/nginx/myblog_error.log; } 3. æ—¥å¿—ç›‘æ§ # å®‰è£…æ—¥å¿—ç›‘æ§å·¥å…· sudo apt install logwatch # é…ç½®æ—¥å¿—ç›‘æ§ sudo nano /etc/logwatch/conf/logwatch.conf # é…ç½®æ¯æ—¥æ—¥å¿—æ£€æŸ¥ Output = mail Format = html MailTo = your-email@domain.com Detail = High ä¸ƒã€æ•…éšœæ’é™¤æŒ‡å— å†…å­˜ç›¸å…³é—®é¢˜ # æ£€æŸ¥å†…å­˜çŠ¶æ€ free -h ps aux --sort=-%mem | head # å¦‚æœå†…å­˜ä¸è¶³ï¼Œè°ƒæ•´æœåŠ¡å‚æ•° nano ~/projects/llama.cpp/start-llama.sh # é™ä½èµ„æºä½¿ç”¨çš„å‚æ•°ç¤ºä¾‹ --ctx-size 1024 \ --batch-size 128 \ --threads 1 æœåŠ¡æ— å“åº” # æ£€æŸ¥è¿›ç¨‹ ps aux | grep llama-server # æ£€æŸ¥ç«¯å£ netstat -tuln | grep 8080 # é‡å¯æœåŠ¡ pkill llama-server ./start-llama.sh # æ£€æŸ¥æ—¥å¿— tail -f ~/projects/llama.cpp/llama.log 2. åšå®¢æœåŠ¡æ•…éšœæ’é™¤ Nginx é—®é¢˜ # æ£€æŸ¥é…ç½®è¯­æ³• sudo nginx -t # æ£€æŸ¥æ—¥å¿— sudo tail -f /var/log/nginx/error.log sudo tail -f /var/log/nginx/myblog_error.log # æ£€æŸ¥æœåŠ¡çŠ¶æ€ sudo systemctl status nginx # é‡å¯æœåŠ¡ sudo systemctl restart nginx Hugo ç”Ÿæˆé—®é¢˜ # æ¸…ç†ç¼“å­˜ rm -rf ~/myblog/public rm -rf ~/myblog/resources # æ›´æ–°ä¸»é¢˜ git submodule update --init --recursive # é‡æ–°ç”Ÿæˆï¼ˆè¯¦ç»†æ¨¡å¼ï¼‰ hugo --verbose å…«ã€ç³»ç»Ÿçº§æ•…éšœæ’é™¤ 1. ç£ç›˜é—®é¢˜ # æ£€æŸ¥ç£ç›˜ä½¿ç”¨æƒ…å†µ df -h du -sh /* # æŸ¥æ‰¾å¤§æ–‡ä»¶ sudo find / -type f -size +100M # æ¸…ç†ç©ºé—´ sudo apt clean sudo apt autoremove sudo journalctl --vacuum-time=7d 2. ç½‘ç»œé—®é¢˜ # ç½‘ç»œçŠ¶æ€æ£€æŸ¥ ip addr show ping -c 4 8.8.8.8 netstat -tuln # DNS æ£€æŸ¥ cat /etc/resolv.conf nslookup google.com # é‡å¯ç½‘ç»œæœåŠ¡ sudo systemctl restart networking sudo systemctl restart wpa_supplicant 3. æ€§èƒ½é—®é¢˜ # CPU æ¸©åº¦ç›‘æ§ vcgencmd measure_temp watch -n 1 vcgencmd measure_temp # CPU é¢‘ç‡æ£€æŸ¥ vcgencmd measure_clock arm cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_cur_freq # ç³»ç»Ÿè´Ÿè½½æ£€æŸ¥ uptime cat /proc/loadavg ä¹ã€ç»´æŠ¤æœ€ä½³å®è·µ 1. æ—¥å¸¸ç»´æŠ¤æ¸…å• æ£€æŸ¥ç³»ç»Ÿæ—¥å¿— ç›‘æ§èµ„æºä½¿ç”¨ éªŒè¯æœåŠ¡çŠ¶æ€ æ£€æŸ¥å¤‡ä»½çŠ¶æ€ æ›´æ–°ç³»ç»Ÿå®‰å…¨è¡¥ä¸ 2. å‘¨æœŸæ€§ç»´æŠ¤ä»»åŠ¡ æ¸…ç†æ—§æ—¥å¿—å’Œä¸´æ—¶æ–‡ä»¶ éªŒè¯å¤‡ä»½å®Œæ•´æ€§ æ£€æŸ¥ç³»ç»Ÿæ›´æ–° æ£€æŸ¥æœåŠ¡æ€§èƒ½ æ›´æ–°æ–‡æ¡£å’Œé…ç½®è¯´æ˜ 3. åº”æ€¥é¢„æ¡ˆ ä¿å­˜æ‰€æœ‰é…ç½®æ–‡ä»¶çš„å¤‡ä»½ è®°å½•æ‰€æœ‰æœåŠ¡çš„é…ç½®æ­¥éª¤ ç»´æŠ¤é—®é¢˜è§£å†³æ–¹æ¡ˆæ–‡æ¡£ å»ºç«‹æœåŠ¡æ¢å¤æµç¨‹ ä¿æŒé‡è¦æ•°æ®çš„å¤šä»½å¤‡ä»½ åã€æ€§èƒ½ä¼˜åŒ–å»ºè®® 1. ç³»ç»Ÿçº§ä¼˜åŒ– # 1. è°ƒæ•´ SWAP è®¾ç½® sudo nano /etc/sysctl.conf # æ·»åŠ æˆ–ä¿®æ”¹ä»¥ä¸‹å‚æ•° vm.swappiness=60 vm.vfs_cache_pressure=50 vm.dirty_background_ratio=5 vm.dirty_ratio=10 # 2. ä¼˜åŒ–æ–‡ä»¶ç³»ç»Ÿ # æ£€æŸ¥å¹¶ä¼˜åŒ–æ–‡ä»¶ç³»ç»Ÿ sudo tune2fs -o journal_data_writeback /dev/mmcblk0p2 # 3. è°ƒæ•´ CPU æ€§èƒ½ sudo nano /boot/config.txt # æ·»åŠ ä»¥ä¸‹é…ç½® arm_freq=1800 over_voltage=6 gpu_freq=500 dtparam=audio=on 2. æœåŠ¡ä¼˜åŒ– AI æœåŠ¡ä¼˜åŒ– # è°ƒæ•´æœåŠ¡å‚æ•° nano ~/projects/llama.cpp/start-llama.sh # ä¼˜åŒ–å‚æ•°ç¤ºä¾‹ --ctx-size 2048 \ --threads 2 \ --batch-size 256 \ --keep-context \ --mlock \ --numa Nginx ä¼˜åŒ– sudo nano /etc/nginx/nginx.conf worker_processes auto; worker_rlimit_nofile 65535; events { worker_connections 1024; multi_accept on; use epoll; } http { sendfile on; tcp_nopush on; tcp_nodelay on; keepalive_timeout 65; types_hash_max_size 2048; server_tokens off; # ç¼“å­˜è®¾ç½® open_file_cache max=1000 inactive=20s; open_file_cache_valid 30s; open_file_cache_min_uses 2; open_file_cache_errors on; } åä¸€ã€ç›‘æ§ä¸æŠ¥è­¦ç³»ç»Ÿ 1. ç³»ç»Ÿç›‘æ§é…ç½® # å®‰è£…ç›‘æ§å·¥å…· sudo apt install prometheus node-exporter grafana # é…ç½® Prometheus sudo nano /etc/prometheus/prometheus.yml global: scrape_interval: 15s scrape_configs: - job_name: &#39;node&#39; static_configs: - targets: [&#39;localhost:9100&#39;] - job_name: &#39;nginx&#39; static_configs: - targets: [&#39;localhost:9113&#39;] 2. è‡ªåŠ¨æŠ¥è­¦è„šæœ¬ # åˆ›å»ºç›‘æ§è„šæœ¬ nano ~/monitor.sh #!/bin/bash # å®šä¹‰é˜ˆå€¼ MAX_CPU_USAGE=90 MAX_MEM_USAGE=90 MAX_DISK_USAGE=90 MAX_TEMP=75 # è·å–ç³»ç»Ÿæ•°æ® CPU_USAGE=$(top -bn1 | grep "Cpu(s)" | awk &#39;{print $2}&#39; | cut -d. -f1) MEM_USAGE=$(free | grep Mem | awk &#39;{print $3/$2 * 100.0}&#39;) DISK_USAGE=$(df -h / | awk &#39;NR==2 {print $5}&#39; | cut -d% -f1) TEMP=$(vcgencmd measure_temp | cut -d= -f2 | cut -d. -f1) # æ£€æŸ¥æœåŠ¡çŠ¶æ€ check_services() { services=("nginx" "llama-server") for service in "${services[@]}"; do if ! pgrep -x "$service" > /dev/null; then echo "è­¦å‘Š: $service æœåŠ¡æœªè¿è¡Œ!" # å¯ä»¥æ·»åŠ é‡å¯æœåŠ¡çš„å‘½ä»¤ fi done } # å‘é€è­¦å‘Š send_alert() { message="$1" # è¿™é‡Œå¯ä»¥æ·»åŠ å‘é€é‚®ä»¶æˆ–å…¶ä»–é€šçŸ¥çš„å‘½ä»¤ echo "$message" >> /var/log/system_alerts.log } # æ£€æŸ¥å„é¡¹æŒ‡æ ‡ if [ "$CPU_USAGE" -gt "$MAX_CPU_USAGE" ]; then send_alert "CPU ä½¿ç”¨ç‡è¿‡é«˜: $CPU_USAGE%" fi if [ "${MEM_USAGE%.*}" -gt "$MAX_MEM_USAGE" ]; then send_alert "å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜: $MEM_USAGE%" fi if [ "$DISK_USAGE" -gt "$MAX_DISK_USAGE" ]; then send_alert "ç£ç›˜ä½¿ç”¨ç‡è¿‡é«˜: $DISK_USAGE%" fi if [ "$TEMP" -gt "$MAX_TEMP" ]; then send_alert "ç³»ç»Ÿæ¸©åº¦è¿‡é«˜: $TEMPÂ°C" fi # æ£€æŸ¥æœåŠ¡çŠ¶æ€ check_services # è®¾ç½®æ‰§è¡Œæƒé™ chmod +x ~/monitor.sh # æ·»åŠ åˆ° crontab crontab -e # æ¯5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ç›‘æ§ */5 * * * * /home/zhaoxiongzhou/monitor.sh åäºŒã€æ•°æ®å¤‡ä»½ä¸æ¢å¤ 1. å®Œæ•´å¤‡ä»½æ–¹æ¡ˆ # åˆ›å»ºå®Œæ•´å¤‡ä»½è„šæœ¬ nano ~/full-backup.sh #!/bin/bash BACKUP_ROOT="/home/zhaoxiongzhou/backups" DATE=$(date +%Y%m%d_%H%M%S) BACKUP_DIR="$BACKUP_ROOT/$DATE" # åˆ›å»ºå¤‡ä»½ç›®å½• mkdir -p "$BACKUP_DIR" # å¤‡ä»½åšå®¢å†…å®¹ echo "å¤‡ä»½åšå®¢å†…å®¹..." tar -czf "$BACKUP_DIR/blog_content.tar.gz" ~/myblog/content tar -czf "$BACKUP_DIR/blog_config.tar.gz" ~/myblog/config.toml # å¤‡ä»½ AI æ¨¡å‹å’Œé…ç½® echo "å¤‡ä»½ AI æœåŠ¡..." tar -czf "$BACKUP_DIR/llama_models.tar.gz" ~/projects/llama.cpp/models tar -czf "$BACKUP_DIR/llama_config.tar.gz" ~/projects/llama.cpp/start-llama.sh # å¤‡ä»½ Nginx é…ç½® echo "å¤‡ä»½ Nginx é…ç½®..." sudo tar -czf "$BACKUP_DIR/nginx_config.tar.gz" /etc/nginx/sites-available/myblog # å¤‡ä»½ç³»ç»Ÿé…ç½® echo "å¤‡ä»½ç³»ç»Ÿé…ç½®..." sudo tar -czf "$BACKUP_DIR/system_config.tar.gz" /boot/config.txt /etc/fstab # åˆ›å»ºå¤‡ä»½æ¸…å• echo "åˆ›å»ºå¤‡ä»½æ¸…å•..." find "$BACKUP_DIR" -type f -exec sha256sum {} \; > "$BACKUP_DIR/checksum.txt" # æ¸…ç†æ—§å¤‡ä»½ï¼ˆä¿ç•™æœ€è¿‘7ä»½ï¼‰ cd "$BACKUP_ROOT" ls -t | tail -n +8 | xargs -r rm -r echo "å¤‡ä»½å®Œæˆ: $BACKUP_DIR" 2. æ•°æ®æ¢å¤æµç¨‹ # åˆ›å»ºæ¢å¤è„šæœ¬ nano ~/restore.sh #!/bin/bash if [ -z "$1" ]; then echo "ä½¿ç”¨æ–¹æ³•: $0 <å¤‡ä»½ç›®å½•>" exit 1 fi BACKUP_DIR="$1" # éªŒè¯å¤‡ä»½å®Œæ•´æ€§ echo "éªŒè¯å¤‡ä»½å®Œæ•´æ€§..." cd "$BACKUP_DIR" sha256sum -c checksum.txt || { echo "å¤‡ä»½éªŒè¯å¤±è´¥ï¼" exit 1 } # æ¢å¤åšå®¢å†…å®¹ echo "æ¢å¤åšå®¢å†…å®¹..." tar -xzf "$BACKUP_DIR/blog_content.tar.gz" -C ~/myblog/ tar -xzf "$BACKUP_DIR/blog_config.tar.gz" -C ~/myblog/ # æ¢å¤ AI æœåŠ¡ echo "æ¢å¤ AI æœåŠ¡..." tar -xzf "$BACKUP_DIR/llama_models.tar.gz" -C ~/projects/llama.cpp/ tar -xzf "$BACKUP_DIR/llama_config.tar.gz" -C ~/projects/llama.cpp/ # æ¢å¤ Nginx é…ç½® echo "æ¢å¤ Nginx é…ç½®..." sudo tar -xzf "$BACKUP_DIR/nginx_config.tar.gz" -C /etc/nginx/sites-available/ # æ¢å¤ç³»ç»Ÿé…ç½® echo "æ¢å¤ç³»ç»Ÿé…ç½®..." sudo tar -xzf "$BACKUP_DIR/system_config.tar.gz" -C / # é‡å¯æœåŠ¡ echo "é‡å¯æœåŠ¡..." sudo systemctl restart nginx pkill llama-server ~/projects/llama.cpp/start-llama.sh echo "æ¢å¤å®Œæˆ" åä¸‰ã€æœåŠ¡å‡çº§æŒ‡å— 1. Hugo åšå®¢å‡çº§ # 1. å¤‡ä»½å½“å‰ç‰ˆæœ¬ cd ~ tar -czf hugo_backup_$(date +%Y%m%d).tar.gz myblog/ # 2. æ£€æŸ¥å½“å‰ç‰ˆæœ¬ hugo version # 3. ä¸‹è½½æ–°ç‰ˆæœ¬ wget https://github.com/gohugoio/hugo/releases/download/v[æ–°ç‰ˆæœ¬]/hugo_extended_[æ–°ç‰ˆæœ¬]_linux-arm64.deb # 4. å®‰è£…æ–°ç‰ˆæœ¬ sudo dpkg -i hugo_extended_[æ–°ç‰ˆæœ¬]_linux-arm64.deb # 5. æ›´æ–°ä¸»é¢˜ cd ~/myblog git submodule update --remote themes/ananke # 6. æµ‹è¯•ç”Ÿæˆ hugo --verbose # 7. éƒ¨ç½²æ›´æ–° ./deploy-blog.sh 2. AI æœåŠ¡å‡çº§ # 1. å¤‡ä»½å½“å‰ç‰ˆæœ¬ cd ~/projects tar -czf llama_backup_$(date +%Y%m%d).tar.gz llama.cpp/ # 2. æ›´æ–°æºç  cd llama.cpp git pull origin master # 3. é‡æ–°ç¼–è¯‘ make clean LLAMA_METAL=1 make -j4 # 4. æµ‹è¯•æ–°ç‰ˆæœ¬ ./llama-server -h # 5. æ›´æ–°å¯åŠ¨è„šæœ¬ nano start-llama.sh 3. ç³»ç»Ÿå‡çº§ # 1. æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ sudo apt update # 2. å‡çº§æ‰€æœ‰åŒ… sudo apt upgrade -y # 3. å‡çº§ç³»ç»Ÿ sudo apt dist-upgrade -y # 4. æ¸…ç†æ—§åŒ… sudo apt autoremove -y sudo apt clean # 5. æ£€æŸ¥å¯åŠ¨é¡¹ sudo systemctl list-unit-files --state=enabled # 6. æ›´æ–°æ ‘è“æ´¾å›ºä»¶ sudo rpi-update # 7. æ£€æŸ¥ç³»ç»ŸçŠ¶æ€ sudo systemctl --failed sudo journalctl -p 3 -xb åå››ã€å®‰å…¨åŠ å›ºæŒ‡å— 1. ç³»ç»Ÿå®‰å…¨é…ç½® # 1. SSH å®‰å…¨é…ç½® sudo nano /etc/ssh/sshd_config # SSH é…ç½®å»ºè®® Port 22222 # ä¿®æ”¹é»˜è®¤ç«¯å£ PermitRootLogin no # ç¦æ­¢ root ç™»å½• PasswordAuthentication no # ç¦ç”¨å¯†ç è®¤è¯ PubkeyAuthentication yes # å¯ç”¨å¯†é’¥è®¤è¯ AllowUsers zhaoxiongzhou # é™åˆ¶å…è®¸çš„ç”¨æˆ· # 2. è®¾ç½®é˜²ç«å¢™è§„åˆ™ sudo apt install ufw fail2ban # é…ç½® UFW sudo ufw default deny incoming sudo ufw default allow outgoing sudo ufw allow 22222/tcp # SSH sudo ufw allow 80/tcp # HTTP sudo ufw allow 8080/tcp # AI æœåŠ¡ sudo ufw enable # é…ç½® fail2ban sudo nano /etc/fail2ban/jail.local [sshd] enabled = true port = 22222 filter = sshd logpath = /var/log/auth.log maxretry = 3 bantime = 3600 2. æœåŠ¡å®‰å…¨é…ç½® Nginx å®‰å…¨è®¾ç½® # 1. åˆ›å»º SSL è¯ä¹¦ sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 \ -keyout /etc/nginx/ssl/nginx.key \ -out /etc/nginx/ssl/nginx.crt # 2. é…ç½® HTTPS sudo nano /etc/nginx/sites-available/myblog server { listen 443 ssl; server_name 10.40.110.47; ssl_certificate /etc/nginx/ssl/nginx.crt; ssl_certificate_key /etc/nginx/ssl/nginx.key; # SSL é…ç½® ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers on; ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options "SAMEORIGIN"; add_header X-XSS-Protection "1; mode=block"; add_header X-Content-Type-Options "nosniff"; add_header Strict-Transport-Security "max-age=31536000"; # å…¶ä»–é…ç½®... } åäº”ã€æ€§èƒ½ç›‘æ§ä¸åˆ†æ 1. ç›‘æ§è„šæœ¬é…ç½® # åˆ›å»ºç»¼åˆç›‘æ§è„šæœ¬ nano ~/system_monitor.sh #!/bin/bash LOG_FILE="/var/log/system_monitor.log" ALERT_FILE="/var/log/system_alerts.log" # è®°å½•æ—¶é—´æˆ³ timestamp() { date "+%Y-%m-%d %H:%M:%S" } # ç³»ç»Ÿèµ„æºç›‘æ§ monitor_resources() { echo "=== ç³»ç»Ÿèµ„æºç›‘æ§ $(timestamp) ===" >> "$LOG_FILE" # CPU ä½¿ç”¨ç‡ CPU_USAGE=$(top -bn1 | grep "Cpu(s)" | awk &#39;{print $2}&#39;) echo "CPU ä½¿ç”¨ç‡: $CPU_USAGE%" >> "$LOG_FILE" # å†…å­˜ä½¿ç”¨ free -h | grep "Mem:" >> "$LOG_FILE" # ç£ç›˜ä½¿ç”¨ df -h / >> "$LOG_FILE" # ç³»ç»Ÿè´Ÿè½½ uptime >> "$LOG_FILE" # CPU æ¸©åº¦ vcgencmd measure_temp >> "$LOG_FILE" } # æœåŠ¡çŠ¶æ€ç›‘æ§ monitor_services() { echo "=== æœåŠ¡çŠ¶æ€ç›‘æ§ $(timestamp) ===" >> "$LOG_FILE" # Nginx çŠ¶æ€ if systemctl is-active nginx >/dev/null 2>&amp;1; then echo "Nginx: è¿è¡Œä¸­" >> "$LOG_FILE" else echo "è­¦å‘Š: Nginx æœªè¿è¡Œ!" >> "$ALERT_FILE" fi # AI æœåŠ¡çŠ¶æ€ if pgrep -f llama-server >/dev/null; then echo "AI æœåŠ¡: è¿è¡Œä¸­" >> "$LOG_FILE" else echo "è­¦å‘Š: AI æœåŠ¡æœªè¿è¡Œ!" >> "$ALERT_FILE" fi } # ç½‘ç»œç›‘æ§ monitor_network() { echo "=== ç½‘ç»œç›‘æ§ $(timestamp) ===" >> "$LOG_FILE" # ç½‘ç»œè¿æ¥æ•° netstat -an | grep ESTABLISHED | wc -l >> "$LOG_FILE" # ç½‘ç»œæµé‡ ifconfig wlan0 | grep bytes >> "$LOG_FILE" } # ä¸»å‡½æ•° main() { monitor_resources monitor_services monitor_network # æ£€æŸ¥æ˜¯å¦éœ€è¦å‘é€è­¦å‘Š if [ -s "$ALERT_FILE" ]; then # å¯ä»¥æ·»åŠ å‘é€è­¦å‘Šçš„å‘½ä»¤ï¼ˆå¦‚é‚®ä»¶é€šçŸ¥ï¼‰ cat "$ALERT_FILE" fi } # æ‰§è¡Œç›‘æ§ main 2. æ€§èƒ½åˆ†æå·¥å…· # å®‰è£…æ€§èƒ½åˆ†æå·¥å…· sudo apt install sysstat iotop htop # åˆ›å»ºæ€§èƒ½æ•°æ®æ”¶é›†è„šæœ¬ nano ~/collect_performance.sh åå…­ã€æ€§èƒ½æ•°æ®æ”¶é›†ä¸åˆ†æ 1. æ€§èƒ½æ•°æ®æ”¶é›†è„šæœ¬ #!/bin/bash # ~/collect_performance.sh PERF_DIR="/home/zhaoxiongzhou/performance_data" DATE=$(date +%Y%m%d_%H%M%S) # åˆ›å»ºæ•°æ®ç›®å½• mkdir -p "$PERF_DIR/$DATE" # CPU æ€§èƒ½æ•°æ® mpstat 1 60 > "$PERF_DIR/$DATE/cpu_stats.log" & # å†…å­˜ä½¿ç”¨æ•°æ® vmstat 1 60 > "$PERF_DIR/$DATE/memory_stats.log" & # IO æ€§èƒ½æ•°æ® iostat -x 1 60 > "$PERF_DIR/$DATE/io_stats.log" & # ç½‘ç»œæ€§èƒ½æ•°æ® sar -n DEV 1 60 > "$PERF_DIR/$DATE/network_stats.log" & # è¿›ç¨‹æ€§èƒ½æ•°æ® ps aux --sort=-%cpu | head -n 20 > "$PERF_DIR/$DATE/top_processes.log" # ç³»ç»Ÿè´Ÿè½½æ•°æ® uptime > "$PERF_DIR/$DATE/load_average.log" # ç­‰å¾…æ‰€æœ‰åå°è¿›ç¨‹å®Œæˆ wait # å‹ç¼©æ•°æ® tar -czf "$PERF_DIR/performance_${DATE}.tar.gz" "$PERF_DIR/$DATE" rm -rf "$PERF_DIR/$DATE" 2. æ€§èƒ½æ•°æ®åˆ†æè„šæœ¬ # åˆ›å»ºåˆ†æè„šæœ¬ nano ~/analyze_performance.sh #!/bin/bash # ~/analyze_performance.sh PERF_DIR="/home/zhaoxiongzhou/performance_data" REPORT_DIR="/home/zhaoxiongzhou/performance_reports" DATE=$(date +%Y%m%d) mkdir -p "$REPORT_DIR" generate_report() { local REPORT_FILE="$REPORT_DIR/report_${DATE}.txt" echo "æ€§èƒ½åˆ†ææŠ¥å‘Š - $(date)" > "$REPORT_FILE" echo "===================" >> "$REPORT_FILE" # CPU ä½¿ç”¨åˆ†æ echo -e "\nCPU ä½¿ç”¨æƒ…å†µ:" >> "$REPORT_FILE" awk &#39;/all/ {total += $3; count++} END {print "å¹³å‡CPUä½¿ç”¨ç‡: " total/count "%"}&#39; \ "$PERF_DIR/latest/cpu_stats.log" >> "$REPORT_FILE" # å†…å­˜ä½¿ç”¨åˆ†æ echo -e "\nå†…å­˜ä½¿ç”¨æƒ…å†µ:" >> "$REPORT_FILE" free -h | grep "Mem:" >> "$REPORT_FILE" # IO æ€§èƒ½åˆ†æ echo -e "\nIO æ€§èƒ½:" >> "$REPORT_FILE" tail -n 10 "$PERF_DIR/latest/io_stats.log" >> "$REPORT_FILE" # ç½‘ç»œæ€§èƒ½åˆ†æ echo -e "\nç½‘ç»œæ€§èƒ½:" >> "$REPORT_FILE" tail -n 10 "$PERF_DIR/latest/network_stats.log" >> "$REPORT_FILE" # è¿›ç¨‹åˆ†æ echo -e "\nèµ„æºå ç”¨æœ€é«˜çš„è¿›ç¨‹:" >> "$REPORT_FILE" head -n 5 "$PERF_DIR/latest/top_processes.log" >> "$REPORT_FILE" echo -e "\nåˆ†æå®Œæˆã€‚æŠ¥å‘Šä¿å­˜åœ¨: $REPORT_FILE" } # ç”ŸæˆæŠ¥å‘Š generate_report åä¸ƒã€è‡ªåŠ¨åŒ–è¿ç»´è„šæœ¬ 1. æœåŠ¡å¥åº·æ£€æŸ¥ä¸è‡ªåŠ¨æ¢å¤ # åˆ›å»ºæœåŠ¡ç›‘æ§è„šæœ¬ nano ~/service_health_check.sh #!/bin/bash # ~/service_health_check.sh LOG_FILE="/var/log/service_health.log" ALERT_SCRIPT="/home/zhaoxiongzhou/send_alert.sh" log_message() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" >> "$LOG_FILE" } check_and_restart_service() { local service_name="$1" local process_pattern="$2" if ! pgrep -f "$process_pattern" > /dev/null; then log_message "è­¦å‘Š: $service_name æœåŠ¡æœªè¿è¡Œï¼Œå°è¯•é‡å¯" case "$service_name" in "nginx") sudo systemctl restart nginx ;; "llama-server") cd ~/projects/llama.cpp ./start-llama.sh ;; esac # ç­‰å¾…æœåŠ¡å¯åŠ¨ sleep 10 # éªŒè¯æœåŠ¡æ˜¯å¦æˆåŠŸé‡å¯ if pgrep -f "$process_pattern" > /dev/null; then log_message "$service_name æœåŠ¡å·²æˆåŠŸé‡å¯" "$ALERT_SCRIPT" "$service_name æœåŠ¡å·²è‡ªåŠ¨é‡å¯" else log_message "é”™è¯¯: $service_name æœåŠ¡é‡å¯å¤±è´¥" "$ALERT_SCRIPT" "è­¦å‘Š: $service_name æœåŠ¡é‡å¯å¤±è´¥ï¼Œéœ€è¦æ‰‹åŠ¨å¹²é¢„" fi else log_message "$service_name æœåŠ¡è¿è¡Œæ­£å¸¸" fi } # æ£€æŸ¥å„ä¸ªæœåŠ¡ check_and_restart_service "nginx" "nginx" check_and_restart_service "llama-server" "llama-server" # æ¸…ç†æ—§æ—¥å¿— find "$LOG_FILE" -mtime +30 -delete 2. è‡ªåŠ¨å¤‡ä»½ä¸æ¸…ç† # åˆ›å»ºè‡ªåŠ¨ç»´æŠ¤è„šæœ¬ nano ~/auto_maintenance.sh #!/bin/bash # ~/auto_maintenance.sh BACKUP_DIR="/home/zhaoxiongzhou/backups" LOG_DIR="/var/log" DATE=$(date +%Y%m%d) # åˆ›å»ºå¤‡ä»½ create_backups() { # åšå®¢å¤‡ä»½ tar -czf "$BACKUP_DIR/blog_$DATE.tar.gz" ~/myblog/content # AI æœåŠ¡é…ç½®å¤‡ä»½ tar -czf "$BACKUP_DIR/llama_config_$DATE.tar.gz" ~/projects/llama.cpp/start-llama.sh # Nginx é…ç½®å¤‡ä»½ sudo tar -czf "$BACKUP_DIR/nginx_config_$DATE.tar.gz" /etc/nginx/sites-available/ } # æ¸…ç†æ—§æ–‡ä»¶ cleanup_old_files() { # åˆ é™¤30å¤©å‰çš„å¤‡ä»½ find "$BACKUP_DIR" -name "*.tar.gz" -mtime +30 -delete # æ¸…ç†æ—¥å¿— sudo find "$LOG_DIR" -name "*.log" -mtime +30 -delete sudo find "$LOG_DIR" -name "*.gz" -mtime +30 -delete # æ¸…ç†ç³»ç»Ÿä¸´æ—¶æ–‡ä»¶ sudo rm -rf /tmp/* sudo rm -rf /var/tmp/* } # ä¸»å‡½æ•° main() { create_backups cleanup_old_files # å‹ç¼©æ—¥å¿— sudo logrotate -f /etc/logrotate.conf # æ¸…ç†åŒ…ç¼“å­˜ sudo apt clean sudo apt autoremove -y } # æ‰§è¡Œç»´æŠ¤ä»»åŠ¡ main åå…«ã€æ—¥å¿—ç®¡ç†ç³»ç»Ÿ 1. é›†ä¸­å¼æ—¥å¿—é…ç½® # åˆ›å»ºæ—¥å¿—ç®¡ç†è„šæœ¬ nano ~/log_management.sh #!/bin/bash # ~/log_management.sh LOG_BASE="/var/log/services" ARCHIVE_DIR="/home/zhaoxiongzhou/log_archives" DATE=$(date +%Y%m%d) # åˆ›å»ºæ—¥å¿—ç›®å½• mkdir -p "$LOG_BASE"/{nginx,ai_service,system} mkdir -p "$ARCHIVE_DIR" # é…ç½®æ—¥å¿—è½®è½¬ sudo tee /etc/logrotate.d/custom_services << EOF $LOG_BASE/nginx/*.log { daily missingok rotate 14 compress delaycompress notifempty create 0640 www-data adm sharedscripts postrotate [ -f /var/run/nginx.pid ] && kill -USR1 \$(cat /var/run/nginx.pid) endscript } $LOG_BASE/ai_service/*.log { daily missingok rotate 14 compress delaycompress notifempty create 0640 zhaoxiongzhou adm } $LOG_BASE/system/*.log { daily missingok rotate 30 compress delaycompress notifempty create 0640 root adm } EOF # æ—¥å¿—åˆ†æå‡½æ•° analyze_logs() { local log_file="$1" local output_file="$2" echo "=== æ—¥å¿—åˆ†ææŠ¥å‘Š $(date) ===" > "$output_file" # é”™è¯¯ç»Ÿè®¡ echo -e "\né”™è¯¯ç»Ÿè®¡:" >> "$output_file" grep -i "error" "$log_file" | sort | uniq -c | sort -nr >> "$output_file" # è­¦å‘Šç»Ÿè®¡ echo -e "\nè­¦å‘Šç»Ÿè®¡:" >> "$output_file" grep -i "warning" "$log_file" | sort | uniq -c | sort -nr >> "$output_file" # è®¿é—®ç»Ÿè®¡ï¼ˆé’ˆå¯¹ Nginx è®¿é—®æ—¥å¿—ï¼‰ if [[ "$log_file" == *"nginx/access"* ]]; then echo -e "\nè®¿é—®é‡ç»Ÿè®¡:" >> "$output_file" awk &#39;{print $1}&#39; "$log_file" | sort | uniq -c | sort -nr | head -n 10 >> "$output_file" fi } # æ—¥å¿—å½’æ¡£å‡½æ•° archive_logs() { local source_dir="$1" local archive_name="logs_${DATE}.tar.gz" find "$source_dir" -name "*.log.*" -mtime +14 -exec tar -czf "$ARCHIVE_DIR/$archive_name" {} + find "$source_dir" -name "*.log.*" -mtime +14 -delete } 2. æ—¥å¿—ç›‘æ§å‘Šè­¦ # åˆ›å»ºæ—¥å¿—ç›‘æ§è„šæœ¬ nano ~/log_monitor.sh #!/bin/bash # ~/log_monitor.sh ALERT_THRESHOLD=10 # é”™è¯¯é˜ˆå€¼ ALERT_SCRIPT="/home/zhaoxiongzhou/send_alert.sh" # ç›‘æ§ç‰¹å®šå…³é”®è¯ monitor_keywords() { local log_file="$1" local keywords=("error" "critical" "failed" "timeout" "exception") for keyword in "${keywords[@]}"; do count=$(grep -i "$keyword" "$log_file" | wc -l) if [ "$count" -gt "$ALERT_THRESHOLD" ]; then "$ALERT_SCRIPT" "è­¦å‘Š: $log_file ä¸­å‘ç°å¤§é‡ $keyword ($count æ¬¡)" fi done } # ç›‘æ§æ—¥å¿—å¤§å° check_log_size() { local log_file="$1" local max_size=$((100 * 1024 * 1024)) # 100MB size=$(stat -f%z "$log_file") if [ "$size" -gt "$max_size" ]; then "$ALERT_SCRIPT" "è­¦å‘Š: $log_file å¤§å°è¶…è¿‡ 100MB" fi } # ä¸»ç›‘æ§å¾ªç¯ main() { while true; do for log_file in "$LOG_BASE"/**/*.log; do monitor_keywords "$log_file" check_log_size "$log_file" done sleep 300 # æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ done } main & åä¹ã€ç³»ç»Ÿä¼˜åŒ–ä¸è°ƒä¼˜ 1. ç³»ç»Ÿå‚æ•°ä¼˜åŒ– # åˆ›å»ºç³»ç»Ÿä¼˜åŒ–è„šæœ¬ nano ~/system_optimize.sh #!/bin/bash # ~/system_optimize.sh # ç³»ç»Ÿå‚æ•°ä¼˜åŒ– optimize_sysctl() { sudo tee /etc/sysctl.d/99-custom.conf << EOF # å†…å­˜ç®¡ç†ä¼˜åŒ– vm.swappiness = 60 vm.vfs_cache_pressure = 50 vm.dirty_background_ratio = 5 vm.dirty_ratio = 10 # ç½‘ç»œä¼˜åŒ– net.core.somaxconn = 1024 net.core.netdev_max_backlog = 5000 net.ipv4.tcp_max_syn_backlog = 2048 net.ipv4.tcp_fin_timeout = 20 net.ipv4.tcp_keepalive_time = 1200 net.ipv4.tcp_keepalive_intvl = 15 net.ipv4.tcp_keepalive_probes = 5 # æ–‡ä»¶ç³»ç»Ÿä¼˜åŒ– fs.file-max = 65535 fs.inotify.max_user_watches = 524288 EOF # åº”ç”¨æ–°çš„ç³»ç»Ÿå‚æ•° sudo sysctl -p /etc/sysctl.d/99-custom.conf } # CPU é¢‘ç‡ä¼˜åŒ– optimize_cpu() { sudo tee /boot/config.txt << EOF # CPU è®¾ç½® arm_freq=1800 over_voltage=6 gpu_freq=500 # æ¸©åº¦æ§åˆ¶ temp_limit=75 EOF } # æœåŠ¡ä¼˜åŒ– optimize_services() { # ç¦ç”¨ä¸å¿…è¦çš„æœåŠ¡ UNNECESSARY_SERVICES=( "bluetooth" "cups" "avahi-daemon" ) for service in "${UNNECESSARY_SERVICES[@]}"; do if systemctl is-enabled "$service" &>/dev/null; then sudo systemctl disable "$service" sudo systemctl stop "$service" fi done } # å†…å­˜ä¼˜åŒ– optimize_memory() { # è°ƒæ•´ ZRAM sudo tee /etc/default/zramswap << EOF ALGO=lz4 PERCENT=50 EOF # é‡å¯ ZRAM æœåŠ¡ sudo systemctl restart zramswap } 2. æœåŠ¡ä¼˜åŒ–é…ç½® # Nginx ä¼˜åŒ–é…ç½® sudo nano /etc/nginx/nginx.conf user www-data; worker_processes auto; worker_rlimit_nofile 65535; events { worker_connections 1024; multi_accept on; use epoll; } http { # åŸºç¡€è®¾ç½® sendfile on; tcp_nopush on; tcp_nodelay on; keepalive_timeout 65; types_hash_max_size 2048; server_tokens off; # MIME ç±»å‹ include /etc/nginx/mime.types; default_type application/octet-stream; # æ—¥å¿—æ ¼å¼ log_format main &#39;$remote_addr - $remote_user [$time_local] "$request" &#39; &#39;$status $body_bytes_sent "$http_referer" &#39; &#39;"$http_user_agent" "$http_x_forwarded_for"&#39;; # ç¼“å†²åŒºè®¾ç½® client_body_buffer_size 10K; client_header_buffer_size 1k; client_max_body_size 8m; large_client_header_buffers 2 1k; # è¶…æ—¶è®¾ç½® client_body_timeout 12; client_header_timeout 12; send_timeout 10; # ç¼“å­˜è®¾ç½® open_file_cache max=1000 inactive=20s; open_file_cache_valid 30s; open_file_cache_min_uses 2; open_file_cache_errors on; # Gzip å‹ç¼© gzip on; gzip_vary on; gzip_proxied any; gzip_comp_level 6; gzip_types text/plain text/css text/xml application/json application/javascript application/xml+rss application/atom+xml image/svg+xml; } äºŒåã€æœåŠ¡ç›‘æ§é¢æ¿é…ç½® 1. Grafana ç›‘æ§ç³»ç»Ÿé…ç½® # å®‰è£… Grafana sudo apt-get install -y apt-transport-https sudo apt-get install -y software-properties-common wget wget -q -O - https://packages.grafana.com/gpg.key | sudo apt-key add - echo "deb https://packages.grafana.com/oss/deb stable main" | sudo tee -a /etc/apt/sources.list.d/grafana.list sudo apt-get update sudo apt-get install -y grafana # é…ç½® Grafana sudo nano /etc/grafana/grafana.ini [server] http_addr = 0.0.0.0 http_port = 3000 [security] admin_user = admin admin_password = your_secure_password [auth.anonymous] enabled = false [paths] data = /var/lib/grafana logs = /var/log/grafana plugins = /var/lib/grafana/plugins [dashboards] versions_to_keep = 20 2. Prometheus é…ç½® # å®‰è£… Prometheus sudo apt-get install -y prometheus # é…ç½® Prometheus sudo nano /etc/prometheus/prometheus.yml global: scrape_interval: 15s evaluation_interval: 15s scrape_configs: - job_name: &#39;node&#39; static_configs: - targets: [&#39;localhost:9100&#39;] - job_name: &#39;nginx&#39; static_configs: - targets: [&#39;localhost:9113&#39;] - job_name: &#39;system&#39; static_configs: - targets: [&#39;localhost:9090&#39;] - job_name: &#39;process&#39; static_configs: - targets: [&#39;localhost:9256&#39;] 3. Node Exporter é…ç½® # å®‰è£… Node Exporter sudo apt-get install -y prometheus-node-exporter # åˆ›å»ºè‡ªå®šä¹‰æŒ‡æ ‡æ”¶é›†è„šæœ¬ nano ~/custom_metrics.sh #!/bin/bash # ~/custom_metrics.sh # åˆ›å»ºæŒ‡æ ‡æ–‡ä»¶ METRICS_FILE="/var/lib/node_exporter/custom_metrics.prom" while true; do # CPU æ¸©åº¦ CPU_TEMP=$(vcgencmd measure_temp | sed &#39;s/temp=//&#39; | sed &#39;s/&#39;"&#39;"&#39;C//&#39;) echo "raspberry_pi_cpu_temperature $CPU_TEMP" > "$METRICS_FILE" # AI æœåŠ¡çŠ¶æ€ if pgrep -f llama-server > /dev/null; then echo "ai_service_status 1" >> "$METRICS_FILE" else echo "ai_service_status 0" >> "$METRICS_FILE" fi # åšå®¢æœåŠ¡çŠ¶æ€ if systemctl is-active nginx > /dev/null; then echo "blog_service_status 1" >> "$METRICS_FILE" else echo "blog_service_status 0" >> "$METRICS_FILE" fi # å†…å­˜ä½¿ç”¨ FREE_MEM=$(free | grep Mem | awk &#39;{print $4}&#39;) echo "system_free_memory_bytes $FREE_MEM" >> "$METRICS_FILE" sleep 15 done äºŒåä¸€ã€è‡ªåŠ¨åŒ–éƒ¨ç½²ä¸æ›´æ–° 1. è‡ªåŠ¨éƒ¨ç½²é…ç½®è„šæœ¬ # åˆ›å»ºè‡ªåŠ¨éƒ¨ç½²è„šæœ¬ nano ~/auto_deploy.sh #!/bin/bash # ~/auto_deploy.sh # é…ç½® BLOG_DIR="/home/zhaoxiongzhou/myblog" LLAMA_DIR="/home/zhaoxiongzhou/projects/llama.cpp" BACKUP_DIR="/home/zhaoxiongzhou/backups" LOG_FILE="/var/log/auto_deploy.log" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" >> "$LOG_FILE" } # å¤‡ä»½å½“å‰ç‰ˆæœ¬ backup_current() { log "å¼€å§‹å¤‡ä»½å½“å‰ç‰ˆæœ¬" # åšå®¢å¤‡ä»½ tar -czf "$BACKUP_DIR/blog_$(date +%Y%m%d_%H%M%S).tar.gz" "$BLOG_DIR" # AI æœåŠ¡å¤‡ä»½ tar -czf "$BACKUP_DIR/llama_$(date +%Y%m%d_%H%M%S).tar.gz" "$LLAMA_DIR" log "å¤‡ä»½å®Œæˆ" } # æ›´æ–°åšå®¢ update_blog() { log "å¼€å§‹æ›´æ–°åšå®¢" cd "$BLOG_DIR" || exit 1 # æ‹‰å–æœ€æ–°ä»£ç  if git pull origin master; then # æ›´æ–°ä¸»é¢˜ git submodule update --remote themes/ananke # æ„å»ºç«™ç‚¹ hugo --minify # æ›´æ–°æƒé™ sudo chown -R www-data:www-data public/ # é‡å¯ Nginx sudo systemctl restart nginx log "åšå®¢æ›´æ–°æˆåŠŸ" else log "é”™è¯¯: åšå®¢æ›´æ–°å¤±è´¥" return 1 fi } # æ›´æ–° AI æœåŠ¡ update_ai_service() { log "å¼€å§‹æ›´æ–° AI æœåŠ¡" cd "$LLAMA_DIR" || exit 1 # åœæ­¢å½“å‰æœåŠ¡ pkill llama-server # æ‹‰å–æœ€æ–°ä»£ç  if git pull origin master; then # é‡æ–°ç¼–è¯‘ make clean if LLAMA_METAL=1 make -j4; then # å¯åŠ¨æœåŠ¡ ./start-llama.sh # éªŒè¯æœåŠ¡ sleep 5 if pgrep -f llama-server > /dev/null; then log "AI æœåŠ¡æ›´æ–°æˆåŠŸ" else log "é”™è¯¯: AI æœåŠ¡å¯åŠ¨å¤±è´¥" return 1 fi else log "é”™è¯¯: AI æœåŠ¡ç¼–è¯‘å¤±è´¥" return 1 fi else log "é”™è¯¯: AI æœåŠ¡ä»£ç æ›´æ–°å¤±è´¥" return 1 fi } # ä¸»å‡½æ•° main() { log "å¼€å§‹è‡ªåŠ¨éƒ¨ç½²æµç¨‹" # åˆ›å»ºå¤‡ä»½ backup_current # æ›´æ–°æœåŠ¡ if update_blog && update_ai_service; then log "éƒ¨ç½²å®Œæˆ" return 0 else log "éƒ¨ç½²å¤±è´¥" return 1 fi } # æ‰§è¡Œéƒ¨ç½² main 2. è‡ªåŠ¨æ›´æ–°æ£€æŸ¥è„šæœ¬ # åˆ›å»ºæ›´æ–°æ£€æŸ¥è„šæœ¬ nano ~/check_updates.sh äºŒåä¸€ã€è‡ªåŠ¨æ›´æ–°æ£€æŸ¥ä¸é€šçŸ¥ç³»ç»Ÿ 1. æ›´æ–°æ£€æŸ¥è„šæœ¬ #!/bin/bash # ~/check_updates.sh # é…ç½® NOTIFY_SCRIPT="/home/zhaoxiongzhou/send_notification.sh" LOG_FILE="/var/log/update_check.log" GITHUB_API="https://api.github.com" LLAMA_REPO="ggerganov/llama.cpp" HUGO_REPO="gohugoio/hugo" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # æ£€æŸ¥ GitHub ä»“åº“æ›´æ–° check_github_updates() { local repo="$1" local current_version="$2" # è·å–æœ€æ–°ç‰ˆæœ¬ latest_version=$(curl -s "$GITHUB_API/repos/$repo/releases/latest" | grep -Po &#39;"tag_name": "\K.*?(?=")&#39;) if [ "$latest_version" != "$current_version" ]; then log "å‘ç°æ–°ç‰ˆæœ¬: $repo ($current_version -> $latest_version)" return 0 else log "å½“å‰ç‰ˆæœ¬å·²æ˜¯æœ€æ–°: $repo ($current_version)" return 1 fi } # æ£€æŸ¥ç³»ç»Ÿæ›´æ–° check_system_updates() { sudo apt update > /dev/null 2>&amp;1 updates=$(sudo apt list --upgradable 2>/dev/null | grep -c "upgradable") if [ "$updates" -gt 0 ]; then log "å‘ç° $updates ä¸ªç³»ç»Ÿæ›´æ–°" return 0 else log "ç³»ç»Ÿå·²æ˜¯æœ€æ–°" return 1 fi } # æ£€æŸ¥æœåŠ¡çŠ¶æ€ check_services() { local services=("nginx" "llama-server") local status=0 for service in "${services[@]}"; do if [ "$service" = "nginx" ]; then if ! systemctl is-active --quiet nginx; then log "è­¦å‘Š: Nginx æœåŠ¡æœªè¿è¡Œ" status=1 fi elif [ "$service" = "llama-server" ]; then if ! pgrep -f llama-server > /dev/null; then log "è­¦å‘Š: AI æœåŠ¡æœªè¿è¡Œ" status=1 fi fi done return $status } # å‘é€é€šçŸ¥ send_notification() { local message="$1" local priority="$2" if [ -x "$NOTIFY_SCRIPT" ]; then "$NOTIFY_SCRIPT" "$message" "$priority" else log "é€šçŸ¥è„šæœ¬ä¸å­˜åœ¨æˆ–ä¸å¯æ‰§è¡Œ" fi } # ä¸»å‡½æ•° main() { log "å¼€å§‹æ£€æŸ¥æ›´æ–°" # è·å–å½“å‰ç‰ˆæœ¬ current_llama_version=$(cd ~/projects/llama.cpp && git describe --tags) current_hugo_version=$(hugo version | grep -Po "v\d+\.\d+\.\d+") # æ£€æŸ¥æ›´æ–° updates_found=0 if check_github_updates "$LLAMA_REPO" "$current_llama_version"; then send_notification "llama.cpp æœ‰æ–°ç‰ˆæœ¬å¯ç”¨" "normal" updates_found=1 fi if check_github_updates "$HUGO_REPO" "$current_hugo_version"; then send_notification "Hugo æœ‰æ–°ç‰ˆæœ¬å¯ç”¨" "normal" updates_found=1 fi if check_system_updates; then send_notification "ç³»ç»Ÿæœ‰æ›´æ–°å¯ç”¨" "normal" updates_found=1 fi if ! check_services; then send_notification "æœåŠ¡çŠ¶æ€å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥" "high" fi if [ "$updates_found" -eq 0 ]; then log "æ‰€æœ‰ç»„ä»¶å‡ä¸ºæœ€æ–°ç‰ˆæœ¬" fi } # æ‰§è¡Œæ£€æŸ¥ main äºŒåäºŒã€é€šçŸ¥ç³»ç»Ÿé…ç½® 1. é€šçŸ¥å‘é€è„šæœ¬ # åˆ›å»ºé€šçŸ¥å‘é€è„šæœ¬ nano ~/send_notification.sh #!/bin/bash # ~/send_notification.sh # é…ç½® TELEGRAM_BOT_TOKEN="your_bot_token" TELEGRAM_CHAT_ID="your_chat_id" EMAIL_ADDRESS="your_email@domain.com" DISCORD_WEBHOOK_URL="your_discord_webhook_url" # æ—¥å¿—é…ç½® LOG_FILE="/var/log/notifications.log" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" >> "$LOG_FILE" } # Telegram é€šçŸ¥ send_telegram() { local message="$1" local priority="$2" # æ ¹æ®ä¼˜å…ˆçº§æ·»åŠ è¡¨æƒ…ç¬¦å· case "$priority" in "high") message="ğŸš¨ ç´§æ€¥: $message" ;; "normal") message="â„¹ï¸ é€šçŸ¥: $message" ;; "low") message="ğŸ“ ä¿¡æ¯: $message" ;; esac # å‘é€æ¶ˆæ¯ curl -s -X POST \ "https://api.telegram.org/bot$TELEGRAM_BOT_TOKEN/sendMessage" \ -d "chat_id=$TELEGRAM_CHAT_ID" \ -d "text=$message" \ -d "parse_mode=HTML" log "Telegram é€šçŸ¥å·²å‘é€: $message" } # é‚®ä»¶é€šçŸ¥ send_email() { local message="$1" local priority="$2" local subject case "$priority" in "high") subject="[ç´§æ€¥] æ ‘è“æ´¾æœåŠ¡è­¦å‘Š" ;; "normal") subject="[é€šçŸ¥] æ ‘è“æ´¾æœåŠ¡æ›´æ–°" ;; "low") subject="[ä¿¡æ¯] æ ‘è“æ´¾æœåŠ¡çŠ¶æ€" ;; esac echo "$message" | mail -s "$subject" "$EMAIL_ADDRESS" log "é‚®ä»¶é€šçŸ¥å·²å‘é€: $subject - $message" } # Discord é€šçŸ¥ send_discord() { local message="$1" local priority="$2" local color case "$priority" in "high") color="16711680" # çº¢è‰² ;; "normal") color="65280" # ç»¿è‰² ;; "low") color="255" # è“è‰² ;; esac curl -H "Content-Type: application/json" \ -X POST \ -d "{\"embeds\": [{\"description\": \"$message\", \"color\": $color}]}" \ "$DISCORD_WEBHOOK_URL" log "Discord é€šçŸ¥å·²å‘é€: $message" } # ä¸»å‡½æ•° main() { local message="$1" local priority="${2:-normal}" # é»˜è®¤ä¼˜å…ˆçº§ä¸º normal # æ£€æŸ¥å¿…è¦å‚æ•° if [ -z "$message" ]; then log "é”™è¯¯: æ¶ˆæ¯å†…å®¹ä¸èƒ½ä¸ºç©º" return 1 fi # æ·»åŠ ç³»ç»Ÿä¿¡æ¯ local hostname=$(hostname) local timestamp=$(date &#39;+%Y-%m-%d %H:%M:%S&#39;) message="[$hostname] [$timestamp] $message" # å‘é€æ‰€æœ‰é€šçŸ¥ send_telegram "$message" "$priority" send_email "$message" "$priority" send_discord "$message" "$priority" log "æ‰€æœ‰é€šçŸ¥æ¸ é“å¤„ç†å®Œæˆ" } # æ‰§è¡Œé€šçŸ¥å‘é€ main "$@" äºŒåä¸‰ã€å®šæ—¶ä»»åŠ¡é…ç½® 1. Crontab é…ç½® # ç¼–è¾‘ crontab crontab -e # ç³»ç»Ÿç»´æŠ¤ä»»åŠ¡ # æ¯å¤©å‡Œæ™¨ 2 ç‚¹æ‰§è¡Œç³»ç»Ÿæ›´æ–°æ£€æŸ¥ 0 2 * * * ~/check_updates.sh > /dev/null 2>&amp;1 # æ¯ 6 å°æ—¶æ‰§è¡Œä¸€æ¬¡æœåŠ¡å¥åº·æ£€æŸ¥ 0 */6 * * * ~/service_health_check.sh > /dev/null 2>&amp;1 # æ¯å‘¨æ—¥å‡Œæ™¨ 3 ç‚¹æ‰§è¡Œç³»ç»Ÿä¼˜åŒ– 0 3 * * 0 ~/system_optimize.sh > /dev/null 2>&amp;1 # æ¯å¤©å‡Œæ™¨ 4 ç‚¹æ‰§è¡Œæ—¥å¿—ç®¡ç† 0 4 * * * ~/log_management.sh > /dev/null 2>&amp;1 # æ¯å°æ—¶æ‰§è¡Œæ€§èƒ½æ•°æ®æ”¶é›† 0 * * * * ~/collect_performance.sh > /dev/null 2>&amp;1 # æ¯ 5 åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡å…³é”®æœåŠ¡çŠ¶æ€ */5 * * * * ~/monitor.sh > /dev/null 2>&amp;1 # æ¯å¤©æ™šä¸Š 11 ç‚¹æ‰§è¡Œå¤‡ä»½ 0 23 * * * ~/auto_backup.sh > /dev/null 2>&amp;1 # æ¯æœˆ 1 å·æ‰§è¡Œå®Œæ•´ç³»ç»Ÿæ£€æŸ¥ 0 1 1 * * ~/full_system_check.sh > /dev/null 2>&amp;1 2. å®Œæ•´ç³»ç»Ÿæ£€æŸ¥è„šæœ¬ # åˆ›å»ºå®Œæ•´ç³»ç»Ÿæ£€æŸ¥è„šæœ¬ nano ~/full_system_check.sh #!/bin/bash # ~/full_system_check.sh LOG_FILE="/var/log/system_check.log" REPORT_FILE="/home/zhaoxiongzhou/reports/monthly_report_$(date +%Y%m).txt" # ç¡®ä¿ç›®å½•å­˜åœ¨ mkdir -p "$(dirname "$REPORT_FILE")" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" "$REPORT_FILE" } # ç³»ç»Ÿä¿¡æ¯æ£€æŸ¥ check_system_info() { log "=== ç³»ç»Ÿä¿¡æ¯ ===" log "ç³»ç»Ÿç‰ˆæœ¬: $(cat /etc/os-release | grep PRETTY_NAME)" log "å†…æ ¸ç‰ˆæœ¬: $(uname -r)" log "è¿è¡Œæ—¶é—´: $(uptime -p)" log "æœ€åå¯åŠ¨: $(who -b | awk &#39;{print $3,$4}&#39;)" } # èµ„æºä½¿ç”¨æ£€æŸ¥ check_resources() { log "=== èµ„æºä½¿ç”¨æƒ…å†µ ===" log "CPU ä½¿ç”¨ç‡: $(top -bn1 | grep "Cpu(s)" | awk &#39;{print $2}&#39;)%" log "å†…å­˜ä½¿ç”¨æƒ…å†µ:" free -h | tee -a "$REPORT_FILE" log "ç£ç›˜ä½¿ç”¨æƒ…å†µ:" df -h | tee -a "$REPORT_FILE" } # æœåŠ¡çŠ¶æ€æ£€æŸ¥ check_services() { log "=== æœåŠ¡çŠ¶æ€ ===" # æ£€æŸ¥ Nginx if systemctl is-active --quiet nginx; then log "Nginx: è¿è¡Œæ­£å¸¸" else log "Nginx: æœªè¿è¡Œ" fi # æ£€æŸ¥ AI æœåŠ¡ if pgrep -f llama-server > /dev/null; then log "AI æœåŠ¡: è¿è¡Œæ­£å¸¸" else log "AI æœåŠ¡: æœªè¿è¡Œ" fi } # å®‰å…¨æ£€æŸ¥ check_security() { log "=== å®‰å…¨æ£€æŸ¥ ===" # æ£€æŸ¥å¤±è´¥çš„ç™»å½•å°è¯• log "å¤±è´¥çš„ç™»å½•å°è¯•:" grep "Failed password" /var/log/auth.log | tail -n 5 | tee -a "$REPORT_FILE" # æ£€æŸ¥å¼€æ”¾çš„ç«¯å£ log "å¼€æ”¾çš„ç«¯å£:" netstat -tuln | grep LISTEN | tee -a "$REPORT_FILE" } # æ€§èƒ½åˆ†æ analyze_performance() { log "=== æ€§èƒ½åˆ†æ ===" # åˆ†æ CPU ä½¿ç”¨æƒ…å†µ log "CPU å¯†é›†è¿›ç¨‹:" ps aux --sort=-%cpu | head -n 5 | tee -a "$REPORT_FILE" # åˆ†æå†…å­˜ä½¿ç”¨æƒ…å†µ log "å†…å­˜å¯†é›†è¿›ç¨‹:" ps aux --sort=-%mem | head -n 5 | tee -a "$REPORT_FILE" } # ä¸»å‡½æ•° main() { log "å¼€å§‹æœˆåº¦ç³»ç»Ÿæ£€æŸ¥ - $(date)" check_system_info check_resources check_services check_security analyze_performance log "ç³»ç»Ÿæ£€æŸ¥å®Œæˆ" # å‘é€æŠ¥å‘Š if [ -f "$REPORT_FILE" ]; then ~/send_notification.sh "æœˆåº¦ç³»ç»Ÿæ£€æŸ¥æŠ¥å‘Šå·²ç”Ÿæˆ" "normal" fi } # æ‰§è¡Œæ£€æŸ¥ main äºŒåå››ã€ç¾éš¾æ¢å¤è®¡åˆ’ 1. ç³»ç»Ÿæ¢å¤è„šæœ¬ # åˆ›å»ºç³»ç»Ÿæ¢å¤è„šæœ¬ nano ~/disaster_recovery.sh #!/bin/bash # ~/disaster_recovery.sh # é…ç½® BACKUP_DIR="/home/zhaoxiongzhou/backups" RECOVERY_LOG="/var/log/recovery.log" SERVICES=("nginx" "llama-server") # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$RECOVERY_LOG" } # éªŒè¯å¤‡ä»½ verify_backup() { local backup_file="$1" if [ ! -f "$backup_file" ]; then log "é”™è¯¯: å¤‡ä»½æ–‡ä»¶ä¸å­˜åœ¨ - $backup_file" return 1 fi # æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§ if ! tar -tzf "$backup_file" >/dev/null 2>&amp;1; then log "é”™è¯¯: å¤‡ä»½æ–‡ä»¶æŸå - $backup_file" return 1 fi return 0 } # åœæ­¢æœåŠ¡ stop_services() { log "åœæ­¢æ‰€æœ‰æœåŠ¡..." for service in "${SERVICES[@]}"; do if [ "$service" = "nginx" ]; then sudo systemctl stop nginx else pkill "$service" fi done # ç­‰å¾…æœåŠ¡å®Œå…¨åœæ­¢ sleep 5 } # æ¢å¤åšå®¢æœåŠ¡ restore_blog() { local backup_file="$BACKUP_DIR/blog_latest.tar.gz" if verify_backup "$backup_file"; then log "å¼€å§‹æ¢å¤åšå®¢æœåŠ¡..." # æ¸…ç†å½“å‰ç›®å½• rm -rf ~/myblog/* # è§£å‹å¤‡ä»½ tar -xzf "$backup_file" -C ~/myblog/ # é‡å»ºç«™ç‚¹ cd ~/myblog hugo --minify # æ¢å¤æƒé™ sudo chown -R www-data:www-data public/ log "åšå®¢æœåŠ¡æ¢å¤å®Œæˆ" else log "åšå®¢æœåŠ¡æ¢å¤å¤±è´¥" return 1 fi } # æ¢å¤ AI æœåŠ¡ restore_ai_service() { local backup_file="$BACKUP_DIR/llama_latest.tar.gz" if verify_backup "$backup_file"; then log "å¼€å§‹æ¢å¤ AI æœåŠ¡..." # æ¸…ç†å½“å‰ç›®å½• rm -rf ~/projects/llama.cpp/* # è§£å‹å¤‡ä»½ tar -xzf "$backup_file" -C ~/projects/llama.cpp/ # é‡æ–°ç¼–è¯‘ cd ~/projects/llama.cpp make clean LLAMA_METAL=1 make -j4 log "AI æœåŠ¡æ¢å¤å®Œæˆ" else log "AI æœåŠ¡æ¢å¤å¤±è´¥" return 1 fi } # æ¢å¤ç³»ç»Ÿé…ç½® restore_system_config() { local backup_file="$BACKUP_DIR/system_config_latest.tar.gz" if verify_backup "$backup_file"; then log "å¼€å§‹æ¢å¤ç³»ç»Ÿé…ç½®..." # è§£å‹ç³»ç»Ÿé…ç½® sudo tar -xzf "$backup_file" -C / # é‡æ–°åŠ è½½ç³»ç»Ÿé…ç½® sudo sysctl --system log "ç³»ç»Ÿé…ç½®æ¢å¤å®Œæˆ" else log "ç³»ç»Ÿé…ç½®æ¢å¤å¤±è´¥" return 1 fi } # å¯åŠ¨æœåŠ¡ start_services() { log "å¯åŠ¨æ‰€æœ‰æœåŠ¡..." # å¯åŠ¨ Nginx sudo systemctl start nginx # å¯åŠ¨ AI æœåŠ¡ ~/projects/llama.cpp/start-llama.sh # éªŒè¯æœåŠ¡çŠ¶æ€ sleep 10 verify_services } # éªŒè¯æœåŠ¡ verify_services() { local status=0 log "éªŒè¯æœåŠ¡çŠ¶æ€..." # æ£€æŸ¥ Nginx if ! systemctl is-active --quiet nginx; then log "è­¦å‘Š: Nginx æœåŠ¡æœªæ­£å¸¸è¿è¡Œ" status=1 fi # æ£€æŸ¥ AI æœåŠ¡ if ! pgrep -f llama-server > /dev/null; then log "è­¦å‘Š: AI æœåŠ¡æœªæ­£å¸¸è¿è¡Œ" status=1 fi return $status } # ä¸»å‡½æ•° main() { log "å¼€å§‹ç³»ç»Ÿæ¢å¤æµç¨‹..." # åœæ­¢æœåŠ¡ stop_services # æ‰§è¡Œæ¢å¤ if restore_system_config && restore_blog && restore_ai_service; then # å¯åŠ¨æœåŠ¡ start_services if verify_services; then log "ç³»ç»Ÿæ¢å¤æˆåŠŸå®Œæˆ" ~/send_notification.sh "ç³»ç»Ÿæ¢å¤æˆåŠŸå®Œæˆ" "normal" return 0 else log "ç³»ç»Ÿæ¢å¤å®Œæˆï¼Œä½†éƒ¨åˆ†æœåŠ¡å¯èƒ½æœªæ­£å¸¸è¿è¡Œ" ~/send_notification.sh "ç³»ç»Ÿæ¢å¤å®Œæˆï¼Œä½†éœ€è¦æ‰‹åŠ¨æ£€æŸ¥æœåŠ¡çŠ¶æ€" "high" return 1 fi else log "ç³»ç»Ÿæ¢å¤å¤±è´¥" ~/send_notification.sh "ç³»ç»Ÿæ¢å¤å¤±è´¥ï¼Œéœ€è¦æ‰‹åŠ¨å¹²é¢„" "high" return 1 fi } # æ‰§è¡Œæ¢å¤ main äºŒåäº”ã€æ–‡æ¡£ç®¡ç†ç³»ç»Ÿ 1. æ–‡æ¡£ç”Ÿæˆè„šæœ¬ # åˆ›å»ºæ–‡æ¡£ç”Ÿæˆè„šæœ¬ nano ~/generate_docs.sh #!/bin/bash # ~/generate_docs.sh # é…ç½® DOCS_DIR="/home/zhaoxiongzhou/documentation" SCRIPTS_DIR="/home/zhaoxiongzhou" CONFIG_DIR="/etc" LOG_FILE="/var/log/documentation.log" # ç¡®ä¿ç›®å½•å­˜åœ¨ mkdir -p "$DOCS_DIR"/{scripts,configs,logs,maintenance} # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # ç”Ÿæˆè„šæœ¬æ–‡æ¡£ generate_script_docs() { log "ç”Ÿæˆè„šæœ¬æ–‡æ¡£..." for script in "$SCRIPTS_DIR"/*.sh; do if [ -f "$script" ]; then script_name=$(basename "$script") output_file="$DOCS_DIR/scripts/${script_name%.sh}.md" { echo "# $script_name" echo "## è·¯å¾„: $script" echo "## æœ€åä¿®æ”¹: $(date -r "$script" &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo "## æƒé™: $(stat -c &#39;%a&#39; "$script")" echo "## æ‰€æœ‰è€…: $(stat -c &#39;%U:%G&#39; "$script")" echo echo "## åŠŸèƒ½æè¿°" grep -A 5 "^#.*åŠŸèƒ½:" "$script" 2>/dev/null || echo "æœªæä¾›åŠŸèƒ½æè¿°" echo echo "## è„šæœ¬å†…å®¹" echo &#39;```bash&#39; cat "$script" echo &#39;```&#39; echo echo "## ä¾èµ–é¡¹" grep "^[^#]*apt.*install" "$script" 2>/dev/null || echo "æœªæ‰¾åˆ°æ˜ç¡®çš„ä¾èµ–é¡¹" echo echo "## å®šæ—¶ä»»åŠ¡" crontab -l 2>/dev/null | grep "$script_name" || echo "æœªé…ç½®å®šæ—¶ä»»åŠ¡" } > "$output_file" fi done } # ç”Ÿæˆé…ç½®æ–‡æ¡£ generate_config_docs() { log "ç”Ÿæˆé…ç½®æ–‡æ¡£..." # Nginx é…ç½® { echo "# Nginx é…ç½®æ–‡æ¡£" echo "## ä¸»é…ç½®æ–‡ä»¶" echo &#39;```nginx&#39; cat /etc/nginx/nginx.conf echo &#39;```&#39; echo "## ç«™ç‚¹é…ç½®" echo &#39;```nginx&#39; cat /etc/nginx/sites-available/myblog echo &#39;```&#39; } > "$DOCS_DIR/configs/nginx_config.md" # ç³»ç»Ÿé…ç½® { echo "# ç³»ç»Ÿé…ç½®æ–‡æ¡£" echo "## Sysctl é…ç½®" echo &#39;```bash&#39; cat /etc/sysctl.d/99-custom.conf echo &#39;```&#39; echo "## æ ‘è“æ´¾é…ç½®" echo &#39;```bash&#39; cat /boot/config.txt echo &#39;```&#39; } > "$DOCS_DIR/configs/system_config.md" } # ç”Ÿæˆç»´æŠ¤æ–‡æ¡£ generate_maintenance_docs() { log "ç”Ÿæˆç»´æŠ¤æ–‡æ¡£..." { echo "# ç³»ç»Ÿç»´æŠ¤æ–‡æ¡£" echo "## å®šæ—¶ä»»åŠ¡" echo &#39;```bash&#39; crontab -l echo &#39;```&#39; echo "## æœåŠ¡çŠ¶æ€" echo &#39;```bash&#39; systemctl status nginx ps aux | grep llama-server echo &#39;```&#39; echo "## èµ„æºä½¿ç”¨" echo &#39;```bash&#39; df -h free -h top -bn1 echo &#39;```&#39; echo "## æœ€è¿‘æ—¥å¿—" echo &#39;```bash&#39; tail -n 50 /var/log/syslog echo &#39;```&#39; } > "$DOCS_DIR/maintenance/system_status.md" } # ç”Ÿæˆç´¢å¼• generate_index() { log "ç”Ÿæˆæ–‡æ¡£ç´¢å¼•..." { echo "# ç³»ç»Ÿæ–‡æ¡£ç´¢å¼•" echo "## ç”Ÿæˆæ—¶é—´: $(date &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo echo "## è„šæœ¬æ–‡æ¡£" for doc in "$DOCS_DIR/scripts"/*.md; do echo "- [$(basename "${doc%.md}")](scripts/$(basename "$doc"))" done echo echo "## é…ç½®æ–‡æ¡£" for doc in "$DOCS_DIR/configs"/*.md; do echo "- [$(basename "${doc%.md}")](configs/$(basename "$doc"))" done echo echo "## ç»´æŠ¤æ–‡æ¡£" for doc in "$DOCS_DIR/maintenance"/*.md; do echo "- [$(basename "${doc%.md}")](maintenance/$(basename "$doc"))" done } > "$DOCS_DIR/index.md" } # ä¸»å‡½æ•° main() { log "å¼€å§‹ç”Ÿæˆæ–‡æ¡£..." generate_script_docs generate_config_docs generate_maintenance_docs generate_index log "æ–‡æ¡£ç”Ÿæˆå®Œæˆ: $DOCS_DIR" } # æ‰§è¡Œæ–‡æ¡£ç”Ÿæˆ main äºŒåå…­ã€æ€§èƒ½æµ‹è¯•ä¸åŸºå‡†æµ‹è¯• 1. æ€§èƒ½æµ‹è¯•è„šæœ¬ # åˆ›å»ºæ€§èƒ½æµ‹è¯•è„šæœ¬ nano ~/benchmark.sh #!/bin/bash # ~/benchmark.sh # é…ç½® RESULTS_DIR="/home/zhaoxiongzhou/benchmark_results" LOG_FILE="/var/log/benchmark.log" DURATION=300 # æµ‹è¯•æŒç»­æ—¶é—´ï¼ˆç§’ï¼‰ CONCURRENT_USERS=10 # å¹¶å‘ç”¨æˆ·æ•° # ç¡®ä¿ç›®å½•å­˜åœ¨ mkdir -p "$RESULTS_DIR" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # CPU æ€§èƒ½æµ‹è¯• benchmark_cpu() { log "å¼€å§‹ CPU æ€§èƒ½æµ‹è¯•..." # ä½¿ç”¨ sysbench è¿›è¡Œ CPU æµ‹è¯• sysbench cpu --cpu-max-prime=20000 --threads=4 run > "$RESULTS_DIR/cpu_benchmark.txt" # è®°å½• CPU æ¸©åº¦ for i in $(seq 1 10); do vcgencmd measure_temp >> "$RESULTS_DIR/cpu_temp.txt" sleep 1 done } # å†…å­˜æ€§èƒ½æµ‹è¯• benchmark_memory() { log "å¼€å§‹å†…å­˜æ€§èƒ½æµ‹è¯•..." # ä½¿ç”¨ sysbench è¿›è¡Œå†…å­˜æµ‹è¯• sysbench memory --memory-block-size=1K --memory-total-size=10G run > "$RESULTS_DIR/memory_benchmark.txt" } # ç£ç›˜æ€§èƒ½æµ‹è¯• benchmark_disk() { log "å¼€å§‹ç£ç›˜æ€§èƒ½æµ‹è¯•..." # ä½¿ç”¨ dd æµ‹è¯•å†™å…¥é€Ÿåº¦ dd if=/dev/zero of=/tmp/test_file bs=1M count=1000 conv=fdatasync 2>> "$RESULTS_DIR/disk_write_benchmark.txt" # ä½¿ç”¨ dd æµ‹è¯•è¯»å–é€Ÿåº¦ dd if=/tmp/test_file of=/dev/null bs=1M count=1000 2>> "$RESULTS_DIR/disk_read_benchmark.txt" # æ¸…ç†æµ‹è¯•æ–‡ä»¶ rm /tmp/test_file } # ç½‘ç»œæ€§èƒ½æµ‹è¯• benchmark_network() { log "å¼€å§‹ç½‘ç»œæ€§èƒ½æµ‹è¯•..." # ä½¿ç”¨ iperf3 æµ‹è¯•ç½‘ç»œæ€§èƒ½ iperf3 -c iperf.he.net -t 30 > "$RESULTS_DIR/network_benchmark.txt" } # Web æœåŠ¡æ€§èƒ½æµ‹è¯• benchmark_web() { log "å¼€å§‹ Web æœåŠ¡æ€§èƒ½æµ‹è¯•..." # ä½¿ç”¨ ab æµ‹è¯• Web æœåŠ¡ ab -n 1000 -c "$CONCURRENT_USERS" http://localhost/ > "$RESULTS_DIR/web_benchmark.txt" } # AI æœåŠ¡æ€§èƒ½æµ‹è¯• benchmark_ai() { log "å¼€å§‹ AI æœåŠ¡æ€§èƒ½æµ‹è¯•..." # åˆ›å»ºæµ‹è¯•è¯·æ±‚ cat > /tmp/test_prompt.txt << EOF Hello, how are you? EOF # ä½¿ç”¨ curl æµ‹è¯• AI æœåŠ¡å“åº”æ—¶é—´ for i in $(seq 1 10); do time curl -X POST \ -H "Content-Type: application/json" \ -d @/tmp/test_prompt.txt \ http://localhost:8080/completion >> "$RESULTS_DIR/ai_benchmark.txt" 2>&amp;1 echo -e "\n---\n" >> "$RESULTS_DIR/ai_benchmark.txt" sleep 2 done } # ç”ŸæˆæŠ¥å‘Š generate_report() { log "ç”Ÿæˆæ€§èƒ½æµ‹è¯•æŠ¥å‘Š..." local report_file="$RESULTS_DIR/benchmark_report_$(date +%Y%m%d_%H%M%S).md" { echo "# æ€§èƒ½æµ‹è¯•æŠ¥å‘Š" echo "## æµ‹è¯•æ—¶é—´: $(date &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo echo "## ç³»ç»Ÿä¿¡æ¯" echo &#39;```&#39; uname -a echo &#39;```&#39; echo echo "## CPU æ€§èƒ½" echo &#39;```&#39; cat "$RESULTS_DIR/cpu_benchmark.txt" echo &#39;```&#39; echo echo "## å†…å­˜æ€§èƒ½" echo &#39;```&#39; cat "$RESULTS_DIR/memory_benchmark.txt" echo &#39;```&#39; echo echo "## ç£ç›˜æ€§èƒ½" echo &#39;```&#39; cat "$RESULTS_DIR/disk_write_benchmark.txt" cat "$RESULTS_DIR/disk_read_benchmark.txt" echo &#39;```&#39; echo echo "## ç½‘ç»œæ€§èƒ½" echo &#39;```&#39; cat "$RESULTS_DIR/network_benchmark.txt" echo &#39;```&#39; echo echo "## Web æœåŠ¡æ€§èƒ½" echo &#39;```&#39; cat "$RESULTS_DIR/web_benchmark.txt" echo &#39;```&#39; echo echo "## AI æœåŠ¡æ€§èƒ½" echo &#39;```&#39; cat "$RESULTS_DIR/ai_benchmark.txt" echo &#39;```&#39; } > "$report_file" log "æ€§èƒ½æµ‹è¯•æŠ¥å‘Šå·²ç”Ÿæˆ: $report_file" } # ä¸»å‡½æ•° main() { log "å¼€å§‹æ€§èƒ½æµ‹è¯•..." # å®‰è£…å¿…è¦çš„å·¥å…· sudo apt install -y sysbench apache2-utils iperf3 # æ‰§è¡Œå„é¡¹æµ‹è¯• benchmark_cpu benchmark_memory benchmark_disk benchmark_network benchmark_web benchmark_ai # ç”ŸæˆæŠ¥å‘Š generate_report log "æ€§èƒ½æµ‹è¯•å®Œæˆ" } # æ‰§è¡Œæµ‹è¯• main äºŒåä¸ƒã€å®‰å…¨å®¡è®¡ç³»ç»Ÿ 1. å®‰å…¨å®¡è®¡è„šæœ¬ # åˆ›å»ºå®‰å…¨å®¡è®¡è„šæœ¬ nano ~/security_audit.sh #!/bin/bash # ~/security_audit.sh # é…ç½® AUDIT_DIR="/home/zhaoxiongzhou/security_audits" REPORT_FILE="$AUDIT_DIR/security_report_$(date +%Y%m%d_%H%M%S).md" LOG_FILE="/var/log/security_audit.log" # ç¡®ä¿ç›®å½•å­˜åœ¨ mkdir -p "$AUDIT_DIR" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # æ£€æŸ¥ç³»ç»Ÿç”¨æˆ· audit_users() { log "æ£€æŸ¥ç³»ç»Ÿç”¨æˆ·..." { echo "## ç³»ç»Ÿç”¨æˆ·å®¡è®¡" echo "### ç‰¹æƒç”¨æˆ·" echo &#39;```&#39; awk -F: &#39;$3 == 0 {print $1}&#39; /etc/passwd echo &#39;```&#39; echo "### æœ€è¿‘çš„ç”¨æˆ·æ´»åŠ¨" echo &#39;```&#39; last | head -n 10 echo &#39;```&#39; echo "### å¤±è´¥çš„ç™»å½•å°è¯•" echo &#39;```&#39; grep "Failed password" /var/log/auth.log | tail -n 10 echo &#39;```&#39; } >> "$REPORT_FILE" } # æ£€æŸ¥ç½‘ç»œå®‰å…¨ audit_network() { log "æ£€æŸ¥ç½‘ç»œå®‰å…¨..." { echo "## ç½‘ç»œå®‰å…¨å®¡è®¡" echo "### å¼€æ”¾ç«¯å£" echo &#39;```&#39; netstat -tuln echo &#39;```&#39; echo "### æ´»åŠ¨è¿æ¥" echo &#39;```&#39; netstat -nat | grep ESTABLISHED echo &#39;```&#39; echo "### é˜²ç«å¢™è§„åˆ™" echo &#39;```&#39; sudo iptables -L -n echo &#39;```&#39; } >> "$REPORT_FILE" } # æ£€æŸ¥æ–‡ä»¶æƒé™ audit_permissions() { log "æ£€æŸ¥æ–‡ä»¶æƒé™..." { echo "## æ–‡ä»¶æƒé™å®¡è®¡" echo "### SUID æ–‡ä»¶" echo &#39;```&#39; sudo find / -type f -perm -4000 2>/dev/null echo &#39;```&#39; echo "### ä¸–ç•Œå¯å†™æ–‡ä»¶" echo &#39;```&#39; sudo find / -type f -perm -2 ! -path "/proc/*" ! -path "/sys/*" 2>/dev/null echo &#39;```&#39; echo "### æ•æ„Ÿç›®å½•æƒé™" echo &#39;```&#39; ls -la /etc/nginx/ ls -la ~/projects/llama.cpp/ ls -la ~/myblog/ echo &#39;```&#39; } >> "$REPORT_FILE" } # æ£€æŸ¥æœåŠ¡é…ç½® audit_services() { log "æ£€æŸ¥æœåŠ¡é…ç½®..." { echo "## æœåŠ¡é…ç½®å®¡è®¡" echo "### Nginx é…ç½®æ£€æŸ¥" echo &#39;```&#39; sudo nginx -t 2>&amp;1 echo &#39;```&#39; echo "### SSL é…ç½®" echo &#39;```&#39; openssl s_client -connect localhost:443 -servername localhost </dev/null 2>/dev/null | openssl x509 -text echo &#39;```&#39; echo "### æœåŠ¡çŠ¶æ€" echo &#39;```&#39; systemctl list-units --type=service --state=active echo &#39;```&#39; } >> "$REPORT_FILE" } # æ£€æŸ¥ç³»ç»Ÿæ›´æ–° audit_updates() { log "æ£€æŸ¥ç³»ç»Ÿæ›´æ–°..." { echo "## ç³»ç»Ÿæ›´æ–°å®¡è®¡" echo "### å¯ç”¨æ›´æ–°" echo &#39;```&#39; apt list --upgradable 2>/dev/null echo &#39;```&#39; echo "### å·²å®‰è£…åŒ…" echo &#39;```&#39; dpkg -l | grep "^ii" | wc -l echo &#39;```&#39; } >> "$REPORT_FILE" } # æ£€æŸ¥æ—¥å¿—å¼‚å¸¸ audit_logs() { log "æ£€æŸ¥æ—¥å¿—å¼‚å¸¸..." { echo "## æ—¥å¿—å®¡è®¡" echo "### ç³»ç»Ÿé”™è¯¯" echo &#39;```&#39; sudo journalctl -p 3 -xb --no-pager | tail -n 20 echo &#39;```&#39; echo "### å¼‚å¸¸è®¿é—®" echo &#39;```&#39; grep -i "error\|failed\|warning" /var/log/nginx/error.log | tail -n 20 echo &#39;```&#39; } >> "$REPORT_FILE" } # ç”Ÿæˆå®‰å…¨å»ºè®® generate_recommendations() { log "ç”Ÿæˆå®‰å…¨å»ºè®®..." { echo "## å®‰å…¨å»ºè®®" echo "### é«˜ä¼˜å…ˆçº§" # æ£€æŸ¥å¹¶ç”Ÿæˆå»ºè®® if grep -q "Failed password" /var/log/auth.log; then echo "- å»ºè®®ï¼šå¯ç”¨ fail2ban åŠ å¼º SSH é˜²æŠ¤" fi if [ $(find / -type f -perm -2 2>/dev/null | wc -l) -gt 0 ]; then echo "- å»ºè®®ï¼šæ£€æŸ¥å¹¶ä¿®å¤ä¸–ç•Œå¯å†™æ–‡ä»¶æƒé™" fi echo "### ä¸­ä¼˜å…ˆçº§" # æ·»åŠ å…¶ä»–å»ºè®® echo "- å®šæœŸæ›´æ–°ç³»ç»ŸåŒ…" echo "- æ£€æŸ¥å¹¶æ›´æ–° SSL è¯ä¹¦" echo "- å®šæœŸå®¡æŸ¥ç”¨æˆ·æƒé™" } >> "$REPORT_FILE" } # ä¸»å‡½æ•° main() { log "å¼€å§‹å®‰å…¨å®¡è®¡..." # åˆ›å»ºæŠ¥å‘Šå¤´éƒ¨ { echo "# å®‰å…¨å®¡è®¡æŠ¥å‘Š" echo "## ç”Ÿæˆæ—¶é—´: $(date &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo "## ç³»ç»Ÿä¿¡æ¯" echo &#39;```&#39; uname -a echo &#39;```&#39; echo } > "$REPORT_FILE" # æ‰§è¡Œå„é¡¹å®¡è®¡ audit_users audit_network audit_permissions audit_services audit_updates audit_logs generate_recommendations log "å®‰å…¨å®¡è®¡å®Œæˆï¼ŒæŠ¥å‘Šå·²ç”Ÿæˆ: $REPORT_FILE" # å‘é€é€šçŸ¥ ~/send_notification.sh "å®‰å…¨å®¡è®¡æŠ¥å‘Šå·²ç”Ÿæˆ" "normal" } # æ‰§è¡Œå®¡è®¡ main äºŒåå…«ã€èµ„æºé™åˆ¶ä¸æ§åˆ¶ 1. èµ„æºé™åˆ¶é…ç½®è„šæœ¬ # åˆ›å»ºèµ„æºé™åˆ¶é…ç½®è„šæœ¬ nano ~/resource_control.sh #!/bin/bash # ~/resource_control.sh # é…ç½® LOG_FILE="/var/log/resource_control.log" LIMITS_CONF="/etc/security/limits.conf" SYSTEMD_DIR="/etc/systemd/system" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # é…ç½®ç³»ç»Ÿèµ„æºé™åˆ¶ configure_system_limits() { log "é…ç½®ç³»ç»Ÿèµ„æºé™åˆ¶..." # å¤‡ä»½åŸå§‹é…ç½® sudo cp "$LIMITS_CONF" "${LIMITS_CONF}.backup" # æ·»åŠ èµ„æºé™åˆ¶é…ç½® sudo tee -a "$LIMITS_CONF" << EOF # ç”¨æˆ·èµ„æºé™åˆ¶ zhaoxiongzhou soft nofile 65535 zhaoxiongzhou hard nofile 65535 zhaoxiongzhou soft nproc 2048 zhaoxiongzhou hard nproc 4096 # ç³»ç»ŸæœåŠ¡èµ„æºé™åˆ¶ www-data soft nofile 65535 www-data hard nofile 65535 www-data soft nproc 1024 www-data hard nproc 2048 EOF } # é…ç½® AI æœåŠ¡èµ„æºé™åˆ¶ configure_ai_service() { log "é…ç½® AI æœåŠ¡èµ„æºé™åˆ¶..." # åˆ›å»º systemd æœåŠ¡æ–‡ä»¶ sudo tee "$SYSTEMD_DIR/llama-server.service" << EOF [Unit] Description=Llama AI Server After=network.target [Service] User=zhaoxiongzhou Group=zhaoxiongzhou WorkingDirectory=/home/zhaoxiongzhou/projects/llama.cpp ExecStart=/home/zhaoxiongzhou/projects/llama.cpp/start-llama.sh # èµ„æºé™åˆ¶ CPUQuota=80% MemoryLimit=2G TasksMax=128 LimitNOFILE=65535 # é‡å¯ç­–ç•¥ Restart=always RestartSec=10 [Install] WantedBy=multi-user.target EOF # é‡æ–°åŠ è½½ systemd é…ç½® sudo systemctl daemon-reload } # é…ç½® Nginx èµ„æºé™åˆ¶ configure_nginx() { log "é…ç½® Nginx èµ„æºé™åˆ¶..." # ä¿®æ”¹ Nginx é…ç½® sudo tee "/etc/nginx/conf.d/resource_limits.conf" << EOF # å·¥ä½œè¿›ç¨‹é™åˆ¶ worker_processes auto; worker_rlimit_nofile 65535; # è¿æ¥é™åˆ¶ events { worker_connections 1024; multi_accept on; } # å®¢æˆ·ç«¯é™åˆ¶ http { # è¯·æ±‚é™åˆ¶ limit_req_zone \$binary_remote_addr zone=one:10m rate=10r/s; # è¿æ¥é™åˆ¶ limit_conn_zone \$binary_remote_addr zone=addr:10m; server { # åº”ç”¨é™åˆ¶ location / { limit_req zone=one burst=5; limit_conn addr 10; } } } EOF } # é…ç½®ç³»ç»Ÿèµ„æºç›‘æ§ configure_monitoring() { log "é…ç½®èµ„æºç›‘æ§..." # åˆ›å»ºç›‘æ§è„šæœ¬ cat > ~/monitor_resources.sh << EOF #!/bin/bash while true; do # CPU ä½¿ç”¨ç‡ CPU_USAGE=\$(top -bn1 | grep "Cpu(s)" | awk &#39;{print \$2}&#39;) # å†…å­˜ä½¿ç”¨ç‡ MEM_USAGE=\$(free | grep Mem | awk &#39;{print \$3/\$2 * 100.0}&#39;) # è¿›ç¨‹æ•° PROCESS_COUNT=\$(ps aux | wc -l) # æ£€æŸ¥é™åˆ¶ if (( \$(echo "\$CPU_USAGE > 80" | bc -l) )); then ~/send_notification.sh "è­¦å‘Š: CPU ä½¿ç”¨ç‡è¿‡é«˜ (\${CPU_USAGE}%)" "high" fi if (( \$(echo "\$MEM_USAGE > 90" | bc -l) )); then ~/send_notification.sh "è­¦å‘Š: å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜ (\${MEM_USAGE}%)" "high" fi if [ "\$PROCESS_COUNT" -gt 200 ]; then ~/send_notification.sh "è­¦å‘Š: è¿›ç¨‹æ•°è¿‡å¤š (\$PROCESS_COUNT)" "high" fi sleep 60 done EOF chmod +x ~/monitor_resources.sh } # åº”ç”¨é…ç½® apply_configurations() { log "åº”ç”¨èµ„æºé™åˆ¶é…ç½®..." # é‡å¯æœåŠ¡ sudo systemctl restart nginx sudo systemctl restart llama-server # å¯åŠ¨ç›‘æ§ ~/monitor_resources.sh & # éªŒè¯é…ç½® log "éªŒè¯é…ç½®..." sudo nginx -t sudo systemctl status llama-server ulimit -a } # ä¸»å‡½æ•° main() { log "å¼€å§‹é…ç½®èµ„æºé™åˆ¶..." configure_system_limits configure_ai_service configure_nginx configure_monitoring apply_configurations log "èµ„æºé™åˆ¶é…ç½®å®Œæˆ" } # æ‰§è¡Œé…ç½® main äºŒåä¹ã€è‡ªåŠ¨åŒ–æµ‹è¯•ç³»ç»Ÿ 1. é›†æˆæµ‹è¯•è„šæœ¬ # åˆ›å»ºé›†æˆæµ‹è¯•è„šæœ¬ nano ~/integration_test.sh #!/bin/bash # ~/integration_test.sh # é…ç½® TEST_DIR="/home/zhaoxiongzhou/tests" REPORT_DIR="/home/zhaoxiongzhou/test_reports" LOG_FILE="/var/log/integration_test.log" # ç¡®ä¿ç›®å½•å­˜åœ¨ mkdir -p "$TEST_DIR" "$REPORT_DIR" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # æµ‹è¯• Web æœåŠ¡ test_web_service() { log "æµ‹è¯• Web æœåŠ¡..." local result=0 # æµ‹è¯•é¦–é¡µè®¿é—® if curl -s -o /dev/null -w "%{http_code}" http://localhost/ | grep -q "200"; then log "é¦–é¡µè®¿é—®æµ‹è¯•é€šè¿‡" else log "é”™è¯¯: é¦–é¡µè®¿é—®æµ‹è¯•å¤±è´¥" result=1 fi # æµ‹è¯•é™æ€èµ„æº if curl -s -o /dev/null -w "%{http_code}" http://localhost/css/main.css | grep -q "200"; then log "é™æ€èµ„æºæµ‹è¯•é€šè¿‡" else log "é”™è¯¯: é™æ€èµ„æºæµ‹è¯•å¤±è´¥" result=1 fi # æµ‹è¯• 404 é¡µé¢ if curl -s -o /dev/null -w "%{http_code}" http://localhost/nonexistent | grep -q "404"; then log "404 é¡µé¢æµ‹è¯•é€šè¿‡" else log "é”™è¯¯: 404 é¡µé¢æµ‹è¯•å¤±è´¥" result=1 fi return $result } # æµ‹è¯• AI æœåŠ¡ test_ai_service() { log "æµ‹è¯• AI æœåŠ¡..." local result=0 # æµ‹è¯•æœåŠ¡å¯ç”¨æ€§ if curl -s -o /dev/null -w "%{http_code}" http://localhost:8080/health | grep -q "200"; then log "AI æœåŠ¡å¥åº·æ£€æŸ¥é€šè¿‡" else log "é”™è¯¯: AI æœåŠ¡å¥åº·æ£€æŸ¥å¤±è´¥" result=1 fi # æµ‹è¯•æ¨¡å‹å“åº” local response=$(curl -s -X POST \ -H "Content-Type: application/json" \ -d &#39;{"prompt": "Hello", "max_tokens": 10}&#39; \ http://localhost:8080/completion) if echo "$response" | grep -q "text"; then log "AI æœåŠ¡å“åº”æµ‹è¯•é€šè¿‡" else log "é”™è¯¯: AI æœåŠ¡å“åº”æµ‹è¯•å¤±è´¥" result=1 fi return $result } # æµ‹è¯•ç³»ç»ŸæœåŠ¡ test_system_services() { log "æµ‹è¯•ç³»ç»ŸæœåŠ¡..." local result=0 # æµ‹è¯• Nginx çŠ¶æ€ if systemctl is-active --quiet nginx; then log "Nginx æœåŠ¡æµ‹è¯•é€šè¿‡" else log "é”™è¯¯: Nginx æœåŠ¡æµ‹è¯•å¤±è´¥" result=1 fi # æµ‹è¯•ç³»ç»Ÿèµ„æº local cpu_usage=$(top -bn1 | grep "Cpu(s)" | awk &#39;{print $2}&#39;) local mem_usage=$(free | grep Mem | awk &#39;{print $3/$2 * 100.0}&#39;) if [ $(echo "$cpu_usage < 90" | bc -l) -eq 1 ]; then log "CPU ä½¿ç”¨ç‡æ­£å¸¸" else log "è­¦å‘Š: CPU ä½¿ç”¨ç‡è¿‡é«˜" result=1 fi if [ $(echo "$mem_usage < 90" | bc -l) -eq 1 ]; then log "å†…å­˜ä½¿ç”¨ç‡æ­£å¸¸" else log "è­¦å‘Š: å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜" result=1 fi return $result } # ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š generate_report() { local web_result=$1 local ai_result=$2 local system_result=$3 local report_file="$REPORT_DIR/test_report_$(date +%Y%m%d_%H%M%S).md" { echo "# é›†æˆæµ‹è¯•æŠ¥å‘Š" echo "## æµ‹è¯•æ—¶é—´: $(date &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo echo "## æµ‹è¯•ç»“æœæ‘˜è¦" echo "- Web æœåŠ¡: $([ $web_result -eq 0 ] && echo &#39;é€šè¿‡ âœ…&#39; || echo &#39;å¤±è´¥ âŒ&#39;)" echo "- AI æœåŠ¡: $([ $ai_result -eq 0 ] && echo &#39;é€šè¿‡ âœ…&#39; || echo &#39;å¤±è´¥ âŒ&#39;)" echo "- ç³»ç»ŸæœåŠ¡: $([ $system_result -eq 0 ] && echo &#39;é€šè¿‡ âœ…&#39; || echo &#39;å¤±è´¥ âŒ&#39;)" echo echo "## è¯¦ç»†æ—¥å¿—" echo &#39;```&#39; tail -n 50 "$LOG_FILE" echo &#39;```&#39; } > "$report_file" log "æµ‹è¯•æŠ¥å‘Šå·²ç”Ÿæˆ: $report_file" } # ä¸»å‡½æ•° main() { log "å¼€å§‹é›†æˆæµ‹è¯•..." local web_result=0 local ai_result=0 local system_result=0 # æ‰§è¡Œæµ‹è¯• test_web_service web_result=$? test_ai_service ai_result=$? test_system_services system_result=$? # ç”ŸæˆæŠ¥å‘Š generate_report $web_result $ai_result $system_result # å‘é€é€šçŸ¥ if [ $web_result -eq 0 ] && [ $ai_result -eq 0 ] && [ $system_result -eq 0 ]; then ~/send_notification.sh "é›†æˆæµ‹è¯•å…¨éƒ¨é€šè¿‡" "normal" else ~/send_notification.sh "é›†æˆæµ‹è¯•å­˜åœ¨å¤±è´¥é¡¹ï¼Œè¯·æŸ¥çœ‹æŠ¥å‘Š" "high" fi # è¿”å›æ€»ä½“ç»“æœ return $(( web_result + ai_result + system_result )) } # æ‰§è¡Œæµ‹è¯• main ä¸‰åã€ç³»ç»ŸçŠ¶æ€ä»ªè¡¨æ¿ 1. çŠ¶æ€ç›‘æ§é¡µé¢ç”Ÿæˆè„šæœ¬ # åˆ›å»ºçŠ¶æ€é¡µé¢ç”Ÿæˆè„šæœ¬ nano ~/generate_dashboard.sh #!/bin/bash # ~/generate_dashboard.sh # é…ç½® DASHBOARD_DIR="/var/www/html/dashboard" REFRESH_INTERVAL=60 # é¡µé¢åˆ·æ–°é—´éš”ï¼ˆç§’ï¼‰ LOG_FILE="/var/log/dashboard.log" # ç¡®ä¿ç›®å½•å­˜åœ¨ sudo mkdir -p "$DASHBOARD_DIR" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # æ”¶é›†ç³»ç»ŸçŠ¶æ€æ•°æ® collect_system_data() { # CPU ä¿¡æ¯ CPU_USAGE=$(top -bn1 | grep "Cpu(s)" | awk &#39;{print $2}&#39;) CPU_TEMP=$(vcgencmd measure_temp | sed &#39;s/temp=//&#39; | sed &#39;s/&#39;"&#39;"&#39;C//&#39;) # å†…å­˜ä¿¡æ¯ MEM_TOTAL=$(free -m | awk &#39;/Mem:/ {print $2}&#39;) MEM_USED=$(free -m | awk &#39;/Mem:/ {print $3}&#39;) MEM_USAGE=$(awk "BEGIN {printf \"%.2f\", $MEM_USED/$MEM_TOTAL*100}") # ç£ç›˜ä¿¡æ¯ DISK_USAGE=$(df -h / | awk &#39;NR==2 {print $5}&#39; | sed &#39;s/%//&#39;) # ç³»ç»Ÿè´Ÿè½½ LOAD_AVG=$(uptime | awk -F&#39;load average:&#39; &#39;{print $2}&#39; | xargs) # è¿è¡Œæ—¶é—´ UPTIME=$(uptime -p) } # æ”¶é›†æœåŠ¡çŠ¶æ€ collect_service_data() { # Nginx çŠ¶æ€ if systemctl is-active --quiet nginx; then NGINX_STATUS="è¿è¡Œä¸­ âœ…" else NGINX_STATUS="å·²åœæ­¢ âŒ" fi # AI æœåŠ¡çŠ¶æ€ if pgrep -f llama-server > /dev/null; then AI_STATUS="è¿è¡Œä¸­ âœ…" else AI_STATUS="å·²åœæ­¢ âŒ" fi # è·å–æœ€è¿‘çš„æ—¥å¿— RECENT_LOGS=$(tail -n 10 /var/log/syslog | sed &#39;s/</\&amp;lt;/g&#39; | sed &#39;s/>/\&amp;gt;/g&#39;) } # ç”ŸæˆçŠ¶æ€é¡µé¢ generate_dashboard() { local timestamp=$(date &#39;+%Y-%m-%d %H:%M:%S&#39;) cat > "$DASHBOARD_DIR/index.html" << EOF <!DOCTYPE html> <html lang="zh"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>ç³»ç»ŸçŠ¶æ€ä»ªè¡¨æ¿</title> <meta http-equiv="refresh" content="$REFRESH_INTERVAL"> <style> body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; } .container { max-width: 1200px; margin: 0 auto; } .card { background: white; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); } .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; } .metric { text-align: center; padding: 15px; border-radius: 4px; background: #f8f9fa; } .metric h3 { margin: 0; color: #666; } .metric .value { font-size: 24px; font-weight: bold; margin: 10px 0; } .status { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee; } .logs { background: #2b2b2b; color: #fff; padding: 15px; border-radius: 4px; font-family: monospace; white-space: pre-wrap; } </style> </head> <body> <div class="container"> <h1>ç³»ç»ŸçŠ¶æ€ä»ªè¡¨æ¿</h1> <p>æœ€åæ›´æ–°: $timestamp</p> <div class="card"> <h2>ç³»ç»Ÿèµ„æº</h2> <div class="grid"> <div class="metric"> <h3>CPU ä½¿ç”¨ç‡</h3> <div class="value">$CPU_USAGE%</div> </div> <div class="metric"> <h3>CPU æ¸©åº¦</h3> <div class="value">$CPU_TEMP</div> </div> <div class="metric"> <h3>å†…å­˜ä½¿ç”¨ç‡</h3> <div class="value">$MEM_USAGE%</div> </div> <div class="metric"> <h3>ç£ç›˜ä½¿ç”¨ç‡</h3> <div class="value">$DISK_USAGE%</div> </div> </div> </div> <div class="card"> <h2>ç³»ç»Ÿä¿¡æ¯</h2> <div class="status"> <span>ç³»ç»Ÿè´Ÿè½½:</span> <span>$LOAD_AVG</span> </div> <div class="status"> <span>è¿è¡Œæ—¶é—´:</span> <span>$UPTIME</span> </div> </div> <div class="card"> <h2>æœåŠ¡çŠ¶æ€</h2> <div class="status"> <span>Nginx æœåŠ¡:</span> <span>$NGINX_STATUS</span> </div> <div class="status"> <span>AI æœåŠ¡:</span> <span>$AI_STATUS</span> </div> </div> <div class="card"> <h2>æœ€è¿‘æ—¥å¿—</h2> <div class="logs">$RECENT_LOGS</div> </div> </div> </body> </html> EOF # è®¾ç½®æƒé™ sudo chown www-data:www-data "$DASHBOARD_DIR/index.html" } # ä¸»å‡½æ•° main() { log "å¼€å§‹ç”ŸæˆçŠ¶æ€ä»ªè¡¨æ¿..." # æ”¶é›†æ•°æ® collect_system_data collect_service_data # ç”Ÿæˆé¡µé¢ generate_dashboard log "çŠ¶æ€ä»ªè¡¨æ¿å·²æ›´æ–°" } # æ‰§è¡Œç”Ÿæˆ main ä¸‰åä¸€ã€ç³»ç»Ÿå¤‡ä»½ä¸æ¢å¤å®Œæ•´æ–¹æ¡ˆ 1. å®Œæ•´å¤‡ä»½è„šæœ¬ # åˆ›å»ºå®Œæ•´å¤‡ä»½è„šæœ¬ nano ~/full_backup.sh #!/bin/bash # ~/full_backup.sh # é…ç½® BACKUP_ROOT="/mnt/backup_drive" BACKUP_DIR="$BACKUP_ROOT/system_backups" EXCLUDE_FILE="/home/zhaoxiongzhou/backup_exclude.txt" LOG_FILE="/var/log/backup.log" RETENTION_DAYS=30 COMPRESSION_LEVEL=6 # ç¡®ä¿å¤‡ä»½ç›®å½•å­˜åœ¨ mkdir -p "$BACKUP_DIR" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # æ£€æŸ¥å¤‡ä»½ç¯å¢ƒ check_environment() { log "æ£€æŸ¥å¤‡ä»½ç¯å¢ƒ..." # æ£€æŸ¥å¤‡ä»½ç›®æ ‡ç›®å½• if ! mountpoint -q "$BACKUP_ROOT"; then log "é”™è¯¯: å¤‡ä»½é©±åŠ¨å™¨æœªæŒ‚è½½" return 1 fi # æ£€æŸ¥å¯ç”¨ç©ºé—´ local available_space=$(df -BG "$BACKUP_ROOT" | awk &#39;NR==2 {print $4}&#39; | sed &#39;s/G//&#39;) if [ "$available_space" -lt 10 ]; then log "é”™è¯¯: å¤‡ä»½ç©ºé—´ä¸è¶³ï¼ˆå°äº 10GBï¼‰" return 1 fi # åˆ›å»ºæ’é™¤æ–‡ä»¶ cat > "$EXCLUDE_FILE" << EOF /proc/* /sys/* /tmp/* /run/* /mnt/* /media/* /lost+found /var/cache/* /var/tmp/* /var/log/* /home/*/Downloads/* /home/*/.cache/* EOF return 0 } # åœæ­¢æœåŠ¡ stop_services() { log "åœæ­¢æœåŠ¡..." # åœæ­¢ Nginx sudo systemctl stop nginx # åœæ­¢ AI æœåŠ¡ pkill llama-server # ç­‰å¾…æœåŠ¡å®Œå…¨åœæ­¢ sleep 5 } # å¯åŠ¨æœåŠ¡ start_services() { log "å¯åŠ¨æœåŠ¡..." # å¯åŠ¨ Nginx sudo systemctl start nginx # å¯åŠ¨ AI æœåŠ¡ ~/projects/llama.cpp/start-llama.sh # éªŒè¯æœåŠ¡çŠ¶æ€ sleep 10 if ! systemctl is-active --quiet nginx; then log "è­¦å‘Š: Nginx æœåŠ¡æœªèƒ½æ­£å¸¸å¯åŠ¨" fi if ! pgrep -f llama-server > /dev/null; then log "è­¦å‘Š: AI æœåŠ¡æœªèƒ½æ­£å¸¸å¯åŠ¨" fi } # åˆ›å»ºå®Œæ•´å¤‡ä»½ create_full_backup() { local backup_date=$(date +%Y%m%d_%H%M%S) local backup_file="$BACKUP_DIR/full_backup_${backup_date}.tar.gz" local manifest_file="$BACKUP_DIR/backup_manifest_${backup_date}.txt" log "å¼€å§‹åˆ›å»ºå®Œæ•´å¤‡ä»½..." # åˆ›å»ºæ–‡ä»¶æ¸…å• log "ç”Ÿæˆæ–‡ä»¶æ¸…å•..." find / -xdev -type f ! -path "$(cat $EXCLUDE_FILE | tr &#39;\n&#39; &#39;|&#39;)" > "$manifest_file" # åˆ›å»ºå¤‡ä»½ log "åˆ›å»ºç³»ç»Ÿå¤‡ä»½..." sudo tar -czf "$backup_file" \ --exclude-from="$EXCLUDE_FILE" \ --one-file-system \ --preserve-permissions \ --numeric-owner \ --checkpoint=1000 \ --checkpoint-action=dot \ -C / . # éªŒè¯å¤‡ä»½ if ! tar -tzf "$backup_file" >/dev/null 2>&amp;1; then log "é”™è¯¯: å¤‡ä»½æ–‡ä»¶éªŒè¯å¤±è´¥" return 1 fi # è®¡ç®—æ ¡éªŒå’Œ log "è®¡ç®—æ ¡éªŒå’Œ..." sha256sum "$backup_file" > "${backup_file}.sha256" # åˆ›å»ºå¤‡ä»½ä¿¡æ¯æ–‡ä»¶ cat > "${backup_file}.info" << EOF å¤‡ä»½æ—¶é—´: $(date) ç³»ç»Ÿç‰ˆæœ¬: $(cat /etc/os-release | grep PRETTY_NAME) å†…æ ¸ç‰ˆæœ¬: $(uname -r) å¤‡ä»½å¤§å°: $(du -h "$backup_file" | cut -f1) æ–‡ä»¶æ•°é‡: $(wc -l < "$manifest_file") æ’é™¤è§„åˆ™: $(cat "$EXCLUDE_FILE") EOF return 0 } # æ¸…ç†æ—§å¤‡ä»½ cleanup_old_backups() { log "æ¸…ç†æ—§å¤‡ä»½..." find "$BACKUP_DIR" -type f -name "full_backup_*" -mtime +$RETENTION_DAYS -delete find "$BACKUP_DIR" -type f -name "backup_manifest_*" -mtime +$RETENTION_DAYS -delete find "$BACKUP_DIR" -type f -name "*.sha256" -mtime +$RETENTION_DAYS -delete find "$BACKUP_DIR" -type f -name "*.info" -mtime +$RETENTION_DAYS -delete } # ä¸»å‡½æ•° main() { log "å¼€å§‹å®Œæ•´å¤‡ä»½æµç¨‹..." # æ£€æŸ¥ç¯å¢ƒ if ! check_environment; then log "å¤‡ä»½ç¯å¢ƒæ£€æŸ¥å¤±è´¥ï¼Œç»ˆæ­¢å¤‡ä»½" ~/send_notification.sh "ç³»ç»Ÿå¤‡ä»½å¤±è´¥ï¼šç¯å¢ƒæ£€æŸ¥æœªé€šè¿‡" "high" return 1 fi # åœæ­¢æœåŠ¡ stop_services # åˆ›å»ºå¤‡ä»½ if create_full_backup; then log "å¤‡ä»½åˆ›å»ºæˆåŠŸ" ~/send_notification.sh "ç³»ç»Ÿå®Œæ•´å¤‡ä»½å·²æˆåŠŸåˆ›å»º" "normal" else log "å¤‡ä»½åˆ›å»ºå¤±è´¥" ~/send_notification.sh "ç³»ç»Ÿå¤‡ä»½å¤±è´¥ï¼šå¤‡ä»½åˆ›å»ºè¿‡ç¨‹å‡ºé”™" "high" fi # å¯åŠ¨æœåŠ¡ start_services # æ¸…ç†æ—§å¤‡ä»½ cleanup_old_backups log "å¤‡ä»½æµç¨‹å®Œæˆ" } # æ‰§è¡Œå¤‡ä»½ main ä¸‰åäºŒã€ç³»ç»Ÿæ¢å¤è„šæœ¬ 1. ç³»ç»Ÿæ¢å¤è„šæœ¬ # åˆ›å»ºç³»ç»Ÿæ¢å¤è„šæœ¬ nano ~/system_restore.sh #!/bin/bash # ~/system_restore.sh # é…ç½® BACKUP_ROOT="/mnt/backup_drive" BACKUP_DIR="$BACKUP_ROOT/system_backups" LOG_FILE="/var/log/restore.log" TEMP_DIR="/tmp/restore_temp" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # éªŒè¯å¤‡ä»½æ–‡ä»¶ verify_backup() { local backup_file="$1" log "éªŒè¯å¤‡ä»½æ–‡ä»¶: $backup_file" # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ if [ ! -f "$backup_file" ]; then log "é”™è¯¯: å¤‡ä»½æ–‡ä»¶ä¸å­˜åœ¨" return 1 fi # æ£€æŸ¥æ ¡éªŒå’Œ local checksum_file="${backup_file}.sha256" if [ -f "$checksum_file" ]; then if ! sha256sum -c "$checksum_file"; then log "é”™è¯¯: å¤‡ä»½æ–‡ä»¶æ ¡éªŒå’ŒéªŒè¯å¤±è´¥" return 1 fi else log "è­¦å‘Š: æœªæ‰¾åˆ°æ ¡éªŒå’Œæ–‡ä»¶" fi # æµ‹è¯•å½’æ¡£å®Œæ•´æ€§ if ! tar -tzf "$backup_file" >/dev/null 2>&amp;1; then log "é”™è¯¯: å¤‡ä»½æ–‡ä»¶æŸå" return 1 fi return 0 } # å‡†å¤‡æ¢å¤ç¯å¢ƒ prepare_environment() { log "å‡†å¤‡æ¢å¤ç¯å¢ƒ..." # åˆ›å»ºä¸´æ—¶ç›®å½• mkdir -p "$TEMP_DIR" # åœæ­¢æ‰€æœ‰æœåŠ¡ log "åœæ­¢æœåŠ¡..." sudo systemctl stop nginx pkill llama-server # ç­‰å¾…æœåŠ¡åœæ­¢ sleep 5 # æ¸…ç†ç›®æ ‡ç›®å½• log "æ¸…ç†ç›®æ ‡ç›®å½•..." read -p "è­¦å‘Š: è¿™å°†æ¸…é™¤ç³»ç»Ÿæ–‡ä»¶ã€‚ç¡®å®šè¦ç»§ç»­å—ï¼Ÿ(y/n) " -n 1 -r echo if [[ ! $REPLY =~ ^[Yy]$ ]]; then log "ç”¨æˆ·å–æ¶ˆæ“ä½œ" return 1 fi return 0 } # æ‰§è¡Œæ¢å¤ perform_restore() { local backup_file="$1" log "å¼€å§‹æ¢å¤ç³»ç»Ÿ..." # åˆ›å»ºæ¢å¤å‰çš„å¿«ç…§ log "åˆ›å»ºå½“å‰ç³»ç»Ÿå¿«ç…§..." local snapshot_date=$(date +%Y%m%d_%H%M%S) local snapshot_file="$BACKUP_DIR/pre_restore_snapshot_${snapshot_date}.tar.gz" sudo tar -czf "$snapshot_file" \ --exclude-from="/home/zhaoxiongzhou/backup_exclude.txt" \ --one-file-system \ -C / . # è§£å‹å¤‡ä»½ log "è§£å‹å¤‡ä»½æ–‡ä»¶..." sudo tar -xzf "$backup_file" -C / \ --numeric-owner \ --preserve-permissions \ --checkpoint=1000 \ --checkpoint-action=dot # ä¿®å¤æƒé™ log "ä¿®å¤æ–‡ä»¶æƒé™..." sudo chown -R www-data:www-data /var/www/ sudo chown -R zhaoxiongzhou:zhaoxiongzhou /home/zhaoxiongzhou/ return 0 } # æ¢å¤æœåŠ¡é…ç½® restore_configurations() { log "æ¢å¤æœåŠ¡é…ç½®..." # é‡æ–°åŠ è½½ç³»ç»Ÿé…ç½® sudo systemctl daemon-reload sudo sysctl --system # é‡æ–°é…ç½®ç½‘ç»œ sudo systemctl restart networking # æ¢å¤é˜²ç«å¢™è§„åˆ™ sudo iptables-restore < /etc/iptables/rules.v4 return 0 } # éªŒè¯æ¢å¤ verify_restore() { log "éªŒè¯ç³»ç»Ÿæ¢å¤..." local status=0 # æ£€æŸ¥å…³é”®æ–‡ä»¶ for file in "/etc/nginx/nginx.conf" "/etc/systemd/system/llama-server.service"; do if [ ! -f "$file" ]; then log "é”™è¯¯: æœªæ‰¾åˆ°å…³é”®æ–‡ä»¶ $file" status=1 fi done # å¯åŠ¨æœåŠ¡ sudo systemctl start nginx ~/projects/llama.cpp/start-llama.sh # éªŒè¯æœåŠ¡çŠ¶æ€ sleep 10 if ! systemctl is-active --quiet nginx; then log "é”™è¯¯: Nginx æœåŠ¡æœªèƒ½æ­£å¸¸å¯åŠ¨" status=1 fi if ! pgrep -f llama-server > /dev/null; then log "é”™è¯¯: AI æœåŠ¡æœªèƒ½æ­£å¸¸å¯åŠ¨" status=1 fi return $status } # æ¸…ç†æ¢å¤ç¯å¢ƒ cleanup() { log "æ¸…ç†æ¢å¤ç¯å¢ƒ..." # åˆ é™¤ä¸´æ—¶æ–‡ä»¶ rm -rf "$TEMP_DIR" # æ¸…ç†æ—¥å¿— find /var/log -type f -name "*.gz" -delete return 0 } # ä¸»å‡½æ•° main() { local backup_file # åˆ—å‡ºå¯ç”¨å¤‡ä»½ echo "å¯ç”¨çš„å¤‡ä»½æ–‡ä»¶:" ls -lh "$BACKUP_DIR"/full_backup_*.tar.gz # é€‰æ‹©å¤‡ä»½æ–‡ä»¶ read -p "è¯·è¾“å…¥è¦æ¢å¤çš„å¤‡ä»½æ–‡ä»¶å®Œæ•´è·¯å¾„: " backup_file # éªŒè¯å¤‡ä»½ if ! verify_backup "$backup_file"; then log "å¤‡ä»½éªŒè¯å¤±è´¥ï¼Œç»ˆæ­¢æ¢å¤" return 1 fi # å‡†å¤‡ç¯å¢ƒ if ! prepare_environment; then log "ç¯å¢ƒå‡†å¤‡å¤±è´¥ï¼Œç»ˆæ­¢æ¢å¤" return 1 fi # æ‰§è¡Œæ¢å¤ if perform_restore "$backup_file" && \ restore_configurations && \ verify_restore; then log "ç³»ç»Ÿæ¢å¤æˆåŠŸå®Œæˆ" ~/send_notification.sh "ç³»ç»Ÿæ¢å¤æˆåŠŸå®Œæˆ" "normal" else log "ç³»ç»Ÿæ¢å¤å¤±è´¥" ~/send_notification.sh "ç³»ç»Ÿæ¢å¤å¤±è´¥ï¼Œéœ€è¦æ‰‹åŠ¨æ£€æŸ¥" "high" fi # æ¸…ç†ç¯å¢ƒ cleanup } # æ‰§è¡Œæ¢å¤ main ä¸‰åä¸‰ã€ç³»ç»Ÿè¿ç§»å·¥å…· 1. ç³»ç»Ÿè¿ç§»è„šæœ¬ # åˆ›å»ºç³»ç»Ÿè¿ç§»è„šæœ¬ nano ~/system_migration.sh #!/bin/bash # ~/system_migration.sh # é…ç½® SOURCE_HOST="old-raspberry.local" TARGET_HOST="new-raspberry.local" MIGRATION_DIR="/mnt/migration" LOG_FILE="/var/log/migration.log" SSH_KEY="~/.ssh/migration_key" RSYNC_OPTS="-avz --progress --delete" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # æ£€æŸ¥è¿ç§»ç¯å¢ƒ check_migration_env() { log "æ£€æŸ¥è¿ç§»ç¯å¢ƒ..." # æ£€æŸ¥ SSH å¯†é’¥ if [ ! -f "$SSH_KEY" ]; then log "ç”Ÿæˆ SSH å¯†é’¥..." ssh-keygen -t ed25519 -f "$SSH_KEY" -N "" # å¤åˆ¶å¯†é’¥åˆ°ç›®æ ‡ä¸»æœº ssh-copy-id -i "$SSH_KEY" "zhaoxiongzhou@$TARGET_HOST" fi # æ£€æŸ¥å¿…è¦å·¥å…· for tool in rsync ssh scp; do if ! command -v $tool &>/dev/null; then log "é”™è¯¯: æœªæ‰¾åˆ°å¿…è¦å·¥å…· $tool" return 1 fi done # æ£€æŸ¥ç›®æ ‡ä¸»æœºè¿æ¥ if ! ssh -i "$SSH_KEY" "zhaoxiongzhou@$TARGET_HOST" "echo &#39;Connection test&#39;" &>/dev/null; then log "é”™è¯¯: æ— æ³•è¿æ¥åˆ°ç›®æ ‡ä¸»æœº" return 1 fi return 0 } # è¿ç§»é…ç½®æ–‡ä»¶ migrate_configs() { log "è¿ç§»é…ç½®æ–‡ä»¶..." # åˆ›å»ºé…ç½®ç›®å½• ssh -i "$SSH_KEY" "zhaoxiongzhou@$TARGET_HOST" "mkdir -p ~/configs_backup" # è¿ç§» Nginx é…ç½® rsync $RSYNC_OPTS -e "ssh -i $SSH_KEY" \ /etc/nginx/ \ "zhaoxiongzhou@$TARGET_HOST:~/configs_backup/nginx/" # è¿ç§»ç³»ç»Ÿé…ç½® rsync $RSYNC_OPTS -e "ssh -i $SSH_KEY" \ /etc/sysctl.d/ \ "zhaoxiongzhou@$TARGET_HOST:~/configs_backup/sysctl/" # è¿ç§»æœåŠ¡é…ç½® rsync $RSYNC_OPTS -e "ssh -i $SSH_KEY" \ /etc/systemd/system/ \ "zhaoxiongzhou@$TARGET_HOST:~/configs_backup/systemd/" } # è¿ç§»æ•°æ® migrate_data() { log "è¿ç§»æ•°æ®..." # è¿ç§»åšå®¢æ•°æ® rsync $RSYNC_OPTS -e "ssh -i $SSH_KEY" \ ~/myblog/ \ "zhaoxiongzhou@$TARGET_HOST:~/myblog/" # è¿ç§» AI æœåŠ¡æ•°æ® rsync $RSYNC_OPTS -e "ssh -i $SSH_KEY" \ ~/projects/llama.cpp/ \ "zhaoxiongzhou@$TARGET_HOST:~/projects/llama.cpp/" # è¿ç§»ç”¨æˆ·è„šæœ¬ rsync $RSYNC_OPTS -e "ssh -i $SSH_KEY" \ ~/*.sh \ "zhaoxiongzhou@$TARGET_HOST:~/" } # è¿ç§»æ•°æ®åº“ migrate_database() { log "è¿ç§»æ•°æ®åº“..." # å¯¼å‡ºæ•°æ®åº“ local dump_file="/tmp/database_dump.sql" if [ -f "/var/lib/mysql" ]; then mysqldump --all-databases > "$dump_file" # ä¼ è¾“åˆ°ç›®æ ‡ä¸»æœº scp -i "$SSH_KEY" "$dump_file" "zhaoxiongzhou@$TARGET_HOST:/tmp/" # åœ¨ç›®æ ‡ä¸»æœºå¯¼å…¥æ•°æ®åº“ ssh -i "$SSH_KEY" "zhaoxiongzhou@$TARGET_HOST" \ "mysql < /tmp/database_dump.sql" fi } # é…ç½®ç›®æ ‡ç³»ç»Ÿ configure_target() { log "é…ç½®ç›®æ ‡ç³»ç»Ÿ..." ssh -i "$SSH_KEY" "zhaoxiongzhou@$TARGET_HOST" "bash -s" << &#39;EOF&#39; # å®‰è£…å¿…è¦è½¯ä»¶ sudo apt update sudo apt install -y nginx mysql-server python3 pip # æ¢å¤é…ç½® sudo cp -r ~/configs_backup/nginx/* /etc/nginx/ sudo cp -r ~/configs_backup/sysctl/* /etc/sysctl.d/ sudo cp -r ~/configs_backup/systemd/* /etc/systemd/system/ # è®¾ç½®æƒé™ sudo chown -R www-data:www-data /var/www/ sudo chmod +x ~/*.sh # é‡å¯æœåŠ¡ sudo systemctl daemon-reload sudo systemctl restart nginx EOF } # éªŒè¯è¿ç§» verify_migration() { log "éªŒè¯è¿ç§»..." local status=0 # æ£€æŸ¥æœåŠ¡çŠ¶æ€ ssh -i "$SSH_KEY" "zhaoxiongzhou@$TARGET_HOST" "bash -s" << &#39;EOF&#39; # æ£€æŸ¥ Nginx if ! systemctl is-active --quiet nginx; then echo "é”™è¯¯: Nginx æœåŠ¡æœªè¿è¡Œ" exit 1 fi # æ£€æŸ¥æ–‡ä»¶ for dir in "~/myblog" "~/projects/llama.cpp"; do if [ ! -d "$dir" ]; then echo "é”™è¯¯: ç›®å½• $dir ä¸å­˜åœ¨" exit 1 fi done # æ£€æŸ¥é…ç½® if ! nginx -t &>/dev/null; then echo "é”™è¯¯: Nginx é…ç½®æ— æ•ˆ" exit 1 fi EOF status=$? return $status } # ä¸»å‡½æ•° main() { log "å¼€å§‹ç³»ç»Ÿè¿ç§»..." # æ£€æŸ¥ç¯å¢ƒ if ! check_migration_env; then log "è¿ç§»ç¯å¢ƒæ£€æŸ¥å¤±è´¥" return 1 fi # æ‰§è¡Œè¿ç§» migrate_configs migrate_data migrate_database configure_target # éªŒè¯è¿ç§» if verify_migration; then log "ç³»ç»Ÿè¿ç§»æˆåŠŸå®Œæˆ" ~/send_notification.sh "ç³»ç»Ÿè¿ç§»æˆåŠŸå®Œæˆ" "normal" else log "ç³»ç»Ÿè¿ç§»å¤±è´¥" ~/send_notification.sh "ç³»ç»Ÿè¿ç§»å¤±è´¥ï¼Œéœ€è¦æ‰‹åŠ¨æ£€æŸ¥" "high" fi } # æ‰§è¡Œè¿ç§» main ä¸‰åå››ã€æ—¥å¿—åˆ†æå·¥å…· 1. æ—¥å¿—åˆ†æè„šæœ¬ # åˆ›å»ºæ—¥å¿—åˆ†æè„šæœ¬ nano ~/log_analyzer.sh #!/bin/bash # ~/log_analyzer.sh # é…ç½® LOG_DIRS=( "/var/log" "/var/log/nginx" "/home/zhaoxiongzhou/logs" ) REPORT_DIR="/home/zhaoxiongzhou/log_reports" LOG_FILE="/var/log/analyzer.log" ALERT_THRESHOLD=100 # é”™è¯¯æ—¥å¿—é˜ˆå€¼ RETENTION_DAYS=30 # æŠ¥å‘Šä¿ç•™å¤©æ•° # ç¡®ä¿ç›®å½•å­˜åœ¨ mkdir -p "$REPORT_DIR" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # åˆ†æç³»ç»Ÿæ—¥å¿— analyze_system_logs() { log "åˆ†æç³»ç»Ÿæ—¥å¿—..." local report_file="$REPORT_DIR/system_log_report_$(date +%Y%m%d).md" { echo "# ç³»ç»Ÿæ—¥å¿—åˆ†ææŠ¥å‘Š" echo "## ç”Ÿæˆæ—¶é—´: $(date &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo echo "## ç³»ç»Ÿé”™è¯¯ç»Ÿè®¡" echo "### ä¸¥é‡é”™è¯¯" echo &#39;```&#39; grep -i "error\|critical\|emergency" /var/log/syslog | \ tail -n 50 | sort | uniq -c | sort -nr echo &#39;```&#39; echo "### è®¤è¯å¤±è´¥" echo &#39;```&#39; grep "Failed password" /var/log/auth.log | \ awk &#39;{print $1,$2,$3,$11}&#39; | sort | uniq -c | sort -nr | head -n 10 echo &#39;```&#39; echo "### ç³»ç»Ÿé‡å¯è®°å½•" echo &#39;```&#39; last reboot | head -n 5 echo &#39;```&#39; } > "$report_file" } # åˆ†æ Nginx è®¿é—®æ—¥å¿— analyze_nginx_logs() { log "åˆ†æ Nginx è®¿é—®æ—¥å¿—..." local report_file="$REPORT_DIR/nginx_log_report_$(date +%Y%m%d).md" { echo "# Nginx è®¿é—®æ—¥å¿—åˆ†ææŠ¥å‘Š" echo "## ç”Ÿæˆæ—¶é—´: $(date &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo echo "## è®¿é—®ç»Ÿè®¡" echo "### è¯·æ±‚é‡æœ€å¤§çš„ IP" echo &#39;```&#39; awk &#39;{print $1}&#39; /var/log/nginx/access.log | sort | uniq -c | sort -nr | head -n 10 echo &#39;```&#39; echo "### è®¿é—®é‡æœ€å¤§çš„é¡µé¢" echo &#39;```&#39; awk &#39;{print $7}&#39; /var/log/nginx/access.log | sort | uniq -c | sort -nr | head -n 10 echo &#39;```&#39; echo "### HTTP çŠ¶æ€ç ç»Ÿè®¡" echo &#39;```&#39; awk &#39;{print $9}&#39; /var/log/nginx/access.log | sort | uniq -c | sort -nr echo &#39;```&#39; echo "### æ¯å°æ—¶è¯·æ±‚é‡ç»Ÿè®¡" echo &#39;```&#39; awk &#39;{print $4}&#39; /var/log/nginx/access.log | cut -c 14-15 | sort | uniq -c | \ awk &#39;{printf("%s:00 - %s è¯·æ±‚\n", $2, $1)}&#39; echo &#39;```&#39; } > "$report_file" } # åˆ†æ AI æœåŠ¡æ—¥å¿— analyze_ai_logs() { log "åˆ†æ AI æœåŠ¡æ—¥å¿—..." local report_file="$REPORT_DIR/ai_log_report_$(date +%Y%m%d).md" local ai_log="/home/zhaoxiongzhou/logs/llama.log" if [ -f "$ai_log" ]; then { echo "# AI æœåŠ¡æ—¥å¿—åˆ†ææŠ¥å‘Š" echo "## ç”Ÿæˆæ—¶é—´: $(date &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo echo "## æœåŠ¡ç»Ÿè®¡" echo "### é”™è¯¯ç»Ÿè®¡" echo &#39;```&#39; grep -i "error" "$ai_log" | tail -n 20 echo &#39;```&#39; echo "### æ€§èƒ½ç»Ÿè®¡" echo "#### å“åº”æ—¶é—´åˆ†å¸ƒ" echo &#39;```&#39; grep "response_time" "$ai_log" | \ awk &#39;{sum+=$NF; count++} END {print "å¹³å‡å“åº”æ—¶é—´:", sum/count, "ms"}&#39; echo &#39;```&#39; echo "#### å†…å­˜ä½¿ç”¨ç»Ÿè®¡" echo &#39;```&#39; grep "memory_usage" "$ai_log" | tail -n 10 echo &#39;```&#39; } > "$report_file" fi } # ç”Ÿæˆå®‰å…¨æŠ¥å‘Š generate_security_report() { log "ç”Ÿæˆå®‰å…¨æŠ¥å‘Š..." local report_file="$REPORT_DIR/security_report_$(date +%Y%m%d).md" { echo "# å®‰å…¨åˆ†ææŠ¥å‘Š" echo "## ç”Ÿæˆæ—¶é—´: $(date &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo echo "## å®‰å…¨äº‹ä»¶ç»Ÿè®¡" echo "### SSH æš´åŠ›ç ´è§£å°è¯•" echo &#39;```&#39; grep "Failed password" /var/log/auth.log | \ awk &#39;{print $11,$13}&#39; | sort | uniq -c | sort -nr | head -n 10 echo &#39;```&#39; echo "### å¯ç–‘ IP è®¿é—®" echo &#39;```&#39; grep -i "suspicious\|attack\|hack" /var/log/nginx/access.log | \ awk &#39;{print $1}&#39; | sort | uniq -c | sort -nr echo &#39;```&#39; echo "### æ–‡ä»¶æƒé™å˜æ›´" echo &#39;```&#39; find /etc -mtime -1 -type f -ls echo &#39;```&#39; } > "$report_file" } # æ¸…ç†æ—§æŠ¥å‘Š cleanup_old_reports() { log "æ¸…ç†æ—§æŠ¥å‘Š..." find "$REPORT_DIR" -type f -name "*.md" -mtime +$RETENTION_DAYS -delete } # ç”Ÿæˆæ‘˜è¦æŠ¥å‘Š generate_summary() { log "ç”Ÿæˆæ‘˜è¦æŠ¥å‘Š..." local summary_file="$REPORT_DIR/summary_$(date +%Y%m%d).md" { echo "# æ—¥å¿—åˆ†ææ‘˜è¦æŠ¥å‘Š" echo "## ç”Ÿæˆæ—¶é—´: $(date &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo echo "## å…³é”®æŒ‡æ ‡" # é”™è¯¯ç»Ÿè®¡ local error_count=$(grep -i "error" /var/log/syslog | wc -l) local nginx_error_count=$(grep -i "error" /var/log/nginx/error.log | wc -l) echo "- ç³»ç»Ÿé”™è¯¯æ•°: $error_count" echo "- Nginx é”™è¯¯æ•°: $nginx_error_count" # å®‰å…¨äº‹ä»¶ local ssh_fails=$(grep "Failed password" /var/log/auth.log | wc -l) echo "- SSH å¤±è´¥å°è¯•: $ssh_fails" # å‘Šè­¦åˆ¤æ–­ if [ $error_count -gt $ALERT_THRESHOLD ]; then ~/send_notification.sh "è­¦å‘Š: ç³»ç»Ÿé”™è¯¯æ•°è¶…è¿‡é˜ˆå€¼" "high" fi } > "$summary_file" } # ä¸»å‡½æ•° main() { log "å¼€å§‹æ—¥å¿—åˆ†æ..." # æ‰§è¡Œåˆ†æ analyze_system_logs analyze_nginx_logs analyze_ai_logs generate_security_report generate_summary # æ¸…ç†æ—§æŠ¥å‘Š cleanup_old_reports log "æ—¥å¿—åˆ†æå®Œæˆ" } # æ‰§è¡Œåˆ†æ main ä¸‰åäº”ã€ç³»ç»Ÿä¼˜åŒ–å·¥å…· 1. ç³»ç»Ÿä¼˜åŒ–è„šæœ¬ # åˆ›å»ºç³»ç»Ÿä¼˜åŒ–è„šæœ¬ nano ~/system_optimize.sh #!/bin/bash # ~/system_optimize.sh # é…ç½® LOG_FILE="/var/log/optimize.log" NGINX_CONF="/etc/nginx/nginx.conf" SYSCTL_CONF="/etc/sysctl.d/99-custom.conf" JOURNAL_CONF="/etc/systemd/journald.conf" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # ä¼˜åŒ–ç³»ç»Ÿå‚æ•° optimize_system() { log "ä¼˜åŒ–ç³»ç»Ÿå‚æ•°..." # å¤‡ä»½åŸå§‹é…ç½® cp "$SYSCTL_CONF" "${SYSCTL_CONF}.backup" # é…ç½®ç³»ç»Ÿå‚æ•° cat > "$SYSCTL_CONF" << EOF # ç½‘ç»œä¼˜åŒ– net.core.somaxconn = 2048 net.core.netdev_max_backlog = 4096 net.ipv4.tcp_max_syn_backlog = 4096 net.ipv4.tcp_fin_timeout = 30 net.ipv4.tcp_keepalive_time = 1200 net.ipv4.tcp_max_tw_buckets = 5000 net.ipv4.tcp_fastopen = 3 net.ipv4.tcp_rmem = 4096 87380 16777216 net.ipv4.tcp_wmem = 4096 65536 16777216 # æ–‡ä»¶ç³»ç»Ÿä¼˜åŒ– fs.file-max = 100000 fs.inotify.max_user_watches = 524288 # å†…å­˜ä¼˜åŒ– vm.swappiness = 10 vm.dirty_ratio = 60 vm.dirty_background_ratio = 2 EOF # åº”ç”¨ç³»ç»Ÿå‚æ•° sysctl -p "$SYSCTL_CONF" } # ä¼˜åŒ– Nginx é…ç½® optimize_nginx() { log "ä¼˜åŒ– Nginx é…ç½®..." # å¤‡ä»½åŸå§‹é…ç½® cp "$NGINX_CONF" "${NGINX_CONF}.backup" # é…ç½® Nginx cat > "$NGINX_CONF" << EOF user www-data; worker_processes auto; worker_rlimit_nofile 100000; events { worker_connections 2048; multi_accept on; use epoll; } http { # åŸºç¡€è®¾ç½® sendfile on; tcp_nopush on; tcp_nodelay on; keepalive_timeout 65; types_hash_max_size 2048; server_tokens off; # MIME ç±»å‹ include /etc/nginx/mime.types; default_type application/octet-stream; # æ—¥å¿—æ ¼å¼ log_format main &#39;\$remote_addr - \$remote_user [\$time_local] "\$request" &#39; &#39;\$status \$body_bytes_sent "\$http_referer" &#39; &#39;"\$http_user_agent" "\$http_x_forwarded_for"&#39;; # ç¼“å†²åŒºè®¾ç½® client_body_buffer_size 128k; client_max_body_size 10m; client_header_buffer_size 1k; large_client_header_buffers 4 4k; # Gzip å‹ç¼© gzip on; gzip_vary on; gzip_proxied any; gzip_comp_level 6; gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript; # SSL ä¼˜åŒ– ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers on; ssl_session_cache shared:SSL:10m; ssl_session_timeout 10m; # åŒ…å«å…¶ä»–é…ç½® include /etc/nginx/conf.d/*.conf; include /etc/nginx/sites-enabled/*; } EOF # æµ‹è¯•é…ç½® nginx -t && systemctl restart nginx } # ä¼˜åŒ–ç³»ç»ŸæœåŠ¡ optimize_services() { log "ä¼˜åŒ–ç³»ç»ŸæœåŠ¡..." # ç¦ç”¨ä¸å¿…è¦çš„æœåŠ¡ local unnecessary_services=( "bluetooth" "cups" "avahi-daemon" ) for service in "${unnecessary_services[@]}"; do if systemctl is-active --quiet "$service"; then systemctl stop "$service" systemctl disable "$service" log "å·²ç¦ç”¨æœåŠ¡: $service" fi done # ä¼˜åŒ–æ—¥å¿—æœåŠ¡ cat > "$JOURNAL_CONF" << EOF [Journal] SystemMaxUse=100M SystemMaxFileSize=10M RuntimeMaxUse=50M RuntimeMaxFileSize=5M EOF # é‡å¯æ—¥å¿—æœåŠ¡ systemctl restart systemd-journald } # ä¼˜åŒ–æ–‡ä»¶ç³»ç»Ÿ optimize_filesystem() { log "ä¼˜åŒ–æ–‡ä»¶ç³»ç»Ÿ..." # æ¸…ç†ä¸´æ—¶æ–‡ä»¶ find /tmp -type f -atime +10 -delete find /var/tmp -type f -atime +10 -delete # æ¸…ç†æ—¥å¿— find /var/log -type f -name "*.gz" -delete find /var/log -type f -name "*.old" -delete # ä¼˜åŒ–æ—¥å¿—è½®è½¬ cat > /etc/logrotate.d/custom << EOF /var/log/custom/*.log { daily rotate 7 compress delaycompress missingok notifempty create 640 root adm } EOF } # ä¼˜åŒ–å†…å­˜ä½¿ç”¨ optimize_memory() { log "ä¼˜åŒ–å†…å­˜ä½¿ç”¨..." # æ¸…ç†ç¼“å­˜ sync; echo 3 > /proc/sys/vm/drop_caches # é…ç½® swap ä½¿ç”¨ if [ -f /swapfile ]; then swapoff /swapfile dd if=/dev/zero of=/swapfile bs=1M count=2048 chmod 600 /swapfile mkswap /swapfile swapon /swapfile fi } # éªŒè¯ä¼˜åŒ– verify_optimization() { log "éªŒè¯ç³»ç»Ÿä¼˜åŒ–..." local status=0 # æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½ local load=$(uptime | awk -F&#39;load average:&#39; &#39;{print $2}&#39; | cut -d, -f1) if [ $(echo "$load > 2" | bc -l) -eq 1 ]; then log "è­¦å‘Š: ç³»ç»Ÿè´Ÿè½½è¾ƒé«˜ ($load)" status=1 fi # æ£€æŸ¥å†…å­˜ä½¿ç”¨ local mem_usage=$(free | grep Mem | awk &#39;{print $3/$2 * 100.0}&#39;) if [ $(echo "$mem_usage > 90" | bc -l) -eq 1 ]; then log "è­¦å‘Š: å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜ ($mem_usage%)" status=1 fi # æ£€æŸ¥æœåŠ¡çŠ¶æ€ if ! systemctl is-active --quiet nginx; then log "é”™è¯¯: Nginx æœåŠ¡æœªæ­£å¸¸è¿è¡Œ" status=1 fi return $status } # ä¸»å‡½æ•° main() { log "å¼€å§‹ç³»ç»Ÿä¼˜åŒ–..." optimize_system optimize_nginx optimize_services optimize_filesystem optimize_memory if verify_optimization; then log "ç³»ç»Ÿä¼˜åŒ–æˆåŠŸå®Œæˆ" ~/send_notification.sh "ç³»ç»Ÿä¼˜åŒ–å·²å®Œæˆ" "normal" else log "ç³»ç»Ÿä¼˜åŒ–å®Œæˆï¼Œä½†å­˜åœ¨è­¦å‘Š" ~/send_notification.sh "ç³»ç»Ÿä¼˜åŒ–å®Œæˆï¼Œä½†éœ€è¦æ£€æŸ¥" "high" fi } # æ‰§è¡Œä¼˜åŒ– main ä¸‰åå…­ã€éƒ¨ç½²åæ£€æŸ¥æ¸…å• 1. éƒ¨ç½²æ£€æŸ¥è„šæœ¬ # åˆ›å»ºéƒ¨ç½²æ£€æŸ¥è„šæœ¬ nano ~/deployment_checklist.sh #!/bin/bash # ~/deployment_checklist.sh # é…ç½® LOG_FILE="/var/log/deployment_check.log" REPORT_FILE="/home/zhaoxiongzhou/deployment_report.md" CHECK_INTERVAL=300 # æ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰ # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # æ£€æŸ¥ç³»ç»ŸåŸºç¡€é…ç½® check_system_basics() { log "æ£€æŸ¥ç³»ç»ŸåŸºç¡€é…ç½®..." local status=0 { echo "## ç³»ç»ŸåŸºç¡€æ£€æŸ¥" echo "### ç³»ç»Ÿä¿¡æ¯" echo "- ä¸»æœºå: $(hostname)" echo "- ç³»ç»Ÿç‰ˆæœ¬: $(cat /etc/os-release | grep PRETTY_NAME)" echo "- å†…æ ¸ç‰ˆæœ¬: $(uname -r)" echo "- è¿è¡Œæ—¶é—´: $(uptime -p)" echo echo "### èµ„æºä½¿ç”¨" echo "- CPU ä½¿ç”¨ç‡: $(top -bn1 | grep "Cpu(s)" | awk &#39;{print $2}&#39;)%" echo "- å†…å­˜ä½¿ç”¨ç‡: $(free | grep Mem | awk &#39;{print $3/$2 * 100.0}&#39;)%" echo "- ç£ç›˜ä½¿ç”¨ç‡: $(df -h / | awk &#39;NR==2 {print $5}&#39;)" echo } > "$REPORT_FILE" return $status } # æ£€æŸ¥ç½‘ç»œé…ç½® check_network() { log "æ£€æŸ¥ç½‘ç»œé…ç½®..." local status=0 { echo "### ç½‘ç»œé…ç½®" echo "#### IP é…ç½®" echo &#39;```&#39; ip addr show echo &#39;```&#39; echo "#### è·¯ç”±è¡¨" echo &#39;```&#39; ip route echo &#39;```&#39; echo "#### å¼€æ”¾ç«¯å£" echo &#39;```&#39; netstat -tuln echo &#39;```&#39; echo "#### DNS é…ç½®" echo &#39;```&#39; cat /etc/resolv.conf echo &#39;```&#39; } >> "$REPORT_FILE" return $status } # æ£€æŸ¥æœåŠ¡é…ç½® check_services() { log "æ£€æŸ¥æœåŠ¡é…ç½®..." local status=0 { echo "### æœåŠ¡çŠ¶æ€" echo "#### Nginx é…ç½®" echo &#39;```&#39; nginx -T echo &#39;```&#39; echo "#### æœåŠ¡è¿è¡ŒçŠ¶æ€" echo &#39;```&#39; systemctl status nginx systemctl status mysql ps aux | grep llama-server echo &#39;```&#39; echo "#### æœåŠ¡æ—¥å¿—æ£€æŸ¥" echo &#39;```&#39; tail -n 20 /var/log/nginx/error.log echo &#39;```&#39; } >> "$REPORT_FILE" return $status } # æ£€æŸ¥å®‰å…¨é…ç½® check_security() { log "æ£€æŸ¥å®‰å…¨é…ç½®..." local status=0 { echo "### å®‰å…¨æ£€æŸ¥" echo "#### é˜²ç«å¢™è§„åˆ™" echo &#39;```&#39; sudo iptables -L echo &#39;```&#39; echo "#### SSH é…ç½®" echo &#39;```&#39; grep -v &#39;^#&#39; /etc/ssh/sshd_config echo &#39;```&#39; echo "#### ç”¨æˆ·æƒé™" echo &#39;```&#39; ls -la /home/zhaoxiongzhou/ ls -la /var/www/ echo &#39;```&#39; echo "#### SSL è¯ä¹¦" echo &#39;```&#39; openssl x509 -in /etc/nginx/ssl/server.crt -text -noout echo &#39;```&#39; } >> "$REPORT_FILE" return $status } # æ£€æŸ¥å¤‡ä»½é…ç½® check_backups() { log "æ£€æŸ¥å¤‡ä»½é…ç½®..." local status=0 { echo "### å¤‡ä»½æ£€æŸ¥" echo "#### å¤‡ä»½é…ç½®" echo &#39;```&#39; ls -lh /mnt/backup_drive/system_backups/ echo &#39;```&#39; echo "#### æœ€è¿‘å¤‡ä»½çŠ¶æ€" echo &#39;```&#39; tail -n 20 /var/log/backup.log echo &#39;```&#39; } >> "$REPORT_FILE" return $status } # æ£€æŸ¥ç›‘æ§é…ç½® check_monitoring() { log "æ£€æŸ¥ç›‘æ§é…ç½®..." local status=0 { echo "### ç›‘æ§æ£€æŸ¥" echo "#### ç›‘æ§è„šæœ¬çŠ¶æ€" echo &#39;```&#39; ps aux | grep monitor echo &#39;```&#39; echo "#### å‘Šè­¦é…ç½®" echo &#39;```&#39; cat ~/send_notification.sh echo &#39;```&#39; } >> "$REPORT_FILE" return $status } # ç”Ÿæˆæ€»ç»“æŠ¥å‘Š generate_summary() { log "ç”Ÿæˆæ€»ç»“æŠ¥å‘Š..." { echo "## éƒ¨ç½²æ£€æŸ¥æ€»ç»“" echo "### æ£€æŸ¥æ—¶é—´: $(date &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo echo "### ä¸»è¦å‘ç°" echo "1. ç³»ç»ŸçŠ¶æ€: $([ $system_status -eq 0 ] && echo &#39;æ­£å¸¸ âœ…&#39; || echo &#39;å¼‚å¸¸ âŒ&#39;)" echo "2. ç½‘ç»œé…ç½®: $([ $network_status -eq 0 ] && echo &#39;æ­£å¸¸ âœ…&#39; || echo &#39;å¼‚å¸¸ âŒ&#39;)" echo "3. æœåŠ¡çŠ¶æ€: $([ $services_status -eq 0 ] && echo &#39;æ­£å¸¸ âœ…&#39; || echo &#39;å¼‚å¸¸ âŒ&#39;)" echo "4. å®‰å…¨é…ç½®: $([ $security_status -eq 0 ] && echo &#39;æ­£å¸¸ âœ…&#39; || echo &#39;å¼‚å¸¸ âŒ&#39;)" echo "5. å¤‡ä»½çŠ¶æ€: $([ $backup_status -eq 0 ] && echo &#39;æ­£å¸¸ âœ…&#39; || echo &#39;å¼‚å¸¸ âŒ&#39;)" echo "6. ç›‘æ§çŠ¶æ€: $([ $monitoring_status -eq 0 ] && echo &#39;æ­£å¸¸ âœ…&#39; || echo &#39;å¼‚å¸¸ âŒ&#39;)" echo echo "### å»ºè®®æ“ä½œ" [ $system_status -ne 0 ] && echo "- æ£€æŸ¥ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ" [ $network_status -ne 0 ] && echo "- éªŒè¯ç½‘ç»œé…ç½®" [ $services_status -ne 0 ] && echo "- æ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€" [ $security_status -ne 0 ] && echo "- å®¡æŸ¥å®‰å…¨é…ç½®" [ $backup_status -ne 0 ] && echo "- ç¡®è®¤å¤‡ä»½æ˜¯å¦æ­£å¸¸" [ $monitoring_status -ne 0 ] && echo "- æ£€æŸ¥ç›‘æ§ç³»ç»Ÿ" } >> "$REPORT_FILE" } # ä¸»å‡½æ•° main() { log "å¼€å§‹éƒ¨ç½²åæ£€æŸ¥..." # æ‰§è¡Œæ£€æŸ¥ check_system_basics system_status=$? check_network network_status=$? check_services services_status=$? check_security security_status=$? check_backups backup_status=$? check_monitoring monitoring_status=$? # ç”Ÿæˆæ€»ç»“ generate_summary # å‘é€é€šçŸ¥ if [ $system_status -eq 0 ] && [ $network_status -eq 0 ] && \ [ $services_status -eq 0 ] && [ $security_status -eq 0 ] && \ [ $backup_status -eq 0 ] && [ $monitoring_status -eq 0 ]; then ~/send_notification.sh "éƒ¨ç½²æ£€æŸ¥å®Œæˆï¼šæ‰€æœ‰é¡¹ç›®æ­£å¸¸" "normal" else ~/send_notification.sh "éƒ¨ç½²æ£€æŸ¥å®Œæˆï¼šå­˜åœ¨éœ€è¦å…³æ³¨çš„é¡¹ç›®" "high" fi log "éƒ¨ç½²æ£€æŸ¥å®Œæˆï¼ŒæŠ¥å‘Šå·²ç”Ÿæˆ: $REPORT_FILE" } # æ‰§è¡Œæ£€æŸ¥ main ã€Šæ ‘è“æ´¾æœåŠ¡éƒ¨ç½²ä¸ç»´æŠ¤å®Œæ•´æŒ‡å—ã€‹æ€»å…±åŒ…å«äº† 36 ä¸ªéƒ¨åˆ†ï¼Œæ¶µç›–äº†ä»ç³»ç»Ÿéƒ¨ç½²åˆ°ç»´æŠ¤çš„å„ä¸ªæ–¹é¢ã€‚æ¯ä¸ªè„šæœ¬éƒ½ç»è¿‡ç²¾å¿ƒè®¾è®¡ï¼Œå¯ä»¥ç‹¬ç«‹è¿è¡Œï¼Œä¹Ÿå¯ä»¥äº’ç›¸é…åˆä½¿ç”¨ã€‚
'><meta name=keywords content="RaspberryPi,Hugo,æ•™ç¨‹"><meta name=generator content="Hugo 0.139.3"><meta property="og:url" content="http://10.10.164.61/posts/guide/%E6%A0%91%E8%8E%93%E6%B4%BE%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2%E4%B8%8E%E7%BB%B4%E6%8A%A4%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/"><meta property="og:site_name" content="èµµé›„å·çš„åšå®¢"><meta property="og:title" content="æ ‘è“æ´¾æœåŠ¡éƒ¨ç½²ä¸ç»´æŠ¤å®Œæ•´æŒ‡å—"><meta property="og:description" content='æ ‘è“æ´¾æœåŠ¡éƒ¨ç½²ä¸ç»´æŠ¤å®Œæ•´æŒ‡å— ä¸€ã€ç³»ç»Ÿæ¦‚å†µ 1. ç¡¬ä»¶èµ„æº å¤„ç†å™¨: ARM64 æ¶æ„ æ€»å†…å­˜: 3.7GB å¯ç”¨å†…å­˜: ~2.5GB Swap: 512MB ç½‘ç»œ: wlan0 (IP: 10.40.110.47) 2. æœåŠ¡æ¦‚è§ˆ AI æ™ºèƒ½åŠ©æ‰‹ ç«¯å£: 8080 åŸºäº: llama.cpp æ¨¡å‹: Phi-3-mini-4k-instruct-q4.gguf èµ„æºå ç”¨: CPU: ~300% (å¤šæ ¸) å†…å­˜: ~3GB Swap: 511Mi ä¸ªäººåšå®¢ ç«¯å£: 80 æ¡†æ¶: Hugo v0.139.3-extended ä¸»é¢˜: Ananke WebæœåŠ¡å™¨: Nginx èµ„æºå ç”¨: è½»é‡çº§ 3. æœåŠ¡è®¿é—® AI åŠ©æ‰‹: http://10.40.110.47:8080 åšå®¢å¼€å‘: http://10.40.110.47:1313 åšå®¢æ­£å¼: http://10.40.110.47 äºŒã€AI æ™ºèƒ½åŠ©æ‰‹éƒ¨ç½² 1. ç¯å¢ƒå‡†å¤‡ # æ›´æ–°ç³»ç»Ÿ sudo apt update sudo apt upgrade -y # å®‰è£…ä¾èµ– sudo apt install build-essential git cmake 2. ç¼–è¯‘å®‰è£… # å…‹éš†ä»“åº“ git clone https://github.com/ggerganov/llama.cpp.git cd llama.cpp # ç¼–è¯‘ make clean LLAMA_METAL=1 make -j4 3. æ¨¡å‹é…ç½® # åˆ›å»ºæ¨¡å‹ç›®å½• mkdir models cd models # ä¸‹è½½æ¨¡å‹æ–‡ä»¶ wget [æ¨¡å‹ä¸‹è½½åœ°å€]/Phi-3-mini-4k-instruct-q4.gguf # éªŒè¯æ¨¡å‹æ–‡ä»¶ sha256sum Phi-3-mini-4k-instruct-q4.gguf 4. æœåŠ¡é…ç½® # åˆ›å»ºå¯åŠ¨è„šæœ¬ nano ~/projects/llama.cpp/start-llama.sh #!/bin/bash cd ~/projects/llama.cpp nohup ./llama-server \ -m models/Phi-3-mini-4k-instruct-q4.gguf \ --host 0.0.0.0 \ --port 8080 \ --ctx-size 2048 \ --threads 2 \ --batch-size 256 \ > llama.log 2>&amp;1 & # è®¾ç½®æ‰§è¡Œæƒé™ chmod +x start-llama.sh # å¯åŠ¨æœåŠ¡ ./start-llama.sh # éªŒè¯æœåŠ¡çŠ¶æ€ ps aux | grep llama-server netstat -tuln | grep 8080 ä¸‰ã€ä¸ªäººåšå®¢éƒ¨ç½² 1. Hugo å®‰è£… # ä¸‹è½½ Hugo Extended ç‰ˆæœ¬ wget https://github.com/gohugoio/hugo/releases/download/v0.139.3/hugo_extended_0.139.3_linux-arm64.deb # å®‰è£… sudo dpkg -i hugo_extended_0.139.3_linux-arm64.deb # éªŒè¯å®‰è£… hugo version 2. åšå®¢åˆå§‹åŒ– # åˆ›å»ºç«™ç‚¹ cd ~ hugo new site myblog cd myblog # åˆå§‹åŒ– Git git init # æ·»åŠ ä¸»é¢˜ git submodule add https://github.com/theNewDynamic/gohugo-theme-ananke.git themes/ananke 3. åšå®¢é…ç½® # ç¼–è¾‘é…ç½®æ–‡ä»¶ nano config.toml baseURL = "http://10.40.110.47/" languageCode = "zh-cn" title = "My Blog" theme = "ananke" [params] author = "Your Name" description = "Welcome to my blog" dateFormat = "2006-01-02" background_color_class = "bg-black" recent_posts_number = 3 mainSections = ["posts"] featured_image = false [menu] [[menu.main]] identifier = "posts" name = "æ–‡ç« " url = "/posts/" weight = 1 [[menu.main]] identifier = "about" name = "å…³äº" url = "/about/" weight = 2 4. Nginx é…ç½® # å®‰è£… Nginx sudo apt install nginx # åˆ›å»ºé…ç½®æ–‡ä»¶ sudo nano /etc/nginx/sites-available/myblog server { listen 80; server_name 10.40.110.47; root /home/zhaoxiongzhou/myblog/public; index index.html; location / { try_files $uri $uri/ =404; } access_log /var/log/nginx/myblog_access.log; error_log /var/log/nginx/myblog_error.log; } # å¯ç”¨é…ç½® sudo ln -s /etc/nginx/sites-available/myblog /etc/nginx/sites-enabled/ sudo rm /etc/nginx/sites-enabled/default # æµ‹è¯•é…ç½® sudo nginx -t # é‡å¯ Nginx sudo systemctl restart nginx å››ã€æƒé™ä¸è‡ªåŠ¨åŒ–é…ç½® 1. æƒé™è®¾ç½® # è®¾ç½®ç›®å½•æƒé™ sudo chmod 755 /home/zhaoxiongzhou sudo chmod -R 755 /home/zhaoxiongzhou/myblog # è®¾ç½®æ–‡ä»¶æ‰€æœ‰æƒ sudo chown -R www-data:www-data /home/zhaoxiongzhou/myblog/public # éªŒè¯æƒé™ ls -la ~/myblog/public ls -la /home/zhaoxiongzhou 2. è‡ªåŠ¨éƒ¨ç½²è„šæœ¬ # åˆ›å»ºåšå®¢éƒ¨ç½²è„šæœ¬ nano ~/deploy-blog.sh #!/bin/bash cd ~/myblog hugo sudo chown -R www-data:www-data public/ sudo systemctl restart nginx # è®¾ç½®æ‰§è¡Œæƒé™ chmod +x ~/deploy-blog.sh 3. å¤‡ä»½è„šæœ¬ # åˆ›å»ºå¤‡ä»½è„šæœ¬ nano ~/backup-blog.sh #!/bin/bash BACKUP_DIR="/home/zhaoxiongzhou/backups" DATE=$(date +%Y%m%d) # åˆ›å»ºå¤‡ä»½ç›®å½• mkdir -p $BACKUP_DIR # å¤‡ä»½åšå®¢å†…å®¹ tar -czf $BACKUP_DIR/blog_$DATE.tar.gz ~/myblog/content # å¤‡ä»½é…ç½®æ–‡ä»¶ cp ~/myblog/config.toml $BACKUP_DIR/config_$DATE.toml # åˆ é™¤30å¤©å‰çš„å¤‡ä»½ find $BACKUP_DIR -name "*.tar.gz" -mtime +30 -delete # è®¾ç½®æ‰§è¡Œæƒé™ chmod +x ~/backup-blog.sh # é…ç½®å®šæ—¶ä»»åŠ¡ crontab -e # æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼ˆæ¯å‘¨æ—¥å‡Œæ™¨2ç‚¹æ‰§è¡Œå¤‡ä»½ï¼‰ 0 2 * * 0 /home/zhaoxiongzhou/backup-blog.sh äº”ã€ç³»ç»Ÿç»´æŠ¤ä¸ç›‘æ§ 1. èµ„æºç›‘æ§å‘½ä»¤ # ç³»ç»Ÿèµ„æºç›‘æ§ htop top free -h vmstat 1 # ç£ç›˜ä½¿ç”¨ç›‘æ§ df -h du -sh /* du -sh ~/myblog du -sh ~/projects/llama.cpp # æ¸©åº¦ç›‘æ§ vcgencmd measure_temp 2. æ€§èƒ½ä¼˜åŒ– # æ¸…ç†ç³»ç»Ÿç¼“å­˜ sudo sync; echo 3 | sudo tee /proc/sys/vm/drop_caches # è°ƒæ•´ Swap è®¾ç½® cat /proc/sys/vm/swappiness sudo sysctl vm.swappiness=60 # CPU é¢‘ç‡è°ƒæ•´ sudo nano /boot/config.txt # CPU é…ç½®å‚æ•° arm_freq=1800 over_voltage=6 temp_limit=75 3. ç³»ç»Ÿç»´æŠ¤ # ç³»ç»Ÿæ›´æ–° sudo apt update sudo apt upgrade -y sudo apt autoremove sudo apt clean # æ—¥å¿—æ¸…ç† sudo find /var/log -type f -name "*.log" -mtime +30 -delete sudo find /var/log -type f -name "*.gz" -delete # æœåŠ¡çŠ¶æ€æ£€æŸ¥ systemctl status nginx ps aux | grep llama-server å…­ã€å®‰å…¨é…ç½® 1. é˜²ç«å¢™è®¾ç½® # å®‰è£… UFW sudo apt install ufw # é…ç½®åŸºæœ¬è§„åˆ™ sudo ufw default deny incoming sudo ufw default allow outgoing sudo ufw allow 22 sudo ufw allow 80 sudo ufw allow 8080 # å¯ç”¨é˜²ç«å¢™ sudo ufw enable # æ£€æŸ¥çŠ¶æ€ sudo ufw status 2. Nginx è®¿é—®æ§åˆ¶ # å®‰è£…è®¤è¯å·¥å…· sudo apt install apache2-utils # åˆ›å»ºç”¨æˆ·å¯†ç  sudo htpasswd -c /etc/nginx/.htpasswd username # ä¿®æ”¹ Nginx é…ç½® sudo nano /etc/nginx/sites-available/myblog server { listen 80; server_name 10.40.110.47; root /home/zhaoxiongzhou/myblog/public; index index.html; # æ·»åŠ åŸºæœ¬è®¤è¯ location / { auth_basic "Restricted Access"; auth_basic_user_file /etc/nginx/.htpasswd; try_files $uri $uri/ =404; } # æ—¥å¿—é…ç½® access_log /var/log/nginx/myblog_access.log; error_log /var/log/nginx/myblog_error.log; } 3. æ—¥å¿—ç›‘æ§ # å®‰è£…æ—¥å¿—ç›‘æ§å·¥å…· sudo apt install logwatch # é…ç½®æ—¥å¿—ç›‘æ§ sudo nano /etc/logwatch/conf/logwatch.conf # é…ç½®æ¯æ—¥æ—¥å¿—æ£€æŸ¥ Output = mail Format = html MailTo = your-email@domain.com Detail = High ä¸ƒã€æ•…éšœæ’é™¤æŒ‡å— å†…å­˜ç›¸å…³é—®é¢˜ # æ£€æŸ¥å†…å­˜çŠ¶æ€ free -h ps aux --sort=-%mem | head # å¦‚æœå†…å­˜ä¸è¶³ï¼Œè°ƒæ•´æœåŠ¡å‚æ•° nano ~/projects/llama.cpp/start-llama.sh # é™ä½èµ„æºä½¿ç”¨çš„å‚æ•°ç¤ºä¾‹ --ctx-size 1024 \ --batch-size 128 \ --threads 1 æœåŠ¡æ— å“åº” # æ£€æŸ¥è¿›ç¨‹ ps aux | grep llama-server # æ£€æŸ¥ç«¯å£ netstat -tuln | grep 8080 # é‡å¯æœåŠ¡ pkill llama-server ./start-llama.sh # æ£€æŸ¥æ—¥å¿— tail -f ~/projects/llama.cpp/llama.log 2. åšå®¢æœåŠ¡æ•…éšœæ’é™¤ Nginx é—®é¢˜ # æ£€æŸ¥é…ç½®è¯­æ³• sudo nginx -t # æ£€æŸ¥æ—¥å¿— sudo tail -f /var/log/nginx/error.log sudo tail -f /var/log/nginx/myblog_error.log # æ£€æŸ¥æœåŠ¡çŠ¶æ€ sudo systemctl status nginx # é‡å¯æœåŠ¡ sudo systemctl restart nginx Hugo ç”Ÿæˆé—®é¢˜ # æ¸…ç†ç¼“å­˜ rm -rf ~/myblog/public rm -rf ~/myblog/resources # æ›´æ–°ä¸»é¢˜ git submodule update --init --recursive # é‡æ–°ç”Ÿæˆï¼ˆè¯¦ç»†æ¨¡å¼ï¼‰ hugo --verbose å…«ã€ç³»ç»Ÿçº§æ•…éšœæ’é™¤ 1. ç£ç›˜é—®é¢˜ # æ£€æŸ¥ç£ç›˜ä½¿ç”¨æƒ…å†µ df -h du -sh /* # æŸ¥æ‰¾å¤§æ–‡ä»¶ sudo find / -type f -size +100M # æ¸…ç†ç©ºé—´ sudo apt clean sudo apt autoremove sudo journalctl --vacuum-time=7d 2. ç½‘ç»œé—®é¢˜ # ç½‘ç»œçŠ¶æ€æ£€æŸ¥ ip addr show ping -c 4 8.8.8.8 netstat -tuln # DNS æ£€æŸ¥ cat /etc/resolv.conf nslookup google.com # é‡å¯ç½‘ç»œæœåŠ¡ sudo systemctl restart networking sudo systemctl restart wpa_supplicant 3. æ€§èƒ½é—®é¢˜ # CPU æ¸©åº¦ç›‘æ§ vcgencmd measure_temp watch -n 1 vcgencmd measure_temp # CPU é¢‘ç‡æ£€æŸ¥ vcgencmd measure_clock arm cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_cur_freq # ç³»ç»Ÿè´Ÿè½½æ£€æŸ¥ uptime cat /proc/loadavg ä¹ã€ç»´æŠ¤æœ€ä½³å®è·µ 1. æ—¥å¸¸ç»´æŠ¤æ¸…å• æ£€æŸ¥ç³»ç»Ÿæ—¥å¿— ç›‘æ§èµ„æºä½¿ç”¨ éªŒè¯æœåŠ¡çŠ¶æ€ æ£€æŸ¥å¤‡ä»½çŠ¶æ€ æ›´æ–°ç³»ç»Ÿå®‰å…¨è¡¥ä¸ 2. å‘¨æœŸæ€§ç»´æŠ¤ä»»åŠ¡ æ¸…ç†æ—§æ—¥å¿—å’Œä¸´æ—¶æ–‡ä»¶ éªŒè¯å¤‡ä»½å®Œæ•´æ€§ æ£€æŸ¥ç³»ç»Ÿæ›´æ–° æ£€æŸ¥æœåŠ¡æ€§èƒ½ æ›´æ–°æ–‡æ¡£å’Œé…ç½®è¯´æ˜ 3. åº”æ€¥é¢„æ¡ˆ ä¿å­˜æ‰€æœ‰é…ç½®æ–‡ä»¶çš„å¤‡ä»½ è®°å½•æ‰€æœ‰æœåŠ¡çš„é…ç½®æ­¥éª¤ ç»´æŠ¤é—®é¢˜è§£å†³æ–¹æ¡ˆæ–‡æ¡£ å»ºç«‹æœåŠ¡æ¢å¤æµç¨‹ ä¿æŒé‡è¦æ•°æ®çš„å¤šä»½å¤‡ä»½ åã€æ€§èƒ½ä¼˜åŒ–å»ºè®® 1. ç³»ç»Ÿçº§ä¼˜åŒ– # 1. è°ƒæ•´ SWAP è®¾ç½® sudo nano /etc/sysctl.conf # æ·»åŠ æˆ–ä¿®æ”¹ä»¥ä¸‹å‚æ•° vm.swappiness=60 vm.vfs_cache_pressure=50 vm.dirty_background_ratio=5 vm.dirty_ratio=10 # 2. ä¼˜åŒ–æ–‡ä»¶ç³»ç»Ÿ # æ£€æŸ¥å¹¶ä¼˜åŒ–æ–‡ä»¶ç³»ç»Ÿ sudo tune2fs -o journal_data_writeback /dev/mmcblk0p2 # 3. è°ƒæ•´ CPU æ€§èƒ½ sudo nano /boot/config.txt # æ·»åŠ ä»¥ä¸‹é…ç½® arm_freq=1800 over_voltage=6 gpu_freq=500 dtparam=audio=on 2. æœåŠ¡ä¼˜åŒ– AI æœåŠ¡ä¼˜åŒ– # è°ƒæ•´æœåŠ¡å‚æ•° nano ~/projects/llama.cpp/start-llama.sh # ä¼˜åŒ–å‚æ•°ç¤ºä¾‹ --ctx-size 2048 \ --threads 2 \ --batch-size 256 \ --keep-context \ --mlock \ --numa Nginx ä¼˜åŒ– sudo nano /etc/nginx/nginx.conf worker_processes auto; worker_rlimit_nofile 65535; events { worker_connections 1024; multi_accept on; use epoll; } http { sendfile on; tcp_nopush on; tcp_nodelay on; keepalive_timeout 65; types_hash_max_size 2048; server_tokens off; # ç¼“å­˜è®¾ç½® open_file_cache max=1000 inactive=20s; open_file_cache_valid 30s; open_file_cache_min_uses 2; open_file_cache_errors on; } åä¸€ã€ç›‘æ§ä¸æŠ¥è­¦ç³»ç»Ÿ 1. ç³»ç»Ÿç›‘æ§é…ç½® # å®‰è£…ç›‘æ§å·¥å…· sudo apt install prometheus node-exporter grafana # é…ç½® Prometheus sudo nano /etc/prometheus/prometheus.yml global: scrape_interval: 15s scrape_configs: - job_name: &#39;node&#39; static_configs: - targets: [&#39;localhost:9100&#39;] - job_name: &#39;nginx&#39; static_configs: - targets: [&#39;localhost:9113&#39;] 2. è‡ªåŠ¨æŠ¥è­¦è„šæœ¬ # åˆ›å»ºç›‘æ§è„šæœ¬ nano ~/monitor.sh #!/bin/bash # å®šä¹‰é˜ˆå€¼ MAX_CPU_USAGE=90 MAX_MEM_USAGE=90 MAX_DISK_USAGE=90 MAX_TEMP=75 # è·å–ç³»ç»Ÿæ•°æ® CPU_USAGE=$(top -bn1 | grep "Cpu(s)" | awk &#39;{print $2}&#39; | cut -d. -f1) MEM_USAGE=$(free | grep Mem | awk &#39;{print $3/$2 * 100.0}&#39;) DISK_USAGE=$(df -h / | awk &#39;NR==2 {print $5}&#39; | cut -d% -f1) TEMP=$(vcgencmd measure_temp | cut -d= -f2 | cut -d. -f1) # æ£€æŸ¥æœåŠ¡çŠ¶æ€ check_services() { services=("nginx" "llama-server") for service in "${services[@]}"; do if ! pgrep -x "$service" > /dev/null; then echo "è­¦å‘Š: $service æœåŠ¡æœªè¿è¡Œ!" # å¯ä»¥æ·»åŠ é‡å¯æœåŠ¡çš„å‘½ä»¤ fi done } # å‘é€è­¦å‘Š send_alert() { message="$1" # è¿™é‡Œå¯ä»¥æ·»åŠ å‘é€é‚®ä»¶æˆ–å…¶ä»–é€šçŸ¥çš„å‘½ä»¤ echo "$message" >> /var/log/system_alerts.log } # æ£€æŸ¥å„é¡¹æŒ‡æ ‡ if [ "$CPU_USAGE" -gt "$MAX_CPU_USAGE" ]; then send_alert "CPU ä½¿ç”¨ç‡è¿‡é«˜: $CPU_USAGE%" fi if [ "${MEM_USAGE%.*}" -gt "$MAX_MEM_USAGE" ]; then send_alert "å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜: $MEM_USAGE%" fi if [ "$DISK_USAGE" -gt "$MAX_DISK_USAGE" ]; then send_alert "ç£ç›˜ä½¿ç”¨ç‡è¿‡é«˜: $DISK_USAGE%" fi if [ "$TEMP" -gt "$MAX_TEMP" ]; then send_alert "ç³»ç»Ÿæ¸©åº¦è¿‡é«˜: $TEMPÂ°C" fi # æ£€æŸ¥æœåŠ¡çŠ¶æ€ check_services # è®¾ç½®æ‰§è¡Œæƒé™ chmod +x ~/monitor.sh # æ·»åŠ åˆ° crontab crontab -e # æ¯5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ç›‘æ§ */5 * * * * /home/zhaoxiongzhou/monitor.sh åäºŒã€æ•°æ®å¤‡ä»½ä¸æ¢å¤ 1. å®Œæ•´å¤‡ä»½æ–¹æ¡ˆ # åˆ›å»ºå®Œæ•´å¤‡ä»½è„šæœ¬ nano ~/full-backup.sh #!/bin/bash BACKUP_ROOT="/home/zhaoxiongzhou/backups" DATE=$(date +%Y%m%d_%H%M%S) BACKUP_DIR="$BACKUP_ROOT/$DATE" # åˆ›å»ºå¤‡ä»½ç›®å½• mkdir -p "$BACKUP_DIR" # å¤‡ä»½åšå®¢å†…å®¹ echo "å¤‡ä»½åšå®¢å†…å®¹..." tar -czf "$BACKUP_DIR/blog_content.tar.gz" ~/myblog/content tar -czf "$BACKUP_DIR/blog_config.tar.gz" ~/myblog/config.toml # å¤‡ä»½ AI æ¨¡å‹å’Œé…ç½® echo "å¤‡ä»½ AI æœåŠ¡..." tar -czf "$BACKUP_DIR/llama_models.tar.gz" ~/projects/llama.cpp/models tar -czf "$BACKUP_DIR/llama_config.tar.gz" ~/projects/llama.cpp/start-llama.sh # å¤‡ä»½ Nginx é…ç½® echo "å¤‡ä»½ Nginx é…ç½®..." sudo tar -czf "$BACKUP_DIR/nginx_config.tar.gz" /etc/nginx/sites-available/myblog # å¤‡ä»½ç³»ç»Ÿé…ç½® echo "å¤‡ä»½ç³»ç»Ÿé…ç½®..." sudo tar -czf "$BACKUP_DIR/system_config.tar.gz" /boot/config.txt /etc/fstab # åˆ›å»ºå¤‡ä»½æ¸…å• echo "åˆ›å»ºå¤‡ä»½æ¸…å•..." find "$BACKUP_DIR" -type f -exec sha256sum {} \; > "$BACKUP_DIR/checksum.txt" # æ¸…ç†æ—§å¤‡ä»½ï¼ˆä¿ç•™æœ€è¿‘7ä»½ï¼‰ cd "$BACKUP_ROOT" ls -t | tail -n +8 | xargs -r rm -r echo "å¤‡ä»½å®Œæˆ: $BACKUP_DIR" 2. æ•°æ®æ¢å¤æµç¨‹ # åˆ›å»ºæ¢å¤è„šæœ¬ nano ~/restore.sh #!/bin/bash if [ -z "$1" ]; then echo "ä½¿ç”¨æ–¹æ³•: $0 <å¤‡ä»½ç›®å½•>" exit 1 fi BACKUP_DIR="$1" # éªŒè¯å¤‡ä»½å®Œæ•´æ€§ echo "éªŒè¯å¤‡ä»½å®Œæ•´æ€§..." cd "$BACKUP_DIR" sha256sum -c checksum.txt || { echo "å¤‡ä»½éªŒè¯å¤±è´¥ï¼" exit 1 } # æ¢å¤åšå®¢å†…å®¹ echo "æ¢å¤åšå®¢å†…å®¹..." tar -xzf "$BACKUP_DIR/blog_content.tar.gz" -C ~/myblog/ tar -xzf "$BACKUP_DIR/blog_config.tar.gz" -C ~/myblog/ # æ¢å¤ AI æœåŠ¡ echo "æ¢å¤ AI æœåŠ¡..." tar -xzf "$BACKUP_DIR/llama_models.tar.gz" -C ~/projects/llama.cpp/ tar -xzf "$BACKUP_DIR/llama_config.tar.gz" -C ~/projects/llama.cpp/ # æ¢å¤ Nginx é…ç½® echo "æ¢å¤ Nginx é…ç½®..." sudo tar -xzf "$BACKUP_DIR/nginx_config.tar.gz" -C /etc/nginx/sites-available/ # æ¢å¤ç³»ç»Ÿé…ç½® echo "æ¢å¤ç³»ç»Ÿé…ç½®..." sudo tar -xzf "$BACKUP_DIR/system_config.tar.gz" -C / # é‡å¯æœåŠ¡ echo "é‡å¯æœåŠ¡..." sudo systemctl restart nginx pkill llama-server ~/projects/llama.cpp/start-llama.sh echo "æ¢å¤å®Œæˆ" åä¸‰ã€æœåŠ¡å‡çº§æŒ‡å— 1. Hugo åšå®¢å‡çº§ # 1. å¤‡ä»½å½“å‰ç‰ˆæœ¬ cd ~ tar -czf hugo_backup_$(date +%Y%m%d).tar.gz myblog/ # 2. æ£€æŸ¥å½“å‰ç‰ˆæœ¬ hugo version # 3. ä¸‹è½½æ–°ç‰ˆæœ¬ wget https://github.com/gohugoio/hugo/releases/download/v[æ–°ç‰ˆæœ¬]/hugo_extended_[æ–°ç‰ˆæœ¬]_linux-arm64.deb # 4. å®‰è£…æ–°ç‰ˆæœ¬ sudo dpkg -i hugo_extended_[æ–°ç‰ˆæœ¬]_linux-arm64.deb # 5. æ›´æ–°ä¸»é¢˜ cd ~/myblog git submodule update --remote themes/ananke # 6. æµ‹è¯•ç”Ÿæˆ hugo --verbose # 7. éƒ¨ç½²æ›´æ–° ./deploy-blog.sh 2. AI æœåŠ¡å‡çº§ # 1. å¤‡ä»½å½“å‰ç‰ˆæœ¬ cd ~/projects tar -czf llama_backup_$(date +%Y%m%d).tar.gz llama.cpp/ # 2. æ›´æ–°æºç  cd llama.cpp git pull origin master # 3. é‡æ–°ç¼–è¯‘ make clean LLAMA_METAL=1 make -j4 # 4. æµ‹è¯•æ–°ç‰ˆæœ¬ ./llama-server -h # 5. æ›´æ–°å¯åŠ¨è„šæœ¬ nano start-llama.sh 3. ç³»ç»Ÿå‡çº§ # 1. æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ sudo apt update # 2. å‡çº§æ‰€æœ‰åŒ… sudo apt upgrade -y # 3. å‡çº§ç³»ç»Ÿ sudo apt dist-upgrade -y # 4. æ¸…ç†æ—§åŒ… sudo apt autoremove -y sudo apt clean # 5. æ£€æŸ¥å¯åŠ¨é¡¹ sudo systemctl list-unit-files --state=enabled # 6. æ›´æ–°æ ‘è“æ´¾å›ºä»¶ sudo rpi-update # 7. æ£€æŸ¥ç³»ç»ŸçŠ¶æ€ sudo systemctl --failed sudo journalctl -p 3 -xb åå››ã€å®‰å…¨åŠ å›ºæŒ‡å— 1. ç³»ç»Ÿå®‰å…¨é…ç½® # 1. SSH å®‰å…¨é…ç½® sudo nano /etc/ssh/sshd_config # SSH é…ç½®å»ºè®® Port 22222 # ä¿®æ”¹é»˜è®¤ç«¯å£ PermitRootLogin no # ç¦æ­¢ root ç™»å½• PasswordAuthentication no # ç¦ç”¨å¯†ç è®¤è¯ PubkeyAuthentication yes # å¯ç”¨å¯†é’¥è®¤è¯ AllowUsers zhaoxiongzhou # é™åˆ¶å…è®¸çš„ç”¨æˆ· # 2. è®¾ç½®é˜²ç«å¢™è§„åˆ™ sudo apt install ufw fail2ban # é…ç½® UFW sudo ufw default deny incoming sudo ufw default allow outgoing sudo ufw allow 22222/tcp # SSH sudo ufw allow 80/tcp # HTTP sudo ufw allow 8080/tcp # AI æœåŠ¡ sudo ufw enable # é…ç½® fail2ban sudo nano /etc/fail2ban/jail.local [sshd] enabled = true port = 22222 filter = sshd logpath = /var/log/auth.log maxretry = 3 bantime = 3600 2. æœåŠ¡å®‰å…¨é…ç½® Nginx å®‰å…¨è®¾ç½® # 1. åˆ›å»º SSL è¯ä¹¦ sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 \ -keyout /etc/nginx/ssl/nginx.key \ -out /etc/nginx/ssl/nginx.crt # 2. é…ç½® HTTPS sudo nano /etc/nginx/sites-available/myblog server { listen 443 ssl; server_name 10.40.110.47; ssl_certificate /etc/nginx/ssl/nginx.crt; ssl_certificate_key /etc/nginx/ssl/nginx.key; # SSL é…ç½® ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers on; ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options "SAMEORIGIN"; add_header X-XSS-Protection "1; mode=block"; add_header X-Content-Type-Options "nosniff"; add_header Strict-Transport-Security "max-age=31536000"; # å…¶ä»–é…ç½®... } åäº”ã€æ€§èƒ½ç›‘æ§ä¸åˆ†æ 1. ç›‘æ§è„šæœ¬é…ç½® # åˆ›å»ºç»¼åˆç›‘æ§è„šæœ¬ nano ~/system_monitor.sh #!/bin/bash LOG_FILE="/var/log/system_monitor.log" ALERT_FILE="/var/log/system_alerts.log" # è®°å½•æ—¶é—´æˆ³ timestamp() { date "+%Y-%m-%d %H:%M:%S" } # ç³»ç»Ÿèµ„æºç›‘æ§ monitor_resources() { echo "=== ç³»ç»Ÿèµ„æºç›‘æ§ $(timestamp) ===" >> "$LOG_FILE" # CPU ä½¿ç”¨ç‡ CPU_USAGE=$(top -bn1 | grep "Cpu(s)" | awk &#39;{print $2}&#39;) echo "CPU ä½¿ç”¨ç‡: $CPU_USAGE%" >> "$LOG_FILE" # å†…å­˜ä½¿ç”¨ free -h | grep "Mem:" >> "$LOG_FILE" # ç£ç›˜ä½¿ç”¨ df -h / >> "$LOG_FILE" # ç³»ç»Ÿè´Ÿè½½ uptime >> "$LOG_FILE" # CPU æ¸©åº¦ vcgencmd measure_temp >> "$LOG_FILE" } # æœåŠ¡çŠ¶æ€ç›‘æ§ monitor_services() { echo "=== æœåŠ¡çŠ¶æ€ç›‘æ§ $(timestamp) ===" >> "$LOG_FILE" # Nginx çŠ¶æ€ if systemctl is-active nginx >/dev/null 2>&amp;1; then echo "Nginx: è¿è¡Œä¸­" >> "$LOG_FILE" else echo "è­¦å‘Š: Nginx æœªè¿è¡Œ!" >> "$ALERT_FILE" fi # AI æœåŠ¡çŠ¶æ€ if pgrep -f llama-server >/dev/null; then echo "AI æœåŠ¡: è¿è¡Œä¸­" >> "$LOG_FILE" else echo "è­¦å‘Š: AI æœåŠ¡æœªè¿è¡Œ!" >> "$ALERT_FILE" fi } # ç½‘ç»œç›‘æ§ monitor_network() { echo "=== ç½‘ç»œç›‘æ§ $(timestamp) ===" >> "$LOG_FILE" # ç½‘ç»œè¿æ¥æ•° netstat -an | grep ESTABLISHED | wc -l >> "$LOG_FILE" # ç½‘ç»œæµé‡ ifconfig wlan0 | grep bytes >> "$LOG_FILE" } # ä¸»å‡½æ•° main() { monitor_resources monitor_services monitor_network # æ£€æŸ¥æ˜¯å¦éœ€è¦å‘é€è­¦å‘Š if [ -s "$ALERT_FILE" ]; then # å¯ä»¥æ·»åŠ å‘é€è­¦å‘Šçš„å‘½ä»¤ï¼ˆå¦‚é‚®ä»¶é€šçŸ¥ï¼‰ cat "$ALERT_FILE" fi } # æ‰§è¡Œç›‘æ§ main 2. æ€§èƒ½åˆ†æå·¥å…· # å®‰è£…æ€§èƒ½åˆ†æå·¥å…· sudo apt install sysstat iotop htop # åˆ›å»ºæ€§èƒ½æ•°æ®æ”¶é›†è„šæœ¬ nano ~/collect_performance.sh åå…­ã€æ€§èƒ½æ•°æ®æ”¶é›†ä¸åˆ†æ 1. æ€§èƒ½æ•°æ®æ”¶é›†è„šæœ¬ #!/bin/bash # ~/collect_performance.sh PERF_DIR="/home/zhaoxiongzhou/performance_data" DATE=$(date +%Y%m%d_%H%M%S) # åˆ›å»ºæ•°æ®ç›®å½• mkdir -p "$PERF_DIR/$DATE" # CPU æ€§èƒ½æ•°æ® mpstat 1 60 > "$PERF_DIR/$DATE/cpu_stats.log" & # å†…å­˜ä½¿ç”¨æ•°æ® vmstat 1 60 > "$PERF_DIR/$DATE/memory_stats.log" & # IO æ€§èƒ½æ•°æ® iostat -x 1 60 > "$PERF_DIR/$DATE/io_stats.log" & # ç½‘ç»œæ€§èƒ½æ•°æ® sar -n DEV 1 60 > "$PERF_DIR/$DATE/network_stats.log" & # è¿›ç¨‹æ€§èƒ½æ•°æ® ps aux --sort=-%cpu | head -n 20 > "$PERF_DIR/$DATE/top_processes.log" # ç³»ç»Ÿè´Ÿè½½æ•°æ® uptime > "$PERF_DIR/$DATE/load_average.log" # ç­‰å¾…æ‰€æœ‰åå°è¿›ç¨‹å®Œæˆ wait # å‹ç¼©æ•°æ® tar -czf "$PERF_DIR/performance_${DATE}.tar.gz" "$PERF_DIR/$DATE" rm -rf "$PERF_DIR/$DATE" 2. æ€§èƒ½æ•°æ®åˆ†æè„šæœ¬ # åˆ›å»ºåˆ†æè„šæœ¬ nano ~/analyze_performance.sh #!/bin/bash # ~/analyze_performance.sh PERF_DIR="/home/zhaoxiongzhou/performance_data" REPORT_DIR="/home/zhaoxiongzhou/performance_reports" DATE=$(date +%Y%m%d) mkdir -p "$REPORT_DIR" generate_report() { local REPORT_FILE="$REPORT_DIR/report_${DATE}.txt" echo "æ€§èƒ½åˆ†ææŠ¥å‘Š - $(date)" > "$REPORT_FILE" echo "===================" >> "$REPORT_FILE" # CPU ä½¿ç”¨åˆ†æ echo -e "\nCPU ä½¿ç”¨æƒ…å†µ:" >> "$REPORT_FILE" awk &#39;/all/ {total += $3; count++} END {print "å¹³å‡CPUä½¿ç”¨ç‡: " total/count "%"}&#39; \ "$PERF_DIR/latest/cpu_stats.log" >> "$REPORT_FILE" # å†…å­˜ä½¿ç”¨åˆ†æ echo -e "\nå†…å­˜ä½¿ç”¨æƒ…å†µ:" >> "$REPORT_FILE" free -h | grep "Mem:" >> "$REPORT_FILE" # IO æ€§èƒ½åˆ†æ echo -e "\nIO æ€§èƒ½:" >> "$REPORT_FILE" tail -n 10 "$PERF_DIR/latest/io_stats.log" >> "$REPORT_FILE" # ç½‘ç»œæ€§èƒ½åˆ†æ echo -e "\nç½‘ç»œæ€§èƒ½:" >> "$REPORT_FILE" tail -n 10 "$PERF_DIR/latest/network_stats.log" >> "$REPORT_FILE" # è¿›ç¨‹åˆ†æ echo -e "\nèµ„æºå ç”¨æœ€é«˜çš„è¿›ç¨‹:" >> "$REPORT_FILE" head -n 5 "$PERF_DIR/latest/top_processes.log" >> "$REPORT_FILE" echo -e "\nåˆ†æå®Œæˆã€‚æŠ¥å‘Šä¿å­˜åœ¨: $REPORT_FILE" } # ç”ŸæˆæŠ¥å‘Š generate_report åä¸ƒã€è‡ªåŠ¨åŒ–è¿ç»´è„šæœ¬ 1. æœåŠ¡å¥åº·æ£€æŸ¥ä¸è‡ªåŠ¨æ¢å¤ # åˆ›å»ºæœåŠ¡ç›‘æ§è„šæœ¬ nano ~/service_health_check.sh #!/bin/bash # ~/service_health_check.sh LOG_FILE="/var/log/service_health.log" ALERT_SCRIPT="/home/zhaoxiongzhou/send_alert.sh" log_message() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" >> "$LOG_FILE" } check_and_restart_service() { local service_name="$1" local process_pattern="$2" if ! pgrep -f "$process_pattern" > /dev/null; then log_message "è­¦å‘Š: $service_name æœåŠ¡æœªè¿è¡Œï¼Œå°è¯•é‡å¯" case "$service_name" in "nginx") sudo systemctl restart nginx ;; "llama-server") cd ~/projects/llama.cpp ./start-llama.sh ;; esac # ç­‰å¾…æœåŠ¡å¯åŠ¨ sleep 10 # éªŒè¯æœåŠ¡æ˜¯å¦æˆåŠŸé‡å¯ if pgrep -f "$process_pattern" > /dev/null; then log_message "$service_name æœåŠ¡å·²æˆåŠŸé‡å¯" "$ALERT_SCRIPT" "$service_name æœåŠ¡å·²è‡ªåŠ¨é‡å¯" else log_message "é”™è¯¯: $service_name æœåŠ¡é‡å¯å¤±è´¥" "$ALERT_SCRIPT" "è­¦å‘Š: $service_name æœåŠ¡é‡å¯å¤±è´¥ï¼Œéœ€è¦æ‰‹åŠ¨å¹²é¢„" fi else log_message "$service_name æœåŠ¡è¿è¡Œæ­£å¸¸" fi } # æ£€æŸ¥å„ä¸ªæœåŠ¡ check_and_restart_service "nginx" "nginx" check_and_restart_service "llama-server" "llama-server" # æ¸…ç†æ—§æ—¥å¿— find "$LOG_FILE" -mtime +30 -delete 2. è‡ªåŠ¨å¤‡ä»½ä¸æ¸…ç† # åˆ›å»ºè‡ªåŠ¨ç»´æŠ¤è„šæœ¬ nano ~/auto_maintenance.sh #!/bin/bash # ~/auto_maintenance.sh BACKUP_DIR="/home/zhaoxiongzhou/backups" LOG_DIR="/var/log" DATE=$(date +%Y%m%d) # åˆ›å»ºå¤‡ä»½ create_backups() { # åšå®¢å¤‡ä»½ tar -czf "$BACKUP_DIR/blog_$DATE.tar.gz" ~/myblog/content # AI æœåŠ¡é…ç½®å¤‡ä»½ tar -czf "$BACKUP_DIR/llama_config_$DATE.tar.gz" ~/projects/llama.cpp/start-llama.sh # Nginx é…ç½®å¤‡ä»½ sudo tar -czf "$BACKUP_DIR/nginx_config_$DATE.tar.gz" /etc/nginx/sites-available/ } # æ¸…ç†æ—§æ–‡ä»¶ cleanup_old_files() { # åˆ é™¤30å¤©å‰çš„å¤‡ä»½ find "$BACKUP_DIR" -name "*.tar.gz" -mtime +30 -delete # æ¸…ç†æ—¥å¿— sudo find "$LOG_DIR" -name "*.log" -mtime +30 -delete sudo find "$LOG_DIR" -name "*.gz" -mtime +30 -delete # æ¸…ç†ç³»ç»Ÿä¸´æ—¶æ–‡ä»¶ sudo rm -rf /tmp/* sudo rm -rf /var/tmp/* } # ä¸»å‡½æ•° main() { create_backups cleanup_old_files # å‹ç¼©æ—¥å¿— sudo logrotate -f /etc/logrotate.conf # æ¸…ç†åŒ…ç¼“å­˜ sudo apt clean sudo apt autoremove -y } # æ‰§è¡Œç»´æŠ¤ä»»åŠ¡ main åå…«ã€æ—¥å¿—ç®¡ç†ç³»ç»Ÿ 1. é›†ä¸­å¼æ—¥å¿—é…ç½® # åˆ›å»ºæ—¥å¿—ç®¡ç†è„šæœ¬ nano ~/log_management.sh #!/bin/bash # ~/log_management.sh LOG_BASE="/var/log/services" ARCHIVE_DIR="/home/zhaoxiongzhou/log_archives" DATE=$(date +%Y%m%d) # åˆ›å»ºæ—¥å¿—ç›®å½• mkdir -p "$LOG_BASE"/{nginx,ai_service,system} mkdir -p "$ARCHIVE_DIR" # é…ç½®æ—¥å¿—è½®è½¬ sudo tee /etc/logrotate.d/custom_services << EOF $LOG_BASE/nginx/*.log { daily missingok rotate 14 compress delaycompress notifempty create 0640 www-data adm sharedscripts postrotate [ -f /var/run/nginx.pid ] && kill -USR1 \$(cat /var/run/nginx.pid) endscript } $LOG_BASE/ai_service/*.log { daily missingok rotate 14 compress delaycompress notifempty create 0640 zhaoxiongzhou adm } $LOG_BASE/system/*.log { daily missingok rotate 30 compress delaycompress notifempty create 0640 root adm } EOF # æ—¥å¿—åˆ†æå‡½æ•° analyze_logs() { local log_file="$1" local output_file="$2" echo "=== æ—¥å¿—åˆ†ææŠ¥å‘Š $(date) ===" > "$output_file" # é”™è¯¯ç»Ÿè®¡ echo -e "\né”™è¯¯ç»Ÿè®¡:" >> "$output_file" grep -i "error" "$log_file" | sort | uniq -c | sort -nr >> "$output_file" # è­¦å‘Šç»Ÿè®¡ echo -e "\nè­¦å‘Šç»Ÿè®¡:" >> "$output_file" grep -i "warning" "$log_file" | sort | uniq -c | sort -nr >> "$output_file" # è®¿é—®ç»Ÿè®¡ï¼ˆé’ˆå¯¹ Nginx è®¿é—®æ—¥å¿—ï¼‰ if [[ "$log_file" == *"nginx/access"* ]]; then echo -e "\nè®¿é—®é‡ç»Ÿè®¡:" >> "$output_file" awk &#39;{print $1}&#39; "$log_file" | sort | uniq -c | sort -nr | head -n 10 >> "$output_file" fi } # æ—¥å¿—å½’æ¡£å‡½æ•° archive_logs() { local source_dir="$1" local archive_name="logs_${DATE}.tar.gz" find "$source_dir" -name "*.log.*" -mtime +14 -exec tar -czf "$ARCHIVE_DIR/$archive_name" {} + find "$source_dir" -name "*.log.*" -mtime +14 -delete } 2. æ—¥å¿—ç›‘æ§å‘Šè­¦ # åˆ›å»ºæ—¥å¿—ç›‘æ§è„šæœ¬ nano ~/log_monitor.sh #!/bin/bash # ~/log_monitor.sh ALERT_THRESHOLD=10 # é”™è¯¯é˜ˆå€¼ ALERT_SCRIPT="/home/zhaoxiongzhou/send_alert.sh" # ç›‘æ§ç‰¹å®šå…³é”®è¯ monitor_keywords() { local log_file="$1" local keywords=("error" "critical" "failed" "timeout" "exception") for keyword in "${keywords[@]}"; do count=$(grep -i "$keyword" "$log_file" | wc -l) if [ "$count" -gt "$ALERT_THRESHOLD" ]; then "$ALERT_SCRIPT" "è­¦å‘Š: $log_file ä¸­å‘ç°å¤§é‡ $keyword ($count æ¬¡)" fi done } # ç›‘æ§æ—¥å¿—å¤§å° check_log_size() { local log_file="$1" local max_size=$((100 * 1024 * 1024)) # 100MB size=$(stat -f%z "$log_file") if [ "$size" -gt "$max_size" ]; then "$ALERT_SCRIPT" "è­¦å‘Š: $log_file å¤§å°è¶…è¿‡ 100MB" fi } # ä¸»ç›‘æ§å¾ªç¯ main() { while true; do for log_file in "$LOG_BASE"/**/*.log; do monitor_keywords "$log_file" check_log_size "$log_file" done sleep 300 # æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ done } main & åä¹ã€ç³»ç»Ÿä¼˜åŒ–ä¸è°ƒä¼˜ 1. ç³»ç»Ÿå‚æ•°ä¼˜åŒ– # åˆ›å»ºç³»ç»Ÿä¼˜åŒ–è„šæœ¬ nano ~/system_optimize.sh #!/bin/bash # ~/system_optimize.sh # ç³»ç»Ÿå‚æ•°ä¼˜åŒ– optimize_sysctl() { sudo tee /etc/sysctl.d/99-custom.conf << EOF # å†…å­˜ç®¡ç†ä¼˜åŒ– vm.swappiness = 60 vm.vfs_cache_pressure = 50 vm.dirty_background_ratio = 5 vm.dirty_ratio = 10 # ç½‘ç»œä¼˜åŒ– net.core.somaxconn = 1024 net.core.netdev_max_backlog = 5000 net.ipv4.tcp_max_syn_backlog = 2048 net.ipv4.tcp_fin_timeout = 20 net.ipv4.tcp_keepalive_time = 1200 net.ipv4.tcp_keepalive_intvl = 15 net.ipv4.tcp_keepalive_probes = 5 # æ–‡ä»¶ç³»ç»Ÿä¼˜åŒ– fs.file-max = 65535 fs.inotify.max_user_watches = 524288 EOF # åº”ç”¨æ–°çš„ç³»ç»Ÿå‚æ•° sudo sysctl -p /etc/sysctl.d/99-custom.conf } # CPU é¢‘ç‡ä¼˜åŒ– optimize_cpu() { sudo tee /boot/config.txt << EOF # CPU è®¾ç½® arm_freq=1800 over_voltage=6 gpu_freq=500 # æ¸©åº¦æ§åˆ¶ temp_limit=75 EOF } # æœåŠ¡ä¼˜åŒ– optimize_services() { # ç¦ç”¨ä¸å¿…è¦çš„æœåŠ¡ UNNECESSARY_SERVICES=( "bluetooth" "cups" "avahi-daemon" ) for service in "${UNNECESSARY_SERVICES[@]}"; do if systemctl is-enabled "$service" &>/dev/null; then sudo systemctl disable "$service" sudo systemctl stop "$service" fi done } # å†…å­˜ä¼˜åŒ– optimize_memory() { # è°ƒæ•´ ZRAM sudo tee /etc/default/zramswap << EOF ALGO=lz4 PERCENT=50 EOF # é‡å¯ ZRAM æœåŠ¡ sudo systemctl restart zramswap } 2. æœåŠ¡ä¼˜åŒ–é…ç½® # Nginx ä¼˜åŒ–é…ç½® sudo nano /etc/nginx/nginx.conf user www-data; worker_processes auto; worker_rlimit_nofile 65535; events { worker_connections 1024; multi_accept on; use epoll; } http { # åŸºç¡€è®¾ç½® sendfile on; tcp_nopush on; tcp_nodelay on; keepalive_timeout 65; types_hash_max_size 2048; server_tokens off; # MIME ç±»å‹ include /etc/nginx/mime.types; default_type application/octet-stream; # æ—¥å¿—æ ¼å¼ log_format main &#39;$remote_addr - $remote_user [$time_local] "$request" &#39; &#39;$status $body_bytes_sent "$http_referer" &#39; &#39;"$http_user_agent" "$http_x_forwarded_for"&#39;; # ç¼“å†²åŒºè®¾ç½® client_body_buffer_size 10K; client_header_buffer_size 1k; client_max_body_size 8m; large_client_header_buffers 2 1k; # è¶…æ—¶è®¾ç½® client_body_timeout 12; client_header_timeout 12; send_timeout 10; # ç¼“å­˜è®¾ç½® open_file_cache max=1000 inactive=20s; open_file_cache_valid 30s; open_file_cache_min_uses 2; open_file_cache_errors on; # Gzip å‹ç¼© gzip on; gzip_vary on; gzip_proxied any; gzip_comp_level 6; gzip_types text/plain text/css text/xml application/json application/javascript application/xml+rss application/atom+xml image/svg+xml; } äºŒåã€æœåŠ¡ç›‘æ§é¢æ¿é…ç½® 1. Grafana ç›‘æ§ç³»ç»Ÿé…ç½® # å®‰è£… Grafana sudo apt-get install -y apt-transport-https sudo apt-get install -y software-properties-common wget wget -q -O - https://packages.grafana.com/gpg.key | sudo apt-key add - echo "deb https://packages.grafana.com/oss/deb stable main" | sudo tee -a /etc/apt/sources.list.d/grafana.list sudo apt-get update sudo apt-get install -y grafana # é…ç½® Grafana sudo nano /etc/grafana/grafana.ini [server] http_addr = 0.0.0.0 http_port = 3000 [security] admin_user = admin admin_password = your_secure_password [auth.anonymous] enabled = false [paths] data = /var/lib/grafana logs = /var/log/grafana plugins = /var/lib/grafana/plugins [dashboards] versions_to_keep = 20 2. Prometheus é…ç½® # å®‰è£… Prometheus sudo apt-get install -y prometheus # é…ç½® Prometheus sudo nano /etc/prometheus/prometheus.yml global: scrape_interval: 15s evaluation_interval: 15s scrape_configs: - job_name: &#39;node&#39; static_configs: - targets: [&#39;localhost:9100&#39;] - job_name: &#39;nginx&#39; static_configs: - targets: [&#39;localhost:9113&#39;] - job_name: &#39;system&#39; static_configs: - targets: [&#39;localhost:9090&#39;] - job_name: &#39;process&#39; static_configs: - targets: [&#39;localhost:9256&#39;] 3. Node Exporter é…ç½® # å®‰è£… Node Exporter sudo apt-get install -y prometheus-node-exporter # åˆ›å»ºè‡ªå®šä¹‰æŒ‡æ ‡æ”¶é›†è„šæœ¬ nano ~/custom_metrics.sh #!/bin/bash # ~/custom_metrics.sh # åˆ›å»ºæŒ‡æ ‡æ–‡ä»¶ METRICS_FILE="/var/lib/node_exporter/custom_metrics.prom" while true; do # CPU æ¸©åº¦ CPU_TEMP=$(vcgencmd measure_temp | sed &#39;s/temp=//&#39; | sed &#39;s/&#39;"&#39;"&#39;C//&#39;) echo "raspberry_pi_cpu_temperature $CPU_TEMP" > "$METRICS_FILE" # AI æœåŠ¡çŠ¶æ€ if pgrep -f llama-server > /dev/null; then echo "ai_service_status 1" >> "$METRICS_FILE" else echo "ai_service_status 0" >> "$METRICS_FILE" fi # åšå®¢æœåŠ¡çŠ¶æ€ if systemctl is-active nginx > /dev/null; then echo "blog_service_status 1" >> "$METRICS_FILE" else echo "blog_service_status 0" >> "$METRICS_FILE" fi # å†…å­˜ä½¿ç”¨ FREE_MEM=$(free | grep Mem | awk &#39;{print $4}&#39;) echo "system_free_memory_bytes $FREE_MEM" >> "$METRICS_FILE" sleep 15 done äºŒåä¸€ã€è‡ªåŠ¨åŒ–éƒ¨ç½²ä¸æ›´æ–° 1. è‡ªåŠ¨éƒ¨ç½²é…ç½®è„šæœ¬ # åˆ›å»ºè‡ªåŠ¨éƒ¨ç½²è„šæœ¬ nano ~/auto_deploy.sh #!/bin/bash # ~/auto_deploy.sh # é…ç½® BLOG_DIR="/home/zhaoxiongzhou/myblog" LLAMA_DIR="/home/zhaoxiongzhou/projects/llama.cpp" BACKUP_DIR="/home/zhaoxiongzhou/backups" LOG_FILE="/var/log/auto_deploy.log" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" >> "$LOG_FILE" } # å¤‡ä»½å½“å‰ç‰ˆæœ¬ backup_current() { log "å¼€å§‹å¤‡ä»½å½“å‰ç‰ˆæœ¬" # åšå®¢å¤‡ä»½ tar -czf "$BACKUP_DIR/blog_$(date +%Y%m%d_%H%M%S).tar.gz" "$BLOG_DIR" # AI æœåŠ¡å¤‡ä»½ tar -czf "$BACKUP_DIR/llama_$(date +%Y%m%d_%H%M%S).tar.gz" "$LLAMA_DIR" log "å¤‡ä»½å®Œæˆ" } # æ›´æ–°åšå®¢ update_blog() { log "å¼€å§‹æ›´æ–°åšå®¢" cd "$BLOG_DIR" || exit 1 # æ‹‰å–æœ€æ–°ä»£ç  if git pull origin master; then # æ›´æ–°ä¸»é¢˜ git submodule update --remote themes/ananke # æ„å»ºç«™ç‚¹ hugo --minify # æ›´æ–°æƒé™ sudo chown -R www-data:www-data public/ # é‡å¯ Nginx sudo systemctl restart nginx log "åšå®¢æ›´æ–°æˆåŠŸ" else log "é”™è¯¯: åšå®¢æ›´æ–°å¤±è´¥" return 1 fi } # æ›´æ–° AI æœåŠ¡ update_ai_service() { log "å¼€å§‹æ›´æ–° AI æœåŠ¡" cd "$LLAMA_DIR" || exit 1 # åœæ­¢å½“å‰æœåŠ¡ pkill llama-server # æ‹‰å–æœ€æ–°ä»£ç  if git pull origin master; then # é‡æ–°ç¼–è¯‘ make clean if LLAMA_METAL=1 make -j4; then # å¯åŠ¨æœåŠ¡ ./start-llama.sh # éªŒè¯æœåŠ¡ sleep 5 if pgrep -f llama-server > /dev/null; then log "AI æœåŠ¡æ›´æ–°æˆåŠŸ" else log "é”™è¯¯: AI æœåŠ¡å¯åŠ¨å¤±è´¥" return 1 fi else log "é”™è¯¯: AI æœåŠ¡ç¼–è¯‘å¤±è´¥" return 1 fi else log "é”™è¯¯: AI æœåŠ¡ä»£ç æ›´æ–°å¤±è´¥" return 1 fi } # ä¸»å‡½æ•° main() { log "å¼€å§‹è‡ªåŠ¨éƒ¨ç½²æµç¨‹" # åˆ›å»ºå¤‡ä»½ backup_current # æ›´æ–°æœåŠ¡ if update_blog && update_ai_service; then log "éƒ¨ç½²å®Œæˆ" return 0 else log "éƒ¨ç½²å¤±è´¥" return 1 fi } # æ‰§è¡Œéƒ¨ç½² main 2. è‡ªåŠ¨æ›´æ–°æ£€æŸ¥è„šæœ¬ # åˆ›å»ºæ›´æ–°æ£€æŸ¥è„šæœ¬ nano ~/check_updates.sh äºŒåä¸€ã€è‡ªåŠ¨æ›´æ–°æ£€æŸ¥ä¸é€šçŸ¥ç³»ç»Ÿ 1. æ›´æ–°æ£€æŸ¥è„šæœ¬ #!/bin/bash # ~/check_updates.sh # é…ç½® NOTIFY_SCRIPT="/home/zhaoxiongzhou/send_notification.sh" LOG_FILE="/var/log/update_check.log" GITHUB_API="https://api.github.com" LLAMA_REPO="ggerganov/llama.cpp" HUGO_REPO="gohugoio/hugo" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # æ£€æŸ¥ GitHub ä»“åº“æ›´æ–° check_github_updates() { local repo="$1" local current_version="$2" # è·å–æœ€æ–°ç‰ˆæœ¬ latest_version=$(curl -s "$GITHUB_API/repos/$repo/releases/latest" | grep -Po &#39;"tag_name": "\K.*?(?=")&#39;) if [ "$latest_version" != "$current_version" ]; then log "å‘ç°æ–°ç‰ˆæœ¬: $repo ($current_version -> $latest_version)" return 0 else log "å½“å‰ç‰ˆæœ¬å·²æ˜¯æœ€æ–°: $repo ($current_version)" return 1 fi } # æ£€æŸ¥ç³»ç»Ÿæ›´æ–° check_system_updates() { sudo apt update > /dev/null 2>&amp;1 updates=$(sudo apt list --upgradable 2>/dev/null | grep -c "upgradable") if [ "$updates" -gt 0 ]; then log "å‘ç° $updates ä¸ªç³»ç»Ÿæ›´æ–°" return 0 else log "ç³»ç»Ÿå·²æ˜¯æœ€æ–°" return 1 fi } # æ£€æŸ¥æœåŠ¡çŠ¶æ€ check_services() { local services=("nginx" "llama-server") local status=0 for service in "${services[@]}"; do if [ "$service" = "nginx" ]; then if ! systemctl is-active --quiet nginx; then log "è­¦å‘Š: Nginx æœåŠ¡æœªè¿è¡Œ" status=1 fi elif [ "$service" = "llama-server" ]; then if ! pgrep -f llama-server > /dev/null; then log "è­¦å‘Š: AI æœåŠ¡æœªè¿è¡Œ" status=1 fi fi done return $status } # å‘é€é€šçŸ¥ send_notification() { local message="$1" local priority="$2" if [ -x "$NOTIFY_SCRIPT" ]; then "$NOTIFY_SCRIPT" "$message" "$priority" else log "é€šçŸ¥è„šæœ¬ä¸å­˜åœ¨æˆ–ä¸å¯æ‰§è¡Œ" fi } # ä¸»å‡½æ•° main() { log "å¼€å§‹æ£€æŸ¥æ›´æ–°" # è·å–å½“å‰ç‰ˆæœ¬ current_llama_version=$(cd ~/projects/llama.cpp && git describe --tags) current_hugo_version=$(hugo version | grep -Po "v\d+\.\d+\.\d+") # æ£€æŸ¥æ›´æ–° updates_found=0 if check_github_updates "$LLAMA_REPO" "$current_llama_version"; then send_notification "llama.cpp æœ‰æ–°ç‰ˆæœ¬å¯ç”¨" "normal" updates_found=1 fi if check_github_updates "$HUGO_REPO" "$current_hugo_version"; then send_notification "Hugo æœ‰æ–°ç‰ˆæœ¬å¯ç”¨" "normal" updates_found=1 fi if check_system_updates; then send_notification "ç³»ç»Ÿæœ‰æ›´æ–°å¯ç”¨" "normal" updates_found=1 fi if ! check_services; then send_notification "æœåŠ¡çŠ¶æ€å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥" "high" fi if [ "$updates_found" -eq 0 ]; then log "æ‰€æœ‰ç»„ä»¶å‡ä¸ºæœ€æ–°ç‰ˆæœ¬" fi } # æ‰§è¡Œæ£€æŸ¥ main äºŒåäºŒã€é€šçŸ¥ç³»ç»Ÿé…ç½® 1. é€šçŸ¥å‘é€è„šæœ¬ # åˆ›å»ºé€šçŸ¥å‘é€è„šæœ¬ nano ~/send_notification.sh #!/bin/bash # ~/send_notification.sh # é…ç½® TELEGRAM_BOT_TOKEN="your_bot_token" TELEGRAM_CHAT_ID="your_chat_id" EMAIL_ADDRESS="your_email@domain.com" DISCORD_WEBHOOK_URL="your_discord_webhook_url" # æ—¥å¿—é…ç½® LOG_FILE="/var/log/notifications.log" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" >> "$LOG_FILE" } # Telegram é€šçŸ¥ send_telegram() { local message="$1" local priority="$2" # æ ¹æ®ä¼˜å…ˆçº§æ·»åŠ è¡¨æƒ…ç¬¦å· case "$priority" in "high") message="ğŸš¨ ç´§æ€¥: $message" ;; "normal") message="â„¹ï¸ é€šçŸ¥: $message" ;; "low") message="ğŸ“ ä¿¡æ¯: $message" ;; esac # å‘é€æ¶ˆæ¯ curl -s -X POST \ "https://api.telegram.org/bot$TELEGRAM_BOT_TOKEN/sendMessage" \ -d "chat_id=$TELEGRAM_CHAT_ID" \ -d "text=$message" \ -d "parse_mode=HTML" log "Telegram é€šçŸ¥å·²å‘é€: $message" } # é‚®ä»¶é€šçŸ¥ send_email() { local message="$1" local priority="$2" local subject case "$priority" in "high") subject="[ç´§æ€¥] æ ‘è“æ´¾æœåŠ¡è­¦å‘Š" ;; "normal") subject="[é€šçŸ¥] æ ‘è“æ´¾æœåŠ¡æ›´æ–°" ;; "low") subject="[ä¿¡æ¯] æ ‘è“æ´¾æœåŠ¡çŠ¶æ€" ;; esac echo "$message" | mail -s "$subject" "$EMAIL_ADDRESS" log "é‚®ä»¶é€šçŸ¥å·²å‘é€: $subject - $message" } # Discord é€šçŸ¥ send_discord() { local message="$1" local priority="$2" local color case "$priority" in "high") color="16711680" # çº¢è‰² ;; "normal") color="65280" # ç»¿è‰² ;; "low") color="255" # è“è‰² ;; esac curl -H "Content-Type: application/json" \ -X POST \ -d "{\"embeds\": [{\"description\": \"$message\", \"color\": $color}]}" \ "$DISCORD_WEBHOOK_URL" log "Discord é€šçŸ¥å·²å‘é€: $message" } # ä¸»å‡½æ•° main() { local message="$1" local priority="${2:-normal}" # é»˜è®¤ä¼˜å…ˆçº§ä¸º normal # æ£€æŸ¥å¿…è¦å‚æ•° if [ -z "$message" ]; then log "é”™è¯¯: æ¶ˆæ¯å†…å®¹ä¸èƒ½ä¸ºç©º" return 1 fi # æ·»åŠ ç³»ç»Ÿä¿¡æ¯ local hostname=$(hostname) local timestamp=$(date &#39;+%Y-%m-%d %H:%M:%S&#39;) message="[$hostname] [$timestamp] $message" # å‘é€æ‰€æœ‰é€šçŸ¥ send_telegram "$message" "$priority" send_email "$message" "$priority" send_discord "$message" "$priority" log "æ‰€æœ‰é€šçŸ¥æ¸ é“å¤„ç†å®Œæˆ" } # æ‰§è¡Œé€šçŸ¥å‘é€ main "$@" äºŒåä¸‰ã€å®šæ—¶ä»»åŠ¡é…ç½® 1. Crontab é…ç½® # ç¼–è¾‘ crontab crontab -e # ç³»ç»Ÿç»´æŠ¤ä»»åŠ¡ # æ¯å¤©å‡Œæ™¨ 2 ç‚¹æ‰§è¡Œç³»ç»Ÿæ›´æ–°æ£€æŸ¥ 0 2 * * * ~/check_updates.sh > /dev/null 2>&amp;1 # æ¯ 6 å°æ—¶æ‰§è¡Œä¸€æ¬¡æœåŠ¡å¥åº·æ£€æŸ¥ 0 */6 * * * ~/service_health_check.sh > /dev/null 2>&amp;1 # æ¯å‘¨æ—¥å‡Œæ™¨ 3 ç‚¹æ‰§è¡Œç³»ç»Ÿä¼˜åŒ– 0 3 * * 0 ~/system_optimize.sh > /dev/null 2>&amp;1 # æ¯å¤©å‡Œæ™¨ 4 ç‚¹æ‰§è¡Œæ—¥å¿—ç®¡ç† 0 4 * * * ~/log_management.sh > /dev/null 2>&amp;1 # æ¯å°æ—¶æ‰§è¡Œæ€§èƒ½æ•°æ®æ”¶é›† 0 * * * * ~/collect_performance.sh > /dev/null 2>&amp;1 # æ¯ 5 åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡å…³é”®æœåŠ¡çŠ¶æ€ */5 * * * * ~/monitor.sh > /dev/null 2>&amp;1 # æ¯å¤©æ™šä¸Š 11 ç‚¹æ‰§è¡Œå¤‡ä»½ 0 23 * * * ~/auto_backup.sh > /dev/null 2>&amp;1 # æ¯æœˆ 1 å·æ‰§è¡Œå®Œæ•´ç³»ç»Ÿæ£€æŸ¥ 0 1 1 * * ~/full_system_check.sh > /dev/null 2>&amp;1 2. å®Œæ•´ç³»ç»Ÿæ£€æŸ¥è„šæœ¬ # åˆ›å»ºå®Œæ•´ç³»ç»Ÿæ£€æŸ¥è„šæœ¬ nano ~/full_system_check.sh #!/bin/bash # ~/full_system_check.sh LOG_FILE="/var/log/system_check.log" REPORT_FILE="/home/zhaoxiongzhou/reports/monthly_report_$(date +%Y%m).txt" # ç¡®ä¿ç›®å½•å­˜åœ¨ mkdir -p "$(dirname "$REPORT_FILE")" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" "$REPORT_FILE" } # ç³»ç»Ÿä¿¡æ¯æ£€æŸ¥ check_system_info() { log "=== ç³»ç»Ÿä¿¡æ¯ ===" log "ç³»ç»Ÿç‰ˆæœ¬: $(cat /etc/os-release | grep PRETTY_NAME)" log "å†…æ ¸ç‰ˆæœ¬: $(uname -r)" log "è¿è¡Œæ—¶é—´: $(uptime -p)" log "æœ€åå¯åŠ¨: $(who -b | awk &#39;{print $3,$4}&#39;)" } # èµ„æºä½¿ç”¨æ£€æŸ¥ check_resources() { log "=== èµ„æºä½¿ç”¨æƒ…å†µ ===" log "CPU ä½¿ç”¨ç‡: $(top -bn1 | grep "Cpu(s)" | awk &#39;{print $2}&#39;)%" log "å†…å­˜ä½¿ç”¨æƒ…å†µ:" free -h | tee -a "$REPORT_FILE" log "ç£ç›˜ä½¿ç”¨æƒ…å†µ:" df -h | tee -a "$REPORT_FILE" } # æœåŠ¡çŠ¶æ€æ£€æŸ¥ check_services() { log "=== æœåŠ¡çŠ¶æ€ ===" # æ£€æŸ¥ Nginx if systemctl is-active --quiet nginx; then log "Nginx: è¿è¡Œæ­£å¸¸" else log "Nginx: æœªè¿è¡Œ" fi # æ£€æŸ¥ AI æœåŠ¡ if pgrep -f llama-server > /dev/null; then log "AI æœåŠ¡: è¿è¡Œæ­£å¸¸" else log "AI æœåŠ¡: æœªè¿è¡Œ" fi } # å®‰å…¨æ£€æŸ¥ check_security() { log "=== å®‰å…¨æ£€æŸ¥ ===" # æ£€æŸ¥å¤±è´¥çš„ç™»å½•å°è¯• log "å¤±è´¥çš„ç™»å½•å°è¯•:" grep "Failed password" /var/log/auth.log | tail -n 5 | tee -a "$REPORT_FILE" # æ£€æŸ¥å¼€æ”¾çš„ç«¯å£ log "å¼€æ”¾çš„ç«¯å£:" netstat -tuln | grep LISTEN | tee -a "$REPORT_FILE" } # æ€§èƒ½åˆ†æ analyze_performance() { log "=== æ€§èƒ½åˆ†æ ===" # åˆ†æ CPU ä½¿ç”¨æƒ…å†µ log "CPU å¯†é›†è¿›ç¨‹:" ps aux --sort=-%cpu | head -n 5 | tee -a "$REPORT_FILE" # åˆ†æå†…å­˜ä½¿ç”¨æƒ…å†µ log "å†…å­˜å¯†é›†è¿›ç¨‹:" ps aux --sort=-%mem | head -n 5 | tee -a "$REPORT_FILE" } # ä¸»å‡½æ•° main() { log "å¼€å§‹æœˆåº¦ç³»ç»Ÿæ£€æŸ¥ - $(date)" check_system_info check_resources check_services check_security analyze_performance log "ç³»ç»Ÿæ£€æŸ¥å®Œæˆ" # å‘é€æŠ¥å‘Š if [ -f "$REPORT_FILE" ]; then ~/send_notification.sh "æœˆåº¦ç³»ç»Ÿæ£€æŸ¥æŠ¥å‘Šå·²ç”Ÿæˆ" "normal" fi } # æ‰§è¡Œæ£€æŸ¥ main äºŒåå››ã€ç¾éš¾æ¢å¤è®¡åˆ’ 1. ç³»ç»Ÿæ¢å¤è„šæœ¬ # åˆ›å»ºç³»ç»Ÿæ¢å¤è„šæœ¬ nano ~/disaster_recovery.sh #!/bin/bash # ~/disaster_recovery.sh # é…ç½® BACKUP_DIR="/home/zhaoxiongzhou/backups" RECOVERY_LOG="/var/log/recovery.log" SERVICES=("nginx" "llama-server") # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$RECOVERY_LOG" } # éªŒè¯å¤‡ä»½ verify_backup() { local backup_file="$1" if [ ! -f "$backup_file" ]; then log "é”™è¯¯: å¤‡ä»½æ–‡ä»¶ä¸å­˜åœ¨ - $backup_file" return 1 fi # æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§ if ! tar -tzf "$backup_file" >/dev/null 2>&amp;1; then log "é”™è¯¯: å¤‡ä»½æ–‡ä»¶æŸå - $backup_file" return 1 fi return 0 } # åœæ­¢æœåŠ¡ stop_services() { log "åœæ­¢æ‰€æœ‰æœåŠ¡..." for service in "${SERVICES[@]}"; do if [ "$service" = "nginx" ]; then sudo systemctl stop nginx else pkill "$service" fi done # ç­‰å¾…æœåŠ¡å®Œå…¨åœæ­¢ sleep 5 } # æ¢å¤åšå®¢æœåŠ¡ restore_blog() { local backup_file="$BACKUP_DIR/blog_latest.tar.gz" if verify_backup "$backup_file"; then log "å¼€å§‹æ¢å¤åšå®¢æœåŠ¡..." # æ¸…ç†å½“å‰ç›®å½• rm -rf ~/myblog/* # è§£å‹å¤‡ä»½ tar -xzf "$backup_file" -C ~/myblog/ # é‡å»ºç«™ç‚¹ cd ~/myblog hugo --minify # æ¢å¤æƒé™ sudo chown -R www-data:www-data public/ log "åšå®¢æœåŠ¡æ¢å¤å®Œæˆ" else log "åšå®¢æœåŠ¡æ¢å¤å¤±è´¥" return 1 fi } # æ¢å¤ AI æœåŠ¡ restore_ai_service() { local backup_file="$BACKUP_DIR/llama_latest.tar.gz" if verify_backup "$backup_file"; then log "å¼€å§‹æ¢å¤ AI æœåŠ¡..." # æ¸…ç†å½“å‰ç›®å½• rm -rf ~/projects/llama.cpp/* # è§£å‹å¤‡ä»½ tar -xzf "$backup_file" -C ~/projects/llama.cpp/ # é‡æ–°ç¼–è¯‘ cd ~/projects/llama.cpp make clean LLAMA_METAL=1 make -j4 log "AI æœåŠ¡æ¢å¤å®Œæˆ" else log "AI æœåŠ¡æ¢å¤å¤±è´¥" return 1 fi } # æ¢å¤ç³»ç»Ÿé…ç½® restore_system_config() { local backup_file="$BACKUP_DIR/system_config_latest.tar.gz" if verify_backup "$backup_file"; then log "å¼€å§‹æ¢å¤ç³»ç»Ÿé…ç½®..." # è§£å‹ç³»ç»Ÿé…ç½® sudo tar -xzf "$backup_file" -C / # é‡æ–°åŠ è½½ç³»ç»Ÿé…ç½® sudo sysctl --system log "ç³»ç»Ÿé…ç½®æ¢å¤å®Œæˆ" else log "ç³»ç»Ÿé…ç½®æ¢å¤å¤±è´¥" return 1 fi } # å¯åŠ¨æœåŠ¡ start_services() { log "å¯åŠ¨æ‰€æœ‰æœåŠ¡..." # å¯åŠ¨ Nginx sudo systemctl start nginx # å¯åŠ¨ AI æœåŠ¡ ~/projects/llama.cpp/start-llama.sh # éªŒè¯æœåŠ¡çŠ¶æ€ sleep 10 verify_services } # éªŒè¯æœåŠ¡ verify_services() { local status=0 log "éªŒè¯æœåŠ¡çŠ¶æ€..." # æ£€æŸ¥ Nginx if ! systemctl is-active --quiet nginx; then log "è­¦å‘Š: Nginx æœåŠ¡æœªæ­£å¸¸è¿è¡Œ" status=1 fi # æ£€æŸ¥ AI æœåŠ¡ if ! pgrep -f llama-server > /dev/null; then log "è­¦å‘Š: AI æœåŠ¡æœªæ­£å¸¸è¿è¡Œ" status=1 fi return $status } # ä¸»å‡½æ•° main() { log "å¼€å§‹ç³»ç»Ÿæ¢å¤æµç¨‹..." # åœæ­¢æœåŠ¡ stop_services # æ‰§è¡Œæ¢å¤ if restore_system_config && restore_blog && restore_ai_service; then # å¯åŠ¨æœåŠ¡ start_services if verify_services; then log "ç³»ç»Ÿæ¢å¤æˆåŠŸå®Œæˆ" ~/send_notification.sh "ç³»ç»Ÿæ¢å¤æˆåŠŸå®Œæˆ" "normal" return 0 else log "ç³»ç»Ÿæ¢å¤å®Œæˆï¼Œä½†éƒ¨åˆ†æœåŠ¡å¯èƒ½æœªæ­£å¸¸è¿è¡Œ" ~/send_notification.sh "ç³»ç»Ÿæ¢å¤å®Œæˆï¼Œä½†éœ€è¦æ‰‹åŠ¨æ£€æŸ¥æœåŠ¡çŠ¶æ€" "high" return 1 fi else log "ç³»ç»Ÿæ¢å¤å¤±è´¥" ~/send_notification.sh "ç³»ç»Ÿæ¢å¤å¤±è´¥ï¼Œéœ€è¦æ‰‹åŠ¨å¹²é¢„" "high" return 1 fi } # æ‰§è¡Œæ¢å¤ main äºŒåäº”ã€æ–‡æ¡£ç®¡ç†ç³»ç»Ÿ 1. æ–‡æ¡£ç”Ÿæˆè„šæœ¬ # åˆ›å»ºæ–‡æ¡£ç”Ÿæˆè„šæœ¬ nano ~/generate_docs.sh #!/bin/bash # ~/generate_docs.sh # é…ç½® DOCS_DIR="/home/zhaoxiongzhou/documentation" SCRIPTS_DIR="/home/zhaoxiongzhou" CONFIG_DIR="/etc" LOG_FILE="/var/log/documentation.log" # ç¡®ä¿ç›®å½•å­˜åœ¨ mkdir -p "$DOCS_DIR"/{scripts,configs,logs,maintenance} # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # ç”Ÿæˆè„šæœ¬æ–‡æ¡£ generate_script_docs() { log "ç”Ÿæˆè„šæœ¬æ–‡æ¡£..." for script in "$SCRIPTS_DIR"/*.sh; do if [ -f "$script" ]; then script_name=$(basename "$script") output_file="$DOCS_DIR/scripts/${script_name%.sh}.md" { echo "# $script_name" echo "## è·¯å¾„: $script" echo "## æœ€åä¿®æ”¹: $(date -r "$script" &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo "## æƒé™: $(stat -c &#39;%a&#39; "$script")" echo "## æ‰€æœ‰è€…: $(stat -c &#39;%U:%G&#39; "$script")" echo echo "## åŠŸèƒ½æè¿°" grep -A 5 "^#.*åŠŸèƒ½:" "$script" 2>/dev/null || echo "æœªæä¾›åŠŸèƒ½æè¿°" echo echo "## è„šæœ¬å†…å®¹" echo &#39;```bash&#39; cat "$script" echo &#39;```&#39; echo echo "## ä¾èµ–é¡¹" grep "^[^#]*apt.*install" "$script" 2>/dev/null || echo "æœªæ‰¾åˆ°æ˜ç¡®çš„ä¾èµ–é¡¹" echo echo "## å®šæ—¶ä»»åŠ¡" crontab -l 2>/dev/null | grep "$script_name" || echo "æœªé…ç½®å®šæ—¶ä»»åŠ¡" } > "$output_file" fi done } # ç”Ÿæˆé…ç½®æ–‡æ¡£ generate_config_docs() { log "ç”Ÿæˆé…ç½®æ–‡æ¡£..." # Nginx é…ç½® { echo "# Nginx é…ç½®æ–‡æ¡£" echo "## ä¸»é…ç½®æ–‡ä»¶" echo &#39;```nginx&#39; cat /etc/nginx/nginx.conf echo &#39;```&#39; echo "## ç«™ç‚¹é…ç½®" echo &#39;```nginx&#39; cat /etc/nginx/sites-available/myblog echo &#39;```&#39; } > "$DOCS_DIR/configs/nginx_config.md" # ç³»ç»Ÿé…ç½® { echo "# ç³»ç»Ÿé…ç½®æ–‡æ¡£" echo "## Sysctl é…ç½®" echo &#39;```bash&#39; cat /etc/sysctl.d/99-custom.conf echo &#39;```&#39; echo "## æ ‘è“æ´¾é…ç½®" echo &#39;```bash&#39; cat /boot/config.txt echo &#39;```&#39; } > "$DOCS_DIR/configs/system_config.md" } # ç”Ÿæˆç»´æŠ¤æ–‡æ¡£ generate_maintenance_docs() { log "ç”Ÿæˆç»´æŠ¤æ–‡æ¡£..." { echo "# ç³»ç»Ÿç»´æŠ¤æ–‡æ¡£" echo "## å®šæ—¶ä»»åŠ¡" echo &#39;```bash&#39; crontab -l echo &#39;```&#39; echo "## æœåŠ¡çŠ¶æ€" echo &#39;```bash&#39; systemctl status nginx ps aux | grep llama-server echo &#39;```&#39; echo "## èµ„æºä½¿ç”¨" echo &#39;```bash&#39; df -h free -h top -bn1 echo &#39;```&#39; echo "## æœ€è¿‘æ—¥å¿—" echo &#39;```bash&#39; tail -n 50 /var/log/syslog echo &#39;```&#39; } > "$DOCS_DIR/maintenance/system_status.md" } # ç”Ÿæˆç´¢å¼• generate_index() { log "ç”Ÿæˆæ–‡æ¡£ç´¢å¼•..." { echo "# ç³»ç»Ÿæ–‡æ¡£ç´¢å¼•" echo "## ç”Ÿæˆæ—¶é—´: $(date &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo echo "## è„šæœ¬æ–‡æ¡£" for doc in "$DOCS_DIR/scripts"/*.md; do echo "- [$(basename "${doc%.md}")](scripts/$(basename "$doc"))" done echo echo "## é…ç½®æ–‡æ¡£" for doc in "$DOCS_DIR/configs"/*.md; do echo "- [$(basename "${doc%.md}")](configs/$(basename "$doc"))" done echo echo "## ç»´æŠ¤æ–‡æ¡£" for doc in "$DOCS_DIR/maintenance"/*.md; do echo "- [$(basename "${doc%.md}")](maintenance/$(basename "$doc"))" done } > "$DOCS_DIR/index.md" } # ä¸»å‡½æ•° main() { log "å¼€å§‹ç”Ÿæˆæ–‡æ¡£..." generate_script_docs generate_config_docs generate_maintenance_docs generate_index log "æ–‡æ¡£ç”Ÿæˆå®Œæˆ: $DOCS_DIR" } # æ‰§è¡Œæ–‡æ¡£ç”Ÿæˆ main äºŒåå…­ã€æ€§èƒ½æµ‹è¯•ä¸åŸºå‡†æµ‹è¯• 1. æ€§èƒ½æµ‹è¯•è„šæœ¬ # åˆ›å»ºæ€§èƒ½æµ‹è¯•è„šæœ¬ nano ~/benchmark.sh #!/bin/bash # ~/benchmark.sh # é…ç½® RESULTS_DIR="/home/zhaoxiongzhou/benchmark_results" LOG_FILE="/var/log/benchmark.log" DURATION=300 # æµ‹è¯•æŒç»­æ—¶é—´ï¼ˆç§’ï¼‰ CONCURRENT_USERS=10 # å¹¶å‘ç”¨æˆ·æ•° # ç¡®ä¿ç›®å½•å­˜åœ¨ mkdir -p "$RESULTS_DIR" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # CPU æ€§èƒ½æµ‹è¯• benchmark_cpu() { log "å¼€å§‹ CPU æ€§èƒ½æµ‹è¯•..." # ä½¿ç”¨ sysbench è¿›è¡Œ CPU æµ‹è¯• sysbench cpu --cpu-max-prime=20000 --threads=4 run > "$RESULTS_DIR/cpu_benchmark.txt" # è®°å½• CPU æ¸©åº¦ for i in $(seq 1 10); do vcgencmd measure_temp >> "$RESULTS_DIR/cpu_temp.txt" sleep 1 done } # å†…å­˜æ€§èƒ½æµ‹è¯• benchmark_memory() { log "å¼€å§‹å†…å­˜æ€§èƒ½æµ‹è¯•..." # ä½¿ç”¨ sysbench è¿›è¡Œå†…å­˜æµ‹è¯• sysbench memory --memory-block-size=1K --memory-total-size=10G run > "$RESULTS_DIR/memory_benchmark.txt" } # ç£ç›˜æ€§èƒ½æµ‹è¯• benchmark_disk() { log "å¼€å§‹ç£ç›˜æ€§èƒ½æµ‹è¯•..." # ä½¿ç”¨ dd æµ‹è¯•å†™å…¥é€Ÿåº¦ dd if=/dev/zero of=/tmp/test_file bs=1M count=1000 conv=fdatasync 2>> "$RESULTS_DIR/disk_write_benchmark.txt" # ä½¿ç”¨ dd æµ‹è¯•è¯»å–é€Ÿåº¦ dd if=/tmp/test_file of=/dev/null bs=1M count=1000 2>> "$RESULTS_DIR/disk_read_benchmark.txt" # æ¸…ç†æµ‹è¯•æ–‡ä»¶ rm /tmp/test_file } # ç½‘ç»œæ€§èƒ½æµ‹è¯• benchmark_network() { log "å¼€å§‹ç½‘ç»œæ€§èƒ½æµ‹è¯•..." # ä½¿ç”¨ iperf3 æµ‹è¯•ç½‘ç»œæ€§èƒ½ iperf3 -c iperf.he.net -t 30 > "$RESULTS_DIR/network_benchmark.txt" } # Web æœåŠ¡æ€§èƒ½æµ‹è¯• benchmark_web() { log "å¼€å§‹ Web æœåŠ¡æ€§èƒ½æµ‹è¯•..." # ä½¿ç”¨ ab æµ‹è¯• Web æœåŠ¡ ab -n 1000 -c "$CONCURRENT_USERS" http://localhost/ > "$RESULTS_DIR/web_benchmark.txt" } # AI æœåŠ¡æ€§èƒ½æµ‹è¯• benchmark_ai() { log "å¼€å§‹ AI æœåŠ¡æ€§èƒ½æµ‹è¯•..." # åˆ›å»ºæµ‹è¯•è¯·æ±‚ cat > /tmp/test_prompt.txt << EOF Hello, how are you? EOF # ä½¿ç”¨ curl æµ‹è¯• AI æœåŠ¡å“åº”æ—¶é—´ for i in $(seq 1 10); do time curl -X POST \ -H "Content-Type: application/json" \ -d @/tmp/test_prompt.txt \ http://localhost:8080/completion >> "$RESULTS_DIR/ai_benchmark.txt" 2>&amp;1 echo -e "\n---\n" >> "$RESULTS_DIR/ai_benchmark.txt" sleep 2 done } # ç”ŸæˆæŠ¥å‘Š generate_report() { log "ç”Ÿæˆæ€§èƒ½æµ‹è¯•æŠ¥å‘Š..." local report_file="$RESULTS_DIR/benchmark_report_$(date +%Y%m%d_%H%M%S).md" { echo "# æ€§èƒ½æµ‹è¯•æŠ¥å‘Š" echo "## æµ‹è¯•æ—¶é—´: $(date &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo echo "## ç³»ç»Ÿä¿¡æ¯" echo &#39;```&#39; uname -a echo &#39;```&#39; echo echo "## CPU æ€§èƒ½" echo &#39;```&#39; cat "$RESULTS_DIR/cpu_benchmark.txt" echo &#39;```&#39; echo echo "## å†…å­˜æ€§èƒ½" echo &#39;```&#39; cat "$RESULTS_DIR/memory_benchmark.txt" echo &#39;```&#39; echo echo "## ç£ç›˜æ€§èƒ½" echo &#39;```&#39; cat "$RESULTS_DIR/disk_write_benchmark.txt" cat "$RESULTS_DIR/disk_read_benchmark.txt" echo &#39;```&#39; echo echo "## ç½‘ç»œæ€§èƒ½" echo &#39;```&#39; cat "$RESULTS_DIR/network_benchmark.txt" echo &#39;```&#39; echo echo "## Web æœåŠ¡æ€§èƒ½" echo &#39;```&#39; cat "$RESULTS_DIR/web_benchmark.txt" echo &#39;```&#39; echo echo "## AI æœåŠ¡æ€§èƒ½" echo &#39;```&#39; cat "$RESULTS_DIR/ai_benchmark.txt" echo &#39;```&#39; } > "$report_file" log "æ€§èƒ½æµ‹è¯•æŠ¥å‘Šå·²ç”Ÿæˆ: $report_file" } # ä¸»å‡½æ•° main() { log "å¼€å§‹æ€§èƒ½æµ‹è¯•..." # å®‰è£…å¿…è¦çš„å·¥å…· sudo apt install -y sysbench apache2-utils iperf3 # æ‰§è¡Œå„é¡¹æµ‹è¯• benchmark_cpu benchmark_memory benchmark_disk benchmark_network benchmark_web benchmark_ai # ç”ŸæˆæŠ¥å‘Š generate_report log "æ€§èƒ½æµ‹è¯•å®Œæˆ" } # æ‰§è¡Œæµ‹è¯• main äºŒåä¸ƒã€å®‰å…¨å®¡è®¡ç³»ç»Ÿ 1. å®‰å…¨å®¡è®¡è„šæœ¬ # åˆ›å»ºå®‰å…¨å®¡è®¡è„šæœ¬ nano ~/security_audit.sh #!/bin/bash # ~/security_audit.sh # é…ç½® AUDIT_DIR="/home/zhaoxiongzhou/security_audits" REPORT_FILE="$AUDIT_DIR/security_report_$(date +%Y%m%d_%H%M%S).md" LOG_FILE="/var/log/security_audit.log" # ç¡®ä¿ç›®å½•å­˜åœ¨ mkdir -p "$AUDIT_DIR" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # æ£€æŸ¥ç³»ç»Ÿç”¨æˆ· audit_users() { log "æ£€æŸ¥ç³»ç»Ÿç”¨æˆ·..." { echo "## ç³»ç»Ÿç”¨æˆ·å®¡è®¡" echo "### ç‰¹æƒç”¨æˆ·" echo &#39;```&#39; awk -F: &#39;$3 == 0 {print $1}&#39; /etc/passwd echo &#39;```&#39; echo "### æœ€è¿‘çš„ç”¨æˆ·æ´»åŠ¨" echo &#39;```&#39; last | head -n 10 echo &#39;```&#39; echo "### å¤±è´¥çš„ç™»å½•å°è¯•" echo &#39;```&#39; grep "Failed password" /var/log/auth.log | tail -n 10 echo &#39;```&#39; } >> "$REPORT_FILE" } # æ£€æŸ¥ç½‘ç»œå®‰å…¨ audit_network() { log "æ£€æŸ¥ç½‘ç»œå®‰å…¨..." { echo "## ç½‘ç»œå®‰å…¨å®¡è®¡" echo "### å¼€æ”¾ç«¯å£" echo &#39;```&#39; netstat -tuln echo &#39;```&#39; echo "### æ´»åŠ¨è¿æ¥" echo &#39;```&#39; netstat -nat | grep ESTABLISHED echo &#39;```&#39; echo "### é˜²ç«å¢™è§„åˆ™" echo &#39;```&#39; sudo iptables -L -n echo &#39;```&#39; } >> "$REPORT_FILE" } # æ£€æŸ¥æ–‡ä»¶æƒé™ audit_permissions() { log "æ£€æŸ¥æ–‡ä»¶æƒé™..." { echo "## æ–‡ä»¶æƒé™å®¡è®¡" echo "### SUID æ–‡ä»¶" echo &#39;```&#39; sudo find / -type f -perm -4000 2>/dev/null echo &#39;```&#39; echo "### ä¸–ç•Œå¯å†™æ–‡ä»¶" echo &#39;```&#39; sudo find / -type f -perm -2 ! -path "/proc/*" ! -path "/sys/*" 2>/dev/null echo &#39;```&#39; echo "### æ•æ„Ÿç›®å½•æƒé™" echo &#39;```&#39; ls -la /etc/nginx/ ls -la ~/projects/llama.cpp/ ls -la ~/myblog/ echo &#39;```&#39; } >> "$REPORT_FILE" } # æ£€æŸ¥æœåŠ¡é…ç½® audit_services() { log "æ£€æŸ¥æœåŠ¡é…ç½®..." { echo "## æœåŠ¡é…ç½®å®¡è®¡" echo "### Nginx é…ç½®æ£€æŸ¥" echo &#39;```&#39; sudo nginx -t 2>&amp;1 echo &#39;```&#39; echo "### SSL é…ç½®" echo &#39;```&#39; openssl s_client -connect localhost:443 -servername localhost </dev/null 2>/dev/null | openssl x509 -text echo &#39;```&#39; echo "### æœåŠ¡çŠ¶æ€" echo &#39;```&#39; systemctl list-units --type=service --state=active echo &#39;```&#39; } >> "$REPORT_FILE" } # æ£€æŸ¥ç³»ç»Ÿæ›´æ–° audit_updates() { log "æ£€æŸ¥ç³»ç»Ÿæ›´æ–°..." { echo "## ç³»ç»Ÿæ›´æ–°å®¡è®¡" echo "### å¯ç”¨æ›´æ–°" echo &#39;```&#39; apt list --upgradable 2>/dev/null echo &#39;```&#39; echo "### å·²å®‰è£…åŒ…" echo &#39;```&#39; dpkg -l | grep "^ii" | wc -l echo &#39;```&#39; } >> "$REPORT_FILE" } # æ£€æŸ¥æ—¥å¿—å¼‚å¸¸ audit_logs() { log "æ£€æŸ¥æ—¥å¿—å¼‚å¸¸..." { echo "## æ—¥å¿—å®¡è®¡" echo "### ç³»ç»Ÿé”™è¯¯" echo &#39;```&#39; sudo journalctl -p 3 -xb --no-pager | tail -n 20 echo &#39;```&#39; echo "### å¼‚å¸¸è®¿é—®" echo &#39;```&#39; grep -i "error\|failed\|warning" /var/log/nginx/error.log | tail -n 20 echo &#39;```&#39; } >> "$REPORT_FILE" } # ç”Ÿæˆå®‰å…¨å»ºè®® generate_recommendations() { log "ç”Ÿæˆå®‰å…¨å»ºè®®..." { echo "## å®‰å…¨å»ºè®®" echo "### é«˜ä¼˜å…ˆçº§" # æ£€æŸ¥å¹¶ç”Ÿæˆå»ºè®® if grep -q "Failed password" /var/log/auth.log; then echo "- å»ºè®®ï¼šå¯ç”¨ fail2ban åŠ å¼º SSH é˜²æŠ¤" fi if [ $(find / -type f -perm -2 2>/dev/null | wc -l) -gt 0 ]; then echo "- å»ºè®®ï¼šæ£€æŸ¥å¹¶ä¿®å¤ä¸–ç•Œå¯å†™æ–‡ä»¶æƒé™" fi echo "### ä¸­ä¼˜å…ˆçº§" # æ·»åŠ å…¶ä»–å»ºè®® echo "- å®šæœŸæ›´æ–°ç³»ç»ŸåŒ…" echo "- æ£€æŸ¥å¹¶æ›´æ–° SSL è¯ä¹¦" echo "- å®šæœŸå®¡æŸ¥ç”¨æˆ·æƒé™" } >> "$REPORT_FILE" } # ä¸»å‡½æ•° main() { log "å¼€å§‹å®‰å…¨å®¡è®¡..." # åˆ›å»ºæŠ¥å‘Šå¤´éƒ¨ { echo "# å®‰å…¨å®¡è®¡æŠ¥å‘Š" echo "## ç”Ÿæˆæ—¶é—´: $(date &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo "## ç³»ç»Ÿä¿¡æ¯" echo &#39;```&#39; uname -a echo &#39;```&#39; echo } > "$REPORT_FILE" # æ‰§è¡Œå„é¡¹å®¡è®¡ audit_users audit_network audit_permissions audit_services audit_updates audit_logs generate_recommendations log "å®‰å…¨å®¡è®¡å®Œæˆï¼ŒæŠ¥å‘Šå·²ç”Ÿæˆ: $REPORT_FILE" # å‘é€é€šçŸ¥ ~/send_notification.sh "å®‰å…¨å®¡è®¡æŠ¥å‘Šå·²ç”Ÿæˆ" "normal" } # æ‰§è¡Œå®¡è®¡ main äºŒåå…«ã€èµ„æºé™åˆ¶ä¸æ§åˆ¶ 1. èµ„æºé™åˆ¶é…ç½®è„šæœ¬ # åˆ›å»ºèµ„æºé™åˆ¶é…ç½®è„šæœ¬ nano ~/resource_control.sh #!/bin/bash # ~/resource_control.sh # é…ç½® LOG_FILE="/var/log/resource_control.log" LIMITS_CONF="/etc/security/limits.conf" SYSTEMD_DIR="/etc/systemd/system" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # é…ç½®ç³»ç»Ÿèµ„æºé™åˆ¶ configure_system_limits() { log "é…ç½®ç³»ç»Ÿèµ„æºé™åˆ¶..." # å¤‡ä»½åŸå§‹é…ç½® sudo cp "$LIMITS_CONF" "${LIMITS_CONF}.backup" # æ·»åŠ èµ„æºé™åˆ¶é…ç½® sudo tee -a "$LIMITS_CONF" << EOF # ç”¨æˆ·èµ„æºé™åˆ¶ zhaoxiongzhou soft nofile 65535 zhaoxiongzhou hard nofile 65535 zhaoxiongzhou soft nproc 2048 zhaoxiongzhou hard nproc 4096 # ç³»ç»ŸæœåŠ¡èµ„æºé™åˆ¶ www-data soft nofile 65535 www-data hard nofile 65535 www-data soft nproc 1024 www-data hard nproc 2048 EOF } # é…ç½® AI æœåŠ¡èµ„æºé™åˆ¶ configure_ai_service() { log "é…ç½® AI æœåŠ¡èµ„æºé™åˆ¶..." # åˆ›å»º systemd æœåŠ¡æ–‡ä»¶ sudo tee "$SYSTEMD_DIR/llama-server.service" << EOF [Unit] Description=Llama AI Server After=network.target [Service] User=zhaoxiongzhou Group=zhaoxiongzhou WorkingDirectory=/home/zhaoxiongzhou/projects/llama.cpp ExecStart=/home/zhaoxiongzhou/projects/llama.cpp/start-llama.sh # èµ„æºé™åˆ¶ CPUQuota=80% MemoryLimit=2G TasksMax=128 LimitNOFILE=65535 # é‡å¯ç­–ç•¥ Restart=always RestartSec=10 [Install] WantedBy=multi-user.target EOF # é‡æ–°åŠ è½½ systemd é…ç½® sudo systemctl daemon-reload } # é…ç½® Nginx èµ„æºé™åˆ¶ configure_nginx() { log "é…ç½® Nginx èµ„æºé™åˆ¶..." # ä¿®æ”¹ Nginx é…ç½® sudo tee "/etc/nginx/conf.d/resource_limits.conf" << EOF # å·¥ä½œè¿›ç¨‹é™åˆ¶ worker_processes auto; worker_rlimit_nofile 65535; # è¿æ¥é™åˆ¶ events { worker_connections 1024; multi_accept on; } # å®¢æˆ·ç«¯é™åˆ¶ http { # è¯·æ±‚é™åˆ¶ limit_req_zone \$binary_remote_addr zone=one:10m rate=10r/s; # è¿æ¥é™åˆ¶ limit_conn_zone \$binary_remote_addr zone=addr:10m; server { # åº”ç”¨é™åˆ¶ location / { limit_req zone=one burst=5; limit_conn addr 10; } } } EOF } # é…ç½®ç³»ç»Ÿèµ„æºç›‘æ§ configure_monitoring() { log "é…ç½®èµ„æºç›‘æ§..." # åˆ›å»ºç›‘æ§è„šæœ¬ cat > ~/monitor_resources.sh << EOF #!/bin/bash while true; do # CPU ä½¿ç”¨ç‡ CPU_USAGE=\$(top -bn1 | grep "Cpu(s)" | awk &#39;{print \$2}&#39;) # å†…å­˜ä½¿ç”¨ç‡ MEM_USAGE=\$(free | grep Mem | awk &#39;{print \$3/\$2 * 100.0}&#39;) # è¿›ç¨‹æ•° PROCESS_COUNT=\$(ps aux | wc -l) # æ£€æŸ¥é™åˆ¶ if (( \$(echo "\$CPU_USAGE > 80" | bc -l) )); then ~/send_notification.sh "è­¦å‘Š: CPU ä½¿ç”¨ç‡è¿‡é«˜ (\${CPU_USAGE}%)" "high" fi if (( \$(echo "\$MEM_USAGE > 90" | bc -l) )); then ~/send_notification.sh "è­¦å‘Š: å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜ (\${MEM_USAGE}%)" "high" fi if [ "\$PROCESS_COUNT" -gt 200 ]; then ~/send_notification.sh "è­¦å‘Š: è¿›ç¨‹æ•°è¿‡å¤š (\$PROCESS_COUNT)" "high" fi sleep 60 done EOF chmod +x ~/monitor_resources.sh } # åº”ç”¨é…ç½® apply_configurations() { log "åº”ç”¨èµ„æºé™åˆ¶é…ç½®..." # é‡å¯æœåŠ¡ sudo systemctl restart nginx sudo systemctl restart llama-server # å¯åŠ¨ç›‘æ§ ~/monitor_resources.sh & # éªŒè¯é…ç½® log "éªŒè¯é…ç½®..." sudo nginx -t sudo systemctl status llama-server ulimit -a } # ä¸»å‡½æ•° main() { log "å¼€å§‹é…ç½®èµ„æºé™åˆ¶..." configure_system_limits configure_ai_service configure_nginx configure_monitoring apply_configurations log "èµ„æºé™åˆ¶é…ç½®å®Œæˆ" } # æ‰§è¡Œé…ç½® main äºŒåä¹ã€è‡ªåŠ¨åŒ–æµ‹è¯•ç³»ç»Ÿ 1. é›†æˆæµ‹è¯•è„šæœ¬ # åˆ›å»ºé›†æˆæµ‹è¯•è„šæœ¬ nano ~/integration_test.sh #!/bin/bash # ~/integration_test.sh # é…ç½® TEST_DIR="/home/zhaoxiongzhou/tests" REPORT_DIR="/home/zhaoxiongzhou/test_reports" LOG_FILE="/var/log/integration_test.log" # ç¡®ä¿ç›®å½•å­˜åœ¨ mkdir -p "$TEST_DIR" "$REPORT_DIR" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # æµ‹è¯• Web æœåŠ¡ test_web_service() { log "æµ‹è¯• Web æœåŠ¡..." local result=0 # æµ‹è¯•é¦–é¡µè®¿é—® if curl -s -o /dev/null -w "%{http_code}" http://localhost/ | grep -q "200"; then log "é¦–é¡µè®¿é—®æµ‹è¯•é€šè¿‡" else log "é”™è¯¯: é¦–é¡µè®¿é—®æµ‹è¯•å¤±è´¥" result=1 fi # æµ‹è¯•é™æ€èµ„æº if curl -s -o /dev/null -w "%{http_code}" http://localhost/css/main.css | grep -q "200"; then log "é™æ€èµ„æºæµ‹è¯•é€šè¿‡" else log "é”™è¯¯: é™æ€èµ„æºæµ‹è¯•å¤±è´¥" result=1 fi # æµ‹è¯• 404 é¡µé¢ if curl -s -o /dev/null -w "%{http_code}" http://localhost/nonexistent | grep -q "404"; then log "404 é¡µé¢æµ‹è¯•é€šè¿‡" else log "é”™è¯¯: 404 é¡µé¢æµ‹è¯•å¤±è´¥" result=1 fi return $result } # æµ‹è¯• AI æœåŠ¡ test_ai_service() { log "æµ‹è¯• AI æœåŠ¡..." local result=0 # æµ‹è¯•æœåŠ¡å¯ç”¨æ€§ if curl -s -o /dev/null -w "%{http_code}" http://localhost:8080/health | grep -q "200"; then log "AI æœåŠ¡å¥åº·æ£€æŸ¥é€šè¿‡" else log "é”™è¯¯: AI æœåŠ¡å¥åº·æ£€æŸ¥å¤±è´¥" result=1 fi # æµ‹è¯•æ¨¡å‹å“åº” local response=$(curl -s -X POST \ -H "Content-Type: application/json" \ -d &#39;{"prompt": "Hello", "max_tokens": 10}&#39; \ http://localhost:8080/completion) if echo "$response" | grep -q "text"; then log "AI æœåŠ¡å“åº”æµ‹è¯•é€šè¿‡" else log "é”™è¯¯: AI æœåŠ¡å“åº”æµ‹è¯•å¤±è´¥" result=1 fi return $result } # æµ‹è¯•ç³»ç»ŸæœåŠ¡ test_system_services() { log "æµ‹è¯•ç³»ç»ŸæœåŠ¡..." local result=0 # æµ‹è¯• Nginx çŠ¶æ€ if systemctl is-active --quiet nginx; then log "Nginx æœåŠ¡æµ‹è¯•é€šè¿‡" else log "é”™è¯¯: Nginx æœåŠ¡æµ‹è¯•å¤±è´¥" result=1 fi # æµ‹è¯•ç³»ç»Ÿèµ„æº local cpu_usage=$(top -bn1 | grep "Cpu(s)" | awk &#39;{print $2}&#39;) local mem_usage=$(free | grep Mem | awk &#39;{print $3/$2 * 100.0}&#39;) if [ $(echo "$cpu_usage < 90" | bc -l) -eq 1 ]; then log "CPU ä½¿ç”¨ç‡æ­£å¸¸" else log "è­¦å‘Š: CPU ä½¿ç”¨ç‡è¿‡é«˜" result=1 fi if [ $(echo "$mem_usage < 90" | bc -l) -eq 1 ]; then log "å†…å­˜ä½¿ç”¨ç‡æ­£å¸¸" else log "è­¦å‘Š: å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜" result=1 fi return $result } # ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š generate_report() { local web_result=$1 local ai_result=$2 local system_result=$3 local report_file="$REPORT_DIR/test_report_$(date +%Y%m%d_%H%M%S).md" { echo "# é›†æˆæµ‹è¯•æŠ¥å‘Š" echo "## æµ‹è¯•æ—¶é—´: $(date &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo echo "## æµ‹è¯•ç»“æœæ‘˜è¦" echo "- Web æœåŠ¡: $([ $web_result -eq 0 ] && echo &#39;é€šè¿‡ âœ…&#39; || echo &#39;å¤±è´¥ âŒ&#39;)" echo "- AI æœåŠ¡: $([ $ai_result -eq 0 ] && echo &#39;é€šè¿‡ âœ…&#39; || echo &#39;å¤±è´¥ âŒ&#39;)" echo "- ç³»ç»ŸæœåŠ¡: $([ $system_result -eq 0 ] && echo &#39;é€šè¿‡ âœ…&#39; || echo &#39;å¤±è´¥ âŒ&#39;)" echo echo "## è¯¦ç»†æ—¥å¿—" echo &#39;```&#39; tail -n 50 "$LOG_FILE" echo &#39;```&#39; } > "$report_file" log "æµ‹è¯•æŠ¥å‘Šå·²ç”Ÿæˆ: $report_file" } # ä¸»å‡½æ•° main() { log "å¼€å§‹é›†æˆæµ‹è¯•..." local web_result=0 local ai_result=0 local system_result=0 # æ‰§è¡Œæµ‹è¯• test_web_service web_result=$? test_ai_service ai_result=$? test_system_services system_result=$? # ç”ŸæˆæŠ¥å‘Š generate_report $web_result $ai_result $system_result # å‘é€é€šçŸ¥ if [ $web_result -eq 0 ] && [ $ai_result -eq 0 ] && [ $system_result -eq 0 ]; then ~/send_notification.sh "é›†æˆæµ‹è¯•å…¨éƒ¨é€šè¿‡" "normal" else ~/send_notification.sh "é›†æˆæµ‹è¯•å­˜åœ¨å¤±è´¥é¡¹ï¼Œè¯·æŸ¥çœ‹æŠ¥å‘Š" "high" fi # è¿”å›æ€»ä½“ç»“æœ return $(( web_result + ai_result + system_result )) } # æ‰§è¡Œæµ‹è¯• main ä¸‰åã€ç³»ç»ŸçŠ¶æ€ä»ªè¡¨æ¿ 1. çŠ¶æ€ç›‘æ§é¡µé¢ç”Ÿæˆè„šæœ¬ # åˆ›å»ºçŠ¶æ€é¡µé¢ç”Ÿæˆè„šæœ¬ nano ~/generate_dashboard.sh #!/bin/bash # ~/generate_dashboard.sh # é…ç½® DASHBOARD_DIR="/var/www/html/dashboard" REFRESH_INTERVAL=60 # é¡µé¢åˆ·æ–°é—´éš”ï¼ˆç§’ï¼‰ LOG_FILE="/var/log/dashboard.log" # ç¡®ä¿ç›®å½•å­˜åœ¨ sudo mkdir -p "$DASHBOARD_DIR" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # æ”¶é›†ç³»ç»ŸçŠ¶æ€æ•°æ® collect_system_data() { # CPU ä¿¡æ¯ CPU_USAGE=$(top -bn1 | grep "Cpu(s)" | awk &#39;{print $2}&#39;) CPU_TEMP=$(vcgencmd measure_temp | sed &#39;s/temp=//&#39; | sed &#39;s/&#39;"&#39;"&#39;C//&#39;) # å†…å­˜ä¿¡æ¯ MEM_TOTAL=$(free -m | awk &#39;/Mem:/ {print $2}&#39;) MEM_USED=$(free -m | awk &#39;/Mem:/ {print $3}&#39;) MEM_USAGE=$(awk "BEGIN {printf \"%.2f\", $MEM_USED/$MEM_TOTAL*100}") # ç£ç›˜ä¿¡æ¯ DISK_USAGE=$(df -h / | awk &#39;NR==2 {print $5}&#39; | sed &#39;s/%//&#39;) # ç³»ç»Ÿè´Ÿè½½ LOAD_AVG=$(uptime | awk -F&#39;load average:&#39; &#39;{print $2}&#39; | xargs) # è¿è¡Œæ—¶é—´ UPTIME=$(uptime -p) } # æ”¶é›†æœåŠ¡çŠ¶æ€ collect_service_data() { # Nginx çŠ¶æ€ if systemctl is-active --quiet nginx; then NGINX_STATUS="è¿è¡Œä¸­ âœ…" else NGINX_STATUS="å·²åœæ­¢ âŒ" fi # AI æœåŠ¡çŠ¶æ€ if pgrep -f llama-server > /dev/null; then AI_STATUS="è¿è¡Œä¸­ âœ…" else AI_STATUS="å·²åœæ­¢ âŒ" fi # è·å–æœ€è¿‘çš„æ—¥å¿— RECENT_LOGS=$(tail -n 10 /var/log/syslog | sed &#39;s/</\&amp;lt;/g&#39; | sed &#39;s/>/\&amp;gt;/g&#39;) } # ç”ŸæˆçŠ¶æ€é¡µé¢ generate_dashboard() { local timestamp=$(date &#39;+%Y-%m-%d %H:%M:%S&#39;) cat > "$DASHBOARD_DIR/index.html" << EOF <!DOCTYPE html> <html lang="zh"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>ç³»ç»ŸçŠ¶æ€ä»ªè¡¨æ¿</title> <meta http-equiv="refresh" content="$REFRESH_INTERVAL"> <style> body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; } .container { max-width: 1200px; margin: 0 auto; } .card { background: white; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); } .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; } .metric { text-align: center; padding: 15px; border-radius: 4px; background: #f8f9fa; } .metric h3 { margin: 0; color: #666; } .metric .value { font-size: 24px; font-weight: bold; margin: 10px 0; } .status { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee; } .logs { background: #2b2b2b; color: #fff; padding: 15px; border-radius: 4px; font-family: monospace; white-space: pre-wrap; } </style> </head> <body> <div class="container"> <h1>ç³»ç»ŸçŠ¶æ€ä»ªè¡¨æ¿</h1> <p>æœ€åæ›´æ–°: $timestamp</p> <div class="card"> <h2>ç³»ç»Ÿèµ„æº</h2> <div class="grid"> <div class="metric"> <h3>CPU ä½¿ç”¨ç‡</h3> <div class="value">$CPU_USAGE%</div> </div> <div class="metric"> <h3>CPU æ¸©åº¦</h3> <div class="value">$CPU_TEMP</div> </div> <div class="metric"> <h3>å†…å­˜ä½¿ç”¨ç‡</h3> <div class="value">$MEM_USAGE%</div> </div> <div class="metric"> <h3>ç£ç›˜ä½¿ç”¨ç‡</h3> <div class="value">$DISK_USAGE%</div> </div> </div> </div> <div class="card"> <h2>ç³»ç»Ÿä¿¡æ¯</h2> <div class="status"> <span>ç³»ç»Ÿè´Ÿè½½:</span> <span>$LOAD_AVG</span> </div> <div class="status"> <span>è¿è¡Œæ—¶é—´:</span> <span>$UPTIME</span> </div> </div> <div class="card"> <h2>æœåŠ¡çŠ¶æ€</h2> <div class="status"> <span>Nginx æœåŠ¡:</span> <span>$NGINX_STATUS</span> </div> <div class="status"> <span>AI æœåŠ¡:</span> <span>$AI_STATUS</span> </div> </div> <div class="card"> <h2>æœ€è¿‘æ—¥å¿—</h2> <div class="logs">$RECENT_LOGS</div> </div> </div> </body> </html> EOF # è®¾ç½®æƒé™ sudo chown www-data:www-data "$DASHBOARD_DIR/index.html" } # ä¸»å‡½æ•° main() { log "å¼€å§‹ç”ŸæˆçŠ¶æ€ä»ªè¡¨æ¿..." # æ”¶é›†æ•°æ® collect_system_data collect_service_data # ç”Ÿæˆé¡µé¢ generate_dashboard log "çŠ¶æ€ä»ªè¡¨æ¿å·²æ›´æ–°" } # æ‰§è¡Œç”Ÿæˆ main ä¸‰åä¸€ã€ç³»ç»Ÿå¤‡ä»½ä¸æ¢å¤å®Œæ•´æ–¹æ¡ˆ 1. å®Œæ•´å¤‡ä»½è„šæœ¬ # åˆ›å»ºå®Œæ•´å¤‡ä»½è„šæœ¬ nano ~/full_backup.sh #!/bin/bash # ~/full_backup.sh # é…ç½® BACKUP_ROOT="/mnt/backup_drive" BACKUP_DIR="$BACKUP_ROOT/system_backups" EXCLUDE_FILE="/home/zhaoxiongzhou/backup_exclude.txt" LOG_FILE="/var/log/backup.log" RETENTION_DAYS=30 COMPRESSION_LEVEL=6 # ç¡®ä¿å¤‡ä»½ç›®å½•å­˜åœ¨ mkdir -p "$BACKUP_DIR" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # æ£€æŸ¥å¤‡ä»½ç¯å¢ƒ check_environment() { log "æ£€æŸ¥å¤‡ä»½ç¯å¢ƒ..." # æ£€æŸ¥å¤‡ä»½ç›®æ ‡ç›®å½• if ! mountpoint -q "$BACKUP_ROOT"; then log "é”™è¯¯: å¤‡ä»½é©±åŠ¨å™¨æœªæŒ‚è½½" return 1 fi # æ£€æŸ¥å¯ç”¨ç©ºé—´ local available_space=$(df -BG "$BACKUP_ROOT" | awk &#39;NR==2 {print $4}&#39; | sed &#39;s/G//&#39;) if [ "$available_space" -lt 10 ]; then log "é”™è¯¯: å¤‡ä»½ç©ºé—´ä¸è¶³ï¼ˆå°äº 10GBï¼‰" return 1 fi # åˆ›å»ºæ’é™¤æ–‡ä»¶ cat > "$EXCLUDE_FILE" << EOF /proc/* /sys/* /tmp/* /run/* /mnt/* /media/* /lost+found /var/cache/* /var/tmp/* /var/log/* /home/*/Downloads/* /home/*/.cache/* EOF return 0 } # åœæ­¢æœåŠ¡ stop_services() { log "åœæ­¢æœåŠ¡..." # åœæ­¢ Nginx sudo systemctl stop nginx # åœæ­¢ AI æœåŠ¡ pkill llama-server # ç­‰å¾…æœåŠ¡å®Œå…¨åœæ­¢ sleep 5 } # å¯åŠ¨æœåŠ¡ start_services() { log "å¯åŠ¨æœåŠ¡..." # å¯åŠ¨ Nginx sudo systemctl start nginx # å¯åŠ¨ AI æœåŠ¡ ~/projects/llama.cpp/start-llama.sh # éªŒè¯æœåŠ¡çŠ¶æ€ sleep 10 if ! systemctl is-active --quiet nginx; then log "è­¦å‘Š: Nginx æœåŠ¡æœªèƒ½æ­£å¸¸å¯åŠ¨" fi if ! pgrep -f llama-server > /dev/null; then log "è­¦å‘Š: AI æœåŠ¡æœªèƒ½æ­£å¸¸å¯åŠ¨" fi } # åˆ›å»ºå®Œæ•´å¤‡ä»½ create_full_backup() { local backup_date=$(date +%Y%m%d_%H%M%S) local backup_file="$BACKUP_DIR/full_backup_${backup_date}.tar.gz" local manifest_file="$BACKUP_DIR/backup_manifest_${backup_date}.txt" log "å¼€å§‹åˆ›å»ºå®Œæ•´å¤‡ä»½..." # åˆ›å»ºæ–‡ä»¶æ¸…å• log "ç”Ÿæˆæ–‡ä»¶æ¸…å•..." find / -xdev -type f ! -path "$(cat $EXCLUDE_FILE | tr &#39;\n&#39; &#39;|&#39;)" > "$manifest_file" # åˆ›å»ºå¤‡ä»½ log "åˆ›å»ºç³»ç»Ÿå¤‡ä»½..." sudo tar -czf "$backup_file" \ --exclude-from="$EXCLUDE_FILE" \ --one-file-system \ --preserve-permissions \ --numeric-owner \ --checkpoint=1000 \ --checkpoint-action=dot \ -C / . # éªŒè¯å¤‡ä»½ if ! tar -tzf "$backup_file" >/dev/null 2>&amp;1; then log "é”™è¯¯: å¤‡ä»½æ–‡ä»¶éªŒè¯å¤±è´¥" return 1 fi # è®¡ç®—æ ¡éªŒå’Œ log "è®¡ç®—æ ¡éªŒå’Œ..." sha256sum "$backup_file" > "${backup_file}.sha256" # åˆ›å»ºå¤‡ä»½ä¿¡æ¯æ–‡ä»¶ cat > "${backup_file}.info" << EOF å¤‡ä»½æ—¶é—´: $(date) ç³»ç»Ÿç‰ˆæœ¬: $(cat /etc/os-release | grep PRETTY_NAME) å†…æ ¸ç‰ˆæœ¬: $(uname -r) å¤‡ä»½å¤§å°: $(du -h "$backup_file" | cut -f1) æ–‡ä»¶æ•°é‡: $(wc -l < "$manifest_file") æ’é™¤è§„åˆ™: $(cat "$EXCLUDE_FILE") EOF return 0 } # æ¸…ç†æ—§å¤‡ä»½ cleanup_old_backups() { log "æ¸…ç†æ—§å¤‡ä»½..." find "$BACKUP_DIR" -type f -name "full_backup_*" -mtime +$RETENTION_DAYS -delete find "$BACKUP_DIR" -type f -name "backup_manifest_*" -mtime +$RETENTION_DAYS -delete find "$BACKUP_DIR" -type f -name "*.sha256" -mtime +$RETENTION_DAYS -delete find "$BACKUP_DIR" -type f -name "*.info" -mtime +$RETENTION_DAYS -delete } # ä¸»å‡½æ•° main() { log "å¼€å§‹å®Œæ•´å¤‡ä»½æµç¨‹..." # æ£€æŸ¥ç¯å¢ƒ if ! check_environment; then log "å¤‡ä»½ç¯å¢ƒæ£€æŸ¥å¤±è´¥ï¼Œç»ˆæ­¢å¤‡ä»½" ~/send_notification.sh "ç³»ç»Ÿå¤‡ä»½å¤±è´¥ï¼šç¯å¢ƒæ£€æŸ¥æœªé€šè¿‡" "high" return 1 fi # åœæ­¢æœåŠ¡ stop_services # åˆ›å»ºå¤‡ä»½ if create_full_backup; then log "å¤‡ä»½åˆ›å»ºæˆåŠŸ" ~/send_notification.sh "ç³»ç»Ÿå®Œæ•´å¤‡ä»½å·²æˆåŠŸåˆ›å»º" "normal" else log "å¤‡ä»½åˆ›å»ºå¤±è´¥" ~/send_notification.sh "ç³»ç»Ÿå¤‡ä»½å¤±è´¥ï¼šå¤‡ä»½åˆ›å»ºè¿‡ç¨‹å‡ºé”™" "high" fi # å¯åŠ¨æœåŠ¡ start_services # æ¸…ç†æ—§å¤‡ä»½ cleanup_old_backups log "å¤‡ä»½æµç¨‹å®Œæˆ" } # æ‰§è¡Œå¤‡ä»½ main ä¸‰åäºŒã€ç³»ç»Ÿæ¢å¤è„šæœ¬ 1. ç³»ç»Ÿæ¢å¤è„šæœ¬ # åˆ›å»ºç³»ç»Ÿæ¢å¤è„šæœ¬ nano ~/system_restore.sh #!/bin/bash # ~/system_restore.sh # é…ç½® BACKUP_ROOT="/mnt/backup_drive" BACKUP_DIR="$BACKUP_ROOT/system_backups" LOG_FILE="/var/log/restore.log" TEMP_DIR="/tmp/restore_temp" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # éªŒè¯å¤‡ä»½æ–‡ä»¶ verify_backup() { local backup_file="$1" log "éªŒè¯å¤‡ä»½æ–‡ä»¶: $backup_file" # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ if [ ! -f "$backup_file" ]; then log "é”™è¯¯: å¤‡ä»½æ–‡ä»¶ä¸å­˜åœ¨" return 1 fi # æ£€æŸ¥æ ¡éªŒå’Œ local checksum_file="${backup_file}.sha256" if [ -f "$checksum_file" ]; then if ! sha256sum -c "$checksum_file"; then log "é”™è¯¯: å¤‡ä»½æ–‡ä»¶æ ¡éªŒå’ŒéªŒè¯å¤±è´¥" return 1 fi else log "è­¦å‘Š: æœªæ‰¾åˆ°æ ¡éªŒå’Œæ–‡ä»¶" fi # æµ‹è¯•å½’æ¡£å®Œæ•´æ€§ if ! tar -tzf "$backup_file" >/dev/null 2>&amp;1; then log "é”™è¯¯: å¤‡ä»½æ–‡ä»¶æŸå" return 1 fi return 0 } # å‡†å¤‡æ¢å¤ç¯å¢ƒ prepare_environment() { log "å‡†å¤‡æ¢å¤ç¯å¢ƒ..." # åˆ›å»ºä¸´æ—¶ç›®å½• mkdir -p "$TEMP_DIR" # åœæ­¢æ‰€æœ‰æœåŠ¡ log "åœæ­¢æœåŠ¡..." sudo systemctl stop nginx pkill llama-server # ç­‰å¾…æœåŠ¡åœæ­¢ sleep 5 # æ¸…ç†ç›®æ ‡ç›®å½• log "æ¸…ç†ç›®æ ‡ç›®å½•..." read -p "è­¦å‘Š: è¿™å°†æ¸…é™¤ç³»ç»Ÿæ–‡ä»¶ã€‚ç¡®å®šè¦ç»§ç»­å—ï¼Ÿ(y/n) " -n 1 -r echo if [[ ! $REPLY =~ ^[Yy]$ ]]; then log "ç”¨æˆ·å–æ¶ˆæ“ä½œ" return 1 fi return 0 } # æ‰§è¡Œæ¢å¤ perform_restore() { local backup_file="$1" log "å¼€å§‹æ¢å¤ç³»ç»Ÿ..." # åˆ›å»ºæ¢å¤å‰çš„å¿«ç…§ log "åˆ›å»ºå½“å‰ç³»ç»Ÿå¿«ç…§..." local snapshot_date=$(date +%Y%m%d_%H%M%S) local snapshot_file="$BACKUP_DIR/pre_restore_snapshot_${snapshot_date}.tar.gz" sudo tar -czf "$snapshot_file" \ --exclude-from="/home/zhaoxiongzhou/backup_exclude.txt" \ --one-file-system \ -C / . # è§£å‹å¤‡ä»½ log "è§£å‹å¤‡ä»½æ–‡ä»¶..." sudo tar -xzf "$backup_file" -C / \ --numeric-owner \ --preserve-permissions \ --checkpoint=1000 \ --checkpoint-action=dot # ä¿®å¤æƒé™ log "ä¿®å¤æ–‡ä»¶æƒé™..." sudo chown -R www-data:www-data /var/www/ sudo chown -R zhaoxiongzhou:zhaoxiongzhou /home/zhaoxiongzhou/ return 0 } # æ¢å¤æœåŠ¡é…ç½® restore_configurations() { log "æ¢å¤æœåŠ¡é…ç½®..." # é‡æ–°åŠ è½½ç³»ç»Ÿé…ç½® sudo systemctl daemon-reload sudo sysctl --system # é‡æ–°é…ç½®ç½‘ç»œ sudo systemctl restart networking # æ¢å¤é˜²ç«å¢™è§„åˆ™ sudo iptables-restore < /etc/iptables/rules.v4 return 0 } # éªŒè¯æ¢å¤ verify_restore() { log "éªŒè¯ç³»ç»Ÿæ¢å¤..." local status=0 # æ£€æŸ¥å…³é”®æ–‡ä»¶ for file in "/etc/nginx/nginx.conf" "/etc/systemd/system/llama-server.service"; do if [ ! -f "$file" ]; then log "é”™è¯¯: æœªæ‰¾åˆ°å…³é”®æ–‡ä»¶ $file" status=1 fi done # å¯åŠ¨æœåŠ¡ sudo systemctl start nginx ~/projects/llama.cpp/start-llama.sh # éªŒè¯æœåŠ¡çŠ¶æ€ sleep 10 if ! systemctl is-active --quiet nginx; then log "é”™è¯¯: Nginx æœåŠ¡æœªèƒ½æ­£å¸¸å¯åŠ¨" status=1 fi if ! pgrep -f llama-server > /dev/null; then log "é”™è¯¯: AI æœåŠ¡æœªèƒ½æ­£å¸¸å¯åŠ¨" status=1 fi return $status } # æ¸…ç†æ¢å¤ç¯å¢ƒ cleanup() { log "æ¸…ç†æ¢å¤ç¯å¢ƒ..." # åˆ é™¤ä¸´æ—¶æ–‡ä»¶ rm -rf "$TEMP_DIR" # æ¸…ç†æ—¥å¿— find /var/log -type f -name "*.gz" -delete return 0 } # ä¸»å‡½æ•° main() { local backup_file # åˆ—å‡ºå¯ç”¨å¤‡ä»½ echo "å¯ç”¨çš„å¤‡ä»½æ–‡ä»¶:" ls -lh "$BACKUP_DIR"/full_backup_*.tar.gz # é€‰æ‹©å¤‡ä»½æ–‡ä»¶ read -p "è¯·è¾“å…¥è¦æ¢å¤çš„å¤‡ä»½æ–‡ä»¶å®Œæ•´è·¯å¾„: " backup_file # éªŒè¯å¤‡ä»½ if ! verify_backup "$backup_file"; then log "å¤‡ä»½éªŒè¯å¤±è´¥ï¼Œç»ˆæ­¢æ¢å¤" return 1 fi # å‡†å¤‡ç¯å¢ƒ if ! prepare_environment; then log "ç¯å¢ƒå‡†å¤‡å¤±è´¥ï¼Œç»ˆæ­¢æ¢å¤" return 1 fi # æ‰§è¡Œæ¢å¤ if perform_restore "$backup_file" && \ restore_configurations && \ verify_restore; then log "ç³»ç»Ÿæ¢å¤æˆåŠŸå®Œæˆ" ~/send_notification.sh "ç³»ç»Ÿæ¢å¤æˆåŠŸå®Œæˆ" "normal" else log "ç³»ç»Ÿæ¢å¤å¤±è´¥" ~/send_notification.sh "ç³»ç»Ÿæ¢å¤å¤±è´¥ï¼Œéœ€è¦æ‰‹åŠ¨æ£€æŸ¥" "high" fi # æ¸…ç†ç¯å¢ƒ cleanup } # æ‰§è¡Œæ¢å¤ main ä¸‰åä¸‰ã€ç³»ç»Ÿè¿ç§»å·¥å…· 1. ç³»ç»Ÿè¿ç§»è„šæœ¬ # åˆ›å»ºç³»ç»Ÿè¿ç§»è„šæœ¬ nano ~/system_migration.sh #!/bin/bash # ~/system_migration.sh # é…ç½® SOURCE_HOST="old-raspberry.local" TARGET_HOST="new-raspberry.local" MIGRATION_DIR="/mnt/migration" LOG_FILE="/var/log/migration.log" SSH_KEY="~/.ssh/migration_key" RSYNC_OPTS="-avz --progress --delete" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # æ£€æŸ¥è¿ç§»ç¯å¢ƒ check_migration_env() { log "æ£€æŸ¥è¿ç§»ç¯å¢ƒ..." # æ£€æŸ¥ SSH å¯†é’¥ if [ ! -f "$SSH_KEY" ]; then log "ç”Ÿæˆ SSH å¯†é’¥..." ssh-keygen -t ed25519 -f "$SSH_KEY" -N "" # å¤åˆ¶å¯†é’¥åˆ°ç›®æ ‡ä¸»æœº ssh-copy-id -i "$SSH_KEY" "zhaoxiongzhou@$TARGET_HOST" fi # æ£€æŸ¥å¿…è¦å·¥å…· for tool in rsync ssh scp; do if ! command -v $tool &>/dev/null; then log "é”™è¯¯: æœªæ‰¾åˆ°å¿…è¦å·¥å…· $tool" return 1 fi done # æ£€æŸ¥ç›®æ ‡ä¸»æœºè¿æ¥ if ! ssh -i "$SSH_KEY" "zhaoxiongzhou@$TARGET_HOST" "echo &#39;Connection test&#39;" &>/dev/null; then log "é”™è¯¯: æ— æ³•è¿æ¥åˆ°ç›®æ ‡ä¸»æœº" return 1 fi return 0 } # è¿ç§»é…ç½®æ–‡ä»¶ migrate_configs() { log "è¿ç§»é…ç½®æ–‡ä»¶..." # åˆ›å»ºé…ç½®ç›®å½• ssh -i "$SSH_KEY" "zhaoxiongzhou@$TARGET_HOST" "mkdir -p ~/configs_backup" # è¿ç§» Nginx é…ç½® rsync $RSYNC_OPTS -e "ssh -i $SSH_KEY" \ /etc/nginx/ \ "zhaoxiongzhou@$TARGET_HOST:~/configs_backup/nginx/" # è¿ç§»ç³»ç»Ÿé…ç½® rsync $RSYNC_OPTS -e "ssh -i $SSH_KEY" \ /etc/sysctl.d/ \ "zhaoxiongzhou@$TARGET_HOST:~/configs_backup/sysctl/" # è¿ç§»æœåŠ¡é…ç½® rsync $RSYNC_OPTS -e "ssh -i $SSH_KEY" \ /etc/systemd/system/ \ "zhaoxiongzhou@$TARGET_HOST:~/configs_backup/systemd/" } # è¿ç§»æ•°æ® migrate_data() { log "è¿ç§»æ•°æ®..." # è¿ç§»åšå®¢æ•°æ® rsync $RSYNC_OPTS -e "ssh -i $SSH_KEY" \ ~/myblog/ \ "zhaoxiongzhou@$TARGET_HOST:~/myblog/" # è¿ç§» AI æœåŠ¡æ•°æ® rsync $RSYNC_OPTS -e "ssh -i $SSH_KEY" \ ~/projects/llama.cpp/ \ "zhaoxiongzhou@$TARGET_HOST:~/projects/llama.cpp/" # è¿ç§»ç”¨æˆ·è„šæœ¬ rsync $RSYNC_OPTS -e "ssh -i $SSH_KEY" \ ~/*.sh \ "zhaoxiongzhou@$TARGET_HOST:~/" } # è¿ç§»æ•°æ®åº“ migrate_database() { log "è¿ç§»æ•°æ®åº“..." # å¯¼å‡ºæ•°æ®åº“ local dump_file="/tmp/database_dump.sql" if [ -f "/var/lib/mysql" ]; then mysqldump --all-databases > "$dump_file" # ä¼ è¾“åˆ°ç›®æ ‡ä¸»æœº scp -i "$SSH_KEY" "$dump_file" "zhaoxiongzhou@$TARGET_HOST:/tmp/" # åœ¨ç›®æ ‡ä¸»æœºå¯¼å…¥æ•°æ®åº“ ssh -i "$SSH_KEY" "zhaoxiongzhou@$TARGET_HOST" \ "mysql < /tmp/database_dump.sql" fi } # é…ç½®ç›®æ ‡ç³»ç»Ÿ configure_target() { log "é…ç½®ç›®æ ‡ç³»ç»Ÿ..." ssh -i "$SSH_KEY" "zhaoxiongzhou@$TARGET_HOST" "bash -s" << &#39;EOF&#39; # å®‰è£…å¿…è¦è½¯ä»¶ sudo apt update sudo apt install -y nginx mysql-server python3 pip # æ¢å¤é…ç½® sudo cp -r ~/configs_backup/nginx/* /etc/nginx/ sudo cp -r ~/configs_backup/sysctl/* /etc/sysctl.d/ sudo cp -r ~/configs_backup/systemd/* /etc/systemd/system/ # è®¾ç½®æƒé™ sudo chown -R www-data:www-data /var/www/ sudo chmod +x ~/*.sh # é‡å¯æœåŠ¡ sudo systemctl daemon-reload sudo systemctl restart nginx EOF } # éªŒè¯è¿ç§» verify_migration() { log "éªŒè¯è¿ç§»..." local status=0 # æ£€æŸ¥æœåŠ¡çŠ¶æ€ ssh -i "$SSH_KEY" "zhaoxiongzhou@$TARGET_HOST" "bash -s" << &#39;EOF&#39; # æ£€æŸ¥ Nginx if ! systemctl is-active --quiet nginx; then echo "é”™è¯¯: Nginx æœåŠ¡æœªè¿è¡Œ" exit 1 fi # æ£€æŸ¥æ–‡ä»¶ for dir in "~/myblog" "~/projects/llama.cpp"; do if [ ! -d "$dir" ]; then echo "é”™è¯¯: ç›®å½• $dir ä¸å­˜åœ¨" exit 1 fi done # æ£€æŸ¥é…ç½® if ! nginx -t &>/dev/null; then echo "é”™è¯¯: Nginx é…ç½®æ— æ•ˆ" exit 1 fi EOF status=$? return $status } # ä¸»å‡½æ•° main() { log "å¼€å§‹ç³»ç»Ÿè¿ç§»..." # æ£€æŸ¥ç¯å¢ƒ if ! check_migration_env; then log "è¿ç§»ç¯å¢ƒæ£€æŸ¥å¤±è´¥" return 1 fi # æ‰§è¡Œè¿ç§» migrate_configs migrate_data migrate_database configure_target # éªŒè¯è¿ç§» if verify_migration; then log "ç³»ç»Ÿè¿ç§»æˆåŠŸå®Œæˆ" ~/send_notification.sh "ç³»ç»Ÿè¿ç§»æˆåŠŸå®Œæˆ" "normal" else log "ç³»ç»Ÿè¿ç§»å¤±è´¥" ~/send_notification.sh "ç³»ç»Ÿè¿ç§»å¤±è´¥ï¼Œéœ€è¦æ‰‹åŠ¨æ£€æŸ¥" "high" fi } # æ‰§è¡Œè¿ç§» main ä¸‰åå››ã€æ—¥å¿—åˆ†æå·¥å…· 1. æ—¥å¿—åˆ†æè„šæœ¬ # åˆ›å»ºæ—¥å¿—åˆ†æè„šæœ¬ nano ~/log_analyzer.sh #!/bin/bash # ~/log_analyzer.sh # é…ç½® LOG_DIRS=( "/var/log" "/var/log/nginx" "/home/zhaoxiongzhou/logs" ) REPORT_DIR="/home/zhaoxiongzhou/log_reports" LOG_FILE="/var/log/analyzer.log" ALERT_THRESHOLD=100 # é”™è¯¯æ—¥å¿—é˜ˆå€¼ RETENTION_DAYS=30 # æŠ¥å‘Šä¿ç•™å¤©æ•° # ç¡®ä¿ç›®å½•å­˜åœ¨ mkdir -p "$REPORT_DIR" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # åˆ†æç³»ç»Ÿæ—¥å¿— analyze_system_logs() { log "åˆ†æç³»ç»Ÿæ—¥å¿—..." local report_file="$REPORT_DIR/system_log_report_$(date +%Y%m%d).md" { echo "# ç³»ç»Ÿæ—¥å¿—åˆ†ææŠ¥å‘Š" echo "## ç”Ÿæˆæ—¶é—´: $(date &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo echo "## ç³»ç»Ÿé”™è¯¯ç»Ÿè®¡" echo "### ä¸¥é‡é”™è¯¯" echo &#39;```&#39; grep -i "error\|critical\|emergency" /var/log/syslog | \ tail -n 50 | sort | uniq -c | sort -nr echo &#39;```&#39; echo "### è®¤è¯å¤±è´¥" echo &#39;```&#39; grep "Failed password" /var/log/auth.log | \ awk &#39;{print $1,$2,$3,$11}&#39; | sort | uniq -c | sort -nr | head -n 10 echo &#39;```&#39; echo "### ç³»ç»Ÿé‡å¯è®°å½•" echo &#39;```&#39; last reboot | head -n 5 echo &#39;```&#39; } > "$report_file" } # åˆ†æ Nginx è®¿é—®æ—¥å¿— analyze_nginx_logs() { log "åˆ†æ Nginx è®¿é—®æ—¥å¿—..." local report_file="$REPORT_DIR/nginx_log_report_$(date +%Y%m%d).md" { echo "# Nginx è®¿é—®æ—¥å¿—åˆ†ææŠ¥å‘Š" echo "## ç”Ÿæˆæ—¶é—´: $(date &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo echo "## è®¿é—®ç»Ÿè®¡" echo "### è¯·æ±‚é‡æœ€å¤§çš„ IP" echo &#39;```&#39; awk &#39;{print $1}&#39; /var/log/nginx/access.log | sort | uniq -c | sort -nr | head -n 10 echo &#39;```&#39; echo "### è®¿é—®é‡æœ€å¤§çš„é¡µé¢" echo &#39;```&#39; awk &#39;{print $7}&#39; /var/log/nginx/access.log | sort | uniq -c | sort -nr | head -n 10 echo &#39;```&#39; echo "### HTTP çŠ¶æ€ç ç»Ÿè®¡" echo &#39;```&#39; awk &#39;{print $9}&#39; /var/log/nginx/access.log | sort | uniq -c | sort -nr echo &#39;```&#39; echo "### æ¯å°æ—¶è¯·æ±‚é‡ç»Ÿè®¡" echo &#39;```&#39; awk &#39;{print $4}&#39; /var/log/nginx/access.log | cut -c 14-15 | sort | uniq -c | \ awk &#39;{printf("%s:00 - %s è¯·æ±‚\n", $2, $1)}&#39; echo &#39;```&#39; } > "$report_file" } # åˆ†æ AI æœåŠ¡æ—¥å¿— analyze_ai_logs() { log "åˆ†æ AI æœåŠ¡æ—¥å¿—..." local report_file="$REPORT_DIR/ai_log_report_$(date +%Y%m%d).md" local ai_log="/home/zhaoxiongzhou/logs/llama.log" if [ -f "$ai_log" ]; then { echo "# AI æœåŠ¡æ—¥å¿—åˆ†ææŠ¥å‘Š" echo "## ç”Ÿæˆæ—¶é—´: $(date &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo echo "## æœåŠ¡ç»Ÿè®¡" echo "### é”™è¯¯ç»Ÿè®¡" echo &#39;```&#39; grep -i "error" "$ai_log" | tail -n 20 echo &#39;```&#39; echo "### æ€§èƒ½ç»Ÿè®¡" echo "#### å“åº”æ—¶é—´åˆ†å¸ƒ" echo &#39;```&#39; grep "response_time" "$ai_log" | \ awk &#39;{sum+=$NF; count++} END {print "å¹³å‡å“åº”æ—¶é—´:", sum/count, "ms"}&#39; echo &#39;```&#39; echo "#### å†…å­˜ä½¿ç”¨ç»Ÿè®¡" echo &#39;```&#39; grep "memory_usage" "$ai_log" | tail -n 10 echo &#39;```&#39; } > "$report_file" fi } # ç”Ÿæˆå®‰å…¨æŠ¥å‘Š generate_security_report() { log "ç”Ÿæˆå®‰å…¨æŠ¥å‘Š..." local report_file="$REPORT_DIR/security_report_$(date +%Y%m%d).md" { echo "# å®‰å…¨åˆ†ææŠ¥å‘Š" echo "## ç”Ÿæˆæ—¶é—´: $(date &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo echo "## å®‰å…¨äº‹ä»¶ç»Ÿè®¡" echo "### SSH æš´åŠ›ç ´è§£å°è¯•" echo &#39;```&#39; grep "Failed password" /var/log/auth.log | \ awk &#39;{print $11,$13}&#39; | sort | uniq -c | sort -nr | head -n 10 echo &#39;```&#39; echo "### å¯ç–‘ IP è®¿é—®" echo &#39;```&#39; grep -i "suspicious\|attack\|hack" /var/log/nginx/access.log | \ awk &#39;{print $1}&#39; | sort | uniq -c | sort -nr echo &#39;```&#39; echo "### æ–‡ä»¶æƒé™å˜æ›´" echo &#39;```&#39; find /etc -mtime -1 -type f -ls echo &#39;```&#39; } > "$report_file" } # æ¸…ç†æ—§æŠ¥å‘Š cleanup_old_reports() { log "æ¸…ç†æ—§æŠ¥å‘Š..." find "$REPORT_DIR" -type f -name "*.md" -mtime +$RETENTION_DAYS -delete } # ç”Ÿæˆæ‘˜è¦æŠ¥å‘Š generate_summary() { log "ç”Ÿæˆæ‘˜è¦æŠ¥å‘Š..." local summary_file="$REPORT_DIR/summary_$(date +%Y%m%d).md" { echo "# æ—¥å¿—åˆ†ææ‘˜è¦æŠ¥å‘Š" echo "## ç”Ÿæˆæ—¶é—´: $(date &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo echo "## å…³é”®æŒ‡æ ‡" # é”™è¯¯ç»Ÿè®¡ local error_count=$(grep -i "error" /var/log/syslog | wc -l) local nginx_error_count=$(grep -i "error" /var/log/nginx/error.log | wc -l) echo "- ç³»ç»Ÿé”™è¯¯æ•°: $error_count" echo "- Nginx é”™è¯¯æ•°: $nginx_error_count" # å®‰å…¨äº‹ä»¶ local ssh_fails=$(grep "Failed password" /var/log/auth.log | wc -l) echo "- SSH å¤±è´¥å°è¯•: $ssh_fails" # å‘Šè­¦åˆ¤æ–­ if [ $error_count -gt $ALERT_THRESHOLD ]; then ~/send_notification.sh "è­¦å‘Š: ç³»ç»Ÿé”™è¯¯æ•°è¶…è¿‡é˜ˆå€¼" "high" fi } > "$summary_file" } # ä¸»å‡½æ•° main() { log "å¼€å§‹æ—¥å¿—åˆ†æ..." # æ‰§è¡Œåˆ†æ analyze_system_logs analyze_nginx_logs analyze_ai_logs generate_security_report generate_summary # æ¸…ç†æ—§æŠ¥å‘Š cleanup_old_reports log "æ—¥å¿—åˆ†æå®Œæˆ" } # æ‰§è¡Œåˆ†æ main ä¸‰åäº”ã€ç³»ç»Ÿä¼˜åŒ–å·¥å…· 1. ç³»ç»Ÿä¼˜åŒ–è„šæœ¬ # åˆ›å»ºç³»ç»Ÿä¼˜åŒ–è„šæœ¬ nano ~/system_optimize.sh #!/bin/bash # ~/system_optimize.sh # é…ç½® LOG_FILE="/var/log/optimize.log" NGINX_CONF="/etc/nginx/nginx.conf" SYSCTL_CONF="/etc/sysctl.d/99-custom.conf" JOURNAL_CONF="/etc/systemd/journald.conf" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # ä¼˜åŒ–ç³»ç»Ÿå‚æ•° optimize_system() { log "ä¼˜åŒ–ç³»ç»Ÿå‚æ•°..." # å¤‡ä»½åŸå§‹é…ç½® cp "$SYSCTL_CONF" "${SYSCTL_CONF}.backup" # é…ç½®ç³»ç»Ÿå‚æ•° cat > "$SYSCTL_CONF" << EOF # ç½‘ç»œä¼˜åŒ– net.core.somaxconn = 2048 net.core.netdev_max_backlog = 4096 net.ipv4.tcp_max_syn_backlog = 4096 net.ipv4.tcp_fin_timeout = 30 net.ipv4.tcp_keepalive_time = 1200 net.ipv4.tcp_max_tw_buckets = 5000 net.ipv4.tcp_fastopen = 3 net.ipv4.tcp_rmem = 4096 87380 16777216 net.ipv4.tcp_wmem = 4096 65536 16777216 # æ–‡ä»¶ç³»ç»Ÿä¼˜åŒ– fs.file-max = 100000 fs.inotify.max_user_watches = 524288 # å†…å­˜ä¼˜åŒ– vm.swappiness = 10 vm.dirty_ratio = 60 vm.dirty_background_ratio = 2 EOF # åº”ç”¨ç³»ç»Ÿå‚æ•° sysctl -p "$SYSCTL_CONF" } # ä¼˜åŒ– Nginx é…ç½® optimize_nginx() { log "ä¼˜åŒ– Nginx é…ç½®..." # å¤‡ä»½åŸå§‹é…ç½® cp "$NGINX_CONF" "${NGINX_CONF}.backup" # é…ç½® Nginx cat > "$NGINX_CONF" << EOF user www-data; worker_processes auto; worker_rlimit_nofile 100000; events { worker_connections 2048; multi_accept on; use epoll; } http { # åŸºç¡€è®¾ç½® sendfile on; tcp_nopush on; tcp_nodelay on; keepalive_timeout 65; types_hash_max_size 2048; server_tokens off; # MIME ç±»å‹ include /etc/nginx/mime.types; default_type application/octet-stream; # æ—¥å¿—æ ¼å¼ log_format main &#39;\$remote_addr - \$remote_user [\$time_local] "\$request" &#39; &#39;\$status \$body_bytes_sent "\$http_referer" &#39; &#39;"\$http_user_agent" "\$http_x_forwarded_for"&#39;; # ç¼“å†²åŒºè®¾ç½® client_body_buffer_size 128k; client_max_body_size 10m; client_header_buffer_size 1k; large_client_header_buffers 4 4k; # Gzip å‹ç¼© gzip on; gzip_vary on; gzip_proxied any; gzip_comp_level 6; gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript; # SSL ä¼˜åŒ– ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers on; ssl_session_cache shared:SSL:10m; ssl_session_timeout 10m; # åŒ…å«å…¶ä»–é…ç½® include /etc/nginx/conf.d/*.conf; include /etc/nginx/sites-enabled/*; } EOF # æµ‹è¯•é…ç½® nginx -t && systemctl restart nginx } # ä¼˜åŒ–ç³»ç»ŸæœåŠ¡ optimize_services() { log "ä¼˜åŒ–ç³»ç»ŸæœåŠ¡..." # ç¦ç”¨ä¸å¿…è¦çš„æœåŠ¡ local unnecessary_services=( "bluetooth" "cups" "avahi-daemon" ) for service in "${unnecessary_services[@]}"; do if systemctl is-active --quiet "$service"; then systemctl stop "$service" systemctl disable "$service" log "å·²ç¦ç”¨æœåŠ¡: $service" fi done # ä¼˜åŒ–æ—¥å¿—æœåŠ¡ cat > "$JOURNAL_CONF" << EOF [Journal] SystemMaxUse=100M SystemMaxFileSize=10M RuntimeMaxUse=50M RuntimeMaxFileSize=5M EOF # é‡å¯æ—¥å¿—æœåŠ¡ systemctl restart systemd-journald } # ä¼˜åŒ–æ–‡ä»¶ç³»ç»Ÿ optimize_filesystem() { log "ä¼˜åŒ–æ–‡ä»¶ç³»ç»Ÿ..." # æ¸…ç†ä¸´æ—¶æ–‡ä»¶ find /tmp -type f -atime +10 -delete find /var/tmp -type f -atime +10 -delete # æ¸…ç†æ—¥å¿— find /var/log -type f -name "*.gz" -delete find /var/log -type f -name "*.old" -delete # ä¼˜åŒ–æ—¥å¿—è½®è½¬ cat > /etc/logrotate.d/custom << EOF /var/log/custom/*.log { daily rotate 7 compress delaycompress missingok notifempty create 640 root adm } EOF } # ä¼˜åŒ–å†…å­˜ä½¿ç”¨ optimize_memory() { log "ä¼˜åŒ–å†…å­˜ä½¿ç”¨..." # æ¸…ç†ç¼“å­˜ sync; echo 3 > /proc/sys/vm/drop_caches # é…ç½® swap ä½¿ç”¨ if [ -f /swapfile ]; then swapoff /swapfile dd if=/dev/zero of=/swapfile bs=1M count=2048 chmod 600 /swapfile mkswap /swapfile swapon /swapfile fi } # éªŒè¯ä¼˜åŒ– verify_optimization() { log "éªŒè¯ç³»ç»Ÿä¼˜åŒ–..." local status=0 # æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½ local load=$(uptime | awk -F&#39;load average:&#39; &#39;{print $2}&#39; | cut -d, -f1) if [ $(echo "$load > 2" | bc -l) -eq 1 ]; then log "è­¦å‘Š: ç³»ç»Ÿè´Ÿè½½è¾ƒé«˜ ($load)" status=1 fi # æ£€æŸ¥å†…å­˜ä½¿ç”¨ local mem_usage=$(free | grep Mem | awk &#39;{print $3/$2 * 100.0}&#39;) if [ $(echo "$mem_usage > 90" | bc -l) -eq 1 ]; then log "è­¦å‘Š: å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜ ($mem_usage%)" status=1 fi # æ£€æŸ¥æœåŠ¡çŠ¶æ€ if ! systemctl is-active --quiet nginx; then log "é”™è¯¯: Nginx æœåŠ¡æœªæ­£å¸¸è¿è¡Œ" status=1 fi return $status } # ä¸»å‡½æ•° main() { log "å¼€å§‹ç³»ç»Ÿä¼˜åŒ–..." optimize_system optimize_nginx optimize_services optimize_filesystem optimize_memory if verify_optimization; then log "ç³»ç»Ÿä¼˜åŒ–æˆåŠŸå®Œæˆ" ~/send_notification.sh "ç³»ç»Ÿä¼˜åŒ–å·²å®Œæˆ" "normal" else log "ç³»ç»Ÿä¼˜åŒ–å®Œæˆï¼Œä½†å­˜åœ¨è­¦å‘Š" ~/send_notification.sh "ç³»ç»Ÿä¼˜åŒ–å®Œæˆï¼Œä½†éœ€è¦æ£€æŸ¥" "high" fi } # æ‰§è¡Œä¼˜åŒ– main ä¸‰åå…­ã€éƒ¨ç½²åæ£€æŸ¥æ¸…å• 1. éƒ¨ç½²æ£€æŸ¥è„šæœ¬ # åˆ›å»ºéƒ¨ç½²æ£€æŸ¥è„šæœ¬ nano ~/deployment_checklist.sh #!/bin/bash # ~/deployment_checklist.sh # é…ç½® LOG_FILE="/var/log/deployment_check.log" REPORT_FILE="/home/zhaoxiongzhou/deployment_report.md" CHECK_INTERVAL=300 # æ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰ # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # æ£€æŸ¥ç³»ç»ŸåŸºç¡€é…ç½® check_system_basics() { log "æ£€æŸ¥ç³»ç»ŸåŸºç¡€é…ç½®..." local status=0 { echo "## ç³»ç»ŸåŸºç¡€æ£€æŸ¥" echo "### ç³»ç»Ÿä¿¡æ¯" echo "- ä¸»æœºå: $(hostname)" echo "- ç³»ç»Ÿç‰ˆæœ¬: $(cat /etc/os-release | grep PRETTY_NAME)" echo "- å†…æ ¸ç‰ˆæœ¬: $(uname -r)" echo "- è¿è¡Œæ—¶é—´: $(uptime -p)" echo echo "### èµ„æºä½¿ç”¨" echo "- CPU ä½¿ç”¨ç‡: $(top -bn1 | grep "Cpu(s)" | awk &#39;{print $2}&#39;)%" echo "- å†…å­˜ä½¿ç”¨ç‡: $(free | grep Mem | awk &#39;{print $3/$2 * 100.0}&#39;)%" echo "- ç£ç›˜ä½¿ç”¨ç‡: $(df -h / | awk &#39;NR==2 {print $5}&#39;)" echo } > "$REPORT_FILE" return $status } # æ£€æŸ¥ç½‘ç»œé…ç½® check_network() { log "æ£€æŸ¥ç½‘ç»œé…ç½®..." local status=0 { echo "### ç½‘ç»œé…ç½®" echo "#### IP é…ç½®" echo &#39;```&#39; ip addr show echo &#39;```&#39; echo "#### è·¯ç”±è¡¨" echo &#39;```&#39; ip route echo &#39;```&#39; echo "#### å¼€æ”¾ç«¯å£" echo &#39;```&#39; netstat -tuln echo &#39;```&#39; echo "#### DNS é…ç½®" echo &#39;```&#39; cat /etc/resolv.conf echo &#39;```&#39; } >> "$REPORT_FILE" return $status } # æ£€æŸ¥æœåŠ¡é…ç½® check_services() { log "æ£€æŸ¥æœåŠ¡é…ç½®..." local status=0 { echo "### æœåŠ¡çŠ¶æ€" echo "#### Nginx é…ç½®" echo &#39;```&#39; nginx -T echo &#39;```&#39; echo "#### æœåŠ¡è¿è¡ŒçŠ¶æ€" echo &#39;```&#39; systemctl status nginx systemctl status mysql ps aux | grep llama-server echo &#39;```&#39; echo "#### æœåŠ¡æ—¥å¿—æ£€æŸ¥" echo &#39;```&#39; tail -n 20 /var/log/nginx/error.log echo &#39;```&#39; } >> "$REPORT_FILE" return $status } # æ£€æŸ¥å®‰å…¨é…ç½® check_security() { log "æ£€æŸ¥å®‰å…¨é…ç½®..." local status=0 { echo "### å®‰å…¨æ£€æŸ¥" echo "#### é˜²ç«å¢™è§„åˆ™" echo &#39;```&#39; sudo iptables -L echo &#39;```&#39; echo "#### SSH é…ç½®" echo &#39;```&#39; grep -v &#39;^#&#39; /etc/ssh/sshd_config echo &#39;```&#39; echo "#### ç”¨æˆ·æƒé™" echo &#39;```&#39; ls -la /home/zhaoxiongzhou/ ls -la /var/www/ echo &#39;```&#39; echo "#### SSL è¯ä¹¦" echo &#39;```&#39; openssl x509 -in /etc/nginx/ssl/server.crt -text -noout echo &#39;```&#39; } >> "$REPORT_FILE" return $status } # æ£€æŸ¥å¤‡ä»½é…ç½® check_backups() { log "æ£€æŸ¥å¤‡ä»½é…ç½®..." local status=0 { echo "### å¤‡ä»½æ£€æŸ¥" echo "#### å¤‡ä»½é…ç½®" echo &#39;```&#39; ls -lh /mnt/backup_drive/system_backups/ echo &#39;```&#39; echo "#### æœ€è¿‘å¤‡ä»½çŠ¶æ€" echo &#39;```&#39; tail -n 20 /var/log/backup.log echo &#39;```&#39; } >> "$REPORT_FILE" return $status } # æ£€æŸ¥ç›‘æ§é…ç½® check_monitoring() { log "æ£€æŸ¥ç›‘æ§é…ç½®..." local status=0 { echo "### ç›‘æ§æ£€æŸ¥" echo "#### ç›‘æ§è„šæœ¬çŠ¶æ€" echo &#39;```&#39; ps aux | grep monitor echo &#39;```&#39; echo "#### å‘Šè­¦é…ç½®" echo &#39;```&#39; cat ~/send_notification.sh echo &#39;```&#39; } >> "$REPORT_FILE" return $status } # ç”Ÿæˆæ€»ç»“æŠ¥å‘Š generate_summary() { log "ç”Ÿæˆæ€»ç»“æŠ¥å‘Š..." { echo "## éƒ¨ç½²æ£€æŸ¥æ€»ç»“" echo "### æ£€æŸ¥æ—¶é—´: $(date &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo echo "### ä¸»è¦å‘ç°" echo "1. ç³»ç»ŸçŠ¶æ€: $([ $system_status -eq 0 ] && echo &#39;æ­£å¸¸ âœ…&#39; || echo &#39;å¼‚å¸¸ âŒ&#39;)" echo "2. ç½‘ç»œé…ç½®: $([ $network_status -eq 0 ] && echo &#39;æ­£å¸¸ âœ…&#39; || echo &#39;å¼‚å¸¸ âŒ&#39;)" echo "3. æœåŠ¡çŠ¶æ€: $([ $services_status -eq 0 ] && echo &#39;æ­£å¸¸ âœ…&#39; || echo &#39;å¼‚å¸¸ âŒ&#39;)" echo "4. å®‰å…¨é…ç½®: $([ $security_status -eq 0 ] && echo &#39;æ­£å¸¸ âœ…&#39; || echo &#39;å¼‚å¸¸ âŒ&#39;)" echo "5. å¤‡ä»½çŠ¶æ€: $([ $backup_status -eq 0 ] && echo &#39;æ­£å¸¸ âœ…&#39; || echo &#39;å¼‚å¸¸ âŒ&#39;)" echo "6. ç›‘æ§çŠ¶æ€: $([ $monitoring_status -eq 0 ] && echo &#39;æ­£å¸¸ âœ…&#39; || echo &#39;å¼‚å¸¸ âŒ&#39;)" echo echo "### å»ºè®®æ“ä½œ" [ $system_status -ne 0 ] && echo "- æ£€æŸ¥ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ" [ $network_status -ne 0 ] && echo "- éªŒè¯ç½‘ç»œé…ç½®" [ $services_status -ne 0 ] && echo "- æ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€" [ $security_status -ne 0 ] && echo "- å®¡æŸ¥å®‰å…¨é…ç½®" [ $backup_status -ne 0 ] && echo "- ç¡®è®¤å¤‡ä»½æ˜¯å¦æ­£å¸¸" [ $monitoring_status -ne 0 ] && echo "- æ£€æŸ¥ç›‘æ§ç³»ç»Ÿ" } >> "$REPORT_FILE" } # ä¸»å‡½æ•° main() { log "å¼€å§‹éƒ¨ç½²åæ£€æŸ¥..." # æ‰§è¡Œæ£€æŸ¥ check_system_basics system_status=$? check_network network_status=$? check_services services_status=$? check_security security_status=$? check_backups backup_status=$? check_monitoring monitoring_status=$? # ç”Ÿæˆæ€»ç»“ generate_summary # å‘é€é€šçŸ¥ if [ $system_status -eq 0 ] && [ $network_status -eq 0 ] && \ [ $services_status -eq 0 ] && [ $security_status -eq 0 ] && \ [ $backup_status -eq 0 ] && [ $monitoring_status -eq 0 ]; then ~/send_notification.sh "éƒ¨ç½²æ£€æŸ¥å®Œæˆï¼šæ‰€æœ‰é¡¹ç›®æ­£å¸¸" "normal" else ~/send_notification.sh "éƒ¨ç½²æ£€æŸ¥å®Œæˆï¼šå­˜åœ¨éœ€è¦å…³æ³¨çš„é¡¹ç›®" "high" fi log "éƒ¨ç½²æ£€æŸ¥å®Œæˆï¼ŒæŠ¥å‘Šå·²ç”Ÿæˆ: $REPORT_FILE" } # æ‰§è¡Œæ£€æŸ¥ main ã€Šæ ‘è“æ´¾æœåŠ¡éƒ¨ç½²ä¸ç»´æŠ¤å®Œæ•´æŒ‡å—ã€‹æ€»å…±åŒ…å«äº† 36 ä¸ªéƒ¨åˆ†ï¼Œæ¶µç›–äº†ä»ç³»ç»Ÿéƒ¨ç½²åˆ°ç»´æŠ¤çš„å„ä¸ªæ–¹é¢ã€‚æ¯ä¸ªè„šæœ¬éƒ½ç»è¿‡ç²¾å¿ƒè®¾è®¡ï¼Œå¯ä»¥ç‹¬ç«‹è¿è¡Œï¼Œä¹Ÿå¯ä»¥äº’ç›¸é…åˆä½¿ç”¨ã€‚'><meta property="og:locale" content="zh"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-12-03T18:00:00+08:00"><meta property="article:modified_time" content="2024-12-03T18:00:00+08:00"><meta property="article:tag" content="RaspberryPi"><meta property="article:tag" content="Hugo"><meta property="article:tag" content="æ•™ç¨‹"><meta name=twitter:card content="summary"><meta name=twitter:title content="æ ‘è“æ´¾æœåŠ¡éƒ¨ç½²ä¸ç»´æŠ¤å®Œæ•´æŒ‡å—"><meta name=twitter:description content='æ ‘è“æ´¾æœåŠ¡éƒ¨ç½²ä¸ç»´æŠ¤å®Œæ•´æŒ‡å— ä¸€ã€ç³»ç»Ÿæ¦‚å†µ 1. ç¡¬ä»¶èµ„æº å¤„ç†å™¨: ARM64 æ¶æ„ æ€»å†…å­˜: 3.7GB å¯ç”¨å†…å­˜: ~2.5GB Swap: 512MB ç½‘ç»œ: wlan0 (IP: 10.40.110.47) 2. æœåŠ¡æ¦‚è§ˆ AI æ™ºèƒ½åŠ©æ‰‹ ç«¯å£: 8080 åŸºäº: llama.cpp æ¨¡å‹: Phi-3-mini-4k-instruct-q4.gguf èµ„æºå ç”¨: CPU: ~300% (å¤šæ ¸) å†…å­˜: ~3GB Swap: 511Mi ä¸ªäººåšå®¢ ç«¯å£: 80 æ¡†æ¶: Hugo v0.139.3-extended ä¸»é¢˜: Ananke WebæœåŠ¡å™¨: Nginx èµ„æºå ç”¨: è½»é‡çº§ 3. æœåŠ¡è®¿é—® AI åŠ©æ‰‹: http://10.40.110.47:8080 åšå®¢å¼€å‘: http://10.40.110.47:1313 åšå®¢æ­£å¼: http://10.40.110.47 äºŒã€AI æ™ºèƒ½åŠ©æ‰‹éƒ¨ç½² 1. ç¯å¢ƒå‡†å¤‡ # æ›´æ–°ç³»ç»Ÿ sudo apt update sudo apt upgrade -y # å®‰è£…ä¾èµ– sudo apt install build-essential git cmake 2. ç¼–è¯‘å®‰è£… # å…‹éš†ä»“åº“ git clone https://github.com/ggerganov/llama.cpp.git cd llama.cpp # ç¼–è¯‘ make clean LLAMA_METAL=1 make -j4 3. æ¨¡å‹é…ç½® # åˆ›å»ºæ¨¡å‹ç›®å½• mkdir models cd models # ä¸‹è½½æ¨¡å‹æ–‡ä»¶ wget [æ¨¡å‹ä¸‹è½½åœ°å€]/Phi-3-mini-4k-instruct-q4.gguf # éªŒè¯æ¨¡å‹æ–‡ä»¶ sha256sum Phi-3-mini-4k-instruct-q4.gguf 4. æœåŠ¡é…ç½® # åˆ›å»ºå¯åŠ¨è„šæœ¬ nano ~/projects/llama.cpp/start-llama.sh #!/bin/bash cd ~/projects/llama.cpp nohup ./llama-server \ -m models/Phi-3-mini-4k-instruct-q4.gguf \ --host 0.0.0.0 \ --port 8080 \ --ctx-size 2048 \ --threads 2 \ --batch-size 256 \ > llama.log 2>&amp;1 & # è®¾ç½®æ‰§è¡Œæƒé™ chmod +x start-llama.sh # å¯åŠ¨æœåŠ¡ ./start-llama.sh # éªŒè¯æœåŠ¡çŠ¶æ€ ps aux | grep llama-server netstat -tuln | grep 8080 ä¸‰ã€ä¸ªäººåšå®¢éƒ¨ç½² 1. Hugo å®‰è£… # ä¸‹è½½ Hugo Extended ç‰ˆæœ¬ wget https://github.com/gohugoio/hugo/releases/download/v0.139.3/hugo_extended_0.139.3_linux-arm64.deb # å®‰è£… sudo dpkg -i hugo_extended_0.139.3_linux-arm64.deb # éªŒè¯å®‰è£… hugo version 2. åšå®¢åˆå§‹åŒ– # åˆ›å»ºç«™ç‚¹ cd ~ hugo new site myblog cd myblog # åˆå§‹åŒ– Git git init # æ·»åŠ ä¸»é¢˜ git submodule add https://github.com/theNewDynamic/gohugo-theme-ananke.git themes/ananke 3. åšå®¢é…ç½® # ç¼–è¾‘é…ç½®æ–‡ä»¶ nano config.toml baseURL = "http://10.40.110.47/" languageCode = "zh-cn" title = "My Blog" theme = "ananke" [params] author = "Your Name" description = "Welcome to my blog" dateFormat = "2006-01-02" background_color_class = "bg-black" recent_posts_number = 3 mainSections = ["posts"] featured_image = false [menu] [[menu.main]] identifier = "posts" name = "æ–‡ç« " url = "/posts/" weight = 1 [[menu.main]] identifier = "about" name = "å…³äº" url = "/about/" weight = 2 4. Nginx é…ç½® # å®‰è£… Nginx sudo apt install nginx # åˆ›å»ºé…ç½®æ–‡ä»¶ sudo nano /etc/nginx/sites-available/myblog server { listen 80; server_name 10.40.110.47; root /home/zhaoxiongzhou/myblog/public; index index.html; location / { try_files $uri $uri/ =404; } access_log /var/log/nginx/myblog_access.log; error_log /var/log/nginx/myblog_error.log; } # å¯ç”¨é…ç½® sudo ln -s /etc/nginx/sites-available/myblog /etc/nginx/sites-enabled/ sudo rm /etc/nginx/sites-enabled/default # æµ‹è¯•é…ç½® sudo nginx -t # é‡å¯ Nginx sudo systemctl restart nginx å››ã€æƒé™ä¸è‡ªåŠ¨åŒ–é…ç½® 1. æƒé™è®¾ç½® # è®¾ç½®ç›®å½•æƒé™ sudo chmod 755 /home/zhaoxiongzhou sudo chmod -R 755 /home/zhaoxiongzhou/myblog # è®¾ç½®æ–‡ä»¶æ‰€æœ‰æƒ sudo chown -R www-data:www-data /home/zhaoxiongzhou/myblog/public # éªŒè¯æƒé™ ls -la ~/myblog/public ls -la /home/zhaoxiongzhou 2. è‡ªåŠ¨éƒ¨ç½²è„šæœ¬ # åˆ›å»ºåšå®¢éƒ¨ç½²è„šæœ¬ nano ~/deploy-blog.sh #!/bin/bash cd ~/myblog hugo sudo chown -R www-data:www-data public/ sudo systemctl restart nginx # è®¾ç½®æ‰§è¡Œæƒé™ chmod +x ~/deploy-blog.sh 3. å¤‡ä»½è„šæœ¬ # åˆ›å»ºå¤‡ä»½è„šæœ¬ nano ~/backup-blog.sh #!/bin/bash BACKUP_DIR="/home/zhaoxiongzhou/backups" DATE=$(date +%Y%m%d) # åˆ›å»ºå¤‡ä»½ç›®å½• mkdir -p $BACKUP_DIR # å¤‡ä»½åšå®¢å†…å®¹ tar -czf $BACKUP_DIR/blog_$DATE.tar.gz ~/myblog/content # å¤‡ä»½é…ç½®æ–‡ä»¶ cp ~/myblog/config.toml $BACKUP_DIR/config_$DATE.toml # åˆ é™¤30å¤©å‰çš„å¤‡ä»½ find $BACKUP_DIR -name "*.tar.gz" -mtime +30 -delete # è®¾ç½®æ‰§è¡Œæƒé™ chmod +x ~/backup-blog.sh # é…ç½®å®šæ—¶ä»»åŠ¡ crontab -e # æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼ˆæ¯å‘¨æ—¥å‡Œæ™¨2ç‚¹æ‰§è¡Œå¤‡ä»½ï¼‰ 0 2 * * 0 /home/zhaoxiongzhou/backup-blog.sh äº”ã€ç³»ç»Ÿç»´æŠ¤ä¸ç›‘æ§ 1. èµ„æºç›‘æ§å‘½ä»¤ # ç³»ç»Ÿèµ„æºç›‘æ§ htop top free -h vmstat 1 # ç£ç›˜ä½¿ç”¨ç›‘æ§ df -h du -sh /* du -sh ~/myblog du -sh ~/projects/llama.cpp # æ¸©åº¦ç›‘æ§ vcgencmd measure_temp 2. æ€§èƒ½ä¼˜åŒ– # æ¸…ç†ç³»ç»Ÿç¼“å­˜ sudo sync; echo 3 | sudo tee /proc/sys/vm/drop_caches # è°ƒæ•´ Swap è®¾ç½® cat /proc/sys/vm/swappiness sudo sysctl vm.swappiness=60 # CPU é¢‘ç‡è°ƒæ•´ sudo nano /boot/config.txt # CPU é…ç½®å‚æ•° arm_freq=1800 over_voltage=6 temp_limit=75 3. ç³»ç»Ÿç»´æŠ¤ # ç³»ç»Ÿæ›´æ–° sudo apt update sudo apt upgrade -y sudo apt autoremove sudo apt clean # æ—¥å¿—æ¸…ç† sudo find /var/log -type f -name "*.log" -mtime +30 -delete sudo find /var/log -type f -name "*.gz" -delete # æœåŠ¡çŠ¶æ€æ£€æŸ¥ systemctl status nginx ps aux | grep llama-server å…­ã€å®‰å…¨é…ç½® 1. é˜²ç«å¢™è®¾ç½® # å®‰è£… UFW sudo apt install ufw # é…ç½®åŸºæœ¬è§„åˆ™ sudo ufw default deny incoming sudo ufw default allow outgoing sudo ufw allow 22 sudo ufw allow 80 sudo ufw allow 8080 # å¯ç”¨é˜²ç«å¢™ sudo ufw enable # æ£€æŸ¥çŠ¶æ€ sudo ufw status 2. Nginx è®¿é—®æ§åˆ¶ # å®‰è£…è®¤è¯å·¥å…· sudo apt install apache2-utils # åˆ›å»ºç”¨æˆ·å¯†ç  sudo htpasswd -c /etc/nginx/.htpasswd username # ä¿®æ”¹ Nginx é…ç½® sudo nano /etc/nginx/sites-available/myblog server { listen 80; server_name 10.40.110.47; root /home/zhaoxiongzhou/myblog/public; index index.html; # æ·»åŠ åŸºæœ¬è®¤è¯ location / { auth_basic "Restricted Access"; auth_basic_user_file /etc/nginx/.htpasswd; try_files $uri $uri/ =404; } # æ—¥å¿—é…ç½® access_log /var/log/nginx/myblog_access.log; error_log /var/log/nginx/myblog_error.log; } 3. æ—¥å¿—ç›‘æ§ # å®‰è£…æ—¥å¿—ç›‘æ§å·¥å…· sudo apt install logwatch # é…ç½®æ—¥å¿—ç›‘æ§ sudo nano /etc/logwatch/conf/logwatch.conf # é…ç½®æ¯æ—¥æ—¥å¿—æ£€æŸ¥ Output = mail Format = html MailTo = your-email@domain.com Detail = High ä¸ƒã€æ•…éšœæ’é™¤æŒ‡å— å†…å­˜ç›¸å…³é—®é¢˜ # æ£€æŸ¥å†…å­˜çŠ¶æ€ free -h ps aux --sort=-%mem | head # å¦‚æœå†…å­˜ä¸è¶³ï¼Œè°ƒæ•´æœåŠ¡å‚æ•° nano ~/projects/llama.cpp/start-llama.sh # é™ä½èµ„æºä½¿ç”¨çš„å‚æ•°ç¤ºä¾‹ --ctx-size 1024 \ --batch-size 128 \ --threads 1 æœåŠ¡æ— å“åº” # æ£€æŸ¥è¿›ç¨‹ ps aux | grep llama-server # æ£€æŸ¥ç«¯å£ netstat -tuln | grep 8080 # é‡å¯æœåŠ¡ pkill llama-server ./start-llama.sh # æ£€æŸ¥æ—¥å¿— tail -f ~/projects/llama.cpp/llama.log 2. åšå®¢æœåŠ¡æ•…éšœæ’é™¤ Nginx é—®é¢˜ # æ£€æŸ¥é…ç½®è¯­æ³• sudo nginx -t # æ£€æŸ¥æ—¥å¿— sudo tail -f /var/log/nginx/error.log sudo tail -f /var/log/nginx/myblog_error.log # æ£€æŸ¥æœåŠ¡çŠ¶æ€ sudo systemctl status nginx # é‡å¯æœåŠ¡ sudo systemctl restart nginx Hugo ç”Ÿæˆé—®é¢˜ # æ¸…ç†ç¼“å­˜ rm -rf ~/myblog/public rm -rf ~/myblog/resources # æ›´æ–°ä¸»é¢˜ git submodule update --init --recursive # é‡æ–°ç”Ÿæˆï¼ˆè¯¦ç»†æ¨¡å¼ï¼‰ hugo --verbose å…«ã€ç³»ç»Ÿçº§æ•…éšœæ’é™¤ 1. ç£ç›˜é—®é¢˜ # æ£€æŸ¥ç£ç›˜ä½¿ç”¨æƒ…å†µ df -h du -sh /* # æŸ¥æ‰¾å¤§æ–‡ä»¶ sudo find / -type f -size +100M # æ¸…ç†ç©ºé—´ sudo apt clean sudo apt autoremove sudo journalctl --vacuum-time=7d 2. ç½‘ç»œé—®é¢˜ # ç½‘ç»œçŠ¶æ€æ£€æŸ¥ ip addr show ping -c 4 8.8.8.8 netstat -tuln # DNS æ£€æŸ¥ cat /etc/resolv.conf nslookup google.com # é‡å¯ç½‘ç»œæœåŠ¡ sudo systemctl restart networking sudo systemctl restart wpa_supplicant 3. æ€§èƒ½é—®é¢˜ # CPU æ¸©åº¦ç›‘æ§ vcgencmd measure_temp watch -n 1 vcgencmd measure_temp # CPU é¢‘ç‡æ£€æŸ¥ vcgencmd measure_clock arm cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_cur_freq # ç³»ç»Ÿè´Ÿè½½æ£€æŸ¥ uptime cat /proc/loadavg ä¹ã€ç»´æŠ¤æœ€ä½³å®è·µ 1. æ—¥å¸¸ç»´æŠ¤æ¸…å• æ£€æŸ¥ç³»ç»Ÿæ—¥å¿— ç›‘æ§èµ„æºä½¿ç”¨ éªŒè¯æœåŠ¡çŠ¶æ€ æ£€æŸ¥å¤‡ä»½çŠ¶æ€ æ›´æ–°ç³»ç»Ÿå®‰å…¨è¡¥ä¸ 2. å‘¨æœŸæ€§ç»´æŠ¤ä»»åŠ¡ æ¸…ç†æ—§æ—¥å¿—å’Œä¸´æ—¶æ–‡ä»¶ éªŒè¯å¤‡ä»½å®Œæ•´æ€§ æ£€æŸ¥ç³»ç»Ÿæ›´æ–° æ£€æŸ¥æœåŠ¡æ€§èƒ½ æ›´æ–°æ–‡æ¡£å’Œé…ç½®è¯´æ˜ 3. åº”æ€¥é¢„æ¡ˆ ä¿å­˜æ‰€æœ‰é…ç½®æ–‡ä»¶çš„å¤‡ä»½ è®°å½•æ‰€æœ‰æœåŠ¡çš„é…ç½®æ­¥éª¤ ç»´æŠ¤é—®é¢˜è§£å†³æ–¹æ¡ˆæ–‡æ¡£ å»ºç«‹æœåŠ¡æ¢å¤æµç¨‹ ä¿æŒé‡è¦æ•°æ®çš„å¤šä»½å¤‡ä»½ åã€æ€§èƒ½ä¼˜åŒ–å»ºè®® 1. ç³»ç»Ÿçº§ä¼˜åŒ– # 1. è°ƒæ•´ SWAP è®¾ç½® sudo nano /etc/sysctl.conf # æ·»åŠ æˆ–ä¿®æ”¹ä»¥ä¸‹å‚æ•° vm.swappiness=60 vm.vfs_cache_pressure=50 vm.dirty_background_ratio=5 vm.dirty_ratio=10 # 2. ä¼˜åŒ–æ–‡ä»¶ç³»ç»Ÿ # æ£€æŸ¥å¹¶ä¼˜åŒ–æ–‡ä»¶ç³»ç»Ÿ sudo tune2fs -o journal_data_writeback /dev/mmcblk0p2 # 3. è°ƒæ•´ CPU æ€§èƒ½ sudo nano /boot/config.txt # æ·»åŠ ä»¥ä¸‹é…ç½® arm_freq=1800 over_voltage=6 gpu_freq=500 dtparam=audio=on 2. æœåŠ¡ä¼˜åŒ– AI æœåŠ¡ä¼˜åŒ– # è°ƒæ•´æœåŠ¡å‚æ•° nano ~/projects/llama.cpp/start-llama.sh # ä¼˜åŒ–å‚æ•°ç¤ºä¾‹ --ctx-size 2048 \ --threads 2 \ --batch-size 256 \ --keep-context \ --mlock \ --numa Nginx ä¼˜åŒ– sudo nano /etc/nginx/nginx.conf worker_processes auto; worker_rlimit_nofile 65535; events { worker_connections 1024; multi_accept on; use epoll; } http { sendfile on; tcp_nopush on; tcp_nodelay on; keepalive_timeout 65; types_hash_max_size 2048; server_tokens off; # ç¼“å­˜è®¾ç½® open_file_cache max=1000 inactive=20s; open_file_cache_valid 30s; open_file_cache_min_uses 2; open_file_cache_errors on; } åä¸€ã€ç›‘æ§ä¸æŠ¥è­¦ç³»ç»Ÿ 1. ç³»ç»Ÿç›‘æ§é…ç½® # å®‰è£…ç›‘æ§å·¥å…· sudo apt install prometheus node-exporter grafana # é…ç½® Prometheus sudo nano /etc/prometheus/prometheus.yml global: scrape_interval: 15s scrape_configs: - job_name: &#39;node&#39; static_configs: - targets: [&#39;localhost:9100&#39;] - job_name: &#39;nginx&#39; static_configs: - targets: [&#39;localhost:9113&#39;] 2. è‡ªåŠ¨æŠ¥è­¦è„šæœ¬ # åˆ›å»ºç›‘æ§è„šæœ¬ nano ~/monitor.sh #!/bin/bash # å®šä¹‰é˜ˆå€¼ MAX_CPU_USAGE=90 MAX_MEM_USAGE=90 MAX_DISK_USAGE=90 MAX_TEMP=75 # è·å–ç³»ç»Ÿæ•°æ® CPU_USAGE=$(top -bn1 | grep "Cpu(s)" | awk &#39;{print $2}&#39; | cut -d. -f1) MEM_USAGE=$(free | grep Mem | awk &#39;{print $3/$2 * 100.0}&#39;) DISK_USAGE=$(df -h / | awk &#39;NR==2 {print $5}&#39; | cut -d% -f1) TEMP=$(vcgencmd measure_temp | cut -d= -f2 | cut -d. -f1) # æ£€æŸ¥æœåŠ¡çŠ¶æ€ check_services() { services=("nginx" "llama-server") for service in "${services[@]}"; do if ! pgrep -x "$service" > /dev/null; then echo "è­¦å‘Š: $service æœåŠ¡æœªè¿è¡Œ!" # å¯ä»¥æ·»åŠ é‡å¯æœåŠ¡çš„å‘½ä»¤ fi done } # å‘é€è­¦å‘Š send_alert() { message="$1" # è¿™é‡Œå¯ä»¥æ·»åŠ å‘é€é‚®ä»¶æˆ–å…¶ä»–é€šçŸ¥çš„å‘½ä»¤ echo "$message" >> /var/log/system_alerts.log } # æ£€æŸ¥å„é¡¹æŒ‡æ ‡ if [ "$CPU_USAGE" -gt "$MAX_CPU_USAGE" ]; then send_alert "CPU ä½¿ç”¨ç‡è¿‡é«˜: $CPU_USAGE%" fi if [ "${MEM_USAGE%.*}" -gt "$MAX_MEM_USAGE" ]; then send_alert "å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜: $MEM_USAGE%" fi if [ "$DISK_USAGE" -gt "$MAX_DISK_USAGE" ]; then send_alert "ç£ç›˜ä½¿ç”¨ç‡è¿‡é«˜: $DISK_USAGE%" fi if [ "$TEMP" -gt "$MAX_TEMP" ]; then send_alert "ç³»ç»Ÿæ¸©åº¦è¿‡é«˜: $TEMPÂ°C" fi # æ£€æŸ¥æœåŠ¡çŠ¶æ€ check_services # è®¾ç½®æ‰§è¡Œæƒé™ chmod +x ~/monitor.sh # æ·»åŠ åˆ° crontab crontab -e # æ¯5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ç›‘æ§ */5 * * * * /home/zhaoxiongzhou/monitor.sh åäºŒã€æ•°æ®å¤‡ä»½ä¸æ¢å¤ 1. å®Œæ•´å¤‡ä»½æ–¹æ¡ˆ # åˆ›å»ºå®Œæ•´å¤‡ä»½è„šæœ¬ nano ~/full-backup.sh #!/bin/bash BACKUP_ROOT="/home/zhaoxiongzhou/backups" DATE=$(date +%Y%m%d_%H%M%S) BACKUP_DIR="$BACKUP_ROOT/$DATE" # åˆ›å»ºå¤‡ä»½ç›®å½• mkdir -p "$BACKUP_DIR" # å¤‡ä»½åšå®¢å†…å®¹ echo "å¤‡ä»½åšå®¢å†…å®¹..." tar -czf "$BACKUP_DIR/blog_content.tar.gz" ~/myblog/content tar -czf "$BACKUP_DIR/blog_config.tar.gz" ~/myblog/config.toml # å¤‡ä»½ AI æ¨¡å‹å’Œé…ç½® echo "å¤‡ä»½ AI æœåŠ¡..." tar -czf "$BACKUP_DIR/llama_models.tar.gz" ~/projects/llama.cpp/models tar -czf "$BACKUP_DIR/llama_config.tar.gz" ~/projects/llama.cpp/start-llama.sh # å¤‡ä»½ Nginx é…ç½® echo "å¤‡ä»½ Nginx é…ç½®..." sudo tar -czf "$BACKUP_DIR/nginx_config.tar.gz" /etc/nginx/sites-available/myblog # å¤‡ä»½ç³»ç»Ÿé…ç½® echo "å¤‡ä»½ç³»ç»Ÿé…ç½®..." sudo tar -czf "$BACKUP_DIR/system_config.tar.gz" /boot/config.txt /etc/fstab # åˆ›å»ºå¤‡ä»½æ¸…å• echo "åˆ›å»ºå¤‡ä»½æ¸…å•..." find "$BACKUP_DIR" -type f -exec sha256sum {} \; > "$BACKUP_DIR/checksum.txt" # æ¸…ç†æ—§å¤‡ä»½ï¼ˆä¿ç•™æœ€è¿‘7ä»½ï¼‰ cd "$BACKUP_ROOT" ls -t | tail -n +8 | xargs -r rm -r echo "å¤‡ä»½å®Œæˆ: $BACKUP_DIR" 2. æ•°æ®æ¢å¤æµç¨‹ # åˆ›å»ºæ¢å¤è„šæœ¬ nano ~/restore.sh #!/bin/bash if [ -z "$1" ]; then echo "ä½¿ç”¨æ–¹æ³•: $0 <å¤‡ä»½ç›®å½•>" exit 1 fi BACKUP_DIR="$1" # éªŒè¯å¤‡ä»½å®Œæ•´æ€§ echo "éªŒè¯å¤‡ä»½å®Œæ•´æ€§..." cd "$BACKUP_DIR" sha256sum -c checksum.txt || { echo "å¤‡ä»½éªŒè¯å¤±è´¥ï¼" exit 1 } # æ¢å¤åšå®¢å†…å®¹ echo "æ¢å¤åšå®¢å†…å®¹..." tar -xzf "$BACKUP_DIR/blog_content.tar.gz" -C ~/myblog/ tar -xzf "$BACKUP_DIR/blog_config.tar.gz" -C ~/myblog/ # æ¢å¤ AI æœåŠ¡ echo "æ¢å¤ AI æœåŠ¡..." tar -xzf "$BACKUP_DIR/llama_models.tar.gz" -C ~/projects/llama.cpp/ tar -xzf "$BACKUP_DIR/llama_config.tar.gz" -C ~/projects/llama.cpp/ # æ¢å¤ Nginx é…ç½® echo "æ¢å¤ Nginx é…ç½®..." sudo tar -xzf "$BACKUP_DIR/nginx_config.tar.gz" -C /etc/nginx/sites-available/ # æ¢å¤ç³»ç»Ÿé…ç½® echo "æ¢å¤ç³»ç»Ÿé…ç½®..." sudo tar -xzf "$BACKUP_DIR/system_config.tar.gz" -C / # é‡å¯æœåŠ¡ echo "é‡å¯æœåŠ¡..." sudo systemctl restart nginx pkill llama-server ~/projects/llama.cpp/start-llama.sh echo "æ¢å¤å®Œæˆ" åä¸‰ã€æœåŠ¡å‡çº§æŒ‡å— 1. Hugo åšå®¢å‡çº§ # 1. å¤‡ä»½å½“å‰ç‰ˆæœ¬ cd ~ tar -czf hugo_backup_$(date +%Y%m%d).tar.gz myblog/ # 2. æ£€æŸ¥å½“å‰ç‰ˆæœ¬ hugo version # 3. ä¸‹è½½æ–°ç‰ˆæœ¬ wget https://github.com/gohugoio/hugo/releases/download/v[æ–°ç‰ˆæœ¬]/hugo_extended_[æ–°ç‰ˆæœ¬]_linux-arm64.deb # 4. å®‰è£…æ–°ç‰ˆæœ¬ sudo dpkg -i hugo_extended_[æ–°ç‰ˆæœ¬]_linux-arm64.deb # 5. æ›´æ–°ä¸»é¢˜ cd ~/myblog git submodule update --remote themes/ananke # 6. æµ‹è¯•ç”Ÿæˆ hugo --verbose # 7. éƒ¨ç½²æ›´æ–° ./deploy-blog.sh 2. AI æœåŠ¡å‡çº§ # 1. å¤‡ä»½å½“å‰ç‰ˆæœ¬ cd ~/projects tar -czf llama_backup_$(date +%Y%m%d).tar.gz llama.cpp/ # 2. æ›´æ–°æºç  cd llama.cpp git pull origin master # 3. é‡æ–°ç¼–è¯‘ make clean LLAMA_METAL=1 make -j4 # 4. æµ‹è¯•æ–°ç‰ˆæœ¬ ./llama-server -h # 5. æ›´æ–°å¯åŠ¨è„šæœ¬ nano start-llama.sh 3. ç³»ç»Ÿå‡çº§ # 1. æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ sudo apt update # 2. å‡çº§æ‰€æœ‰åŒ… sudo apt upgrade -y # 3. å‡çº§ç³»ç»Ÿ sudo apt dist-upgrade -y # 4. æ¸…ç†æ—§åŒ… sudo apt autoremove -y sudo apt clean # 5. æ£€æŸ¥å¯åŠ¨é¡¹ sudo systemctl list-unit-files --state=enabled # 6. æ›´æ–°æ ‘è“æ´¾å›ºä»¶ sudo rpi-update # 7. æ£€æŸ¥ç³»ç»ŸçŠ¶æ€ sudo systemctl --failed sudo journalctl -p 3 -xb åå››ã€å®‰å…¨åŠ å›ºæŒ‡å— 1. ç³»ç»Ÿå®‰å…¨é…ç½® # 1. SSH å®‰å…¨é…ç½® sudo nano /etc/ssh/sshd_config # SSH é…ç½®å»ºè®® Port 22222 # ä¿®æ”¹é»˜è®¤ç«¯å£ PermitRootLogin no # ç¦æ­¢ root ç™»å½• PasswordAuthentication no # ç¦ç”¨å¯†ç è®¤è¯ PubkeyAuthentication yes # å¯ç”¨å¯†é’¥è®¤è¯ AllowUsers zhaoxiongzhou # é™åˆ¶å…è®¸çš„ç”¨æˆ· # 2. è®¾ç½®é˜²ç«å¢™è§„åˆ™ sudo apt install ufw fail2ban # é…ç½® UFW sudo ufw default deny incoming sudo ufw default allow outgoing sudo ufw allow 22222/tcp # SSH sudo ufw allow 80/tcp # HTTP sudo ufw allow 8080/tcp # AI æœåŠ¡ sudo ufw enable # é…ç½® fail2ban sudo nano /etc/fail2ban/jail.local [sshd] enabled = true port = 22222 filter = sshd logpath = /var/log/auth.log maxretry = 3 bantime = 3600 2. æœåŠ¡å®‰å…¨é…ç½® Nginx å®‰å…¨è®¾ç½® # 1. åˆ›å»º SSL è¯ä¹¦ sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 \ -keyout /etc/nginx/ssl/nginx.key \ -out /etc/nginx/ssl/nginx.crt # 2. é…ç½® HTTPS sudo nano /etc/nginx/sites-available/myblog server { listen 443 ssl; server_name 10.40.110.47; ssl_certificate /etc/nginx/ssl/nginx.crt; ssl_certificate_key /etc/nginx/ssl/nginx.key; # SSL é…ç½® ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers on; ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options "SAMEORIGIN"; add_header X-XSS-Protection "1; mode=block"; add_header X-Content-Type-Options "nosniff"; add_header Strict-Transport-Security "max-age=31536000"; # å…¶ä»–é…ç½®... } åäº”ã€æ€§èƒ½ç›‘æ§ä¸åˆ†æ 1. ç›‘æ§è„šæœ¬é…ç½® # åˆ›å»ºç»¼åˆç›‘æ§è„šæœ¬ nano ~/system_monitor.sh #!/bin/bash LOG_FILE="/var/log/system_monitor.log" ALERT_FILE="/var/log/system_alerts.log" # è®°å½•æ—¶é—´æˆ³ timestamp() { date "+%Y-%m-%d %H:%M:%S" } # ç³»ç»Ÿèµ„æºç›‘æ§ monitor_resources() { echo "=== ç³»ç»Ÿèµ„æºç›‘æ§ $(timestamp) ===" >> "$LOG_FILE" # CPU ä½¿ç”¨ç‡ CPU_USAGE=$(top -bn1 | grep "Cpu(s)" | awk &#39;{print $2}&#39;) echo "CPU ä½¿ç”¨ç‡: $CPU_USAGE%" >> "$LOG_FILE" # å†…å­˜ä½¿ç”¨ free -h | grep "Mem:" >> "$LOG_FILE" # ç£ç›˜ä½¿ç”¨ df -h / >> "$LOG_FILE" # ç³»ç»Ÿè´Ÿè½½ uptime >> "$LOG_FILE" # CPU æ¸©åº¦ vcgencmd measure_temp >> "$LOG_FILE" } # æœåŠ¡çŠ¶æ€ç›‘æ§ monitor_services() { echo "=== æœåŠ¡çŠ¶æ€ç›‘æ§ $(timestamp) ===" >> "$LOG_FILE" # Nginx çŠ¶æ€ if systemctl is-active nginx >/dev/null 2>&amp;1; then echo "Nginx: è¿è¡Œä¸­" >> "$LOG_FILE" else echo "è­¦å‘Š: Nginx æœªè¿è¡Œ!" >> "$ALERT_FILE" fi # AI æœåŠ¡çŠ¶æ€ if pgrep -f llama-server >/dev/null; then echo "AI æœåŠ¡: è¿è¡Œä¸­" >> "$LOG_FILE" else echo "è­¦å‘Š: AI æœåŠ¡æœªè¿è¡Œ!" >> "$ALERT_FILE" fi } # ç½‘ç»œç›‘æ§ monitor_network() { echo "=== ç½‘ç»œç›‘æ§ $(timestamp) ===" >> "$LOG_FILE" # ç½‘ç»œè¿æ¥æ•° netstat -an | grep ESTABLISHED | wc -l >> "$LOG_FILE" # ç½‘ç»œæµé‡ ifconfig wlan0 | grep bytes >> "$LOG_FILE" } # ä¸»å‡½æ•° main() { monitor_resources monitor_services monitor_network # æ£€æŸ¥æ˜¯å¦éœ€è¦å‘é€è­¦å‘Š if [ -s "$ALERT_FILE" ]; then # å¯ä»¥æ·»åŠ å‘é€è­¦å‘Šçš„å‘½ä»¤ï¼ˆå¦‚é‚®ä»¶é€šçŸ¥ï¼‰ cat "$ALERT_FILE" fi } # æ‰§è¡Œç›‘æ§ main 2. æ€§èƒ½åˆ†æå·¥å…· # å®‰è£…æ€§èƒ½åˆ†æå·¥å…· sudo apt install sysstat iotop htop # åˆ›å»ºæ€§èƒ½æ•°æ®æ”¶é›†è„šæœ¬ nano ~/collect_performance.sh åå…­ã€æ€§èƒ½æ•°æ®æ”¶é›†ä¸åˆ†æ 1. æ€§èƒ½æ•°æ®æ”¶é›†è„šæœ¬ #!/bin/bash # ~/collect_performance.sh PERF_DIR="/home/zhaoxiongzhou/performance_data" DATE=$(date +%Y%m%d_%H%M%S) # åˆ›å»ºæ•°æ®ç›®å½• mkdir -p "$PERF_DIR/$DATE" # CPU æ€§èƒ½æ•°æ® mpstat 1 60 > "$PERF_DIR/$DATE/cpu_stats.log" & # å†…å­˜ä½¿ç”¨æ•°æ® vmstat 1 60 > "$PERF_DIR/$DATE/memory_stats.log" & # IO æ€§èƒ½æ•°æ® iostat -x 1 60 > "$PERF_DIR/$DATE/io_stats.log" & # ç½‘ç»œæ€§èƒ½æ•°æ® sar -n DEV 1 60 > "$PERF_DIR/$DATE/network_stats.log" & # è¿›ç¨‹æ€§èƒ½æ•°æ® ps aux --sort=-%cpu | head -n 20 > "$PERF_DIR/$DATE/top_processes.log" # ç³»ç»Ÿè´Ÿè½½æ•°æ® uptime > "$PERF_DIR/$DATE/load_average.log" # ç­‰å¾…æ‰€æœ‰åå°è¿›ç¨‹å®Œæˆ wait # å‹ç¼©æ•°æ® tar -czf "$PERF_DIR/performance_${DATE}.tar.gz" "$PERF_DIR/$DATE" rm -rf "$PERF_DIR/$DATE" 2. æ€§èƒ½æ•°æ®åˆ†æè„šæœ¬ # åˆ›å»ºåˆ†æè„šæœ¬ nano ~/analyze_performance.sh #!/bin/bash # ~/analyze_performance.sh PERF_DIR="/home/zhaoxiongzhou/performance_data" REPORT_DIR="/home/zhaoxiongzhou/performance_reports" DATE=$(date +%Y%m%d) mkdir -p "$REPORT_DIR" generate_report() { local REPORT_FILE="$REPORT_DIR/report_${DATE}.txt" echo "æ€§èƒ½åˆ†ææŠ¥å‘Š - $(date)" > "$REPORT_FILE" echo "===================" >> "$REPORT_FILE" # CPU ä½¿ç”¨åˆ†æ echo -e "\nCPU ä½¿ç”¨æƒ…å†µ:" >> "$REPORT_FILE" awk &#39;/all/ {total += $3; count++} END {print "å¹³å‡CPUä½¿ç”¨ç‡: " total/count "%"}&#39; \ "$PERF_DIR/latest/cpu_stats.log" >> "$REPORT_FILE" # å†…å­˜ä½¿ç”¨åˆ†æ echo -e "\nå†…å­˜ä½¿ç”¨æƒ…å†µ:" >> "$REPORT_FILE" free -h | grep "Mem:" >> "$REPORT_FILE" # IO æ€§èƒ½åˆ†æ echo -e "\nIO æ€§èƒ½:" >> "$REPORT_FILE" tail -n 10 "$PERF_DIR/latest/io_stats.log" >> "$REPORT_FILE" # ç½‘ç»œæ€§èƒ½åˆ†æ echo -e "\nç½‘ç»œæ€§èƒ½:" >> "$REPORT_FILE" tail -n 10 "$PERF_DIR/latest/network_stats.log" >> "$REPORT_FILE" # è¿›ç¨‹åˆ†æ echo -e "\nèµ„æºå ç”¨æœ€é«˜çš„è¿›ç¨‹:" >> "$REPORT_FILE" head -n 5 "$PERF_DIR/latest/top_processes.log" >> "$REPORT_FILE" echo -e "\nåˆ†æå®Œæˆã€‚æŠ¥å‘Šä¿å­˜åœ¨: $REPORT_FILE" } # ç”ŸæˆæŠ¥å‘Š generate_report åä¸ƒã€è‡ªåŠ¨åŒ–è¿ç»´è„šæœ¬ 1. æœåŠ¡å¥åº·æ£€æŸ¥ä¸è‡ªåŠ¨æ¢å¤ # åˆ›å»ºæœåŠ¡ç›‘æ§è„šæœ¬ nano ~/service_health_check.sh #!/bin/bash # ~/service_health_check.sh LOG_FILE="/var/log/service_health.log" ALERT_SCRIPT="/home/zhaoxiongzhou/send_alert.sh" log_message() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" >> "$LOG_FILE" } check_and_restart_service() { local service_name="$1" local process_pattern="$2" if ! pgrep -f "$process_pattern" > /dev/null; then log_message "è­¦å‘Š: $service_name æœåŠ¡æœªè¿è¡Œï¼Œå°è¯•é‡å¯" case "$service_name" in "nginx") sudo systemctl restart nginx ;; "llama-server") cd ~/projects/llama.cpp ./start-llama.sh ;; esac # ç­‰å¾…æœåŠ¡å¯åŠ¨ sleep 10 # éªŒè¯æœåŠ¡æ˜¯å¦æˆåŠŸé‡å¯ if pgrep -f "$process_pattern" > /dev/null; then log_message "$service_name æœåŠ¡å·²æˆåŠŸé‡å¯" "$ALERT_SCRIPT" "$service_name æœåŠ¡å·²è‡ªåŠ¨é‡å¯" else log_message "é”™è¯¯: $service_name æœåŠ¡é‡å¯å¤±è´¥" "$ALERT_SCRIPT" "è­¦å‘Š: $service_name æœåŠ¡é‡å¯å¤±è´¥ï¼Œéœ€è¦æ‰‹åŠ¨å¹²é¢„" fi else log_message "$service_name æœåŠ¡è¿è¡Œæ­£å¸¸" fi } # æ£€æŸ¥å„ä¸ªæœåŠ¡ check_and_restart_service "nginx" "nginx" check_and_restart_service "llama-server" "llama-server" # æ¸…ç†æ—§æ—¥å¿— find "$LOG_FILE" -mtime +30 -delete 2. è‡ªåŠ¨å¤‡ä»½ä¸æ¸…ç† # åˆ›å»ºè‡ªåŠ¨ç»´æŠ¤è„šæœ¬ nano ~/auto_maintenance.sh #!/bin/bash # ~/auto_maintenance.sh BACKUP_DIR="/home/zhaoxiongzhou/backups" LOG_DIR="/var/log" DATE=$(date +%Y%m%d) # åˆ›å»ºå¤‡ä»½ create_backups() { # åšå®¢å¤‡ä»½ tar -czf "$BACKUP_DIR/blog_$DATE.tar.gz" ~/myblog/content # AI æœåŠ¡é…ç½®å¤‡ä»½ tar -czf "$BACKUP_DIR/llama_config_$DATE.tar.gz" ~/projects/llama.cpp/start-llama.sh # Nginx é…ç½®å¤‡ä»½ sudo tar -czf "$BACKUP_DIR/nginx_config_$DATE.tar.gz" /etc/nginx/sites-available/ } # æ¸…ç†æ—§æ–‡ä»¶ cleanup_old_files() { # åˆ é™¤30å¤©å‰çš„å¤‡ä»½ find "$BACKUP_DIR" -name "*.tar.gz" -mtime +30 -delete # æ¸…ç†æ—¥å¿— sudo find "$LOG_DIR" -name "*.log" -mtime +30 -delete sudo find "$LOG_DIR" -name "*.gz" -mtime +30 -delete # æ¸…ç†ç³»ç»Ÿä¸´æ—¶æ–‡ä»¶ sudo rm -rf /tmp/* sudo rm -rf /var/tmp/* } # ä¸»å‡½æ•° main() { create_backups cleanup_old_files # å‹ç¼©æ—¥å¿— sudo logrotate -f /etc/logrotate.conf # æ¸…ç†åŒ…ç¼“å­˜ sudo apt clean sudo apt autoremove -y } # æ‰§è¡Œç»´æŠ¤ä»»åŠ¡ main åå…«ã€æ—¥å¿—ç®¡ç†ç³»ç»Ÿ 1. é›†ä¸­å¼æ—¥å¿—é…ç½® # åˆ›å»ºæ—¥å¿—ç®¡ç†è„šæœ¬ nano ~/log_management.sh #!/bin/bash # ~/log_management.sh LOG_BASE="/var/log/services" ARCHIVE_DIR="/home/zhaoxiongzhou/log_archives" DATE=$(date +%Y%m%d) # åˆ›å»ºæ—¥å¿—ç›®å½• mkdir -p "$LOG_BASE"/{nginx,ai_service,system} mkdir -p "$ARCHIVE_DIR" # é…ç½®æ—¥å¿—è½®è½¬ sudo tee /etc/logrotate.d/custom_services << EOF $LOG_BASE/nginx/*.log { daily missingok rotate 14 compress delaycompress notifempty create 0640 www-data adm sharedscripts postrotate [ -f /var/run/nginx.pid ] && kill -USR1 \$(cat /var/run/nginx.pid) endscript } $LOG_BASE/ai_service/*.log { daily missingok rotate 14 compress delaycompress notifempty create 0640 zhaoxiongzhou adm } $LOG_BASE/system/*.log { daily missingok rotate 30 compress delaycompress notifempty create 0640 root adm } EOF # æ—¥å¿—åˆ†æå‡½æ•° analyze_logs() { local log_file="$1" local output_file="$2" echo "=== æ—¥å¿—åˆ†ææŠ¥å‘Š $(date) ===" > "$output_file" # é”™è¯¯ç»Ÿè®¡ echo -e "\né”™è¯¯ç»Ÿè®¡:" >> "$output_file" grep -i "error" "$log_file" | sort | uniq -c | sort -nr >> "$output_file" # è­¦å‘Šç»Ÿè®¡ echo -e "\nè­¦å‘Šç»Ÿè®¡:" >> "$output_file" grep -i "warning" "$log_file" | sort | uniq -c | sort -nr >> "$output_file" # è®¿é—®ç»Ÿè®¡ï¼ˆé’ˆå¯¹ Nginx è®¿é—®æ—¥å¿—ï¼‰ if [[ "$log_file" == *"nginx/access"* ]]; then echo -e "\nè®¿é—®é‡ç»Ÿè®¡:" >> "$output_file" awk &#39;{print $1}&#39; "$log_file" | sort | uniq -c | sort -nr | head -n 10 >> "$output_file" fi } # æ—¥å¿—å½’æ¡£å‡½æ•° archive_logs() { local source_dir="$1" local archive_name="logs_${DATE}.tar.gz" find "$source_dir" -name "*.log.*" -mtime +14 -exec tar -czf "$ARCHIVE_DIR/$archive_name" {} + find "$source_dir" -name "*.log.*" -mtime +14 -delete } 2. æ—¥å¿—ç›‘æ§å‘Šè­¦ # åˆ›å»ºæ—¥å¿—ç›‘æ§è„šæœ¬ nano ~/log_monitor.sh #!/bin/bash # ~/log_monitor.sh ALERT_THRESHOLD=10 # é”™è¯¯é˜ˆå€¼ ALERT_SCRIPT="/home/zhaoxiongzhou/send_alert.sh" # ç›‘æ§ç‰¹å®šå…³é”®è¯ monitor_keywords() { local log_file="$1" local keywords=("error" "critical" "failed" "timeout" "exception") for keyword in "${keywords[@]}"; do count=$(grep -i "$keyword" "$log_file" | wc -l) if [ "$count" -gt "$ALERT_THRESHOLD" ]; then "$ALERT_SCRIPT" "è­¦å‘Š: $log_file ä¸­å‘ç°å¤§é‡ $keyword ($count æ¬¡)" fi done } # ç›‘æ§æ—¥å¿—å¤§å° check_log_size() { local log_file="$1" local max_size=$((100 * 1024 * 1024)) # 100MB size=$(stat -f%z "$log_file") if [ "$size" -gt "$max_size" ]; then "$ALERT_SCRIPT" "è­¦å‘Š: $log_file å¤§å°è¶…è¿‡ 100MB" fi } # ä¸»ç›‘æ§å¾ªç¯ main() { while true; do for log_file in "$LOG_BASE"/**/*.log; do monitor_keywords "$log_file" check_log_size "$log_file" done sleep 300 # æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ done } main & åä¹ã€ç³»ç»Ÿä¼˜åŒ–ä¸è°ƒä¼˜ 1. ç³»ç»Ÿå‚æ•°ä¼˜åŒ– # åˆ›å»ºç³»ç»Ÿä¼˜åŒ–è„šæœ¬ nano ~/system_optimize.sh #!/bin/bash # ~/system_optimize.sh # ç³»ç»Ÿå‚æ•°ä¼˜åŒ– optimize_sysctl() { sudo tee /etc/sysctl.d/99-custom.conf << EOF # å†…å­˜ç®¡ç†ä¼˜åŒ– vm.swappiness = 60 vm.vfs_cache_pressure = 50 vm.dirty_background_ratio = 5 vm.dirty_ratio = 10 # ç½‘ç»œä¼˜åŒ– net.core.somaxconn = 1024 net.core.netdev_max_backlog = 5000 net.ipv4.tcp_max_syn_backlog = 2048 net.ipv4.tcp_fin_timeout = 20 net.ipv4.tcp_keepalive_time = 1200 net.ipv4.tcp_keepalive_intvl = 15 net.ipv4.tcp_keepalive_probes = 5 # æ–‡ä»¶ç³»ç»Ÿä¼˜åŒ– fs.file-max = 65535 fs.inotify.max_user_watches = 524288 EOF # åº”ç”¨æ–°çš„ç³»ç»Ÿå‚æ•° sudo sysctl -p /etc/sysctl.d/99-custom.conf } # CPU é¢‘ç‡ä¼˜åŒ– optimize_cpu() { sudo tee /boot/config.txt << EOF # CPU è®¾ç½® arm_freq=1800 over_voltage=6 gpu_freq=500 # æ¸©åº¦æ§åˆ¶ temp_limit=75 EOF } # æœåŠ¡ä¼˜åŒ– optimize_services() { # ç¦ç”¨ä¸å¿…è¦çš„æœåŠ¡ UNNECESSARY_SERVICES=( "bluetooth" "cups" "avahi-daemon" ) for service in "${UNNECESSARY_SERVICES[@]}"; do if systemctl is-enabled "$service" &>/dev/null; then sudo systemctl disable "$service" sudo systemctl stop "$service" fi done } # å†…å­˜ä¼˜åŒ– optimize_memory() { # è°ƒæ•´ ZRAM sudo tee /etc/default/zramswap << EOF ALGO=lz4 PERCENT=50 EOF # é‡å¯ ZRAM æœåŠ¡ sudo systemctl restart zramswap } 2. æœåŠ¡ä¼˜åŒ–é…ç½® # Nginx ä¼˜åŒ–é…ç½® sudo nano /etc/nginx/nginx.conf user www-data; worker_processes auto; worker_rlimit_nofile 65535; events { worker_connections 1024; multi_accept on; use epoll; } http { # åŸºç¡€è®¾ç½® sendfile on; tcp_nopush on; tcp_nodelay on; keepalive_timeout 65; types_hash_max_size 2048; server_tokens off; # MIME ç±»å‹ include /etc/nginx/mime.types; default_type application/octet-stream; # æ—¥å¿—æ ¼å¼ log_format main &#39;$remote_addr - $remote_user [$time_local] "$request" &#39; &#39;$status $body_bytes_sent "$http_referer" &#39; &#39;"$http_user_agent" "$http_x_forwarded_for"&#39;; # ç¼“å†²åŒºè®¾ç½® client_body_buffer_size 10K; client_header_buffer_size 1k; client_max_body_size 8m; large_client_header_buffers 2 1k; # è¶…æ—¶è®¾ç½® client_body_timeout 12; client_header_timeout 12; send_timeout 10; # ç¼“å­˜è®¾ç½® open_file_cache max=1000 inactive=20s; open_file_cache_valid 30s; open_file_cache_min_uses 2; open_file_cache_errors on; # Gzip å‹ç¼© gzip on; gzip_vary on; gzip_proxied any; gzip_comp_level 6; gzip_types text/plain text/css text/xml application/json application/javascript application/xml+rss application/atom+xml image/svg+xml; } äºŒåã€æœåŠ¡ç›‘æ§é¢æ¿é…ç½® 1. Grafana ç›‘æ§ç³»ç»Ÿé…ç½® # å®‰è£… Grafana sudo apt-get install -y apt-transport-https sudo apt-get install -y software-properties-common wget wget -q -O - https://packages.grafana.com/gpg.key | sudo apt-key add - echo "deb https://packages.grafana.com/oss/deb stable main" | sudo tee -a /etc/apt/sources.list.d/grafana.list sudo apt-get update sudo apt-get install -y grafana # é…ç½® Grafana sudo nano /etc/grafana/grafana.ini [server] http_addr = 0.0.0.0 http_port = 3000 [security] admin_user = admin admin_password = your_secure_password [auth.anonymous] enabled = false [paths] data = /var/lib/grafana logs = /var/log/grafana plugins = /var/lib/grafana/plugins [dashboards] versions_to_keep = 20 2. Prometheus é…ç½® # å®‰è£… Prometheus sudo apt-get install -y prometheus # é…ç½® Prometheus sudo nano /etc/prometheus/prometheus.yml global: scrape_interval: 15s evaluation_interval: 15s scrape_configs: - job_name: &#39;node&#39; static_configs: - targets: [&#39;localhost:9100&#39;] - job_name: &#39;nginx&#39; static_configs: - targets: [&#39;localhost:9113&#39;] - job_name: &#39;system&#39; static_configs: - targets: [&#39;localhost:9090&#39;] - job_name: &#39;process&#39; static_configs: - targets: [&#39;localhost:9256&#39;] 3. Node Exporter é…ç½® # å®‰è£… Node Exporter sudo apt-get install -y prometheus-node-exporter # åˆ›å»ºè‡ªå®šä¹‰æŒ‡æ ‡æ”¶é›†è„šæœ¬ nano ~/custom_metrics.sh #!/bin/bash # ~/custom_metrics.sh # åˆ›å»ºæŒ‡æ ‡æ–‡ä»¶ METRICS_FILE="/var/lib/node_exporter/custom_metrics.prom" while true; do # CPU æ¸©åº¦ CPU_TEMP=$(vcgencmd measure_temp | sed &#39;s/temp=//&#39; | sed &#39;s/&#39;"&#39;"&#39;C//&#39;) echo "raspberry_pi_cpu_temperature $CPU_TEMP" > "$METRICS_FILE" # AI æœåŠ¡çŠ¶æ€ if pgrep -f llama-server > /dev/null; then echo "ai_service_status 1" >> "$METRICS_FILE" else echo "ai_service_status 0" >> "$METRICS_FILE" fi # åšå®¢æœåŠ¡çŠ¶æ€ if systemctl is-active nginx > /dev/null; then echo "blog_service_status 1" >> "$METRICS_FILE" else echo "blog_service_status 0" >> "$METRICS_FILE" fi # å†…å­˜ä½¿ç”¨ FREE_MEM=$(free | grep Mem | awk &#39;{print $4}&#39;) echo "system_free_memory_bytes $FREE_MEM" >> "$METRICS_FILE" sleep 15 done äºŒåä¸€ã€è‡ªåŠ¨åŒ–éƒ¨ç½²ä¸æ›´æ–° 1. è‡ªåŠ¨éƒ¨ç½²é…ç½®è„šæœ¬ # åˆ›å»ºè‡ªåŠ¨éƒ¨ç½²è„šæœ¬ nano ~/auto_deploy.sh #!/bin/bash # ~/auto_deploy.sh # é…ç½® BLOG_DIR="/home/zhaoxiongzhou/myblog" LLAMA_DIR="/home/zhaoxiongzhou/projects/llama.cpp" BACKUP_DIR="/home/zhaoxiongzhou/backups" LOG_FILE="/var/log/auto_deploy.log" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" >> "$LOG_FILE" } # å¤‡ä»½å½“å‰ç‰ˆæœ¬ backup_current() { log "å¼€å§‹å¤‡ä»½å½“å‰ç‰ˆæœ¬" # åšå®¢å¤‡ä»½ tar -czf "$BACKUP_DIR/blog_$(date +%Y%m%d_%H%M%S).tar.gz" "$BLOG_DIR" # AI æœåŠ¡å¤‡ä»½ tar -czf "$BACKUP_DIR/llama_$(date +%Y%m%d_%H%M%S).tar.gz" "$LLAMA_DIR" log "å¤‡ä»½å®Œæˆ" } # æ›´æ–°åšå®¢ update_blog() { log "å¼€å§‹æ›´æ–°åšå®¢" cd "$BLOG_DIR" || exit 1 # æ‹‰å–æœ€æ–°ä»£ç  if git pull origin master; then # æ›´æ–°ä¸»é¢˜ git submodule update --remote themes/ananke # æ„å»ºç«™ç‚¹ hugo --minify # æ›´æ–°æƒé™ sudo chown -R www-data:www-data public/ # é‡å¯ Nginx sudo systemctl restart nginx log "åšå®¢æ›´æ–°æˆåŠŸ" else log "é”™è¯¯: åšå®¢æ›´æ–°å¤±è´¥" return 1 fi } # æ›´æ–° AI æœåŠ¡ update_ai_service() { log "å¼€å§‹æ›´æ–° AI æœåŠ¡" cd "$LLAMA_DIR" || exit 1 # åœæ­¢å½“å‰æœåŠ¡ pkill llama-server # æ‹‰å–æœ€æ–°ä»£ç  if git pull origin master; then # é‡æ–°ç¼–è¯‘ make clean if LLAMA_METAL=1 make -j4; then # å¯åŠ¨æœåŠ¡ ./start-llama.sh # éªŒè¯æœåŠ¡ sleep 5 if pgrep -f llama-server > /dev/null; then log "AI æœåŠ¡æ›´æ–°æˆåŠŸ" else log "é”™è¯¯: AI æœåŠ¡å¯åŠ¨å¤±è´¥" return 1 fi else log "é”™è¯¯: AI æœåŠ¡ç¼–è¯‘å¤±è´¥" return 1 fi else log "é”™è¯¯: AI æœåŠ¡ä»£ç æ›´æ–°å¤±è´¥" return 1 fi } # ä¸»å‡½æ•° main() { log "å¼€å§‹è‡ªåŠ¨éƒ¨ç½²æµç¨‹" # åˆ›å»ºå¤‡ä»½ backup_current # æ›´æ–°æœåŠ¡ if update_blog && update_ai_service; then log "éƒ¨ç½²å®Œæˆ" return 0 else log "éƒ¨ç½²å¤±è´¥" return 1 fi } # æ‰§è¡Œéƒ¨ç½² main 2. è‡ªåŠ¨æ›´æ–°æ£€æŸ¥è„šæœ¬ # åˆ›å»ºæ›´æ–°æ£€æŸ¥è„šæœ¬ nano ~/check_updates.sh äºŒåä¸€ã€è‡ªåŠ¨æ›´æ–°æ£€æŸ¥ä¸é€šçŸ¥ç³»ç»Ÿ 1. æ›´æ–°æ£€æŸ¥è„šæœ¬ #!/bin/bash # ~/check_updates.sh # é…ç½® NOTIFY_SCRIPT="/home/zhaoxiongzhou/send_notification.sh" LOG_FILE="/var/log/update_check.log" GITHUB_API="https://api.github.com" LLAMA_REPO="ggerganov/llama.cpp" HUGO_REPO="gohugoio/hugo" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # æ£€æŸ¥ GitHub ä»“åº“æ›´æ–° check_github_updates() { local repo="$1" local current_version="$2" # è·å–æœ€æ–°ç‰ˆæœ¬ latest_version=$(curl -s "$GITHUB_API/repos/$repo/releases/latest" | grep -Po &#39;"tag_name": "\K.*?(?=")&#39;) if [ "$latest_version" != "$current_version" ]; then log "å‘ç°æ–°ç‰ˆæœ¬: $repo ($current_version -> $latest_version)" return 0 else log "å½“å‰ç‰ˆæœ¬å·²æ˜¯æœ€æ–°: $repo ($current_version)" return 1 fi } # æ£€æŸ¥ç³»ç»Ÿæ›´æ–° check_system_updates() { sudo apt update > /dev/null 2>&amp;1 updates=$(sudo apt list --upgradable 2>/dev/null | grep -c "upgradable") if [ "$updates" -gt 0 ]; then log "å‘ç° $updates ä¸ªç³»ç»Ÿæ›´æ–°" return 0 else log "ç³»ç»Ÿå·²æ˜¯æœ€æ–°" return 1 fi } # æ£€æŸ¥æœåŠ¡çŠ¶æ€ check_services() { local services=("nginx" "llama-server") local status=0 for service in "${services[@]}"; do if [ "$service" = "nginx" ]; then if ! systemctl is-active --quiet nginx; then log "è­¦å‘Š: Nginx æœåŠ¡æœªè¿è¡Œ" status=1 fi elif [ "$service" = "llama-server" ]; then if ! pgrep -f llama-server > /dev/null; then log "è­¦å‘Š: AI æœåŠ¡æœªè¿è¡Œ" status=1 fi fi done return $status } # å‘é€é€šçŸ¥ send_notification() { local message="$1" local priority="$2" if [ -x "$NOTIFY_SCRIPT" ]; then "$NOTIFY_SCRIPT" "$message" "$priority" else log "é€šçŸ¥è„šæœ¬ä¸å­˜åœ¨æˆ–ä¸å¯æ‰§è¡Œ" fi } # ä¸»å‡½æ•° main() { log "å¼€å§‹æ£€æŸ¥æ›´æ–°" # è·å–å½“å‰ç‰ˆæœ¬ current_llama_version=$(cd ~/projects/llama.cpp && git describe --tags) current_hugo_version=$(hugo version | grep -Po "v\d+\.\d+\.\d+") # æ£€æŸ¥æ›´æ–° updates_found=0 if check_github_updates "$LLAMA_REPO" "$current_llama_version"; then send_notification "llama.cpp æœ‰æ–°ç‰ˆæœ¬å¯ç”¨" "normal" updates_found=1 fi if check_github_updates "$HUGO_REPO" "$current_hugo_version"; then send_notification "Hugo æœ‰æ–°ç‰ˆæœ¬å¯ç”¨" "normal" updates_found=1 fi if check_system_updates; then send_notification "ç³»ç»Ÿæœ‰æ›´æ–°å¯ç”¨" "normal" updates_found=1 fi if ! check_services; then send_notification "æœåŠ¡çŠ¶æ€å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥" "high" fi if [ "$updates_found" -eq 0 ]; then log "æ‰€æœ‰ç»„ä»¶å‡ä¸ºæœ€æ–°ç‰ˆæœ¬" fi } # æ‰§è¡Œæ£€æŸ¥ main äºŒåäºŒã€é€šçŸ¥ç³»ç»Ÿé…ç½® 1. é€šçŸ¥å‘é€è„šæœ¬ # åˆ›å»ºé€šçŸ¥å‘é€è„šæœ¬ nano ~/send_notification.sh #!/bin/bash # ~/send_notification.sh # é…ç½® TELEGRAM_BOT_TOKEN="your_bot_token" TELEGRAM_CHAT_ID="your_chat_id" EMAIL_ADDRESS="your_email@domain.com" DISCORD_WEBHOOK_URL="your_discord_webhook_url" # æ—¥å¿—é…ç½® LOG_FILE="/var/log/notifications.log" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" >> "$LOG_FILE" } # Telegram é€šçŸ¥ send_telegram() { local message="$1" local priority="$2" # æ ¹æ®ä¼˜å…ˆçº§æ·»åŠ è¡¨æƒ…ç¬¦å· case "$priority" in "high") message="ğŸš¨ ç´§æ€¥: $message" ;; "normal") message="â„¹ï¸ é€šçŸ¥: $message" ;; "low") message="ğŸ“ ä¿¡æ¯: $message" ;; esac # å‘é€æ¶ˆæ¯ curl -s -X POST \ "https://api.telegram.org/bot$TELEGRAM_BOT_TOKEN/sendMessage" \ -d "chat_id=$TELEGRAM_CHAT_ID" \ -d "text=$message" \ -d "parse_mode=HTML" log "Telegram é€šçŸ¥å·²å‘é€: $message" } # é‚®ä»¶é€šçŸ¥ send_email() { local message="$1" local priority="$2" local subject case "$priority" in "high") subject="[ç´§æ€¥] æ ‘è“æ´¾æœåŠ¡è­¦å‘Š" ;; "normal") subject="[é€šçŸ¥] æ ‘è“æ´¾æœåŠ¡æ›´æ–°" ;; "low") subject="[ä¿¡æ¯] æ ‘è“æ´¾æœåŠ¡çŠ¶æ€" ;; esac echo "$message" | mail -s "$subject" "$EMAIL_ADDRESS" log "é‚®ä»¶é€šçŸ¥å·²å‘é€: $subject - $message" } # Discord é€šçŸ¥ send_discord() { local message="$1" local priority="$2" local color case "$priority" in "high") color="16711680" # çº¢è‰² ;; "normal") color="65280" # ç»¿è‰² ;; "low") color="255" # è“è‰² ;; esac curl -H "Content-Type: application/json" \ -X POST \ -d "{\"embeds\": [{\"description\": \"$message\", \"color\": $color}]}" \ "$DISCORD_WEBHOOK_URL" log "Discord é€šçŸ¥å·²å‘é€: $message" } # ä¸»å‡½æ•° main() { local message="$1" local priority="${2:-normal}" # é»˜è®¤ä¼˜å…ˆçº§ä¸º normal # æ£€æŸ¥å¿…è¦å‚æ•° if [ -z "$message" ]; then log "é”™è¯¯: æ¶ˆæ¯å†…å®¹ä¸èƒ½ä¸ºç©º" return 1 fi # æ·»åŠ ç³»ç»Ÿä¿¡æ¯ local hostname=$(hostname) local timestamp=$(date &#39;+%Y-%m-%d %H:%M:%S&#39;) message="[$hostname] [$timestamp] $message" # å‘é€æ‰€æœ‰é€šçŸ¥ send_telegram "$message" "$priority" send_email "$message" "$priority" send_discord "$message" "$priority" log "æ‰€æœ‰é€šçŸ¥æ¸ é“å¤„ç†å®Œæˆ" } # æ‰§è¡Œé€šçŸ¥å‘é€ main "$@" äºŒåä¸‰ã€å®šæ—¶ä»»åŠ¡é…ç½® 1. Crontab é…ç½® # ç¼–è¾‘ crontab crontab -e # ç³»ç»Ÿç»´æŠ¤ä»»åŠ¡ # æ¯å¤©å‡Œæ™¨ 2 ç‚¹æ‰§è¡Œç³»ç»Ÿæ›´æ–°æ£€æŸ¥ 0 2 * * * ~/check_updates.sh > /dev/null 2>&amp;1 # æ¯ 6 å°æ—¶æ‰§è¡Œä¸€æ¬¡æœåŠ¡å¥åº·æ£€æŸ¥ 0 */6 * * * ~/service_health_check.sh > /dev/null 2>&amp;1 # æ¯å‘¨æ—¥å‡Œæ™¨ 3 ç‚¹æ‰§è¡Œç³»ç»Ÿä¼˜åŒ– 0 3 * * 0 ~/system_optimize.sh > /dev/null 2>&amp;1 # æ¯å¤©å‡Œæ™¨ 4 ç‚¹æ‰§è¡Œæ—¥å¿—ç®¡ç† 0 4 * * * ~/log_management.sh > /dev/null 2>&amp;1 # æ¯å°æ—¶æ‰§è¡Œæ€§èƒ½æ•°æ®æ”¶é›† 0 * * * * ~/collect_performance.sh > /dev/null 2>&amp;1 # æ¯ 5 åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡å…³é”®æœåŠ¡çŠ¶æ€ */5 * * * * ~/monitor.sh > /dev/null 2>&amp;1 # æ¯å¤©æ™šä¸Š 11 ç‚¹æ‰§è¡Œå¤‡ä»½ 0 23 * * * ~/auto_backup.sh > /dev/null 2>&amp;1 # æ¯æœˆ 1 å·æ‰§è¡Œå®Œæ•´ç³»ç»Ÿæ£€æŸ¥ 0 1 1 * * ~/full_system_check.sh > /dev/null 2>&amp;1 2. å®Œæ•´ç³»ç»Ÿæ£€æŸ¥è„šæœ¬ # åˆ›å»ºå®Œæ•´ç³»ç»Ÿæ£€æŸ¥è„šæœ¬ nano ~/full_system_check.sh #!/bin/bash # ~/full_system_check.sh LOG_FILE="/var/log/system_check.log" REPORT_FILE="/home/zhaoxiongzhou/reports/monthly_report_$(date +%Y%m).txt" # ç¡®ä¿ç›®å½•å­˜åœ¨ mkdir -p "$(dirname "$REPORT_FILE")" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" "$REPORT_FILE" } # ç³»ç»Ÿä¿¡æ¯æ£€æŸ¥ check_system_info() { log "=== ç³»ç»Ÿä¿¡æ¯ ===" log "ç³»ç»Ÿç‰ˆæœ¬: $(cat /etc/os-release | grep PRETTY_NAME)" log "å†…æ ¸ç‰ˆæœ¬: $(uname -r)" log "è¿è¡Œæ—¶é—´: $(uptime -p)" log "æœ€åå¯åŠ¨: $(who -b | awk &#39;{print $3,$4}&#39;)" } # èµ„æºä½¿ç”¨æ£€æŸ¥ check_resources() { log "=== èµ„æºä½¿ç”¨æƒ…å†µ ===" log "CPU ä½¿ç”¨ç‡: $(top -bn1 | grep "Cpu(s)" | awk &#39;{print $2}&#39;)%" log "å†…å­˜ä½¿ç”¨æƒ…å†µ:" free -h | tee -a "$REPORT_FILE" log "ç£ç›˜ä½¿ç”¨æƒ…å†µ:" df -h | tee -a "$REPORT_FILE" } # æœåŠ¡çŠ¶æ€æ£€æŸ¥ check_services() { log "=== æœåŠ¡çŠ¶æ€ ===" # æ£€æŸ¥ Nginx if systemctl is-active --quiet nginx; then log "Nginx: è¿è¡Œæ­£å¸¸" else log "Nginx: æœªè¿è¡Œ" fi # æ£€æŸ¥ AI æœåŠ¡ if pgrep -f llama-server > /dev/null; then log "AI æœåŠ¡: è¿è¡Œæ­£å¸¸" else log "AI æœåŠ¡: æœªè¿è¡Œ" fi } # å®‰å…¨æ£€æŸ¥ check_security() { log "=== å®‰å…¨æ£€æŸ¥ ===" # æ£€æŸ¥å¤±è´¥çš„ç™»å½•å°è¯• log "å¤±è´¥çš„ç™»å½•å°è¯•:" grep "Failed password" /var/log/auth.log | tail -n 5 | tee -a "$REPORT_FILE" # æ£€æŸ¥å¼€æ”¾çš„ç«¯å£ log "å¼€æ”¾çš„ç«¯å£:" netstat -tuln | grep LISTEN | tee -a "$REPORT_FILE" } # æ€§èƒ½åˆ†æ analyze_performance() { log "=== æ€§èƒ½åˆ†æ ===" # åˆ†æ CPU ä½¿ç”¨æƒ…å†µ log "CPU å¯†é›†è¿›ç¨‹:" ps aux --sort=-%cpu | head -n 5 | tee -a "$REPORT_FILE" # åˆ†æå†…å­˜ä½¿ç”¨æƒ…å†µ log "å†…å­˜å¯†é›†è¿›ç¨‹:" ps aux --sort=-%mem | head -n 5 | tee -a "$REPORT_FILE" } # ä¸»å‡½æ•° main() { log "å¼€å§‹æœˆåº¦ç³»ç»Ÿæ£€æŸ¥ - $(date)" check_system_info check_resources check_services check_security analyze_performance log "ç³»ç»Ÿæ£€æŸ¥å®Œæˆ" # å‘é€æŠ¥å‘Š if [ -f "$REPORT_FILE" ]; then ~/send_notification.sh "æœˆåº¦ç³»ç»Ÿæ£€æŸ¥æŠ¥å‘Šå·²ç”Ÿæˆ" "normal" fi } # æ‰§è¡Œæ£€æŸ¥ main äºŒåå››ã€ç¾éš¾æ¢å¤è®¡åˆ’ 1. ç³»ç»Ÿæ¢å¤è„šæœ¬ # åˆ›å»ºç³»ç»Ÿæ¢å¤è„šæœ¬ nano ~/disaster_recovery.sh #!/bin/bash # ~/disaster_recovery.sh # é…ç½® BACKUP_DIR="/home/zhaoxiongzhou/backups" RECOVERY_LOG="/var/log/recovery.log" SERVICES=("nginx" "llama-server") # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$RECOVERY_LOG" } # éªŒè¯å¤‡ä»½ verify_backup() { local backup_file="$1" if [ ! -f "$backup_file" ]; then log "é”™è¯¯: å¤‡ä»½æ–‡ä»¶ä¸å­˜åœ¨ - $backup_file" return 1 fi # æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§ if ! tar -tzf "$backup_file" >/dev/null 2>&amp;1; then log "é”™è¯¯: å¤‡ä»½æ–‡ä»¶æŸå - $backup_file" return 1 fi return 0 } # åœæ­¢æœåŠ¡ stop_services() { log "åœæ­¢æ‰€æœ‰æœåŠ¡..." for service in "${SERVICES[@]}"; do if [ "$service" = "nginx" ]; then sudo systemctl stop nginx else pkill "$service" fi done # ç­‰å¾…æœåŠ¡å®Œå…¨åœæ­¢ sleep 5 } # æ¢å¤åšå®¢æœåŠ¡ restore_blog() { local backup_file="$BACKUP_DIR/blog_latest.tar.gz" if verify_backup "$backup_file"; then log "å¼€å§‹æ¢å¤åšå®¢æœåŠ¡..." # æ¸…ç†å½“å‰ç›®å½• rm -rf ~/myblog/* # è§£å‹å¤‡ä»½ tar -xzf "$backup_file" -C ~/myblog/ # é‡å»ºç«™ç‚¹ cd ~/myblog hugo --minify # æ¢å¤æƒé™ sudo chown -R www-data:www-data public/ log "åšå®¢æœåŠ¡æ¢å¤å®Œæˆ" else log "åšå®¢æœåŠ¡æ¢å¤å¤±è´¥" return 1 fi } # æ¢å¤ AI æœåŠ¡ restore_ai_service() { local backup_file="$BACKUP_DIR/llama_latest.tar.gz" if verify_backup "$backup_file"; then log "å¼€å§‹æ¢å¤ AI æœåŠ¡..." # æ¸…ç†å½“å‰ç›®å½• rm -rf ~/projects/llama.cpp/* # è§£å‹å¤‡ä»½ tar -xzf "$backup_file" -C ~/projects/llama.cpp/ # é‡æ–°ç¼–è¯‘ cd ~/projects/llama.cpp make clean LLAMA_METAL=1 make -j4 log "AI æœåŠ¡æ¢å¤å®Œæˆ" else log "AI æœåŠ¡æ¢å¤å¤±è´¥" return 1 fi } # æ¢å¤ç³»ç»Ÿé…ç½® restore_system_config() { local backup_file="$BACKUP_DIR/system_config_latest.tar.gz" if verify_backup "$backup_file"; then log "å¼€å§‹æ¢å¤ç³»ç»Ÿé…ç½®..." # è§£å‹ç³»ç»Ÿé…ç½® sudo tar -xzf "$backup_file" -C / # é‡æ–°åŠ è½½ç³»ç»Ÿé…ç½® sudo sysctl --system log "ç³»ç»Ÿé…ç½®æ¢å¤å®Œæˆ" else log "ç³»ç»Ÿé…ç½®æ¢å¤å¤±è´¥" return 1 fi } # å¯åŠ¨æœåŠ¡ start_services() { log "å¯åŠ¨æ‰€æœ‰æœåŠ¡..." # å¯åŠ¨ Nginx sudo systemctl start nginx # å¯åŠ¨ AI æœåŠ¡ ~/projects/llama.cpp/start-llama.sh # éªŒè¯æœåŠ¡çŠ¶æ€ sleep 10 verify_services } # éªŒè¯æœåŠ¡ verify_services() { local status=0 log "éªŒè¯æœåŠ¡çŠ¶æ€..." # æ£€æŸ¥ Nginx if ! systemctl is-active --quiet nginx; then log "è­¦å‘Š: Nginx æœåŠ¡æœªæ­£å¸¸è¿è¡Œ" status=1 fi # æ£€æŸ¥ AI æœåŠ¡ if ! pgrep -f llama-server > /dev/null; then log "è­¦å‘Š: AI æœåŠ¡æœªæ­£å¸¸è¿è¡Œ" status=1 fi return $status } # ä¸»å‡½æ•° main() { log "å¼€å§‹ç³»ç»Ÿæ¢å¤æµç¨‹..." # åœæ­¢æœåŠ¡ stop_services # æ‰§è¡Œæ¢å¤ if restore_system_config && restore_blog && restore_ai_service; then # å¯åŠ¨æœåŠ¡ start_services if verify_services; then log "ç³»ç»Ÿæ¢å¤æˆåŠŸå®Œæˆ" ~/send_notification.sh "ç³»ç»Ÿæ¢å¤æˆåŠŸå®Œæˆ" "normal" return 0 else log "ç³»ç»Ÿæ¢å¤å®Œæˆï¼Œä½†éƒ¨åˆ†æœåŠ¡å¯èƒ½æœªæ­£å¸¸è¿è¡Œ" ~/send_notification.sh "ç³»ç»Ÿæ¢å¤å®Œæˆï¼Œä½†éœ€è¦æ‰‹åŠ¨æ£€æŸ¥æœåŠ¡çŠ¶æ€" "high" return 1 fi else log "ç³»ç»Ÿæ¢å¤å¤±è´¥" ~/send_notification.sh "ç³»ç»Ÿæ¢å¤å¤±è´¥ï¼Œéœ€è¦æ‰‹åŠ¨å¹²é¢„" "high" return 1 fi } # æ‰§è¡Œæ¢å¤ main äºŒåäº”ã€æ–‡æ¡£ç®¡ç†ç³»ç»Ÿ 1. æ–‡æ¡£ç”Ÿæˆè„šæœ¬ # åˆ›å»ºæ–‡æ¡£ç”Ÿæˆè„šæœ¬ nano ~/generate_docs.sh #!/bin/bash # ~/generate_docs.sh # é…ç½® DOCS_DIR="/home/zhaoxiongzhou/documentation" SCRIPTS_DIR="/home/zhaoxiongzhou" CONFIG_DIR="/etc" LOG_FILE="/var/log/documentation.log" # ç¡®ä¿ç›®å½•å­˜åœ¨ mkdir -p "$DOCS_DIR"/{scripts,configs,logs,maintenance} # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # ç”Ÿæˆè„šæœ¬æ–‡æ¡£ generate_script_docs() { log "ç”Ÿæˆè„šæœ¬æ–‡æ¡£..." for script in "$SCRIPTS_DIR"/*.sh; do if [ -f "$script" ]; then script_name=$(basename "$script") output_file="$DOCS_DIR/scripts/${script_name%.sh}.md" { echo "# $script_name" echo "## è·¯å¾„: $script" echo "## æœ€åä¿®æ”¹: $(date -r "$script" &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo "## æƒé™: $(stat -c &#39;%a&#39; "$script")" echo "## æ‰€æœ‰è€…: $(stat -c &#39;%U:%G&#39; "$script")" echo echo "## åŠŸèƒ½æè¿°" grep -A 5 "^#.*åŠŸèƒ½:" "$script" 2>/dev/null || echo "æœªæä¾›åŠŸèƒ½æè¿°" echo echo "## è„šæœ¬å†…å®¹" echo &#39;```bash&#39; cat "$script" echo &#39;```&#39; echo echo "## ä¾èµ–é¡¹" grep "^[^#]*apt.*install" "$script" 2>/dev/null || echo "æœªæ‰¾åˆ°æ˜ç¡®çš„ä¾èµ–é¡¹" echo echo "## å®šæ—¶ä»»åŠ¡" crontab -l 2>/dev/null | grep "$script_name" || echo "æœªé…ç½®å®šæ—¶ä»»åŠ¡" } > "$output_file" fi done } # ç”Ÿæˆé…ç½®æ–‡æ¡£ generate_config_docs() { log "ç”Ÿæˆé…ç½®æ–‡æ¡£..." # Nginx é…ç½® { echo "# Nginx é…ç½®æ–‡æ¡£" echo "## ä¸»é…ç½®æ–‡ä»¶" echo &#39;```nginx&#39; cat /etc/nginx/nginx.conf echo &#39;```&#39; echo "## ç«™ç‚¹é…ç½®" echo &#39;```nginx&#39; cat /etc/nginx/sites-available/myblog echo &#39;```&#39; } > "$DOCS_DIR/configs/nginx_config.md" # ç³»ç»Ÿé…ç½® { echo "# ç³»ç»Ÿé…ç½®æ–‡æ¡£" echo "## Sysctl é…ç½®" echo &#39;```bash&#39; cat /etc/sysctl.d/99-custom.conf echo &#39;```&#39; echo "## æ ‘è“æ´¾é…ç½®" echo &#39;```bash&#39; cat /boot/config.txt echo &#39;```&#39; } > "$DOCS_DIR/configs/system_config.md" } # ç”Ÿæˆç»´æŠ¤æ–‡æ¡£ generate_maintenance_docs() { log "ç”Ÿæˆç»´æŠ¤æ–‡æ¡£..." { echo "# ç³»ç»Ÿç»´æŠ¤æ–‡æ¡£" echo "## å®šæ—¶ä»»åŠ¡" echo &#39;```bash&#39; crontab -l echo &#39;```&#39; echo "## æœåŠ¡çŠ¶æ€" echo &#39;```bash&#39; systemctl status nginx ps aux | grep llama-server echo &#39;```&#39; echo "## èµ„æºä½¿ç”¨" echo &#39;```bash&#39; df -h free -h top -bn1 echo &#39;```&#39; echo "## æœ€è¿‘æ—¥å¿—" echo &#39;```bash&#39; tail -n 50 /var/log/syslog echo &#39;```&#39; } > "$DOCS_DIR/maintenance/system_status.md" } # ç”Ÿæˆç´¢å¼• generate_index() { log "ç”Ÿæˆæ–‡æ¡£ç´¢å¼•..." { echo "# ç³»ç»Ÿæ–‡æ¡£ç´¢å¼•" echo "## ç”Ÿæˆæ—¶é—´: $(date &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo echo "## è„šæœ¬æ–‡æ¡£" for doc in "$DOCS_DIR/scripts"/*.md; do echo "- [$(basename "${doc%.md}")](scripts/$(basename "$doc"))" done echo echo "## é…ç½®æ–‡æ¡£" for doc in "$DOCS_DIR/configs"/*.md; do echo "- [$(basename "${doc%.md}")](configs/$(basename "$doc"))" done echo echo "## ç»´æŠ¤æ–‡æ¡£" for doc in "$DOCS_DIR/maintenance"/*.md; do echo "- [$(basename "${doc%.md}")](maintenance/$(basename "$doc"))" done } > "$DOCS_DIR/index.md" } # ä¸»å‡½æ•° main() { log "å¼€å§‹ç”Ÿæˆæ–‡æ¡£..." generate_script_docs generate_config_docs generate_maintenance_docs generate_index log "æ–‡æ¡£ç”Ÿæˆå®Œæˆ: $DOCS_DIR" } # æ‰§è¡Œæ–‡æ¡£ç”Ÿæˆ main äºŒåå…­ã€æ€§èƒ½æµ‹è¯•ä¸åŸºå‡†æµ‹è¯• 1. æ€§èƒ½æµ‹è¯•è„šæœ¬ # åˆ›å»ºæ€§èƒ½æµ‹è¯•è„šæœ¬ nano ~/benchmark.sh #!/bin/bash # ~/benchmark.sh # é…ç½® RESULTS_DIR="/home/zhaoxiongzhou/benchmark_results" LOG_FILE="/var/log/benchmark.log" DURATION=300 # æµ‹è¯•æŒç»­æ—¶é—´ï¼ˆç§’ï¼‰ CONCURRENT_USERS=10 # å¹¶å‘ç”¨æˆ·æ•° # ç¡®ä¿ç›®å½•å­˜åœ¨ mkdir -p "$RESULTS_DIR" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # CPU æ€§èƒ½æµ‹è¯• benchmark_cpu() { log "å¼€å§‹ CPU æ€§èƒ½æµ‹è¯•..." # ä½¿ç”¨ sysbench è¿›è¡Œ CPU æµ‹è¯• sysbench cpu --cpu-max-prime=20000 --threads=4 run > "$RESULTS_DIR/cpu_benchmark.txt" # è®°å½• CPU æ¸©åº¦ for i in $(seq 1 10); do vcgencmd measure_temp >> "$RESULTS_DIR/cpu_temp.txt" sleep 1 done } # å†…å­˜æ€§èƒ½æµ‹è¯• benchmark_memory() { log "å¼€å§‹å†…å­˜æ€§èƒ½æµ‹è¯•..." # ä½¿ç”¨ sysbench è¿›è¡Œå†…å­˜æµ‹è¯• sysbench memory --memory-block-size=1K --memory-total-size=10G run > "$RESULTS_DIR/memory_benchmark.txt" } # ç£ç›˜æ€§èƒ½æµ‹è¯• benchmark_disk() { log "å¼€å§‹ç£ç›˜æ€§èƒ½æµ‹è¯•..." # ä½¿ç”¨ dd æµ‹è¯•å†™å…¥é€Ÿåº¦ dd if=/dev/zero of=/tmp/test_file bs=1M count=1000 conv=fdatasync 2>> "$RESULTS_DIR/disk_write_benchmark.txt" # ä½¿ç”¨ dd æµ‹è¯•è¯»å–é€Ÿåº¦ dd if=/tmp/test_file of=/dev/null bs=1M count=1000 2>> "$RESULTS_DIR/disk_read_benchmark.txt" # æ¸…ç†æµ‹è¯•æ–‡ä»¶ rm /tmp/test_file } # ç½‘ç»œæ€§èƒ½æµ‹è¯• benchmark_network() { log "å¼€å§‹ç½‘ç»œæ€§èƒ½æµ‹è¯•..." # ä½¿ç”¨ iperf3 æµ‹è¯•ç½‘ç»œæ€§èƒ½ iperf3 -c iperf.he.net -t 30 > "$RESULTS_DIR/network_benchmark.txt" } # Web æœåŠ¡æ€§èƒ½æµ‹è¯• benchmark_web() { log "å¼€å§‹ Web æœåŠ¡æ€§èƒ½æµ‹è¯•..." # ä½¿ç”¨ ab æµ‹è¯• Web æœåŠ¡ ab -n 1000 -c "$CONCURRENT_USERS" http://localhost/ > "$RESULTS_DIR/web_benchmark.txt" } # AI æœåŠ¡æ€§èƒ½æµ‹è¯• benchmark_ai() { log "å¼€å§‹ AI æœåŠ¡æ€§èƒ½æµ‹è¯•..." # åˆ›å»ºæµ‹è¯•è¯·æ±‚ cat > /tmp/test_prompt.txt << EOF Hello, how are you? EOF # ä½¿ç”¨ curl æµ‹è¯• AI æœåŠ¡å“åº”æ—¶é—´ for i in $(seq 1 10); do time curl -X POST \ -H "Content-Type: application/json" \ -d @/tmp/test_prompt.txt \ http://localhost:8080/completion >> "$RESULTS_DIR/ai_benchmark.txt" 2>&amp;1 echo -e "\n---\n" >> "$RESULTS_DIR/ai_benchmark.txt" sleep 2 done } # ç”ŸæˆæŠ¥å‘Š generate_report() { log "ç”Ÿæˆæ€§èƒ½æµ‹è¯•æŠ¥å‘Š..." local report_file="$RESULTS_DIR/benchmark_report_$(date +%Y%m%d_%H%M%S).md" { echo "# æ€§èƒ½æµ‹è¯•æŠ¥å‘Š" echo "## æµ‹è¯•æ—¶é—´: $(date &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo echo "## ç³»ç»Ÿä¿¡æ¯" echo &#39;```&#39; uname -a echo &#39;```&#39; echo echo "## CPU æ€§èƒ½" echo &#39;```&#39; cat "$RESULTS_DIR/cpu_benchmark.txt" echo &#39;```&#39; echo echo "## å†…å­˜æ€§èƒ½" echo &#39;```&#39; cat "$RESULTS_DIR/memory_benchmark.txt" echo &#39;```&#39; echo echo "## ç£ç›˜æ€§èƒ½" echo &#39;```&#39; cat "$RESULTS_DIR/disk_write_benchmark.txt" cat "$RESULTS_DIR/disk_read_benchmark.txt" echo &#39;```&#39; echo echo "## ç½‘ç»œæ€§èƒ½" echo &#39;```&#39; cat "$RESULTS_DIR/network_benchmark.txt" echo &#39;```&#39; echo echo "## Web æœåŠ¡æ€§èƒ½" echo &#39;```&#39; cat "$RESULTS_DIR/web_benchmark.txt" echo &#39;```&#39; echo echo "## AI æœåŠ¡æ€§èƒ½" echo &#39;```&#39; cat "$RESULTS_DIR/ai_benchmark.txt" echo &#39;```&#39; } > "$report_file" log "æ€§èƒ½æµ‹è¯•æŠ¥å‘Šå·²ç”Ÿæˆ: $report_file" } # ä¸»å‡½æ•° main() { log "å¼€å§‹æ€§èƒ½æµ‹è¯•..." # å®‰è£…å¿…è¦çš„å·¥å…· sudo apt install -y sysbench apache2-utils iperf3 # æ‰§è¡Œå„é¡¹æµ‹è¯• benchmark_cpu benchmark_memory benchmark_disk benchmark_network benchmark_web benchmark_ai # ç”ŸæˆæŠ¥å‘Š generate_report log "æ€§èƒ½æµ‹è¯•å®Œæˆ" } # æ‰§è¡Œæµ‹è¯• main äºŒåä¸ƒã€å®‰å…¨å®¡è®¡ç³»ç»Ÿ 1. å®‰å…¨å®¡è®¡è„šæœ¬ # åˆ›å»ºå®‰å…¨å®¡è®¡è„šæœ¬ nano ~/security_audit.sh #!/bin/bash # ~/security_audit.sh # é…ç½® AUDIT_DIR="/home/zhaoxiongzhou/security_audits" REPORT_FILE="$AUDIT_DIR/security_report_$(date +%Y%m%d_%H%M%S).md" LOG_FILE="/var/log/security_audit.log" # ç¡®ä¿ç›®å½•å­˜åœ¨ mkdir -p "$AUDIT_DIR" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # æ£€æŸ¥ç³»ç»Ÿç”¨æˆ· audit_users() { log "æ£€æŸ¥ç³»ç»Ÿç”¨æˆ·..." { echo "## ç³»ç»Ÿç”¨æˆ·å®¡è®¡" echo "### ç‰¹æƒç”¨æˆ·" echo &#39;```&#39; awk -F: &#39;$3 == 0 {print $1}&#39; /etc/passwd echo &#39;```&#39; echo "### æœ€è¿‘çš„ç”¨æˆ·æ´»åŠ¨" echo &#39;```&#39; last | head -n 10 echo &#39;```&#39; echo "### å¤±è´¥çš„ç™»å½•å°è¯•" echo &#39;```&#39; grep "Failed password" /var/log/auth.log | tail -n 10 echo &#39;```&#39; } >> "$REPORT_FILE" } # æ£€æŸ¥ç½‘ç»œå®‰å…¨ audit_network() { log "æ£€æŸ¥ç½‘ç»œå®‰å…¨..." { echo "## ç½‘ç»œå®‰å…¨å®¡è®¡" echo "### å¼€æ”¾ç«¯å£" echo &#39;```&#39; netstat -tuln echo &#39;```&#39; echo "### æ´»åŠ¨è¿æ¥" echo &#39;```&#39; netstat -nat | grep ESTABLISHED echo &#39;```&#39; echo "### é˜²ç«å¢™è§„åˆ™" echo &#39;```&#39; sudo iptables -L -n echo &#39;```&#39; } >> "$REPORT_FILE" } # æ£€æŸ¥æ–‡ä»¶æƒé™ audit_permissions() { log "æ£€æŸ¥æ–‡ä»¶æƒé™..." { echo "## æ–‡ä»¶æƒé™å®¡è®¡" echo "### SUID æ–‡ä»¶" echo &#39;```&#39; sudo find / -type f -perm -4000 2>/dev/null echo &#39;```&#39; echo "### ä¸–ç•Œå¯å†™æ–‡ä»¶" echo &#39;```&#39; sudo find / -type f -perm -2 ! -path "/proc/*" ! -path "/sys/*" 2>/dev/null echo &#39;```&#39; echo "### æ•æ„Ÿç›®å½•æƒé™" echo &#39;```&#39; ls -la /etc/nginx/ ls -la ~/projects/llama.cpp/ ls -la ~/myblog/ echo &#39;```&#39; } >> "$REPORT_FILE" } # æ£€æŸ¥æœåŠ¡é…ç½® audit_services() { log "æ£€æŸ¥æœåŠ¡é…ç½®..." { echo "## æœåŠ¡é…ç½®å®¡è®¡" echo "### Nginx é…ç½®æ£€æŸ¥" echo &#39;```&#39; sudo nginx -t 2>&amp;1 echo &#39;```&#39; echo "### SSL é…ç½®" echo &#39;```&#39; openssl s_client -connect localhost:443 -servername localhost </dev/null 2>/dev/null | openssl x509 -text echo &#39;```&#39; echo "### æœåŠ¡çŠ¶æ€" echo &#39;```&#39; systemctl list-units --type=service --state=active echo &#39;```&#39; } >> "$REPORT_FILE" } # æ£€æŸ¥ç³»ç»Ÿæ›´æ–° audit_updates() { log "æ£€æŸ¥ç³»ç»Ÿæ›´æ–°..." { echo "## ç³»ç»Ÿæ›´æ–°å®¡è®¡" echo "### å¯ç”¨æ›´æ–°" echo &#39;```&#39; apt list --upgradable 2>/dev/null echo &#39;```&#39; echo "### å·²å®‰è£…åŒ…" echo &#39;```&#39; dpkg -l | grep "^ii" | wc -l echo &#39;```&#39; } >> "$REPORT_FILE" } # æ£€æŸ¥æ—¥å¿—å¼‚å¸¸ audit_logs() { log "æ£€æŸ¥æ—¥å¿—å¼‚å¸¸..." { echo "## æ—¥å¿—å®¡è®¡" echo "### ç³»ç»Ÿé”™è¯¯" echo &#39;```&#39; sudo journalctl -p 3 -xb --no-pager | tail -n 20 echo &#39;```&#39; echo "### å¼‚å¸¸è®¿é—®" echo &#39;```&#39; grep -i "error\|failed\|warning" /var/log/nginx/error.log | tail -n 20 echo &#39;```&#39; } >> "$REPORT_FILE" } # ç”Ÿæˆå®‰å…¨å»ºè®® generate_recommendations() { log "ç”Ÿæˆå®‰å…¨å»ºè®®..." { echo "## å®‰å…¨å»ºè®®" echo "### é«˜ä¼˜å…ˆçº§" # æ£€æŸ¥å¹¶ç”Ÿæˆå»ºè®® if grep -q "Failed password" /var/log/auth.log; then echo "- å»ºè®®ï¼šå¯ç”¨ fail2ban åŠ å¼º SSH é˜²æŠ¤" fi if [ $(find / -type f -perm -2 2>/dev/null | wc -l) -gt 0 ]; then echo "- å»ºè®®ï¼šæ£€æŸ¥å¹¶ä¿®å¤ä¸–ç•Œå¯å†™æ–‡ä»¶æƒé™" fi echo "### ä¸­ä¼˜å…ˆçº§" # æ·»åŠ å…¶ä»–å»ºè®® echo "- å®šæœŸæ›´æ–°ç³»ç»ŸåŒ…" echo "- æ£€æŸ¥å¹¶æ›´æ–° SSL è¯ä¹¦" echo "- å®šæœŸå®¡æŸ¥ç”¨æˆ·æƒé™" } >> "$REPORT_FILE" } # ä¸»å‡½æ•° main() { log "å¼€å§‹å®‰å…¨å®¡è®¡..." # åˆ›å»ºæŠ¥å‘Šå¤´éƒ¨ { echo "# å®‰å…¨å®¡è®¡æŠ¥å‘Š" echo "## ç”Ÿæˆæ—¶é—´: $(date &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo "## ç³»ç»Ÿä¿¡æ¯" echo &#39;```&#39; uname -a echo &#39;```&#39; echo } > "$REPORT_FILE" # æ‰§è¡Œå„é¡¹å®¡è®¡ audit_users audit_network audit_permissions audit_services audit_updates audit_logs generate_recommendations log "å®‰å…¨å®¡è®¡å®Œæˆï¼ŒæŠ¥å‘Šå·²ç”Ÿæˆ: $REPORT_FILE" # å‘é€é€šçŸ¥ ~/send_notification.sh "å®‰å…¨å®¡è®¡æŠ¥å‘Šå·²ç”Ÿæˆ" "normal" } # æ‰§è¡Œå®¡è®¡ main äºŒåå…«ã€èµ„æºé™åˆ¶ä¸æ§åˆ¶ 1. èµ„æºé™åˆ¶é…ç½®è„šæœ¬ # åˆ›å»ºèµ„æºé™åˆ¶é…ç½®è„šæœ¬ nano ~/resource_control.sh #!/bin/bash # ~/resource_control.sh # é…ç½® LOG_FILE="/var/log/resource_control.log" LIMITS_CONF="/etc/security/limits.conf" SYSTEMD_DIR="/etc/systemd/system" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # é…ç½®ç³»ç»Ÿèµ„æºé™åˆ¶ configure_system_limits() { log "é…ç½®ç³»ç»Ÿèµ„æºé™åˆ¶..." # å¤‡ä»½åŸå§‹é…ç½® sudo cp "$LIMITS_CONF" "${LIMITS_CONF}.backup" # æ·»åŠ èµ„æºé™åˆ¶é…ç½® sudo tee -a "$LIMITS_CONF" << EOF # ç”¨æˆ·èµ„æºé™åˆ¶ zhaoxiongzhou soft nofile 65535 zhaoxiongzhou hard nofile 65535 zhaoxiongzhou soft nproc 2048 zhaoxiongzhou hard nproc 4096 # ç³»ç»ŸæœåŠ¡èµ„æºé™åˆ¶ www-data soft nofile 65535 www-data hard nofile 65535 www-data soft nproc 1024 www-data hard nproc 2048 EOF } # é…ç½® AI æœåŠ¡èµ„æºé™åˆ¶ configure_ai_service() { log "é…ç½® AI æœåŠ¡èµ„æºé™åˆ¶..." # åˆ›å»º systemd æœåŠ¡æ–‡ä»¶ sudo tee "$SYSTEMD_DIR/llama-server.service" << EOF [Unit] Description=Llama AI Server After=network.target [Service] User=zhaoxiongzhou Group=zhaoxiongzhou WorkingDirectory=/home/zhaoxiongzhou/projects/llama.cpp ExecStart=/home/zhaoxiongzhou/projects/llama.cpp/start-llama.sh # èµ„æºé™åˆ¶ CPUQuota=80% MemoryLimit=2G TasksMax=128 LimitNOFILE=65535 # é‡å¯ç­–ç•¥ Restart=always RestartSec=10 [Install] WantedBy=multi-user.target EOF # é‡æ–°åŠ è½½ systemd é…ç½® sudo systemctl daemon-reload } # é…ç½® Nginx èµ„æºé™åˆ¶ configure_nginx() { log "é…ç½® Nginx èµ„æºé™åˆ¶..." # ä¿®æ”¹ Nginx é…ç½® sudo tee "/etc/nginx/conf.d/resource_limits.conf" << EOF # å·¥ä½œè¿›ç¨‹é™åˆ¶ worker_processes auto; worker_rlimit_nofile 65535; # è¿æ¥é™åˆ¶ events { worker_connections 1024; multi_accept on; } # å®¢æˆ·ç«¯é™åˆ¶ http { # è¯·æ±‚é™åˆ¶ limit_req_zone \$binary_remote_addr zone=one:10m rate=10r/s; # è¿æ¥é™åˆ¶ limit_conn_zone \$binary_remote_addr zone=addr:10m; server { # åº”ç”¨é™åˆ¶ location / { limit_req zone=one burst=5; limit_conn addr 10; } } } EOF } # é…ç½®ç³»ç»Ÿèµ„æºç›‘æ§ configure_monitoring() { log "é…ç½®èµ„æºç›‘æ§..." # åˆ›å»ºç›‘æ§è„šæœ¬ cat > ~/monitor_resources.sh << EOF #!/bin/bash while true; do # CPU ä½¿ç”¨ç‡ CPU_USAGE=\$(top -bn1 | grep "Cpu(s)" | awk &#39;{print \$2}&#39;) # å†…å­˜ä½¿ç”¨ç‡ MEM_USAGE=\$(free | grep Mem | awk &#39;{print \$3/\$2 * 100.0}&#39;) # è¿›ç¨‹æ•° PROCESS_COUNT=\$(ps aux | wc -l) # æ£€æŸ¥é™åˆ¶ if (( \$(echo "\$CPU_USAGE > 80" | bc -l) )); then ~/send_notification.sh "è­¦å‘Š: CPU ä½¿ç”¨ç‡è¿‡é«˜ (\${CPU_USAGE}%)" "high" fi if (( \$(echo "\$MEM_USAGE > 90" | bc -l) )); then ~/send_notification.sh "è­¦å‘Š: å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜ (\${MEM_USAGE}%)" "high" fi if [ "\$PROCESS_COUNT" -gt 200 ]; then ~/send_notification.sh "è­¦å‘Š: è¿›ç¨‹æ•°è¿‡å¤š (\$PROCESS_COUNT)" "high" fi sleep 60 done EOF chmod +x ~/monitor_resources.sh } # åº”ç”¨é…ç½® apply_configurations() { log "åº”ç”¨èµ„æºé™åˆ¶é…ç½®..." # é‡å¯æœåŠ¡ sudo systemctl restart nginx sudo systemctl restart llama-server # å¯åŠ¨ç›‘æ§ ~/monitor_resources.sh & # éªŒè¯é…ç½® log "éªŒè¯é…ç½®..." sudo nginx -t sudo systemctl status llama-server ulimit -a } # ä¸»å‡½æ•° main() { log "å¼€å§‹é…ç½®èµ„æºé™åˆ¶..." configure_system_limits configure_ai_service configure_nginx configure_monitoring apply_configurations log "èµ„æºé™åˆ¶é…ç½®å®Œæˆ" } # æ‰§è¡Œé…ç½® main äºŒåä¹ã€è‡ªåŠ¨åŒ–æµ‹è¯•ç³»ç»Ÿ 1. é›†æˆæµ‹è¯•è„šæœ¬ # åˆ›å»ºé›†æˆæµ‹è¯•è„šæœ¬ nano ~/integration_test.sh #!/bin/bash # ~/integration_test.sh # é…ç½® TEST_DIR="/home/zhaoxiongzhou/tests" REPORT_DIR="/home/zhaoxiongzhou/test_reports" LOG_FILE="/var/log/integration_test.log" # ç¡®ä¿ç›®å½•å­˜åœ¨ mkdir -p "$TEST_DIR" "$REPORT_DIR" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # æµ‹è¯• Web æœåŠ¡ test_web_service() { log "æµ‹è¯• Web æœåŠ¡..." local result=0 # æµ‹è¯•é¦–é¡µè®¿é—® if curl -s -o /dev/null -w "%{http_code}" http://localhost/ | grep -q "200"; then log "é¦–é¡µè®¿é—®æµ‹è¯•é€šè¿‡" else log "é”™è¯¯: é¦–é¡µè®¿é—®æµ‹è¯•å¤±è´¥" result=1 fi # æµ‹è¯•é™æ€èµ„æº if curl -s -o /dev/null -w "%{http_code}" http://localhost/css/main.css | grep -q "200"; then log "é™æ€èµ„æºæµ‹è¯•é€šè¿‡" else log "é”™è¯¯: é™æ€èµ„æºæµ‹è¯•å¤±è´¥" result=1 fi # æµ‹è¯• 404 é¡µé¢ if curl -s -o /dev/null -w "%{http_code}" http://localhost/nonexistent | grep -q "404"; then log "404 é¡µé¢æµ‹è¯•é€šè¿‡" else log "é”™è¯¯: 404 é¡µé¢æµ‹è¯•å¤±è´¥" result=1 fi return $result } # æµ‹è¯• AI æœåŠ¡ test_ai_service() { log "æµ‹è¯• AI æœåŠ¡..." local result=0 # æµ‹è¯•æœåŠ¡å¯ç”¨æ€§ if curl -s -o /dev/null -w "%{http_code}" http://localhost:8080/health | grep -q "200"; then log "AI æœåŠ¡å¥åº·æ£€æŸ¥é€šè¿‡" else log "é”™è¯¯: AI æœåŠ¡å¥åº·æ£€æŸ¥å¤±è´¥" result=1 fi # æµ‹è¯•æ¨¡å‹å“åº” local response=$(curl -s -X POST \ -H "Content-Type: application/json" \ -d &#39;{"prompt": "Hello", "max_tokens": 10}&#39; \ http://localhost:8080/completion) if echo "$response" | grep -q "text"; then log "AI æœåŠ¡å“åº”æµ‹è¯•é€šè¿‡" else log "é”™è¯¯: AI æœåŠ¡å“åº”æµ‹è¯•å¤±è´¥" result=1 fi return $result } # æµ‹è¯•ç³»ç»ŸæœåŠ¡ test_system_services() { log "æµ‹è¯•ç³»ç»ŸæœåŠ¡..." local result=0 # æµ‹è¯• Nginx çŠ¶æ€ if systemctl is-active --quiet nginx; then log "Nginx æœåŠ¡æµ‹è¯•é€šè¿‡" else log "é”™è¯¯: Nginx æœåŠ¡æµ‹è¯•å¤±è´¥" result=1 fi # æµ‹è¯•ç³»ç»Ÿèµ„æº local cpu_usage=$(top -bn1 | grep "Cpu(s)" | awk &#39;{print $2}&#39;) local mem_usage=$(free | grep Mem | awk &#39;{print $3/$2 * 100.0}&#39;) if [ $(echo "$cpu_usage < 90" | bc -l) -eq 1 ]; then log "CPU ä½¿ç”¨ç‡æ­£å¸¸" else log "è­¦å‘Š: CPU ä½¿ç”¨ç‡è¿‡é«˜" result=1 fi if [ $(echo "$mem_usage < 90" | bc -l) -eq 1 ]; then log "å†…å­˜ä½¿ç”¨ç‡æ­£å¸¸" else log "è­¦å‘Š: å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜" result=1 fi return $result } # ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š generate_report() { local web_result=$1 local ai_result=$2 local system_result=$3 local report_file="$REPORT_DIR/test_report_$(date +%Y%m%d_%H%M%S).md" { echo "# é›†æˆæµ‹è¯•æŠ¥å‘Š" echo "## æµ‹è¯•æ—¶é—´: $(date &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo echo "## æµ‹è¯•ç»“æœæ‘˜è¦" echo "- Web æœåŠ¡: $([ $web_result -eq 0 ] && echo &#39;é€šè¿‡ âœ…&#39; || echo &#39;å¤±è´¥ âŒ&#39;)" echo "- AI æœåŠ¡: $([ $ai_result -eq 0 ] && echo &#39;é€šè¿‡ âœ…&#39; || echo &#39;å¤±è´¥ âŒ&#39;)" echo "- ç³»ç»ŸæœåŠ¡: $([ $system_result -eq 0 ] && echo &#39;é€šè¿‡ âœ…&#39; || echo &#39;å¤±è´¥ âŒ&#39;)" echo echo "## è¯¦ç»†æ—¥å¿—" echo &#39;```&#39; tail -n 50 "$LOG_FILE" echo &#39;```&#39; } > "$report_file" log "æµ‹è¯•æŠ¥å‘Šå·²ç”Ÿæˆ: $report_file" } # ä¸»å‡½æ•° main() { log "å¼€å§‹é›†æˆæµ‹è¯•..." local web_result=0 local ai_result=0 local system_result=0 # æ‰§è¡Œæµ‹è¯• test_web_service web_result=$? test_ai_service ai_result=$? test_system_services system_result=$? # ç”ŸæˆæŠ¥å‘Š generate_report $web_result $ai_result $system_result # å‘é€é€šçŸ¥ if [ $web_result -eq 0 ] && [ $ai_result -eq 0 ] && [ $system_result -eq 0 ]; then ~/send_notification.sh "é›†æˆæµ‹è¯•å…¨éƒ¨é€šè¿‡" "normal" else ~/send_notification.sh "é›†æˆæµ‹è¯•å­˜åœ¨å¤±è´¥é¡¹ï¼Œè¯·æŸ¥çœ‹æŠ¥å‘Š" "high" fi # è¿”å›æ€»ä½“ç»“æœ return $(( web_result + ai_result + system_result )) } # æ‰§è¡Œæµ‹è¯• main ä¸‰åã€ç³»ç»ŸçŠ¶æ€ä»ªè¡¨æ¿ 1. çŠ¶æ€ç›‘æ§é¡µé¢ç”Ÿæˆè„šæœ¬ # åˆ›å»ºçŠ¶æ€é¡µé¢ç”Ÿæˆè„šæœ¬ nano ~/generate_dashboard.sh #!/bin/bash # ~/generate_dashboard.sh # é…ç½® DASHBOARD_DIR="/var/www/html/dashboard" REFRESH_INTERVAL=60 # é¡µé¢åˆ·æ–°é—´éš”ï¼ˆç§’ï¼‰ LOG_FILE="/var/log/dashboard.log" # ç¡®ä¿ç›®å½•å­˜åœ¨ sudo mkdir -p "$DASHBOARD_DIR" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # æ”¶é›†ç³»ç»ŸçŠ¶æ€æ•°æ® collect_system_data() { # CPU ä¿¡æ¯ CPU_USAGE=$(top -bn1 | grep "Cpu(s)" | awk &#39;{print $2}&#39;) CPU_TEMP=$(vcgencmd measure_temp | sed &#39;s/temp=//&#39; | sed &#39;s/&#39;"&#39;"&#39;C//&#39;) # å†…å­˜ä¿¡æ¯ MEM_TOTAL=$(free -m | awk &#39;/Mem:/ {print $2}&#39;) MEM_USED=$(free -m | awk &#39;/Mem:/ {print $3}&#39;) MEM_USAGE=$(awk "BEGIN {printf \"%.2f\", $MEM_USED/$MEM_TOTAL*100}") # ç£ç›˜ä¿¡æ¯ DISK_USAGE=$(df -h / | awk &#39;NR==2 {print $5}&#39; | sed &#39;s/%//&#39;) # ç³»ç»Ÿè´Ÿè½½ LOAD_AVG=$(uptime | awk -F&#39;load average:&#39; &#39;{print $2}&#39; | xargs) # è¿è¡Œæ—¶é—´ UPTIME=$(uptime -p) } # æ”¶é›†æœåŠ¡çŠ¶æ€ collect_service_data() { # Nginx çŠ¶æ€ if systemctl is-active --quiet nginx; then NGINX_STATUS="è¿è¡Œä¸­ âœ…" else NGINX_STATUS="å·²åœæ­¢ âŒ" fi # AI æœåŠ¡çŠ¶æ€ if pgrep -f llama-server > /dev/null; then AI_STATUS="è¿è¡Œä¸­ âœ…" else AI_STATUS="å·²åœæ­¢ âŒ" fi # è·å–æœ€è¿‘çš„æ—¥å¿— RECENT_LOGS=$(tail -n 10 /var/log/syslog | sed &#39;s/</\&amp;lt;/g&#39; | sed &#39;s/>/\&amp;gt;/g&#39;) } # ç”ŸæˆçŠ¶æ€é¡µé¢ generate_dashboard() { local timestamp=$(date &#39;+%Y-%m-%d %H:%M:%S&#39;) cat > "$DASHBOARD_DIR/index.html" << EOF <!DOCTYPE html> <html lang="zh"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>ç³»ç»ŸçŠ¶æ€ä»ªè¡¨æ¿</title> <meta http-equiv="refresh" content="$REFRESH_INTERVAL"> <style> body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; } .container { max-width: 1200px; margin: 0 auto; } .card { background: white; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); } .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; } .metric { text-align: center; padding: 15px; border-radius: 4px; background: #f8f9fa; } .metric h3 { margin: 0; color: #666; } .metric .value { font-size: 24px; font-weight: bold; margin: 10px 0; } .status { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee; } .logs { background: #2b2b2b; color: #fff; padding: 15px; border-radius: 4px; font-family: monospace; white-space: pre-wrap; } </style> </head> <body> <div class="container"> <h1>ç³»ç»ŸçŠ¶æ€ä»ªè¡¨æ¿</h1> <p>æœ€åæ›´æ–°: $timestamp</p> <div class="card"> <h2>ç³»ç»Ÿèµ„æº</h2> <div class="grid"> <div class="metric"> <h3>CPU ä½¿ç”¨ç‡</h3> <div class="value">$CPU_USAGE%</div> </div> <div class="metric"> <h3>CPU æ¸©åº¦</h3> <div class="value">$CPU_TEMP</div> </div> <div class="metric"> <h3>å†…å­˜ä½¿ç”¨ç‡</h3> <div class="value">$MEM_USAGE%</div> </div> <div class="metric"> <h3>ç£ç›˜ä½¿ç”¨ç‡</h3> <div class="value">$DISK_USAGE%</div> </div> </div> </div> <div class="card"> <h2>ç³»ç»Ÿä¿¡æ¯</h2> <div class="status"> <span>ç³»ç»Ÿè´Ÿè½½:</span> <span>$LOAD_AVG</span> </div> <div class="status"> <span>è¿è¡Œæ—¶é—´:</span> <span>$UPTIME</span> </div> </div> <div class="card"> <h2>æœåŠ¡çŠ¶æ€</h2> <div class="status"> <span>Nginx æœåŠ¡:</span> <span>$NGINX_STATUS</span> </div> <div class="status"> <span>AI æœåŠ¡:</span> <span>$AI_STATUS</span> </div> </div> <div class="card"> <h2>æœ€è¿‘æ—¥å¿—</h2> <div class="logs">$RECENT_LOGS</div> </div> </div> </body> </html> EOF # è®¾ç½®æƒé™ sudo chown www-data:www-data "$DASHBOARD_DIR/index.html" } # ä¸»å‡½æ•° main() { log "å¼€å§‹ç”ŸæˆçŠ¶æ€ä»ªè¡¨æ¿..." # æ”¶é›†æ•°æ® collect_system_data collect_service_data # ç”Ÿæˆé¡µé¢ generate_dashboard log "çŠ¶æ€ä»ªè¡¨æ¿å·²æ›´æ–°" } # æ‰§è¡Œç”Ÿæˆ main ä¸‰åä¸€ã€ç³»ç»Ÿå¤‡ä»½ä¸æ¢å¤å®Œæ•´æ–¹æ¡ˆ 1. å®Œæ•´å¤‡ä»½è„šæœ¬ # åˆ›å»ºå®Œæ•´å¤‡ä»½è„šæœ¬ nano ~/full_backup.sh #!/bin/bash # ~/full_backup.sh # é…ç½® BACKUP_ROOT="/mnt/backup_drive" BACKUP_DIR="$BACKUP_ROOT/system_backups" EXCLUDE_FILE="/home/zhaoxiongzhou/backup_exclude.txt" LOG_FILE="/var/log/backup.log" RETENTION_DAYS=30 COMPRESSION_LEVEL=6 # ç¡®ä¿å¤‡ä»½ç›®å½•å­˜åœ¨ mkdir -p "$BACKUP_DIR" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # æ£€æŸ¥å¤‡ä»½ç¯å¢ƒ check_environment() { log "æ£€æŸ¥å¤‡ä»½ç¯å¢ƒ..." # æ£€æŸ¥å¤‡ä»½ç›®æ ‡ç›®å½• if ! mountpoint -q "$BACKUP_ROOT"; then log "é”™è¯¯: å¤‡ä»½é©±åŠ¨å™¨æœªæŒ‚è½½" return 1 fi # æ£€æŸ¥å¯ç”¨ç©ºé—´ local available_space=$(df -BG "$BACKUP_ROOT" | awk &#39;NR==2 {print $4}&#39; | sed &#39;s/G//&#39;) if [ "$available_space" -lt 10 ]; then log "é”™è¯¯: å¤‡ä»½ç©ºé—´ä¸è¶³ï¼ˆå°äº 10GBï¼‰" return 1 fi # åˆ›å»ºæ’é™¤æ–‡ä»¶ cat > "$EXCLUDE_FILE" << EOF /proc/* /sys/* /tmp/* /run/* /mnt/* /media/* /lost+found /var/cache/* /var/tmp/* /var/log/* /home/*/Downloads/* /home/*/.cache/* EOF return 0 } # åœæ­¢æœåŠ¡ stop_services() { log "åœæ­¢æœåŠ¡..." # åœæ­¢ Nginx sudo systemctl stop nginx # åœæ­¢ AI æœåŠ¡ pkill llama-server # ç­‰å¾…æœåŠ¡å®Œå…¨åœæ­¢ sleep 5 } # å¯åŠ¨æœåŠ¡ start_services() { log "å¯åŠ¨æœåŠ¡..." # å¯åŠ¨ Nginx sudo systemctl start nginx # å¯åŠ¨ AI æœåŠ¡ ~/projects/llama.cpp/start-llama.sh # éªŒè¯æœåŠ¡çŠ¶æ€ sleep 10 if ! systemctl is-active --quiet nginx; then log "è­¦å‘Š: Nginx æœåŠ¡æœªèƒ½æ­£å¸¸å¯åŠ¨" fi if ! pgrep -f llama-server > /dev/null; then log "è­¦å‘Š: AI æœåŠ¡æœªèƒ½æ­£å¸¸å¯åŠ¨" fi } # åˆ›å»ºå®Œæ•´å¤‡ä»½ create_full_backup() { local backup_date=$(date +%Y%m%d_%H%M%S) local backup_file="$BACKUP_DIR/full_backup_${backup_date}.tar.gz" local manifest_file="$BACKUP_DIR/backup_manifest_${backup_date}.txt" log "å¼€å§‹åˆ›å»ºå®Œæ•´å¤‡ä»½..." # åˆ›å»ºæ–‡ä»¶æ¸…å• log "ç”Ÿæˆæ–‡ä»¶æ¸…å•..." find / -xdev -type f ! -path "$(cat $EXCLUDE_FILE | tr &#39;\n&#39; &#39;|&#39;)" > "$manifest_file" # åˆ›å»ºå¤‡ä»½ log "åˆ›å»ºç³»ç»Ÿå¤‡ä»½..." sudo tar -czf "$backup_file" \ --exclude-from="$EXCLUDE_FILE" \ --one-file-system \ --preserve-permissions \ --numeric-owner \ --checkpoint=1000 \ --checkpoint-action=dot \ -C / . # éªŒè¯å¤‡ä»½ if ! tar -tzf "$backup_file" >/dev/null 2>&amp;1; then log "é”™è¯¯: å¤‡ä»½æ–‡ä»¶éªŒè¯å¤±è´¥" return 1 fi # è®¡ç®—æ ¡éªŒå’Œ log "è®¡ç®—æ ¡éªŒå’Œ..." sha256sum "$backup_file" > "${backup_file}.sha256" # åˆ›å»ºå¤‡ä»½ä¿¡æ¯æ–‡ä»¶ cat > "${backup_file}.info" << EOF å¤‡ä»½æ—¶é—´: $(date) ç³»ç»Ÿç‰ˆæœ¬: $(cat /etc/os-release | grep PRETTY_NAME) å†…æ ¸ç‰ˆæœ¬: $(uname -r) å¤‡ä»½å¤§å°: $(du -h "$backup_file" | cut -f1) æ–‡ä»¶æ•°é‡: $(wc -l < "$manifest_file") æ’é™¤è§„åˆ™: $(cat "$EXCLUDE_FILE") EOF return 0 } # æ¸…ç†æ—§å¤‡ä»½ cleanup_old_backups() { log "æ¸…ç†æ—§å¤‡ä»½..." find "$BACKUP_DIR" -type f -name "full_backup_*" -mtime +$RETENTION_DAYS -delete find "$BACKUP_DIR" -type f -name "backup_manifest_*" -mtime +$RETENTION_DAYS -delete find "$BACKUP_DIR" -type f -name "*.sha256" -mtime +$RETENTION_DAYS -delete find "$BACKUP_DIR" -type f -name "*.info" -mtime +$RETENTION_DAYS -delete } # ä¸»å‡½æ•° main() { log "å¼€å§‹å®Œæ•´å¤‡ä»½æµç¨‹..." # æ£€æŸ¥ç¯å¢ƒ if ! check_environment; then log "å¤‡ä»½ç¯å¢ƒæ£€æŸ¥å¤±è´¥ï¼Œç»ˆæ­¢å¤‡ä»½" ~/send_notification.sh "ç³»ç»Ÿå¤‡ä»½å¤±è´¥ï¼šç¯å¢ƒæ£€æŸ¥æœªé€šè¿‡" "high" return 1 fi # åœæ­¢æœåŠ¡ stop_services # åˆ›å»ºå¤‡ä»½ if create_full_backup; then log "å¤‡ä»½åˆ›å»ºæˆåŠŸ" ~/send_notification.sh "ç³»ç»Ÿå®Œæ•´å¤‡ä»½å·²æˆåŠŸåˆ›å»º" "normal" else log "å¤‡ä»½åˆ›å»ºå¤±è´¥" ~/send_notification.sh "ç³»ç»Ÿå¤‡ä»½å¤±è´¥ï¼šå¤‡ä»½åˆ›å»ºè¿‡ç¨‹å‡ºé”™" "high" fi # å¯åŠ¨æœåŠ¡ start_services # æ¸…ç†æ—§å¤‡ä»½ cleanup_old_backups log "å¤‡ä»½æµç¨‹å®Œæˆ" } # æ‰§è¡Œå¤‡ä»½ main ä¸‰åäºŒã€ç³»ç»Ÿæ¢å¤è„šæœ¬ 1. ç³»ç»Ÿæ¢å¤è„šæœ¬ # åˆ›å»ºç³»ç»Ÿæ¢å¤è„šæœ¬ nano ~/system_restore.sh #!/bin/bash # ~/system_restore.sh # é…ç½® BACKUP_ROOT="/mnt/backup_drive" BACKUP_DIR="$BACKUP_ROOT/system_backups" LOG_FILE="/var/log/restore.log" TEMP_DIR="/tmp/restore_temp" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # éªŒè¯å¤‡ä»½æ–‡ä»¶ verify_backup() { local backup_file="$1" log "éªŒè¯å¤‡ä»½æ–‡ä»¶: $backup_file" # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ if [ ! -f "$backup_file" ]; then log "é”™è¯¯: å¤‡ä»½æ–‡ä»¶ä¸å­˜åœ¨" return 1 fi # æ£€æŸ¥æ ¡éªŒå’Œ local checksum_file="${backup_file}.sha256" if [ -f "$checksum_file" ]; then if ! sha256sum -c "$checksum_file"; then log "é”™è¯¯: å¤‡ä»½æ–‡ä»¶æ ¡éªŒå’ŒéªŒè¯å¤±è´¥" return 1 fi else log "è­¦å‘Š: æœªæ‰¾åˆ°æ ¡éªŒå’Œæ–‡ä»¶" fi # æµ‹è¯•å½’æ¡£å®Œæ•´æ€§ if ! tar -tzf "$backup_file" >/dev/null 2>&amp;1; then log "é”™è¯¯: å¤‡ä»½æ–‡ä»¶æŸå" return 1 fi return 0 } # å‡†å¤‡æ¢å¤ç¯å¢ƒ prepare_environment() { log "å‡†å¤‡æ¢å¤ç¯å¢ƒ..." # åˆ›å»ºä¸´æ—¶ç›®å½• mkdir -p "$TEMP_DIR" # åœæ­¢æ‰€æœ‰æœåŠ¡ log "åœæ­¢æœåŠ¡..." sudo systemctl stop nginx pkill llama-server # ç­‰å¾…æœåŠ¡åœæ­¢ sleep 5 # æ¸…ç†ç›®æ ‡ç›®å½• log "æ¸…ç†ç›®æ ‡ç›®å½•..." read -p "è­¦å‘Š: è¿™å°†æ¸…é™¤ç³»ç»Ÿæ–‡ä»¶ã€‚ç¡®å®šè¦ç»§ç»­å—ï¼Ÿ(y/n) " -n 1 -r echo if [[ ! $REPLY =~ ^[Yy]$ ]]; then log "ç”¨æˆ·å–æ¶ˆæ“ä½œ" return 1 fi return 0 } # æ‰§è¡Œæ¢å¤ perform_restore() { local backup_file="$1" log "å¼€å§‹æ¢å¤ç³»ç»Ÿ..." # åˆ›å»ºæ¢å¤å‰çš„å¿«ç…§ log "åˆ›å»ºå½“å‰ç³»ç»Ÿå¿«ç…§..." local snapshot_date=$(date +%Y%m%d_%H%M%S) local snapshot_file="$BACKUP_DIR/pre_restore_snapshot_${snapshot_date}.tar.gz" sudo tar -czf "$snapshot_file" \ --exclude-from="/home/zhaoxiongzhou/backup_exclude.txt" \ --one-file-system \ -C / . # è§£å‹å¤‡ä»½ log "è§£å‹å¤‡ä»½æ–‡ä»¶..." sudo tar -xzf "$backup_file" -C / \ --numeric-owner \ --preserve-permissions \ --checkpoint=1000 \ --checkpoint-action=dot # ä¿®å¤æƒé™ log "ä¿®å¤æ–‡ä»¶æƒé™..." sudo chown -R www-data:www-data /var/www/ sudo chown -R zhaoxiongzhou:zhaoxiongzhou /home/zhaoxiongzhou/ return 0 } # æ¢å¤æœåŠ¡é…ç½® restore_configurations() { log "æ¢å¤æœåŠ¡é…ç½®..." # é‡æ–°åŠ è½½ç³»ç»Ÿé…ç½® sudo systemctl daemon-reload sudo sysctl --system # é‡æ–°é…ç½®ç½‘ç»œ sudo systemctl restart networking # æ¢å¤é˜²ç«å¢™è§„åˆ™ sudo iptables-restore < /etc/iptables/rules.v4 return 0 } # éªŒè¯æ¢å¤ verify_restore() { log "éªŒè¯ç³»ç»Ÿæ¢å¤..." local status=0 # æ£€æŸ¥å…³é”®æ–‡ä»¶ for file in "/etc/nginx/nginx.conf" "/etc/systemd/system/llama-server.service"; do if [ ! -f "$file" ]; then log "é”™è¯¯: æœªæ‰¾åˆ°å…³é”®æ–‡ä»¶ $file" status=1 fi done # å¯åŠ¨æœåŠ¡ sudo systemctl start nginx ~/projects/llama.cpp/start-llama.sh # éªŒè¯æœåŠ¡çŠ¶æ€ sleep 10 if ! systemctl is-active --quiet nginx; then log "é”™è¯¯: Nginx æœåŠ¡æœªèƒ½æ­£å¸¸å¯åŠ¨" status=1 fi if ! pgrep -f llama-server > /dev/null; then log "é”™è¯¯: AI æœåŠ¡æœªèƒ½æ­£å¸¸å¯åŠ¨" status=1 fi return $status } # æ¸…ç†æ¢å¤ç¯å¢ƒ cleanup() { log "æ¸…ç†æ¢å¤ç¯å¢ƒ..." # åˆ é™¤ä¸´æ—¶æ–‡ä»¶ rm -rf "$TEMP_DIR" # æ¸…ç†æ—¥å¿— find /var/log -type f -name "*.gz" -delete return 0 } # ä¸»å‡½æ•° main() { local backup_file # åˆ—å‡ºå¯ç”¨å¤‡ä»½ echo "å¯ç”¨çš„å¤‡ä»½æ–‡ä»¶:" ls -lh "$BACKUP_DIR"/full_backup_*.tar.gz # é€‰æ‹©å¤‡ä»½æ–‡ä»¶ read -p "è¯·è¾“å…¥è¦æ¢å¤çš„å¤‡ä»½æ–‡ä»¶å®Œæ•´è·¯å¾„: " backup_file # éªŒè¯å¤‡ä»½ if ! verify_backup "$backup_file"; then log "å¤‡ä»½éªŒè¯å¤±è´¥ï¼Œç»ˆæ­¢æ¢å¤" return 1 fi # å‡†å¤‡ç¯å¢ƒ if ! prepare_environment; then log "ç¯å¢ƒå‡†å¤‡å¤±è´¥ï¼Œç»ˆæ­¢æ¢å¤" return 1 fi # æ‰§è¡Œæ¢å¤ if perform_restore "$backup_file" && \ restore_configurations && \ verify_restore; then log "ç³»ç»Ÿæ¢å¤æˆåŠŸå®Œæˆ" ~/send_notification.sh "ç³»ç»Ÿæ¢å¤æˆåŠŸå®Œæˆ" "normal" else log "ç³»ç»Ÿæ¢å¤å¤±è´¥" ~/send_notification.sh "ç³»ç»Ÿæ¢å¤å¤±è´¥ï¼Œéœ€è¦æ‰‹åŠ¨æ£€æŸ¥" "high" fi # æ¸…ç†ç¯å¢ƒ cleanup } # æ‰§è¡Œæ¢å¤ main ä¸‰åä¸‰ã€ç³»ç»Ÿè¿ç§»å·¥å…· 1. ç³»ç»Ÿè¿ç§»è„šæœ¬ # åˆ›å»ºç³»ç»Ÿè¿ç§»è„šæœ¬ nano ~/system_migration.sh #!/bin/bash # ~/system_migration.sh # é…ç½® SOURCE_HOST="old-raspberry.local" TARGET_HOST="new-raspberry.local" MIGRATION_DIR="/mnt/migration" LOG_FILE="/var/log/migration.log" SSH_KEY="~/.ssh/migration_key" RSYNC_OPTS="-avz --progress --delete" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # æ£€æŸ¥è¿ç§»ç¯å¢ƒ check_migration_env() { log "æ£€æŸ¥è¿ç§»ç¯å¢ƒ..." # æ£€æŸ¥ SSH å¯†é’¥ if [ ! -f "$SSH_KEY" ]; then log "ç”Ÿæˆ SSH å¯†é’¥..." ssh-keygen -t ed25519 -f "$SSH_KEY" -N "" # å¤åˆ¶å¯†é’¥åˆ°ç›®æ ‡ä¸»æœº ssh-copy-id -i "$SSH_KEY" "zhaoxiongzhou@$TARGET_HOST" fi # æ£€æŸ¥å¿…è¦å·¥å…· for tool in rsync ssh scp; do if ! command -v $tool &>/dev/null; then log "é”™è¯¯: æœªæ‰¾åˆ°å¿…è¦å·¥å…· $tool" return 1 fi done # æ£€æŸ¥ç›®æ ‡ä¸»æœºè¿æ¥ if ! ssh -i "$SSH_KEY" "zhaoxiongzhou@$TARGET_HOST" "echo &#39;Connection test&#39;" &>/dev/null; then log "é”™è¯¯: æ— æ³•è¿æ¥åˆ°ç›®æ ‡ä¸»æœº" return 1 fi return 0 } # è¿ç§»é…ç½®æ–‡ä»¶ migrate_configs() { log "è¿ç§»é…ç½®æ–‡ä»¶..." # åˆ›å»ºé…ç½®ç›®å½• ssh -i "$SSH_KEY" "zhaoxiongzhou@$TARGET_HOST" "mkdir -p ~/configs_backup" # è¿ç§» Nginx é…ç½® rsync $RSYNC_OPTS -e "ssh -i $SSH_KEY" \ /etc/nginx/ \ "zhaoxiongzhou@$TARGET_HOST:~/configs_backup/nginx/" # è¿ç§»ç³»ç»Ÿé…ç½® rsync $RSYNC_OPTS -e "ssh -i $SSH_KEY" \ /etc/sysctl.d/ \ "zhaoxiongzhou@$TARGET_HOST:~/configs_backup/sysctl/" # è¿ç§»æœåŠ¡é…ç½® rsync $RSYNC_OPTS -e "ssh -i $SSH_KEY" \ /etc/systemd/system/ \ "zhaoxiongzhou@$TARGET_HOST:~/configs_backup/systemd/" } # è¿ç§»æ•°æ® migrate_data() { log "è¿ç§»æ•°æ®..." # è¿ç§»åšå®¢æ•°æ® rsync $RSYNC_OPTS -e "ssh -i $SSH_KEY" \ ~/myblog/ \ "zhaoxiongzhou@$TARGET_HOST:~/myblog/" # è¿ç§» AI æœåŠ¡æ•°æ® rsync $RSYNC_OPTS -e "ssh -i $SSH_KEY" \ ~/projects/llama.cpp/ \ "zhaoxiongzhou@$TARGET_HOST:~/projects/llama.cpp/" # è¿ç§»ç”¨æˆ·è„šæœ¬ rsync $RSYNC_OPTS -e "ssh -i $SSH_KEY" \ ~/*.sh \ "zhaoxiongzhou@$TARGET_HOST:~/" } # è¿ç§»æ•°æ®åº“ migrate_database() { log "è¿ç§»æ•°æ®åº“..." # å¯¼å‡ºæ•°æ®åº“ local dump_file="/tmp/database_dump.sql" if [ -f "/var/lib/mysql" ]; then mysqldump --all-databases > "$dump_file" # ä¼ è¾“åˆ°ç›®æ ‡ä¸»æœº scp -i "$SSH_KEY" "$dump_file" "zhaoxiongzhou@$TARGET_HOST:/tmp/" # åœ¨ç›®æ ‡ä¸»æœºå¯¼å…¥æ•°æ®åº“ ssh -i "$SSH_KEY" "zhaoxiongzhou@$TARGET_HOST" \ "mysql < /tmp/database_dump.sql" fi } # é…ç½®ç›®æ ‡ç³»ç»Ÿ configure_target() { log "é…ç½®ç›®æ ‡ç³»ç»Ÿ..." ssh -i "$SSH_KEY" "zhaoxiongzhou@$TARGET_HOST" "bash -s" << &#39;EOF&#39; # å®‰è£…å¿…è¦è½¯ä»¶ sudo apt update sudo apt install -y nginx mysql-server python3 pip # æ¢å¤é…ç½® sudo cp -r ~/configs_backup/nginx/* /etc/nginx/ sudo cp -r ~/configs_backup/sysctl/* /etc/sysctl.d/ sudo cp -r ~/configs_backup/systemd/* /etc/systemd/system/ # è®¾ç½®æƒé™ sudo chown -R www-data:www-data /var/www/ sudo chmod +x ~/*.sh # é‡å¯æœåŠ¡ sudo systemctl daemon-reload sudo systemctl restart nginx EOF } # éªŒè¯è¿ç§» verify_migration() { log "éªŒè¯è¿ç§»..." local status=0 # æ£€æŸ¥æœåŠ¡çŠ¶æ€ ssh -i "$SSH_KEY" "zhaoxiongzhou@$TARGET_HOST" "bash -s" << &#39;EOF&#39; # æ£€æŸ¥ Nginx if ! systemctl is-active --quiet nginx; then echo "é”™è¯¯: Nginx æœåŠ¡æœªè¿è¡Œ" exit 1 fi # æ£€æŸ¥æ–‡ä»¶ for dir in "~/myblog" "~/projects/llama.cpp"; do if [ ! -d "$dir" ]; then echo "é”™è¯¯: ç›®å½• $dir ä¸å­˜åœ¨" exit 1 fi done # æ£€æŸ¥é…ç½® if ! nginx -t &>/dev/null; then echo "é”™è¯¯: Nginx é…ç½®æ— æ•ˆ" exit 1 fi EOF status=$? return $status } # ä¸»å‡½æ•° main() { log "å¼€å§‹ç³»ç»Ÿè¿ç§»..." # æ£€æŸ¥ç¯å¢ƒ if ! check_migration_env; then log "è¿ç§»ç¯å¢ƒæ£€æŸ¥å¤±è´¥" return 1 fi # æ‰§è¡Œè¿ç§» migrate_configs migrate_data migrate_database configure_target # éªŒè¯è¿ç§» if verify_migration; then log "ç³»ç»Ÿè¿ç§»æˆåŠŸå®Œæˆ" ~/send_notification.sh "ç³»ç»Ÿè¿ç§»æˆåŠŸå®Œæˆ" "normal" else log "ç³»ç»Ÿè¿ç§»å¤±è´¥" ~/send_notification.sh "ç³»ç»Ÿè¿ç§»å¤±è´¥ï¼Œéœ€è¦æ‰‹åŠ¨æ£€æŸ¥" "high" fi } # æ‰§è¡Œè¿ç§» main ä¸‰åå››ã€æ—¥å¿—åˆ†æå·¥å…· 1. æ—¥å¿—åˆ†æè„šæœ¬ # åˆ›å»ºæ—¥å¿—åˆ†æè„šæœ¬ nano ~/log_analyzer.sh #!/bin/bash # ~/log_analyzer.sh # é…ç½® LOG_DIRS=( "/var/log" "/var/log/nginx" "/home/zhaoxiongzhou/logs" ) REPORT_DIR="/home/zhaoxiongzhou/log_reports" LOG_FILE="/var/log/analyzer.log" ALERT_THRESHOLD=100 # é”™è¯¯æ—¥å¿—é˜ˆå€¼ RETENTION_DAYS=30 # æŠ¥å‘Šä¿ç•™å¤©æ•° # ç¡®ä¿ç›®å½•å­˜åœ¨ mkdir -p "$REPORT_DIR" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # åˆ†æç³»ç»Ÿæ—¥å¿— analyze_system_logs() { log "åˆ†æç³»ç»Ÿæ—¥å¿—..." local report_file="$REPORT_DIR/system_log_report_$(date +%Y%m%d).md" { echo "# ç³»ç»Ÿæ—¥å¿—åˆ†ææŠ¥å‘Š" echo "## ç”Ÿæˆæ—¶é—´: $(date &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo echo "## ç³»ç»Ÿé”™è¯¯ç»Ÿè®¡" echo "### ä¸¥é‡é”™è¯¯" echo &#39;```&#39; grep -i "error\|critical\|emergency" /var/log/syslog | \ tail -n 50 | sort | uniq -c | sort -nr echo &#39;```&#39; echo "### è®¤è¯å¤±è´¥" echo &#39;```&#39; grep "Failed password" /var/log/auth.log | \ awk &#39;{print $1,$2,$3,$11}&#39; | sort | uniq -c | sort -nr | head -n 10 echo &#39;```&#39; echo "### ç³»ç»Ÿé‡å¯è®°å½•" echo &#39;```&#39; last reboot | head -n 5 echo &#39;```&#39; } > "$report_file" } # åˆ†æ Nginx è®¿é—®æ—¥å¿— analyze_nginx_logs() { log "åˆ†æ Nginx è®¿é—®æ—¥å¿—..." local report_file="$REPORT_DIR/nginx_log_report_$(date +%Y%m%d).md" { echo "# Nginx è®¿é—®æ—¥å¿—åˆ†ææŠ¥å‘Š" echo "## ç”Ÿæˆæ—¶é—´: $(date &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo echo "## è®¿é—®ç»Ÿè®¡" echo "### è¯·æ±‚é‡æœ€å¤§çš„ IP" echo &#39;```&#39; awk &#39;{print $1}&#39; /var/log/nginx/access.log | sort | uniq -c | sort -nr | head -n 10 echo &#39;```&#39; echo "### è®¿é—®é‡æœ€å¤§çš„é¡µé¢" echo &#39;```&#39; awk &#39;{print $7}&#39; /var/log/nginx/access.log | sort | uniq -c | sort -nr | head -n 10 echo &#39;```&#39; echo "### HTTP çŠ¶æ€ç ç»Ÿè®¡" echo &#39;```&#39; awk &#39;{print $9}&#39; /var/log/nginx/access.log | sort | uniq -c | sort -nr echo &#39;```&#39; echo "### æ¯å°æ—¶è¯·æ±‚é‡ç»Ÿè®¡" echo &#39;```&#39; awk &#39;{print $4}&#39; /var/log/nginx/access.log | cut -c 14-15 | sort | uniq -c | \ awk &#39;{printf("%s:00 - %s è¯·æ±‚\n", $2, $1)}&#39; echo &#39;```&#39; } > "$report_file" } # åˆ†æ AI æœåŠ¡æ—¥å¿— analyze_ai_logs() { log "åˆ†æ AI æœåŠ¡æ—¥å¿—..." local report_file="$REPORT_DIR/ai_log_report_$(date +%Y%m%d).md" local ai_log="/home/zhaoxiongzhou/logs/llama.log" if [ -f "$ai_log" ]; then { echo "# AI æœåŠ¡æ—¥å¿—åˆ†ææŠ¥å‘Š" echo "## ç”Ÿæˆæ—¶é—´: $(date &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo echo "## æœåŠ¡ç»Ÿè®¡" echo "### é”™è¯¯ç»Ÿè®¡" echo &#39;```&#39; grep -i "error" "$ai_log" | tail -n 20 echo &#39;```&#39; echo "### æ€§èƒ½ç»Ÿè®¡" echo "#### å“åº”æ—¶é—´åˆ†å¸ƒ" echo &#39;```&#39; grep "response_time" "$ai_log" | \ awk &#39;{sum+=$NF; count++} END {print "å¹³å‡å“åº”æ—¶é—´:", sum/count, "ms"}&#39; echo &#39;```&#39; echo "#### å†…å­˜ä½¿ç”¨ç»Ÿè®¡" echo &#39;```&#39; grep "memory_usage" "$ai_log" | tail -n 10 echo &#39;```&#39; } > "$report_file" fi } # ç”Ÿæˆå®‰å…¨æŠ¥å‘Š generate_security_report() { log "ç”Ÿæˆå®‰å…¨æŠ¥å‘Š..." local report_file="$REPORT_DIR/security_report_$(date +%Y%m%d).md" { echo "# å®‰å…¨åˆ†ææŠ¥å‘Š" echo "## ç”Ÿæˆæ—¶é—´: $(date &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo echo "## å®‰å…¨äº‹ä»¶ç»Ÿè®¡" echo "### SSH æš´åŠ›ç ´è§£å°è¯•" echo &#39;```&#39; grep "Failed password" /var/log/auth.log | \ awk &#39;{print $11,$13}&#39; | sort | uniq -c | sort -nr | head -n 10 echo &#39;```&#39; echo "### å¯ç–‘ IP è®¿é—®" echo &#39;```&#39; grep -i "suspicious\|attack\|hack" /var/log/nginx/access.log | \ awk &#39;{print $1}&#39; | sort | uniq -c | sort -nr echo &#39;```&#39; echo "### æ–‡ä»¶æƒé™å˜æ›´" echo &#39;```&#39; find /etc -mtime -1 -type f -ls echo &#39;```&#39; } > "$report_file" } # æ¸…ç†æ—§æŠ¥å‘Š cleanup_old_reports() { log "æ¸…ç†æ—§æŠ¥å‘Š..." find "$REPORT_DIR" -type f -name "*.md" -mtime +$RETENTION_DAYS -delete } # ç”Ÿæˆæ‘˜è¦æŠ¥å‘Š generate_summary() { log "ç”Ÿæˆæ‘˜è¦æŠ¥å‘Š..." local summary_file="$REPORT_DIR/summary_$(date +%Y%m%d).md" { echo "# æ—¥å¿—åˆ†ææ‘˜è¦æŠ¥å‘Š" echo "## ç”Ÿæˆæ—¶é—´: $(date &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo echo "## å…³é”®æŒ‡æ ‡" # é”™è¯¯ç»Ÿè®¡ local error_count=$(grep -i "error" /var/log/syslog | wc -l) local nginx_error_count=$(grep -i "error" /var/log/nginx/error.log | wc -l) echo "- ç³»ç»Ÿé”™è¯¯æ•°: $error_count" echo "- Nginx é”™è¯¯æ•°: $nginx_error_count" # å®‰å…¨äº‹ä»¶ local ssh_fails=$(grep "Failed password" /var/log/auth.log | wc -l) echo "- SSH å¤±è´¥å°è¯•: $ssh_fails" # å‘Šè­¦åˆ¤æ–­ if [ $error_count -gt $ALERT_THRESHOLD ]; then ~/send_notification.sh "è­¦å‘Š: ç³»ç»Ÿé”™è¯¯æ•°è¶…è¿‡é˜ˆå€¼" "high" fi } > "$summary_file" } # ä¸»å‡½æ•° main() { log "å¼€å§‹æ—¥å¿—åˆ†æ..." # æ‰§è¡Œåˆ†æ analyze_system_logs analyze_nginx_logs analyze_ai_logs generate_security_report generate_summary # æ¸…ç†æ—§æŠ¥å‘Š cleanup_old_reports log "æ—¥å¿—åˆ†æå®Œæˆ" } # æ‰§è¡Œåˆ†æ main ä¸‰åäº”ã€ç³»ç»Ÿä¼˜åŒ–å·¥å…· 1. ç³»ç»Ÿä¼˜åŒ–è„šæœ¬ # åˆ›å»ºç³»ç»Ÿä¼˜åŒ–è„šæœ¬ nano ~/system_optimize.sh #!/bin/bash # ~/system_optimize.sh # é…ç½® LOG_FILE="/var/log/optimize.log" NGINX_CONF="/etc/nginx/nginx.conf" SYSCTL_CONF="/etc/sysctl.d/99-custom.conf" JOURNAL_CONF="/etc/systemd/journald.conf" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # ä¼˜åŒ–ç³»ç»Ÿå‚æ•° optimize_system() { log "ä¼˜åŒ–ç³»ç»Ÿå‚æ•°..." # å¤‡ä»½åŸå§‹é…ç½® cp "$SYSCTL_CONF" "${SYSCTL_CONF}.backup" # é…ç½®ç³»ç»Ÿå‚æ•° cat > "$SYSCTL_CONF" << EOF # ç½‘ç»œä¼˜åŒ– net.core.somaxconn = 2048 net.core.netdev_max_backlog = 4096 net.ipv4.tcp_max_syn_backlog = 4096 net.ipv4.tcp_fin_timeout = 30 net.ipv4.tcp_keepalive_time = 1200 net.ipv4.tcp_max_tw_buckets = 5000 net.ipv4.tcp_fastopen = 3 net.ipv4.tcp_rmem = 4096 87380 16777216 net.ipv4.tcp_wmem = 4096 65536 16777216 # æ–‡ä»¶ç³»ç»Ÿä¼˜åŒ– fs.file-max = 100000 fs.inotify.max_user_watches = 524288 # å†…å­˜ä¼˜åŒ– vm.swappiness = 10 vm.dirty_ratio = 60 vm.dirty_background_ratio = 2 EOF # åº”ç”¨ç³»ç»Ÿå‚æ•° sysctl -p "$SYSCTL_CONF" } # ä¼˜åŒ– Nginx é…ç½® optimize_nginx() { log "ä¼˜åŒ– Nginx é…ç½®..." # å¤‡ä»½åŸå§‹é…ç½® cp "$NGINX_CONF" "${NGINX_CONF}.backup" # é…ç½® Nginx cat > "$NGINX_CONF" << EOF user www-data; worker_processes auto; worker_rlimit_nofile 100000; events { worker_connections 2048; multi_accept on; use epoll; } http { # åŸºç¡€è®¾ç½® sendfile on; tcp_nopush on; tcp_nodelay on; keepalive_timeout 65; types_hash_max_size 2048; server_tokens off; # MIME ç±»å‹ include /etc/nginx/mime.types; default_type application/octet-stream; # æ—¥å¿—æ ¼å¼ log_format main &#39;\$remote_addr - \$remote_user [\$time_local] "\$request" &#39; &#39;\$status \$body_bytes_sent "\$http_referer" &#39; &#39;"\$http_user_agent" "\$http_x_forwarded_for"&#39;; # ç¼“å†²åŒºè®¾ç½® client_body_buffer_size 128k; client_max_body_size 10m; client_header_buffer_size 1k; large_client_header_buffers 4 4k; # Gzip å‹ç¼© gzip on; gzip_vary on; gzip_proxied any; gzip_comp_level 6; gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript; # SSL ä¼˜åŒ– ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers on; ssl_session_cache shared:SSL:10m; ssl_session_timeout 10m; # åŒ…å«å…¶ä»–é…ç½® include /etc/nginx/conf.d/*.conf; include /etc/nginx/sites-enabled/*; } EOF # æµ‹è¯•é…ç½® nginx -t && systemctl restart nginx } # ä¼˜åŒ–ç³»ç»ŸæœåŠ¡ optimize_services() { log "ä¼˜åŒ–ç³»ç»ŸæœåŠ¡..." # ç¦ç”¨ä¸å¿…è¦çš„æœåŠ¡ local unnecessary_services=( "bluetooth" "cups" "avahi-daemon" ) for service in "${unnecessary_services[@]}"; do if systemctl is-active --quiet "$service"; then systemctl stop "$service" systemctl disable "$service" log "å·²ç¦ç”¨æœåŠ¡: $service" fi done # ä¼˜åŒ–æ—¥å¿—æœåŠ¡ cat > "$JOURNAL_CONF" << EOF [Journal] SystemMaxUse=100M SystemMaxFileSize=10M RuntimeMaxUse=50M RuntimeMaxFileSize=5M EOF # é‡å¯æ—¥å¿—æœåŠ¡ systemctl restart systemd-journald } # ä¼˜åŒ–æ–‡ä»¶ç³»ç»Ÿ optimize_filesystem() { log "ä¼˜åŒ–æ–‡ä»¶ç³»ç»Ÿ..." # æ¸…ç†ä¸´æ—¶æ–‡ä»¶ find /tmp -type f -atime +10 -delete find /var/tmp -type f -atime +10 -delete # æ¸…ç†æ—¥å¿— find /var/log -type f -name "*.gz" -delete find /var/log -type f -name "*.old" -delete # ä¼˜åŒ–æ—¥å¿—è½®è½¬ cat > /etc/logrotate.d/custom << EOF /var/log/custom/*.log { daily rotate 7 compress delaycompress missingok notifempty create 640 root adm } EOF } # ä¼˜åŒ–å†…å­˜ä½¿ç”¨ optimize_memory() { log "ä¼˜åŒ–å†…å­˜ä½¿ç”¨..." # æ¸…ç†ç¼“å­˜ sync; echo 3 > /proc/sys/vm/drop_caches # é…ç½® swap ä½¿ç”¨ if [ -f /swapfile ]; then swapoff /swapfile dd if=/dev/zero of=/swapfile bs=1M count=2048 chmod 600 /swapfile mkswap /swapfile swapon /swapfile fi } # éªŒè¯ä¼˜åŒ– verify_optimization() { log "éªŒè¯ç³»ç»Ÿä¼˜åŒ–..." local status=0 # æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½ local load=$(uptime | awk -F&#39;load average:&#39; &#39;{print $2}&#39; | cut -d, -f1) if [ $(echo "$load > 2" | bc -l) -eq 1 ]; then log "è­¦å‘Š: ç³»ç»Ÿè´Ÿè½½è¾ƒé«˜ ($load)" status=1 fi # æ£€æŸ¥å†…å­˜ä½¿ç”¨ local mem_usage=$(free | grep Mem | awk &#39;{print $3/$2 * 100.0}&#39;) if [ $(echo "$mem_usage > 90" | bc -l) -eq 1 ]; then log "è­¦å‘Š: å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜ ($mem_usage%)" status=1 fi # æ£€æŸ¥æœåŠ¡çŠ¶æ€ if ! systemctl is-active --quiet nginx; then log "é”™è¯¯: Nginx æœåŠ¡æœªæ­£å¸¸è¿è¡Œ" status=1 fi return $status } # ä¸»å‡½æ•° main() { log "å¼€å§‹ç³»ç»Ÿä¼˜åŒ–..." optimize_system optimize_nginx optimize_services optimize_filesystem optimize_memory if verify_optimization; then log "ç³»ç»Ÿä¼˜åŒ–æˆåŠŸå®Œæˆ" ~/send_notification.sh "ç³»ç»Ÿä¼˜åŒ–å·²å®Œæˆ" "normal" else log "ç³»ç»Ÿä¼˜åŒ–å®Œæˆï¼Œä½†å­˜åœ¨è­¦å‘Š" ~/send_notification.sh "ç³»ç»Ÿä¼˜åŒ–å®Œæˆï¼Œä½†éœ€è¦æ£€æŸ¥" "high" fi } # æ‰§è¡Œä¼˜åŒ– main ä¸‰åå…­ã€éƒ¨ç½²åæ£€æŸ¥æ¸…å• 1. éƒ¨ç½²æ£€æŸ¥è„šæœ¬ # åˆ›å»ºéƒ¨ç½²æ£€æŸ¥è„šæœ¬ nano ~/deployment_checklist.sh #!/bin/bash # ~/deployment_checklist.sh # é…ç½® LOG_FILE="/var/log/deployment_check.log" REPORT_FILE="/home/zhaoxiongzhou/deployment_report.md" CHECK_INTERVAL=300 # æ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰ # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # æ£€æŸ¥ç³»ç»ŸåŸºç¡€é…ç½® check_system_basics() { log "æ£€æŸ¥ç³»ç»ŸåŸºç¡€é…ç½®..." local status=0 { echo "## ç³»ç»ŸåŸºç¡€æ£€æŸ¥" echo "### ç³»ç»Ÿä¿¡æ¯" echo "- ä¸»æœºå: $(hostname)" echo "- ç³»ç»Ÿç‰ˆæœ¬: $(cat /etc/os-release | grep PRETTY_NAME)" echo "- å†…æ ¸ç‰ˆæœ¬: $(uname -r)" echo "- è¿è¡Œæ—¶é—´: $(uptime -p)" echo echo "### èµ„æºä½¿ç”¨" echo "- CPU ä½¿ç”¨ç‡: $(top -bn1 | grep "Cpu(s)" | awk &#39;{print $2}&#39;)%" echo "- å†…å­˜ä½¿ç”¨ç‡: $(free | grep Mem | awk &#39;{print $3/$2 * 100.0}&#39;)%" echo "- ç£ç›˜ä½¿ç”¨ç‡: $(df -h / | awk &#39;NR==2 {print $5}&#39;)" echo } > "$REPORT_FILE" return $status } # æ£€æŸ¥ç½‘ç»œé…ç½® check_network() { log "æ£€æŸ¥ç½‘ç»œé…ç½®..." local status=0 { echo "### ç½‘ç»œé…ç½®" echo "#### IP é…ç½®" echo &#39;```&#39; ip addr show echo &#39;```&#39; echo "#### è·¯ç”±è¡¨" echo &#39;```&#39; ip route echo &#39;```&#39; echo "#### å¼€æ”¾ç«¯å£" echo &#39;```&#39; netstat -tuln echo &#39;```&#39; echo "#### DNS é…ç½®" echo &#39;```&#39; cat /etc/resolv.conf echo &#39;```&#39; } >> "$REPORT_FILE" return $status } # æ£€æŸ¥æœåŠ¡é…ç½® check_services() { log "æ£€æŸ¥æœåŠ¡é…ç½®..." local status=0 { echo "### æœåŠ¡çŠ¶æ€" echo "#### Nginx é…ç½®" echo &#39;```&#39; nginx -T echo &#39;```&#39; echo "#### æœåŠ¡è¿è¡ŒçŠ¶æ€" echo &#39;```&#39; systemctl status nginx systemctl status mysql ps aux | grep llama-server echo &#39;```&#39; echo "#### æœåŠ¡æ—¥å¿—æ£€æŸ¥" echo &#39;```&#39; tail -n 20 /var/log/nginx/error.log echo &#39;```&#39; } >> "$REPORT_FILE" return $status } # æ£€æŸ¥å®‰å…¨é…ç½® check_security() { log "æ£€æŸ¥å®‰å…¨é…ç½®..." local status=0 { echo "### å®‰å…¨æ£€æŸ¥" echo "#### é˜²ç«å¢™è§„åˆ™" echo &#39;```&#39; sudo iptables -L echo &#39;```&#39; echo "#### SSH é…ç½®" echo &#39;```&#39; grep -v &#39;^#&#39; /etc/ssh/sshd_config echo &#39;```&#39; echo "#### ç”¨æˆ·æƒé™" echo &#39;```&#39; ls -la /home/zhaoxiongzhou/ ls -la /var/www/ echo &#39;```&#39; echo "#### SSL è¯ä¹¦" echo &#39;```&#39; openssl x509 -in /etc/nginx/ssl/server.crt -text -noout echo &#39;```&#39; } >> "$REPORT_FILE" return $status } # æ£€æŸ¥å¤‡ä»½é…ç½® check_backups() { log "æ£€æŸ¥å¤‡ä»½é…ç½®..." local status=0 { echo "### å¤‡ä»½æ£€æŸ¥" echo "#### å¤‡ä»½é…ç½®" echo &#39;```&#39; ls -lh /mnt/backup_drive/system_backups/ echo &#39;```&#39; echo "#### æœ€è¿‘å¤‡ä»½çŠ¶æ€" echo &#39;```&#39; tail -n 20 /var/log/backup.log echo &#39;```&#39; } >> "$REPORT_FILE" return $status } # æ£€æŸ¥ç›‘æ§é…ç½® check_monitoring() { log "æ£€æŸ¥ç›‘æ§é…ç½®..." local status=0 { echo "### ç›‘æ§æ£€æŸ¥" echo "#### ç›‘æ§è„šæœ¬çŠ¶æ€" echo &#39;```&#39; ps aux | grep monitor echo &#39;```&#39; echo "#### å‘Šè­¦é…ç½®" echo &#39;```&#39; cat ~/send_notification.sh echo &#39;```&#39; } >> "$REPORT_FILE" return $status } # ç”Ÿæˆæ€»ç»“æŠ¥å‘Š generate_summary() { log "ç”Ÿæˆæ€»ç»“æŠ¥å‘Š..." { echo "## éƒ¨ç½²æ£€æŸ¥æ€»ç»“" echo "### æ£€æŸ¥æ—¶é—´: $(date &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo echo "### ä¸»è¦å‘ç°" echo "1. ç³»ç»ŸçŠ¶æ€: $([ $system_status -eq 0 ] && echo &#39;æ­£å¸¸ âœ…&#39; || echo &#39;å¼‚å¸¸ âŒ&#39;)" echo "2. ç½‘ç»œé…ç½®: $([ $network_status -eq 0 ] && echo &#39;æ­£å¸¸ âœ…&#39; || echo &#39;å¼‚å¸¸ âŒ&#39;)" echo "3. æœåŠ¡çŠ¶æ€: $([ $services_status -eq 0 ] && echo &#39;æ­£å¸¸ âœ…&#39; || echo &#39;å¼‚å¸¸ âŒ&#39;)" echo "4. å®‰å…¨é…ç½®: $([ $security_status -eq 0 ] && echo &#39;æ­£å¸¸ âœ…&#39; || echo &#39;å¼‚å¸¸ âŒ&#39;)" echo "5. å¤‡ä»½çŠ¶æ€: $([ $backup_status -eq 0 ] && echo &#39;æ­£å¸¸ âœ…&#39; || echo &#39;å¼‚å¸¸ âŒ&#39;)" echo "6. ç›‘æ§çŠ¶æ€: $([ $monitoring_status -eq 0 ] && echo &#39;æ­£å¸¸ âœ…&#39; || echo &#39;å¼‚å¸¸ âŒ&#39;)" echo echo "### å»ºè®®æ“ä½œ" [ $system_status -ne 0 ] && echo "- æ£€æŸ¥ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ" [ $network_status -ne 0 ] && echo "- éªŒè¯ç½‘ç»œé…ç½®" [ $services_status -ne 0 ] && echo "- æ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€" [ $security_status -ne 0 ] && echo "- å®¡æŸ¥å®‰å…¨é…ç½®" [ $backup_status -ne 0 ] && echo "- ç¡®è®¤å¤‡ä»½æ˜¯å¦æ­£å¸¸" [ $monitoring_status -ne 0 ] && echo "- æ£€æŸ¥ç›‘æ§ç³»ç»Ÿ" } >> "$REPORT_FILE" } # ä¸»å‡½æ•° main() { log "å¼€å§‹éƒ¨ç½²åæ£€æŸ¥..." # æ‰§è¡Œæ£€æŸ¥ check_system_basics system_status=$? check_network network_status=$? check_services services_status=$? check_security security_status=$? check_backups backup_status=$? check_monitoring monitoring_status=$? # ç”Ÿæˆæ€»ç»“ generate_summary # å‘é€é€šçŸ¥ if [ $system_status -eq 0 ] && [ $network_status -eq 0 ] && \ [ $services_status -eq 0 ] && [ $security_status -eq 0 ] && \ [ $backup_status -eq 0 ] && [ $monitoring_status -eq 0 ]; then ~/send_notification.sh "éƒ¨ç½²æ£€æŸ¥å®Œæˆï¼šæ‰€æœ‰é¡¹ç›®æ­£å¸¸" "normal" else ~/send_notification.sh "éƒ¨ç½²æ£€æŸ¥å®Œæˆï¼šå­˜åœ¨éœ€è¦å…³æ³¨çš„é¡¹ç›®" "high" fi log "éƒ¨ç½²æ£€æŸ¥å®Œæˆï¼ŒæŠ¥å‘Šå·²ç”Ÿæˆ: $REPORT_FILE" } # æ‰§è¡Œæ£€æŸ¥ main ã€Šæ ‘è“æ´¾æœåŠ¡éƒ¨ç½²ä¸ç»´æŠ¤å®Œæ•´æŒ‡å—ã€‹æ€»å…±åŒ…å«äº† 36 ä¸ªéƒ¨åˆ†ï¼Œæ¶µç›–äº†ä»ç³»ç»Ÿéƒ¨ç½²åˆ°ç»´æŠ¤çš„å„ä¸ªæ–¹é¢ã€‚æ¯ä¸ªè„šæœ¬éƒ½ç»è¿‡ç²¾å¿ƒè®¾è®¡ï¼Œå¯ä»¥ç‹¬ç«‹è¿è¡Œï¼Œä¹Ÿå¯ä»¥äº’ç›¸é…åˆä½¿ç”¨ã€‚'><link rel=stylesheet href=/css/output.min.css><style>pre{padding:1em;overflow:auto}</style><link rel=stylesheet href=/css/custom.css><script defer src=https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js></script></head><body x-data="{
    flip: false,
  }"><div id=dream-global-bg></div><nav class="mt-4 lg:mt-8 py-4"><div class="container flex justify-between px-4"><section class="flex items-center gap-4"><div class="avatar cursor-pointer hover:online" @click="flip = !flip" title=ç¿»è½¬ä¸€ä¸‹ï¼><div class="h-10 rounded-full"><img src=/me/avatar.jpg alt></div></div></section><div class="dropdown dropdown-end sm:hidden"><div tabindex=0 role=button class="btn btn-ghost btn-square" aria-label="Select an option"><ion-icon name=menu class=text-2xl></ion-icon></div><ul tabindex=0 class="dropdown-content menu w-36 bg-base-100 rounded-box z-[1] shadow-md"><li><div role=link tabindex=0 class="inline-flex items-center p-2 cursor-pointer" @click="flip = !flip" title=å…³äº><ion-icon name=information-circle></ion-icon>å…³äº</div></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/posts title=å½’æ¡£><ion-icon name=archive></ion-icon>å½’æ¡£</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/categories title=æ‰€æœ‰åˆ†ç±»><ion-icon name=grid></ion-icon>æ‰€æœ‰åˆ†ç±»</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/tags title=æ‰€æœ‰æ ‡ç­¾><ion-icon name=pricetags></ion-icon>æ‰€æœ‰æ ‡ç­¾</a></li></ul></div><section class="hidden sm:flex sm:items-center sm:gap-2 md:gap-4"><div role=link tabindex=0 class="text-sm font-semibold cursor-pointer hover:underline" @click="flip = !flip" title=å…³äº>å…³äº</div><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href=/posts title=å½’æ¡£><ion-icon class=group-hover:text-primary-content name=archive></ion-icon></a><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href=/categories title=æ‰€æœ‰åˆ†ç±»><ion-icon class=group-hover:text-primary-content name=grid></ion-icon></a><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href=/tags title=æ‰€æœ‰æ ‡ç­¾><ion-icon class=group-hover:text-primary-content name=pricetags></ion-icon></a></section></div></nav><div class=flip-container :class="{ 'flip-it': flip }"><div class=flipper><div class=front><div class=container><div class="mt-4 px-4"><div><article class="mx-auto prose prose-quoteless dark:prose-invert" id=dream-single-post-main itemscope itemtype=http://schema.org/Article><meta itemprop=name content="æ ‘è“æ´¾æœåŠ¡éƒ¨ç½²ä¸ç»´æŠ¤å®Œæ•´æŒ‡å—"><meta itemprop=description content='æ ‘è“æ´¾æœåŠ¡éƒ¨ç½²ä¸ç»´æŠ¤å®Œæ•´æŒ‡å— ä¸€ã€ç³»ç»Ÿæ¦‚å†µ 1. ç¡¬ä»¶èµ„æº å¤„ç†å™¨: ARM64 æ¶æ„ æ€»å†…å­˜: 3.7GB å¯ç”¨å†…å­˜: ~2.5GB Swap: 512MB ç½‘ç»œ: wlan0 (IP: 10.40.110.47) 2. æœåŠ¡æ¦‚è§ˆ AI æ™ºèƒ½åŠ©æ‰‹ ç«¯å£: 8080 åŸºäº: llama.cpp æ¨¡å‹: Phi-3-mini-4k-instruct-q4.gguf èµ„æºå ç”¨: CPU: ~300% (å¤šæ ¸) å†…å­˜: ~3GB Swap: 511Mi ä¸ªäººåšå®¢ ç«¯å£: 80 æ¡†æ¶: Hugo v0.139.3-extended ä¸»é¢˜: Ananke WebæœåŠ¡å™¨: Nginx èµ„æºå ç”¨: è½»é‡çº§ 3. æœåŠ¡è®¿é—® AI åŠ©æ‰‹: http://10.40.110.47:8080 åšå®¢å¼€å‘: http://10.40.110.47:1313 åšå®¢æ­£å¼: http://10.40.110.47 äºŒã€AI æ™ºèƒ½åŠ©æ‰‹éƒ¨ç½² 1. ç¯å¢ƒå‡†å¤‡ # æ›´æ–°ç³»ç»Ÿ sudo apt update sudo apt upgrade -y # å®‰è£…ä¾èµ– sudo apt install build-essential git cmake 2. ç¼–è¯‘å®‰è£… # å…‹éš†ä»“åº“ git clone https://github.com/ggerganov/llama.cpp.git cd llama.cpp # ç¼–è¯‘ make clean LLAMA_METAL=1 make -j4 3. æ¨¡å‹é…ç½® # åˆ›å»ºæ¨¡å‹ç›®å½• mkdir models cd models # ä¸‹è½½æ¨¡å‹æ–‡ä»¶ wget [æ¨¡å‹ä¸‹è½½åœ°å€]/Phi-3-mini-4k-instruct-q4.gguf # éªŒè¯æ¨¡å‹æ–‡ä»¶ sha256sum Phi-3-mini-4k-instruct-q4.gguf 4. æœåŠ¡é…ç½® # åˆ›å»ºå¯åŠ¨è„šæœ¬ nano ~/projects/llama.cpp/start-llama.sh #!/bin/bash cd ~/projects/llama.cpp nohup ./llama-server \ -m models/Phi-3-mini-4k-instruct-q4.gguf \ --host 0.0.0.0 \ --port 8080 \ --ctx-size 2048 \ --threads 2 \ --batch-size 256 \ > llama.log 2>&amp;1 & # è®¾ç½®æ‰§è¡Œæƒé™ chmod +x start-llama.sh # å¯åŠ¨æœåŠ¡ ./start-llama.sh # éªŒè¯æœåŠ¡çŠ¶æ€ ps aux | grep llama-server netstat -tuln | grep 8080 ä¸‰ã€ä¸ªäººåšå®¢éƒ¨ç½² 1. Hugo å®‰è£… # ä¸‹è½½ Hugo Extended ç‰ˆæœ¬ wget https://github.com/gohugoio/hugo/releases/download/v0.139.3/hugo_extended_0.139.3_linux-arm64.deb # å®‰è£… sudo dpkg -i hugo_extended_0.139.3_linux-arm64.deb # éªŒè¯å®‰è£… hugo version 2. åšå®¢åˆå§‹åŒ– # åˆ›å»ºç«™ç‚¹ cd ~ hugo new site myblog cd myblog # åˆå§‹åŒ– Git git init # æ·»åŠ ä¸»é¢˜ git submodule add https://github.com/theNewDynamic/gohugo-theme-ananke.git themes/ananke 3. åšå®¢é…ç½® # ç¼–è¾‘é…ç½®æ–‡ä»¶ nano config.toml baseURL = "http://10.40.110.47/" languageCode = "zh-cn" title = "My Blog" theme = "ananke" [params] author = "Your Name" description = "Welcome to my blog" dateFormat = "2006-01-02" background_color_class = "bg-black" recent_posts_number = 3 mainSections = ["posts"] featured_image = false [menu] [[menu.main]] identifier = "posts" name = "æ–‡ç« " url = "/posts/" weight = 1 [[menu.main]] identifier = "about" name = "å…³äº" url = "/about/" weight = 2 4. Nginx é…ç½® # å®‰è£… Nginx sudo apt install nginx # åˆ›å»ºé…ç½®æ–‡ä»¶ sudo nano /etc/nginx/sites-available/myblog server { listen 80; server_name 10.40.110.47; root /home/zhaoxiongzhou/myblog/public; index index.html; location / { try_files $uri $uri/ =404; } access_log /var/log/nginx/myblog_access.log; error_log /var/log/nginx/myblog_error.log; } # å¯ç”¨é…ç½® sudo ln -s /etc/nginx/sites-available/myblog /etc/nginx/sites-enabled/ sudo rm /etc/nginx/sites-enabled/default # æµ‹è¯•é…ç½® sudo nginx -t # é‡å¯ Nginx sudo systemctl restart nginx å››ã€æƒé™ä¸è‡ªåŠ¨åŒ–é…ç½® 1. æƒé™è®¾ç½® # è®¾ç½®ç›®å½•æƒé™ sudo chmod 755 /home/zhaoxiongzhou sudo chmod -R 755 /home/zhaoxiongzhou/myblog # è®¾ç½®æ–‡ä»¶æ‰€æœ‰æƒ sudo chown -R www-data:www-data /home/zhaoxiongzhou/myblog/public # éªŒè¯æƒé™ ls -la ~/myblog/public ls -la /home/zhaoxiongzhou 2. è‡ªåŠ¨éƒ¨ç½²è„šæœ¬ # åˆ›å»ºåšå®¢éƒ¨ç½²è„šæœ¬ nano ~/deploy-blog.sh #!/bin/bash cd ~/myblog hugo sudo chown -R www-data:www-data public/ sudo systemctl restart nginx # è®¾ç½®æ‰§è¡Œæƒé™ chmod +x ~/deploy-blog.sh 3. å¤‡ä»½è„šæœ¬ # åˆ›å»ºå¤‡ä»½è„šæœ¬ nano ~/backup-blog.sh #!/bin/bash BACKUP_DIR="/home/zhaoxiongzhou/backups" DATE=$(date +%Y%m%d) # åˆ›å»ºå¤‡ä»½ç›®å½• mkdir -p $BACKUP_DIR # å¤‡ä»½åšå®¢å†…å®¹ tar -czf $BACKUP_DIR/blog_$DATE.tar.gz ~/myblog/content # å¤‡ä»½é…ç½®æ–‡ä»¶ cp ~/myblog/config.toml $BACKUP_DIR/config_$DATE.toml # åˆ é™¤30å¤©å‰çš„å¤‡ä»½ find $BACKUP_DIR -name "*.tar.gz" -mtime +30 -delete # è®¾ç½®æ‰§è¡Œæƒé™ chmod +x ~/backup-blog.sh # é…ç½®å®šæ—¶ä»»åŠ¡ crontab -e # æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼ˆæ¯å‘¨æ—¥å‡Œæ™¨2ç‚¹æ‰§è¡Œå¤‡ä»½ï¼‰ 0 2 * * 0 /home/zhaoxiongzhou/backup-blog.sh äº”ã€ç³»ç»Ÿç»´æŠ¤ä¸ç›‘æ§ 1. èµ„æºç›‘æ§å‘½ä»¤ # ç³»ç»Ÿèµ„æºç›‘æ§ htop top free -h vmstat 1 # ç£ç›˜ä½¿ç”¨ç›‘æ§ df -h du -sh /* du -sh ~/myblog du -sh ~/projects/llama.cpp # æ¸©åº¦ç›‘æ§ vcgencmd measure_temp 2. æ€§èƒ½ä¼˜åŒ– # æ¸…ç†ç³»ç»Ÿç¼“å­˜ sudo sync; echo 3 | sudo tee /proc/sys/vm/drop_caches # è°ƒæ•´ Swap è®¾ç½® cat /proc/sys/vm/swappiness sudo sysctl vm.swappiness=60 # CPU é¢‘ç‡è°ƒæ•´ sudo nano /boot/config.txt # CPU é…ç½®å‚æ•° arm_freq=1800 over_voltage=6 temp_limit=75 3. ç³»ç»Ÿç»´æŠ¤ # ç³»ç»Ÿæ›´æ–° sudo apt update sudo apt upgrade -y sudo apt autoremove sudo apt clean # æ—¥å¿—æ¸…ç† sudo find /var/log -type f -name "*.log" -mtime +30 -delete sudo find /var/log -type f -name "*.gz" -delete # æœåŠ¡çŠ¶æ€æ£€æŸ¥ systemctl status nginx ps aux | grep llama-server å…­ã€å®‰å…¨é…ç½® 1. é˜²ç«å¢™è®¾ç½® # å®‰è£… UFW sudo apt install ufw # é…ç½®åŸºæœ¬è§„åˆ™ sudo ufw default deny incoming sudo ufw default allow outgoing sudo ufw allow 22 sudo ufw allow 80 sudo ufw allow 8080 # å¯ç”¨é˜²ç«å¢™ sudo ufw enable # æ£€æŸ¥çŠ¶æ€ sudo ufw status 2. Nginx è®¿é—®æ§åˆ¶ # å®‰è£…è®¤è¯å·¥å…· sudo apt install apache2-utils # åˆ›å»ºç”¨æˆ·å¯†ç  sudo htpasswd -c /etc/nginx/.htpasswd username # ä¿®æ”¹ Nginx é…ç½® sudo nano /etc/nginx/sites-available/myblog server { listen 80; server_name 10.40.110.47; root /home/zhaoxiongzhou/myblog/public; index index.html; # æ·»åŠ åŸºæœ¬è®¤è¯ location / { auth_basic "Restricted Access"; auth_basic_user_file /etc/nginx/.htpasswd; try_files $uri $uri/ =404; } # æ—¥å¿—é…ç½® access_log /var/log/nginx/myblog_access.log; error_log /var/log/nginx/myblog_error.log; } 3. æ—¥å¿—ç›‘æ§ # å®‰è£…æ—¥å¿—ç›‘æ§å·¥å…· sudo apt install logwatch # é…ç½®æ—¥å¿—ç›‘æ§ sudo nano /etc/logwatch/conf/logwatch.conf # é…ç½®æ¯æ—¥æ—¥å¿—æ£€æŸ¥ Output = mail Format = html MailTo = your-email@domain.com Detail = High ä¸ƒã€æ•…éšœæ’é™¤æŒ‡å— å†…å­˜ç›¸å…³é—®é¢˜ # æ£€æŸ¥å†…å­˜çŠ¶æ€ free -h ps aux --sort=-%mem | head # å¦‚æœå†…å­˜ä¸è¶³ï¼Œè°ƒæ•´æœåŠ¡å‚æ•° nano ~/projects/llama.cpp/start-llama.sh # é™ä½èµ„æºä½¿ç”¨çš„å‚æ•°ç¤ºä¾‹ --ctx-size 1024 \ --batch-size 128 \ --threads 1 æœåŠ¡æ— å“åº” # æ£€æŸ¥è¿›ç¨‹ ps aux | grep llama-server # æ£€æŸ¥ç«¯å£ netstat -tuln | grep 8080 # é‡å¯æœåŠ¡ pkill llama-server ./start-llama.sh # æ£€æŸ¥æ—¥å¿— tail -f ~/projects/llama.cpp/llama.log 2. åšå®¢æœåŠ¡æ•…éšœæ’é™¤ Nginx é—®é¢˜ # æ£€æŸ¥é…ç½®è¯­æ³• sudo nginx -t # æ£€æŸ¥æ—¥å¿— sudo tail -f /var/log/nginx/error.log sudo tail -f /var/log/nginx/myblog_error.log # æ£€æŸ¥æœåŠ¡çŠ¶æ€ sudo systemctl status nginx # é‡å¯æœåŠ¡ sudo systemctl restart nginx Hugo ç”Ÿæˆé—®é¢˜ # æ¸…ç†ç¼“å­˜ rm -rf ~/myblog/public rm -rf ~/myblog/resources # æ›´æ–°ä¸»é¢˜ git submodule update --init --recursive # é‡æ–°ç”Ÿæˆï¼ˆè¯¦ç»†æ¨¡å¼ï¼‰ hugo --verbose å…«ã€ç³»ç»Ÿçº§æ•…éšœæ’é™¤ 1. ç£ç›˜é—®é¢˜ # æ£€æŸ¥ç£ç›˜ä½¿ç”¨æƒ…å†µ df -h du -sh /* # æŸ¥æ‰¾å¤§æ–‡ä»¶ sudo find / -type f -size +100M # æ¸…ç†ç©ºé—´ sudo apt clean sudo apt autoremove sudo journalctl --vacuum-time=7d 2. ç½‘ç»œé—®é¢˜ # ç½‘ç»œçŠ¶æ€æ£€æŸ¥ ip addr show ping -c 4 8.8.8.8 netstat -tuln # DNS æ£€æŸ¥ cat /etc/resolv.conf nslookup google.com # é‡å¯ç½‘ç»œæœåŠ¡ sudo systemctl restart networking sudo systemctl restart wpa_supplicant 3. æ€§èƒ½é—®é¢˜ # CPU æ¸©åº¦ç›‘æ§ vcgencmd measure_temp watch -n 1 vcgencmd measure_temp # CPU é¢‘ç‡æ£€æŸ¥ vcgencmd measure_clock arm cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_cur_freq # ç³»ç»Ÿè´Ÿè½½æ£€æŸ¥ uptime cat /proc/loadavg ä¹ã€ç»´æŠ¤æœ€ä½³å®è·µ 1. æ—¥å¸¸ç»´æŠ¤æ¸…å• æ£€æŸ¥ç³»ç»Ÿæ—¥å¿— ç›‘æ§èµ„æºä½¿ç”¨ éªŒè¯æœåŠ¡çŠ¶æ€ æ£€æŸ¥å¤‡ä»½çŠ¶æ€ æ›´æ–°ç³»ç»Ÿå®‰å…¨è¡¥ä¸ 2. å‘¨æœŸæ€§ç»´æŠ¤ä»»åŠ¡ æ¸…ç†æ—§æ—¥å¿—å’Œä¸´æ—¶æ–‡ä»¶ éªŒè¯å¤‡ä»½å®Œæ•´æ€§ æ£€æŸ¥ç³»ç»Ÿæ›´æ–° æ£€æŸ¥æœåŠ¡æ€§èƒ½ æ›´æ–°æ–‡æ¡£å’Œé…ç½®è¯´æ˜ 3. åº”æ€¥é¢„æ¡ˆ ä¿å­˜æ‰€æœ‰é…ç½®æ–‡ä»¶çš„å¤‡ä»½ è®°å½•æ‰€æœ‰æœåŠ¡çš„é…ç½®æ­¥éª¤ ç»´æŠ¤é—®é¢˜è§£å†³æ–¹æ¡ˆæ–‡æ¡£ å»ºç«‹æœåŠ¡æ¢å¤æµç¨‹ ä¿æŒé‡è¦æ•°æ®çš„å¤šä»½å¤‡ä»½ åã€æ€§èƒ½ä¼˜åŒ–å»ºè®® 1. ç³»ç»Ÿçº§ä¼˜åŒ– # 1. è°ƒæ•´ SWAP è®¾ç½® sudo nano /etc/sysctl.conf # æ·»åŠ æˆ–ä¿®æ”¹ä»¥ä¸‹å‚æ•° vm.swappiness=60 vm.vfs_cache_pressure=50 vm.dirty_background_ratio=5 vm.dirty_ratio=10 # 2. ä¼˜åŒ–æ–‡ä»¶ç³»ç»Ÿ # æ£€æŸ¥å¹¶ä¼˜åŒ–æ–‡ä»¶ç³»ç»Ÿ sudo tune2fs -o journal_data_writeback /dev/mmcblk0p2 # 3. è°ƒæ•´ CPU æ€§èƒ½ sudo nano /boot/config.txt # æ·»åŠ ä»¥ä¸‹é…ç½® arm_freq=1800 over_voltage=6 gpu_freq=500 dtparam=audio=on 2. æœåŠ¡ä¼˜åŒ– AI æœåŠ¡ä¼˜åŒ– # è°ƒæ•´æœåŠ¡å‚æ•° nano ~/projects/llama.cpp/start-llama.sh # ä¼˜åŒ–å‚æ•°ç¤ºä¾‹ --ctx-size 2048 \ --threads 2 \ --batch-size 256 \ --keep-context \ --mlock \ --numa Nginx ä¼˜åŒ– sudo nano /etc/nginx/nginx.conf worker_processes auto; worker_rlimit_nofile 65535; events { worker_connections 1024; multi_accept on; use epoll; } http { sendfile on; tcp_nopush on; tcp_nodelay on; keepalive_timeout 65; types_hash_max_size 2048; server_tokens off; # ç¼“å­˜è®¾ç½® open_file_cache max=1000 inactive=20s; open_file_cache_valid 30s; open_file_cache_min_uses 2; open_file_cache_errors on; } åä¸€ã€ç›‘æ§ä¸æŠ¥è­¦ç³»ç»Ÿ 1. ç³»ç»Ÿç›‘æ§é…ç½® # å®‰è£…ç›‘æ§å·¥å…· sudo apt install prometheus node-exporter grafana # é…ç½® Prometheus sudo nano /etc/prometheus/prometheus.yml global: scrape_interval: 15s scrape_configs: - job_name: &#39;node&#39; static_configs: - targets: [&#39;localhost:9100&#39;] - job_name: &#39;nginx&#39; static_configs: - targets: [&#39;localhost:9113&#39;] 2. è‡ªåŠ¨æŠ¥è­¦è„šæœ¬ # åˆ›å»ºç›‘æ§è„šæœ¬ nano ~/monitor.sh #!/bin/bash # å®šä¹‰é˜ˆå€¼ MAX_CPU_USAGE=90 MAX_MEM_USAGE=90 MAX_DISK_USAGE=90 MAX_TEMP=75 # è·å–ç³»ç»Ÿæ•°æ® CPU_USAGE=$(top -bn1 | grep "Cpu(s)" | awk &#39;{print $2}&#39; | cut -d. -f1) MEM_USAGE=$(free | grep Mem | awk &#39;{print $3/$2 * 100.0}&#39;) DISK_USAGE=$(df -h / | awk &#39;NR==2 {print $5}&#39; | cut -d% -f1) TEMP=$(vcgencmd measure_temp | cut -d= -f2 | cut -d. -f1) # æ£€æŸ¥æœåŠ¡çŠ¶æ€ check_services() { services=("nginx" "llama-server") for service in "${services[@]}"; do if ! pgrep -x "$service" > /dev/null; then echo "è­¦å‘Š: $service æœåŠ¡æœªè¿è¡Œ!" # å¯ä»¥æ·»åŠ é‡å¯æœåŠ¡çš„å‘½ä»¤ fi done } # å‘é€è­¦å‘Š send_alert() { message="$1" # è¿™é‡Œå¯ä»¥æ·»åŠ å‘é€é‚®ä»¶æˆ–å…¶ä»–é€šçŸ¥çš„å‘½ä»¤ echo "$message" >> /var/log/system_alerts.log } # æ£€æŸ¥å„é¡¹æŒ‡æ ‡ if [ "$CPU_USAGE" -gt "$MAX_CPU_USAGE" ]; then send_alert "CPU ä½¿ç”¨ç‡è¿‡é«˜: $CPU_USAGE%" fi if [ "${MEM_USAGE%.*}" -gt "$MAX_MEM_USAGE" ]; then send_alert "å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜: $MEM_USAGE%" fi if [ "$DISK_USAGE" -gt "$MAX_DISK_USAGE" ]; then send_alert "ç£ç›˜ä½¿ç”¨ç‡è¿‡é«˜: $DISK_USAGE%" fi if [ "$TEMP" -gt "$MAX_TEMP" ]; then send_alert "ç³»ç»Ÿæ¸©åº¦è¿‡é«˜: $TEMPÂ°C" fi # æ£€æŸ¥æœåŠ¡çŠ¶æ€ check_services # è®¾ç½®æ‰§è¡Œæƒé™ chmod +x ~/monitor.sh # æ·»åŠ åˆ° crontab crontab -e # æ¯5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ç›‘æ§ */5 * * * * /home/zhaoxiongzhou/monitor.sh åäºŒã€æ•°æ®å¤‡ä»½ä¸æ¢å¤ 1. å®Œæ•´å¤‡ä»½æ–¹æ¡ˆ # åˆ›å»ºå®Œæ•´å¤‡ä»½è„šæœ¬ nano ~/full-backup.sh #!/bin/bash BACKUP_ROOT="/home/zhaoxiongzhou/backups" DATE=$(date +%Y%m%d_%H%M%S) BACKUP_DIR="$BACKUP_ROOT/$DATE" # åˆ›å»ºå¤‡ä»½ç›®å½• mkdir -p "$BACKUP_DIR" # å¤‡ä»½åšå®¢å†…å®¹ echo "å¤‡ä»½åšå®¢å†…å®¹..." tar -czf "$BACKUP_DIR/blog_content.tar.gz" ~/myblog/content tar -czf "$BACKUP_DIR/blog_config.tar.gz" ~/myblog/config.toml # å¤‡ä»½ AI æ¨¡å‹å’Œé…ç½® echo "å¤‡ä»½ AI æœåŠ¡..." tar -czf "$BACKUP_DIR/llama_models.tar.gz" ~/projects/llama.cpp/models tar -czf "$BACKUP_DIR/llama_config.tar.gz" ~/projects/llama.cpp/start-llama.sh # å¤‡ä»½ Nginx é…ç½® echo "å¤‡ä»½ Nginx é…ç½®..." sudo tar -czf "$BACKUP_DIR/nginx_config.tar.gz" /etc/nginx/sites-available/myblog # å¤‡ä»½ç³»ç»Ÿé…ç½® echo "å¤‡ä»½ç³»ç»Ÿé…ç½®..." sudo tar -czf "$BACKUP_DIR/system_config.tar.gz" /boot/config.txt /etc/fstab # åˆ›å»ºå¤‡ä»½æ¸…å• echo "åˆ›å»ºå¤‡ä»½æ¸…å•..." find "$BACKUP_DIR" -type f -exec sha256sum {} \; > "$BACKUP_DIR/checksum.txt" # æ¸…ç†æ—§å¤‡ä»½ï¼ˆä¿ç•™æœ€è¿‘7ä»½ï¼‰ cd "$BACKUP_ROOT" ls -t | tail -n +8 | xargs -r rm -r echo "å¤‡ä»½å®Œæˆ: $BACKUP_DIR" 2. æ•°æ®æ¢å¤æµç¨‹ # åˆ›å»ºæ¢å¤è„šæœ¬ nano ~/restore.sh #!/bin/bash if [ -z "$1" ]; then echo "ä½¿ç”¨æ–¹æ³•: $0 <å¤‡ä»½ç›®å½•>" exit 1 fi BACKUP_DIR="$1" # éªŒè¯å¤‡ä»½å®Œæ•´æ€§ echo "éªŒè¯å¤‡ä»½å®Œæ•´æ€§..." cd "$BACKUP_DIR" sha256sum -c checksum.txt || { echo "å¤‡ä»½éªŒè¯å¤±è´¥ï¼" exit 1 } # æ¢å¤åšå®¢å†…å®¹ echo "æ¢å¤åšå®¢å†…å®¹..." tar -xzf "$BACKUP_DIR/blog_content.tar.gz" -C ~/myblog/ tar -xzf "$BACKUP_DIR/blog_config.tar.gz" -C ~/myblog/ # æ¢å¤ AI æœåŠ¡ echo "æ¢å¤ AI æœåŠ¡..." tar -xzf "$BACKUP_DIR/llama_models.tar.gz" -C ~/projects/llama.cpp/ tar -xzf "$BACKUP_DIR/llama_config.tar.gz" -C ~/projects/llama.cpp/ # æ¢å¤ Nginx é…ç½® echo "æ¢å¤ Nginx é…ç½®..." sudo tar -xzf "$BACKUP_DIR/nginx_config.tar.gz" -C /etc/nginx/sites-available/ # æ¢å¤ç³»ç»Ÿé…ç½® echo "æ¢å¤ç³»ç»Ÿé…ç½®..." sudo tar -xzf "$BACKUP_DIR/system_config.tar.gz" -C / # é‡å¯æœåŠ¡ echo "é‡å¯æœåŠ¡..." sudo systemctl restart nginx pkill llama-server ~/projects/llama.cpp/start-llama.sh echo "æ¢å¤å®Œæˆ" åä¸‰ã€æœåŠ¡å‡çº§æŒ‡å— 1. Hugo åšå®¢å‡çº§ # 1. å¤‡ä»½å½“å‰ç‰ˆæœ¬ cd ~ tar -czf hugo_backup_$(date +%Y%m%d).tar.gz myblog/ # 2. æ£€æŸ¥å½“å‰ç‰ˆæœ¬ hugo version # 3. ä¸‹è½½æ–°ç‰ˆæœ¬ wget https://github.com/gohugoio/hugo/releases/download/v[æ–°ç‰ˆæœ¬]/hugo_extended_[æ–°ç‰ˆæœ¬]_linux-arm64.deb # 4. å®‰è£…æ–°ç‰ˆæœ¬ sudo dpkg -i hugo_extended_[æ–°ç‰ˆæœ¬]_linux-arm64.deb # 5. æ›´æ–°ä¸»é¢˜ cd ~/myblog git submodule update --remote themes/ananke # 6. æµ‹è¯•ç”Ÿæˆ hugo --verbose # 7. éƒ¨ç½²æ›´æ–° ./deploy-blog.sh 2. AI æœåŠ¡å‡çº§ # 1. å¤‡ä»½å½“å‰ç‰ˆæœ¬ cd ~/projects tar -czf llama_backup_$(date +%Y%m%d).tar.gz llama.cpp/ # 2. æ›´æ–°æºç  cd llama.cpp git pull origin master # 3. é‡æ–°ç¼–è¯‘ make clean LLAMA_METAL=1 make -j4 # 4. æµ‹è¯•æ–°ç‰ˆæœ¬ ./llama-server -h # 5. æ›´æ–°å¯åŠ¨è„šæœ¬ nano start-llama.sh 3. ç³»ç»Ÿå‡çº§ # 1. æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ sudo apt update # 2. å‡çº§æ‰€æœ‰åŒ… sudo apt upgrade -y # 3. å‡çº§ç³»ç»Ÿ sudo apt dist-upgrade -y # 4. æ¸…ç†æ—§åŒ… sudo apt autoremove -y sudo apt clean # 5. æ£€æŸ¥å¯åŠ¨é¡¹ sudo systemctl list-unit-files --state=enabled # 6. æ›´æ–°æ ‘è“æ´¾å›ºä»¶ sudo rpi-update # 7. æ£€æŸ¥ç³»ç»ŸçŠ¶æ€ sudo systemctl --failed sudo journalctl -p 3 -xb åå››ã€å®‰å…¨åŠ å›ºæŒ‡å— 1. ç³»ç»Ÿå®‰å…¨é…ç½® # 1. SSH å®‰å…¨é…ç½® sudo nano /etc/ssh/sshd_config # SSH é…ç½®å»ºè®® Port 22222 # ä¿®æ”¹é»˜è®¤ç«¯å£ PermitRootLogin no # ç¦æ­¢ root ç™»å½• PasswordAuthentication no # ç¦ç”¨å¯†ç è®¤è¯ PubkeyAuthentication yes # å¯ç”¨å¯†é’¥è®¤è¯ AllowUsers zhaoxiongzhou # é™åˆ¶å…è®¸çš„ç”¨æˆ· # 2. è®¾ç½®é˜²ç«å¢™è§„åˆ™ sudo apt install ufw fail2ban # é…ç½® UFW sudo ufw default deny incoming sudo ufw default allow outgoing sudo ufw allow 22222/tcp # SSH sudo ufw allow 80/tcp # HTTP sudo ufw allow 8080/tcp # AI æœåŠ¡ sudo ufw enable # é…ç½® fail2ban sudo nano /etc/fail2ban/jail.local [sshd] enabled = true port = 22222 filter = sshd logpath = /var/log/auth.log maxretry = 3 bantime = 3600 2. æœåŠ¡å®‰å…¨é…ç½® Nginx å®‰å…¨è®¾ç½® # 1. åˆ›å»º SSL è¯ä¹¦ sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 \ -keyout /etc/nginx/ssl/nginx.key \ -out /etc/nginx/ssl/nginx.crt # 2. é…ç½® HTTPS sudo nano /etc/nginx/sites-available/myblog server { listen 443 ssl; server_name 10.40.110.47; ssl_certificate /etc/nginx/ssl/nginx.crt; ssl_certificate_key /etc/nginx/ssl/nginx.key; # SSL é…ç½® ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers on; ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options "SAMEORIGIN"; add_header X-XSS-Protection "1; mode=block"; add_header X-Content-Type-Options "nosniff"; add_header Strict-Transport-Security "max-age=31536000"; # å…¶ä»–é…ç½®... } åäº”ã€æ€§èƒ½ç›‘æ§ä¸åˆ†æ 1. ç›‘æ§è„šæœ¬é…ç½® # åˆ›å»ºç»¼åˆç›‘æ§è„šæœ¬ nano ~/system_monitor.sh #!/bin/bash LOG_FILE="/var/log/system_monitor.log" ALERT_FILE="/var/log/system_alerts.log" # è®°å½•æ—¶é—´æˆ³ timestamp() { date "+%Y-%m-%d %H:%M:%S" } # ç³»ç»Ÿèµ„æºç›‘æ§ monitor_resources() { echo "=== ç³»ç»Ÿèµ„æºç›‘æ§ $(timestamp) ===" >> "$LOG_FILE" # CPU ä½¿ç”¨ç‡ CPU_USAGE=$(top -bn1 | grep "Cpu(s)" | awk &#39;{print $2}&#39;) echo "CPU ä½¿ç”¨ç‡: $CPU_USAGE%" >> "$LOG_FILE" # å†…å­˜ä½¿ç”¨ free -h | grep "Mem:" >> "$LOG_FILE" # ç£ç›˜ä½¿ç”¨ df -h / >> "$LOG_FILE" # ç³»ç»Ÿè´Ÿè½½ uptime >> "$LOG_FILE" # CPU æ¸©åº¦ vcgencmd measure_temp >> "$LOG_FILE" } # æœåŠ¡çŠ¶æ€ç›‘æ§ monitor_services() { echo "=== æœåŠ¡çŠ¶æ€ç›‘æ§ $(timestamp) ===" >> "$LOG_FILE" # Nginx çŠ¶æ€ if systemctl is-active nginx >/dev/null 2>&amp;1; then echo "Nginx: è¿è¡Œä¸­" >> "$LOG_FILE" else echo "è­¦å‘Š: Nginx æœªè¿è¡Œ!" >> "$ALERT_FILE" fi # AI æœåŠ¡çŠ¶æ€ if pgrep -f llama-server >/dev/null; then echo "AI æœåŠ¡: è¿è¡Œä¸­" >> "$LOG_FILE" else echo "è­¦å‘Š: AI æœåŠ¡æœªè¿è¡Œ!" >> "$ALERT_FILE" fi } # ç½‘ç»œç›‘æ§ monitor_network() { echo "=== ç½‘ç»œç›‘æ§ $(timestamp) ===" >> "$LOG_FILE" # ç½‘ç»œè¿æ¥æ•° netstat -an | grep ESTABLISHED | wc -l >> "$LOG_FILE" # ç½‘ç»œæµé‡ ifconfig wlan0 | grep bytes >> "$LOG_FILE" } # ä¸»å‡½æ•° main() { monitor_resources monitor_services monitor_network # æ£€æŸ¥æ˜¯å¦éœ€è¦å‘é€è­¦å‘Š if [ -s "$ALERT_FILE" ]; then # å¯ä»¥æ·»åŠ å‘é€è­¦å‘Šçš„å‘½ä»¤ï¼ˆå¦‚é‚®ä»¶é€šçŸ¥ï¼‰ cat "$ALERT_FILE" fi } # æ‰§è¡Œç›‘æ§ main 2. æ€§èƒ½åˆ†æå·¥å…· # å®‰è£…æ€§èƒ½åˆ†æå·¥å…· sudo apt install sysstat iotop htop # åˆ›å»ºæ€§èƒ½æ•°æ®æ”¶é›†è„šæœ¬ nano ~/collect_performance.sh åå…­ã€æ€§èƒ½æ•°æ®æ”¶é›†ä¸åˆ†æ 1. æ€§èƒ½æ•°æ®æ”¶é›†è„šæœ¬ #!/bin/bash # ~/collect_performance.sh PERF_DIR="/home/zhaoxiongzhou/performance_data" DATE=$(date +%Y%m%d_%H%M%S) # åˆ›å»ºæ•°æ®ç›®å½• mkdir -p "$PERF_DIR/$DATE" # CPU æ€§èƒ½æ•°æ® mpstat 1 60 > "$PERF_DIR/$DATE/cpu_stats.log" & # å†…å­˜ä½¿ç”¨æ•°æ® vmstat 1 60 > "$PERF_DIR/$DATE/memory_stats.log" & # IO æ€§èƒ½æ•°æ® iostat -x 1 60 > "$PERF_DIR/$DATE/io_stats.log" & # ç½‘ç»œæ€§èƒ½æ•°æ® sar -n DEV 1 60 > "$PERF_DIR/$DATE/network_stats.log" & # è¿›ç¨‹æ€§èƒ½æ•°æ® ps aux --sort=-%cpu | head -n 20 > "$PERF_DIR/$DATE/top_processes.log" # ç³»ç»Ÿè´Ÿè½½æ•°æ® uptime > "$PERF_DIR/$DATE/load_average.log" # ç­‰å¾…æ‰€æœ‰åå°è¿›ç¨‹å®Œæˆ wait # å‹ç¼©æ•°æ® tar -czf "$PERF_DIR/performance_${DATE}.tar.gz" "$PERF_DIR/$DATE" rm -rf "$PERF_DIR/$DATE" 2. æ€§èƒ½æ•°æ®åˆ†æè„šæœ¬ # åˆ›å»ºåˆ†æè„šæœ¬ nano ~/analyze_performance.sh #!/bin/bash # ~/analyze_performance.sh PERF_DIR="/home/zhaoxiongzhou/performance_data" REPORT_DIR="/home/zhaoxiongzhou/performance_reports" DATE=$(date +%Y%m%d) mkdir -p "$REPORT_DIR" generate_report() { local REPORT_FILE="$REPORT_DIR/report_${DATE}.txt" echo "æ€§èƒ½åˆ†ææŠ¥å‘Š - $(date)" > "$REPORT_FILE" echo "===================" >> "$REPORT_FILE" # CPU ä½¿ç”¨åˆ†æ echo -e "\nCPU ä½¿ç”¨æƒ…å†µ:" >> "$REPORT_FILE" awk &#39;/all/ {total += $3; count++} END {print "å¹³å‡CPUä½¿ç”¨ç‡: " total/count "%"}&#39; \ "$PERF_DIR/latest/cpu_stats.log" >> "$REPORT_FILE" # å†…å­˜ä½¿ç”¨åˆ†æ echo -e "\nå†…å­˜ä½¿ç”¨æƒ…å†µ:" >> "$REPORT_FILE" free -h | grep "Mem:" >> "$REPORT_FILE" # IO æ€§èƒ½åˆ†æ echo -e "\nIO æ€§èƒ½:" >> "$REPORT_FILE" tail -n 10 "$PERF_DIR/latest/io_stats.log" >> "$REPORT_FILE" # ç½‘ç»œæ€§èƒ½åˆ†æ echo -e "\nç½‘ç»œæ€§èƒ½:" >> "$REPORT_FILE" tail -n 10 "$PERF_DIR/latest/network_stats.log" >> "$REPORT_FILE" # è¿›ç¨‹åˆ†æ echo -e "\nèµ„æºå ç”¨æœ€é«˜çš„è¿›ç¨‹:" >> "$REPORT_FILE" head -n 5 "$PERF_DIR/latest/top_processes.log" >> "$REPORT_FILE" echo -e "\nåˆ†æå®Œæˆã€‚æŠ¥å‘Šä¿å­˜åœ¨: $REPORT_FILE" } # ç”ŸæˆæŠ¥å‘Š generate_report åä¸ƒã€è‡ªåŠ¨åŒ–è¿ç»´è„šæœ¬ 1. æœåŠ¡å¥åº·æ£€æŸ¥ä¸è‡ªåŠ¨æ¢å¤ # åˆ›å»ºæœåŠ¡ç›‘æ§è„šæœ¬ nano ~/service_health_check.sh #!/bin/bash # ~/service_health_check.sh LOG_FILE="/var/log/service_health.log" ALERT_SCRIPT="/home/zhaoxiongzhou/send_alert.sh" log_message() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" >> "$LOG_FILE" } check_and_restart_service() { local service_name="$1" local process_pattern="$2" if ! pgrep -f "$process_pattern" > /dev/null; then log_message "è­¦å‘Š: $service_name æœåŠ¡æœªè¿è¡Œï¼Œå°è¯•é‡å¯" case "$service_name" in "nginx") sudo systemctl restart nginx ;; "llama-server") cd ~/projects/llama.cpp ./start-llama.sh ;; esac # ç­‰å¾…æœåŠ¡å¯åŠ¨ sleep 10 # éªŒè¯æœåŠ¡æ˜¯å¦æˆåŠŸé‡å¯ if pgrep -f "$process_pattern" > /dev/null; then log_message "$service_name æœåŠ¡å·²æˆåŠŸé‡å¯" "$ALERT_SCRIPT" "$service_name æœåŠ¡å·²è‡ªåŠ¨é‡å¯" else log_message "é”™è¯¯: $service_name æœåŠ¡é‡å¯å¤±è´¥" "$ALERT_SCRIPT" "è­¦å‘Š: $service_name æœåŠ¡é‡å¯å¤±è´¥ï¼Œéœ€è¦æ‰‹åŠ¨å¹²é¢„" fi else log_message "$service_name æœåŠ¡è¿è¡Œæ­£å¸¸" fi } # æ£€æŸ¥å„ä¸ªæœåŠ¡ check_and_restart_service "nginx" "nginx" check_and_restart_service "llama-server" "llama-server" # æ¸…ç†æ—§æ—¥å¿— find "$LOG_FILE" -mtime +30 -delete 2. è‡ªåŠ¨å¤‡ä»½ä¸æ¸…ç† # åˆ›å»ºè‡ªåŠ¨ç»´æŠ¤è„šæœ¬ nano ~/auto_maintenance.sh #!/bin/bash # ~/auto_maintenance.sh BACKUP_DIR="/home/zhaoxiongzhou/backups" LOG_DIR="/var/log" DATE=$(date +%Y%m%d) # åˆ›å»ºå¤‡ä»½ create_backups() { # åšå®¢å¤‡ä»½ tar -czf "$BACKUP_DIR/blog_$DATE.tar.gz" ~/myblog/content # AI æœåŠ¡é…ç½®å¤‡ä»½ tar -czf "$BACKUP_DIR/llama_config_$DATE.tar.gz" ~/projects/llama.cpp/start-llama.sh # Nginx é…ç½®å¤‡ä»½ sudo tar -czf "$BACKUP_DIR/nginx_config_$DATE.tar.gz" /etc/nginx/sites-available/ } # æ¸…ç†æ—§æ–‡ä»¶ cleanup_old_files() { # åˆ é™¤30å¤©å‰çš„å¤‡ä»½ find "$BACKUP_DIR" -name "*.tar.gz" -mtime +30 -delete # æ¸…ç†æ—¥å¿— sudo find "$LOG_DIR" -name "*.log" -mtime +30 -delete sudo find "$LOG_DIR" -name "*.gz" -mtime +30 -delete # æ¸…ç†ç³»ç»Ÿä¸´æ—¶æ–‡ä»¶ sudo rm -rf /tmp/* sudo rm -rf /var/tmp/* } # ä¸»å‡½æ•° main() { create_backups cleanup_old_files # å‹ç¼©æ—¥å¿— sudo logrotate -f /etc/logrotate.conf # æ¸…ç†åŒ…ç¼“å­˜ sudo apt clean sudo apt autoremove -y } # æ‰§è¡Œç»´æŠ¤ä»»åŠ¡ main åå…«ã€æ—¥å¿—ç®¡ç†ç³»ç»Ÿ 1. é›†ä¸­å¼æ—¥å¿—é…ç½® # åˆ›å»ºæ—¥å¿—ç®¡ç†è„šæœ¬ nano ~/log_management.sh #!/bin/bash # ~/log_management.sh LOG_BASE="/var/log/services" ARCHIVE_DIR="/home/zhaoxiongzhou/log_archives" DATE=$(date +%Y%m%d) # åˆ›å»ºæ—¥å¿—ç›®å½• mkdir -p "$LOG_BASE"/{nginx,ai_service,system} mkdir -p "$ARCHIVE_DIR" # é…ç½®æ—¥å¿—è½®è½¬ sudo tee /etc/logrotate.d/custom_services << EOF $LOG_BASE/nginx/*.log { daily missingok rotate 14 compress delaycompress notifempty create 0640 www-data adm sharedscripts postrotate [ -f /var/run/nginx.pid ] && kill -USR1 \$(cat /var/run/nginx.pid) endscript } $LOG_BASE/ai_service/*.log { daily missingok rotate 14 compress delaycompress notifempty create 0640 zhaoxiongzhou adm } $LOG_BASE/system/*.log { daily missingok rotate 30 compress delaycompress notifempty create 0640 root adm } EOF # æ—¥å¿—åˆ†æå‡½æ•° analyze_logs() { local log_file="$1" local output_file="$2" echo "=== æ—¥å¿—åˆ†ææŠ¥å‘Š $(date) ===" > "$output_file" # é”™è¯¯ç»Ÿè®¡ echo -e "\né”™è¯¯ç»Ÿè®¡:" >> "$output_file" grep -i "error" "$log_file" | sort | uniq -c | sort -nr >> "$output_file" # è­¦å‘Šç»Ÿè®¡ echo -e "\nè­¦å‘Šç»Ÿè®¡:" >> "$output_file" grep -i "warning" "$log_file" | sort | uniq -c | sort -nr >> "$output_file" # è®¿é—®ç»Ÿè®¡ï¼ˆé’ˆå¯¹ Nginx è®¿é—®æ—¥å¿—ï¼‰ if [[ "$log_file" == *"nginx/access"* ]]; then echo -e "\nè®¿é—®é‡ç»Ÿè®¡:" >> "$output_file" awk &#39;{print $1}&#39; "$log_file" | sort | uniq -c | sort -nr | head -n 10 >> "$output_file" fi } # æ—¥å¿—å½’æ¡£å‡½æ•° archive_logs() { local source_dir="$1" local archive_name="logs_${DATE}.tar.gz" find "$source_dir" -name "*.log.*" -mtime +14 -exec tar -czf "$ARCHIVE_DIR/$archive_name" {} + find "$source_dir" -name "*.log.*" -mtime +14 -delete } 2. æ—¥å¿—ç›‘æ§å‘Šè­¦ # åˆ›å»ºæ—¥å¿—ç›‘æ§è„šæœ¬ nano ~/log_monitor.sh #!/bin/bash # ~/log_monitor.sh ALERT_THRESHOLD=10 # é”™è¯¯é˜ˆå€¼ ALERT_SCRIPT="/home/zhaoxiongzhou/send_alert.sh" # ç›‘æ§ç‰¹å®šå…³é”®è¯ monitor_keywords() { local log_file="$1" local keywords=("error" "critical" "failed" "timeout" "exception") for keyword in "${keywords[@]}"; do count=$(grep -i "$keyword" "$log_file" | wc -l) if [ "$count" -gt "$ALERT_THRESHOLD" ]; then "$ALERT_SCRIPT" "è­¦å‘Š: $log_file ä¸­å‘ç°å¤§é‡ $keyword ($count æ¬¡)" fi done } # ç›‘æ§æ—¥å¿—å¤§å° check_log_size() { local log_file="$1" local max_size=$((100 * 1024 * 1024)) # 100MB size=$(stat -f%z "$log_file") if [ "$size" -gt "$max_size" ]; then "$ALERT_SCRIPT" "è­¦å‘Š: $log_file å¤§å°è¶…è¿‡ 100MB" fi } # ä¸»ç›‘æ§å¾ªç¯ main() { while true; do for log_file in "$LOG_BASE"/**/*.log; do monitor_keywords "$log_file" check_log_size "$log_file" done sleep 300 # æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ done } main & åä¹ã€ç³»ç»Ÿä¼˜åŒ–ä¸è°ƒä¼˜ 1. ç³»ç»Ÿå‚æ•°ä¼˜åŒ– # åˆ›å»ºç³»ç»Ÿä¼˜åŒ–è„šæœ¬ nano ~/system_optimize.sh #!/bin/bash # ~/system_optimize.sh # ç³»ç»Ÿå‚æ•°ä¼˜åŒ– optimize_sysctl() { sudo tee /etc/sysctl.d/99-custom.conf << EOF # å†…å­˜ç®¡ç†ä¼˜åŒ– vm.swappiness = 60 vm.vfs_cache_pressure = 50 vm.dirty_background_ratio = 5 vm.dirty_ratio = 10 # ç½‘ç»œä¼˜åŒ– net.core.somaxconn = 1024 net.core.netdev_max_backlog = 5000 net.ipv4.tcp_max_syn_backlog = 2048 net.ipv4.tcp_fin_timeout = 20 net.ipv4.tcp_keepalive_time = 1200 net.ipv4.tcp_keepalive_intvl = 15 net.ipv4.tcp_keepalive_probes = 5 # æ–‡ä»¶ç³»ç»Ÿä¼˜åŒ– fs.file-max = 65535 fs.inotify.max_user_watches = 524288 EOF # åº”ç”¨æ–°çš„ç³»ç»Ÿå‚æ•° sudo sysctl -p /etc/sysctl.d/99-custom.conf } # CPU é¢‘ç‡ä¼˜åŒ– optimize_cpu() { sudo tee /boot/config.txt << EOF # CPU è®¾ç½® arm_freq=1800 over_voltage=6 gpu_freq=500 # æ¸©åº¦æ§åˆ¶ temp_limit=75 EOF } # æœåŠ¡ä¼˜åŒ– optimize_services() { # ç¦ç”¨ä¸å¿…è¦çš„æœåŠ¡ UNNECESSARY_SERVICES=( "bluetooth" "cups" "avahi-daemon" ) for service in "${UNNECESSARY_SERVICES[@]}"; do if systemctl is-enabled "$service" &>/dev/null; then sudo systemctl disable "$service" sudo systemctl stop "$service" fi done } # å†…å­˜ä¼˜åŒ– optimize_memory() { # è°ƒæ•´ ZRAM sudo tee /etc/default/zramswap << EOF ALGO=lz4 PERCENT=50 EOF # é‡å¯ ZRAM æœåŠ¡ sudo systemctl restart zramswap } 2. æœåŠ¡ä¼˜åŒ–é…ç½® # Nginx ä¼˜åŒ–é…ç½® sudo nano /etc/nginx/nginx.conf user www-data; worker_processes auto; worker_rlimit_nofile 65535; events { worker_connections 1024; multi_accept on; use epoll; } http { # åŸºç¡€è®¾ç½® sendfile on; tcp_nopush on; tcp_nodelay on; keepalive_timeout 65; types_hash_max_size 2048; server_tokens off; # MIME ç±»å‹ include /etc/nginx/mime.types; default_type application/octet-stream; # æ—¥å¿—æ ¼å¼ log_format main &#39;$remote_addr - $remote_user [$time_local] "$request" &#39; &#39;$status $body_bytes_sent "$http_referer" &#39; &#39;"$http_user_agent" "$http_x_forwarded_for"&#39;; # ç¼“å†²åŒºè®¾ç½® client_body_buffer_size 10K; client_header_buffer_size 1k; client_max_body_size 8m; large_client_header_buffers 2 1k; # è¶…æ—¶è®¾ç½® client_body_timeout 12; client_header_timeout 12; send_timeout 10; # ç¼“å­˜è®¾ç½® open_file_cache max=1000 inactive=20s; open_file_cache_valid 30s; open_file_cache_min_uses 2; open_file_cache_errors on; # Gzip å‹ç¼© gzip on; gzip_vary on; gzip_proxied any; gzip_comp_level 6; gzip_types text/plain text/css text/xml application/json application/javascript application/xml+rss application/atom+xml image/svg+xml; } äºŒåã€æœåŠ¡ç›‘æ§é¢æ¿é…ç½® 1. Grafana ç›‘æ§ç³»ç»Ÿé…ç½® # å®‰è£… Grafana sudo apt-get install -y apt-transport-https sudo apt-get install -y software-properties-common wget wget -q -O - https://packages.grafana.com/gpg.key | sudo apt-key add - echo "deb https://packages.grafana.com/oss/deb stable main" | sudo tee -a /etc/apt/sources.list.d/grafana.list sudo apt-get update sudo apt-get install -y grafana # é…ç½® Grafana sudo nano /etc/grafana/grafana.ini [server] http_addr = 0.0.0.0 http_port = 3000 [security] admin_user = admin admin_password = your_secure_password [auth.anonymous] enabled = false [paths] data = /var/lib/grafana logs = /var/log/grafana plugins = /var/lib/grafana/plugins [dashboards] versions_to_keep = 20 2. Prometheus é…ç½® # å®‰è£… Prometheus sudo apt-get install -y prometheus # é…ç½® Prometheus sudo nano /etc/prometheus/prometheus.yml global: scrape_interval: 15s evaluation_interval: 15s scrape_configs: - job_name: &#39;node&#39; static_configs: - targets: [&#39;localhost:9100&#39;] - job_name: &#39;nginx&#39; static_configs: - targets: [&#39;localhost:9113&#39;] - job_name: &#39;system&#39; static_configs: - targets: [&#39;localhost:9090&#39;] - job_name: &#39;process&#39; static_configs: - targets: [&#39;localhost:9256&#39;] 3. Node Exporter é…ç½® # å®‰è£… Node Exporter sudo apt-get install -y prometheus-node-exporter # åˆ›å»ºè‡ªå®šä¹‰æŒ‡æ ‡æ”¶é›†è„šæœ¬ nano ~/custom_metrics.sh #!/bin/bash # ~/custom_metrics.sh # åˆ›å»ºæŒ‡æ ‡æ–‡ä»¶ METRICS_FILE="/var/lib/node_exporter/custom_metrics.prom" while true; do # CPU æ¸©åº¦ CPU_TEMP=$(vcgencmd measure_temp | sed &#39;s/temp=//&#39; | sed &#39;s/&#39;"&#39;"&#39;C//&#39;) echo "raspberry_pi_cpu_temperature $CPU_TEMP" > "$METRICS_FILE" # AI æœåŠ¡çŠ¶æ€ if pgrep -f llama-server > /dev/null; then echo "ai_service_status 1" >> "$METRICS_FILE" else echo "ai_service_status 0" >> "$METRICS_FILE" fi # åšå®¢æœåŠ¡çŠ¶æ€ if systemctl is-active nginx > /dev/null; then echo "blog_service_status 1" >> "$METRICS_FILE" else echo "blog_service_status 0" >> "$METRICS_FILE" fi # å†…å­˜ä½¿ç”¨ FREE_MEM=$(free | grep Mem | awk &#39;{print $4}&#39;) echo "system_free_memory_bytes $FREE_MEM" >> "$METRICS_FILE" sleep 15 done äºŒåä¸€ã€è‡ªåŠ¨åŒ–éƒ¨ç½²ä¸æ›´æ–° 1. è‡ªåŠ¨éƒ¨ç½²é…ç½®è„šæœ¬ # åˆ›å»ºè‡ªåŠ¨éƒ¨ç½²è„šæœ¬ nano ~/auto_deploy.sh #!/bin/bash # ~/auto_deploy.sh # é…ç½® BLOG_DIR="/home/zhaoxiongzhou/myblog" LLAMA_DIR="/home/zhaoxiongzhou/projects/llama.cpp" BACKUP_DIR="/home/zhaoxiongzhou/backups" LOG_FILE="/var/log/auto_deploy.log" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" >> "$LOG_FILE" } # å¤‡ä»½å½“å‰ç‰ˆæœ¬ backup_current() { log "å¼€å§‹å¤‡ä»½å½“å‰ç‰ˆæœ¬" # åšå®¢å¤‡ä»½ tar -czf "$BACKUP_DIR/blog_$(date +%Y%m%d_%H%M%S).tar.gz" "$BLOG_DIR" # AI æœåŠ¡å¤‡ä»½ tar -czf "$BACKUP_DIR/llama_$(date +%Y%m%d_%H%M%S).tar.gz" "$LLAMA_DIR" log "å¤‡ä»½å®Œæˆ" } # æ›´æ–°åšå®¢ update_blog() { log "å¼€å§‹æ›´æ–°åšå®¢" cd "$BLOG_DIR" || exit 1 # æ‹‰å–æœ€æ–°ä»£ç  if git pull origin master; then # æ›´æ–°ä¸»é¢˜ git submodule update --remote themes/ananke # æ„å»ºç«™ç‚¹ hugo --minify # æ›´æ–°æƒé™ sudo chown -R www-data:www-data public/ # é‡å¯ Nginx sudo systemctl restart nginx log "åšå®¢æ›´æ–°æˆåŠŸ" else log "é”™è¯¯: åšå®¢æ›´æ–°å¤±è´¥" return 1 fi } # æ›´æ–° AI æœåŠ¡ update_ai_service() { log "å¼€å§‹æ›´æ–° AI æœåŠ¡" cd "$LLAMA_DIR" || exit 1 # åœæ­¢å½“å‰æœåŠ¡ pkill llama-server # æ‹‰å–æœ€æ–°ä»£ç  if git pull origin master; then # é‡æ–°ç¼–è¯‘ make clean if LLAMA_METAL=1 make -j4; then # å¯åŠ¨æœåŠ¡ ./start-llama.sh # éªŒè¯æœåŠ¡ sleep 5 if pgrep -f llama-server > /dev/null; then log "AI æœåŠ¡æ›´æ–°æˆåŠŸ" else log "é”™è¯¯: AI æœåŠ¡å¯åŠ¨å¤±è´¥" return 1 fi else log "é”™è¯¯: AI æœåŠ¡ç¼–è¯‘å¤±è´¥" return 1 fi else log "é”™è¯¯: AI æœåŠ¡ä»£ç æ›´æ–°å¤±è´¥" return 1 fi } # ä¸»å‡½æ•° main() { log "å¼€å§‹è‡ªåŠ¨éƒ¨ç½²æµç¨‹" # åˆ›å»ºå¤‡ä»½ backup_current # æ›´æ–°æœåŠ¡ if update_blog && update_ai_service; then log "éƒ¨ç½²å®Œæˆ" return 0 else log "éƒ¨ç½²å¤±è´¥" return 1 fi } # æ‰§è¡Œéƒ¨ç½² main 2. è‡ªåŠ¨æ›´æ–°æ£€æŸ¥è„šæœ¬ # åˆ›å»ºæ›´æ–°æ£€æŸ¥è„šæœ¬ nano ~/check_updates.sh äºŒåä¸€ã€è‡ªåŠ¨æ›´æ–°æ£€æŸ¥ä¸é€šçŸ¥ç³»ç»Ÿ 1. æ›´æ–°æ£€æŸ¥è„šæœ¬ #!/bin/bash # ~/check_updates.sh # é…ç½® NOTIFY_SCRIPT="/home/zhaoxiongzhou/send_notification.sh" LOG_FILE="/var/log/update_check.log" GITHUB_API="https://api.github.com" LLAMA_REPO="ggerganov/llama.cpp" HUGO_REPO="gohugoio/hugo" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # æ£€æŸ¥ GitHub ä»“åº“æ›´æ–° check_github_updates() { local repo="$1" local current_version="$2" # è·å–æœ€æ–°ç‰ˆæœ¬ latest_version=$(curl -s "$GITHUB_API/repos/$repo/releases/latest" | grep -Po &#39;"tag_name": "\K.*?(?=")&#39;) if [ "$latest_version" != "$current_version" ]; then log "å‘ç°æ–°ç‰ˆæœ¬: $repo ($current_version -> $latest_version)" return 0 else log "å½“å‰ç‰ˆæœ¬å·²æ˜¯æœ€æ–°: $repo ($current_version)" return 1 fi } # æ£€æŸ¥ç³»ç»Ÿæ›´æ–° check_system_updates() { sudo apt update > /dev/null 2>&amp;1 updates=$(sudo apt list --upgradable 2>/dev/null | grep -c "upgradable") if [ "$updates" -gt 0 ]; then log "å‘ç° $updates ä¸ªç³»ç»Ÿæ›´æ–°" return 0 else log "ç³»ç»Ÿå·²æ˜¯æœ€æ–°" return 1 fi } # æ£€æŸ¥æœåŠ¡çŠ¶æ€ check_services() { local services=("nginx" "llama-server") local status=0 for service in "${services[@]}"; do if [ "$service" = "nginx" ]; then if ! systemctl is-active --quiet nginx; then log "è­¦å‘Š: Nginx æœåŠ¡æœªè¿è¡Œ" status=1 fi elif [ "$service" = "llama-server" ]; then if ! pgrep -f llama-server > /dev/null; then log "è­¦å‘Š: AI æœåŠ¡æœªè¿è¡Œ" status=1 fi fi done return $status } # å‘é€é€šçŸ¥ send_notification() { local message="$1" local priority="$2" if [ -x "$NOTIFY_SCRIPT" ]; then "$NOTIFY_SCRIPT" "$message" "$priority" else log "é€šçŸ¥è„šæœ¬ä¸å­˜åœ¨æˆ–ä¸å¯æ‰§è¡Œ" fi } # ä¸»å‡½æ•° main() { log "å¼€å§‹æ£€æŸ¥æ›´æ–°" # è·å–å½“å‰ç‰ˆæœ¬ current_llama_version=$(cd ~/projects/llama.cpp && git describe --tags) current_hugo_version=$(hugo version | grep -Po "v\d+\.\d+\.\d+") # æ£€æŸ¥æ›´æ–° updates_found=0 if check_github_updates "$LLAMA_REPO" "$current_llama_version"; then send_notification "llama.cpp æœ‰æ–°ç‰ˆæœ¬å¯ç”¨" "normal" updates_found=1 fi if check_github_updates "$HUGO_REPO" "$current_hugo_version"; then send_notification "Hugo æœ‰æ–°ç‰ˆæœ¬å¯ç”¨" "normal" updates_found=1 fi if check_system_updates; then send_notification "ç³»ç»Ÿæœ‰æ›´æ–°å¯ç”¨" "normal" updates_found=1 fi if ! check_services; then send_notification "æœåŠ¡çŠ¶æ€å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥" "high" fi if [ "$updates_found" -eq 0 ]; then log "æ‰€æœ‰ç»„ä»¶å‡ä¸ºæœ€æ–°ç‰ˆæœ¬" fi } # æ‰§è¡Œæ£€æŸ¥ main äºŒåäºŒã€é€šçŸ¥ç³»ç»Ÿé…ç½® 1. é€šçŸ¥å‘é€è„šæœ¬ # åˆ›å»ºé€šçŸ¥å‘é€è„šæœ¬ nano ~/send_notification.sh #!/bin/bash # ~/send_notification.sh # é…ç½® TELEGRAM_BOT_TOKEN="your_bot_token" TELEGRAM_CHAT_ID="your_chat_id" EMAIL_ADDRESS="your_email@domain.com" DISCORD_WEBHOOK_URL="your_discord_webhook_url" # æ—¥å¿—é…ç½® LOG_FILE="/var/log/notifications.log" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" >> "$LOG_FILE" } # Telegram é€šçŸ¥ send_telegram() { local message="$1" local priority="$2" # æ ¹æ®ä¼˜å…ˆçº§æ·»åŠ è¡¨æƒ…ç¬¦å· case "$priority" in "high") message="ğŸš¨ ç´§æ€¥: $message" ;; "normal") message="â„¹ï¸ é€šçŸ¥: $message" ;; "low") message="ğŸ“ ä¿¡æ¯: $message" ;; esac # å‘é€æ¶ˆæ¯ curl -s -X POST \ "https://api.telegram.org/bot$TELEGRAM_BOT_TOKEN/sendMessage" \ -d "chat_id=$TELEGRAM_CHAT_ID" \ -d "text=$message" \ -d "parse_mode=HTML" log "Telegram é€šçŸ¥å·²å‘é€: $message" } # é‚®ä»¶é€šçŸ¥ send_email() { local message="$1" local priority="$2" local subject case "$priority" in "high") subject="[ç´§æ€¥] æ ‘è“æ´¾æœåŠ¡è­¦å‘Š" ;; "normal") subject="[é€šçŸ¥] æ ‘è“æ´¾æœåŠ¡æ›´æ–°" ;; "low") subject="[ä¿¡æ¯] æ ‘è“æ´¾æœåŠ¡çŠ¶æ€" ;; esac echo "$message" | mail -s "$subject" "$EMAIL_ADDRESS" log "é‚®ä»¶é€šçŸ¥å·²å‘é€: $subject - $message" } # Discord é€šçŸ¥ send_discord() { local message="$1" local priority="$2" local color case "$priority" in "high") color="16711680" # çº¢è‰² ;; "normal") color="65280" # ç»¿è‰² ;; "low") color="255" # è“è‰² ;; esac curl -H "Content-Type: application/json" \ -X POST \ -d "{\"embeds\": [{\"description\": \"$message\", \"color\": $color}]}" \ "$DISCORD_WEBHOOK_URL" log "Discord é€šçŸ¥å·²å‘é€: $message" } # ä¸»å‡½æ•° main() { local message="$1" local priority="${2:-normal}" # é»˜è®¤ä¼˜å…ˆçº§ä¸º normal # æ£€æŸ¥å¿…è¦å‚æ•° if [ -z "$message" ]; then log "é”™è¯¯: æ¶ˆæ¯å†…å®¹ä¸èƒ½ä¸ºç©º" return 1 fi # æ·»åŠ ç³»ç»Ÿä¿¡æ¯ local hostname=$(hostname) local timestamp=$(date &#39;+%Y-%m-%d %H:%M:%S&#39;) message="[$hostname] [$timestamp] $message" # å‘é€æ‰€æœ‰é€šçŸ¥ send_telegram "$message" "$priority" send_email "$message" "$priority" send_discord "$message" "$priority" log "æ‰€æœ‰é€šçŸ¥æ¸ é“å¤„ç†å®Œæˆ" } # æ‰§è¡Œé€šçŸ¥å‘é€ main "$@" äºŒåä¸‰ã€å®šæ—¶ä»»åŠ¡é…ç½® 1. Crontab é…ç½® # ç¼–è¾‘ crontab crontab -e # ç³»ç»Ÿç»´æŠ¤ä»»åŠ¡ # æ¯å¤©å‡Œæ™¨ 2 ç‚¹æ‰§è¡Œç³»ç»Ÿæ›´æ–°æ£€æŸ¥ 0 2 * * * ~/check_updates.sh > /dev/null 2>&amp;1 # æ¯ 6 å°æ—¶æ‰§è¡Œä¸€æ¬¡æœåŠ¡å¥åº·æ£€æŸ¥ 0 */6 * * * ~/service_health_check.sh > /dev/null 2>&amp;1 # æ¯å‘¨æ—¥å‡Œæ™¨ 3 ç‚¹æ‰§è¡Œç³»ç»Ÿä¼˜åŒ– 0 3 * * 0 ~/system_optimize.sh > /dev/null 2>&amp;1 # æ¯å¤©å‡Œæ™¨ 4 ç‚¹æ‰§è¡Œæ—¥å¿—ç®¡ç† 0 4 * * * ~/log_management.sh > /dev/null 2>&amp;1 # æ¯å°æ—¶æ‰§è¡Œæ€§èƒ½æ•°æ®æ”¶é›† 0 * * * * ~/collect_performance.sh > /dev/null 2>&amp;1 # æ¯ 5 åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡å…³é”®æœåŠ¡çŠ¶æ€ */5 * * * * ~/monitor.sh > /dev/null 2>&amp;1 # æ¯å¤©æ™šä¸Š 11 ç‚¹æ‰§è¡Œå¤‡ä»½ 0 23 * * * ~/auto_backup.sh > /dev/null 2>&amp;1 # æ¯æœˆ 1 å·æ‰§è¡Œå®Œæ•´ç³»ç»Ÿæ£€æŸ¥ 0 1 1 * * ~/full_system_check.sh > /dev/null 2>&amp;1 2. å®Œæ•´ç³»ç»Ÿæ£€æŸ¥è„šæœ¬ # åˆ›å»ºå®Œæ•´ç³»ç»Ÿæ£€æŸ¥è„šæœ¬ nano ~/full_system_check.sh #!/bin/bash # ~/full_system_check.sh LOG_FILE="/var/log/system_check.log" REPORT_FILE="/home/zhaoxiongzhou/reports/monthly_report_$(date +%Y%m).txt" # ç¡®ä¿ç›®å½•å­˜åœ¨ mkdir -p "$(dirname "$REPORT_FILE")" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" "$REPORT_FILE" } # ç³»ç»Ÿä¿¡æ¯æ£€æŸ¥ check_system_info() { log "=== ç³»ç»Ÿä¿¡æ¯ ===" log "ç³»ç»Ÿç‰ˆæœ¬: $(cat /etc/os-release | grep PRETTY_NAME)" log "å†…æ ¸ç‰ˆæœ¬: $(uname -r)" log "è¿è¡Œæ—¶é—´: $(uptime -p)" log "æœ€åå¯åŠ¨: $(who -b | awk &#39;{print $3,$4}&#39;)" } # èµ„æºä½¿ç”¨æ£€æŸ¥ check_resources() { log "=== èµ„æºä½¿ç”¨æƒ…å†µ ===" log "CPU ä½¿ç”¨ç‡: $(top -bn1 | grep "Cpu(s)" | awk &#39;{print $2}&#39;)%" log "å†…å­˜ä½¿ç”¨æƒ…å†µ:" free -h | tee -a "$REPORT_FILE" log "ç£ç›˜ä½¿ç”¨æƒ…å†µ:" df -h | tee -a "$REPORT_FILE" } # æœåŠ¡çŠ¶æ€æ£€æŸ¥ check_services() { log "=== æœåŠ¡çŠ¶æ€ ===" # æ£€æŸ¥ Nginx if systemctl is-active --quiet nginx; then log "Nginx: è¿è¡Œæ­£å¸¸" else log "Nginx: æœªè¿è¡Œ" fi # æ£€æŸ¥ AI æœåŠ¡ if pgrep -f llama-server > /dev/null; then log "AI æœåŠ¡: è¿è¡Œæ­£å¸¸" else log "AI æœåŠ¡: æœªè¿è¡Œ" fi } # å®‰å…¨æ£€æŸ¥ check_security() { log "=== å®‰å…¨æ£€æŸ¥ ===" # æ£€æŸ¥å¤±è´¥çš„ç™»å½•å°è¯• log "å¤±è´¥çš„ç™»å½•å°è¯•:" grep "Failed password" /var/log/auth.log | tail -n 5 | tee -a "$REPORT_FILE" # æ£€æŸ¥å¼€æ”¾çš„ç«¯å£ log "å¼€æ”¾çš„ç«¯å£:" netstat -tuln | grep LISTEN | tee -a "$REPORT_FILE" } # æ€§èƒ½åˆ†æ analyze_performance() { log "=== æ€§èƒ½åˆ†æ ===" # åˆ†æ CPU ä½¿ç”¨æƒ…å†µ log "CPU å¯†é›†è¿›ç¨‹:" ps aux --sort=-%cpu | head -n 5 | tee -a "$REPORT_FILE" # åˆ†æå†…å­˜ä½¿ç”¨æƒ…å†µ log "å†…å­˜å¯†é›†è¿›ç¨‹:" ps aux --sort=-%mem | head -n 5 | tee -a "$REPORT_FILE" } # ä¸»å‡½æ•° main() { log "å¼€å§‹æœˆåº¦ç³»ç»Ÿæ£€æŸ¥ - $(date)" check_system_info check_resources check_services check_security analyze_performance log "ç³»ç»Ÿæ£€æŸ¥å®Œæˆ" # å‘é€æŠ¥å‘Š if [ -f "$REPORT_FILE" ]; then ~/send_notification.sh "æœˆåº¦ç³»ç»Ÿæ£€æŸ¥æŠ¥å‘Šå·²ç”Ÿæˆ" "normal" fi } # æ‰§è¡Œæ£€æŸ¥ main äºŒåå››ã€ç¾éš¾æ¢å¤è®¡åˆ’ 1. ç³»ç»Ÿæ¢å¤è„šæœ¬ # åˆ›å»ºç³»ç»Ÿæ¢å¤è„šæœ¬ nano ~/disaster_recovery.sh #!/bin/bash # ~/disaster_recovery.sh # é…ç½® BACKUP_DIR="/home/zhaoxiongzhou/backups" RECOVERY_LOG="/var/log/recovery.log" SERVICES=("nginx" "llama-server") # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$RECOVERY_LOG" } # éªŒè¯å¤‡ä»½ verify_backup() { local backup_file="$1" if [ ! -f "$backup_file" ]; then log "é”™è¯¯: å¤‡ä»½æ–‡ä»¶ä¸å­˜åœ¨ - $backup_file" return 1 fi # æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§ if ! tar -tzf "$backup_file" >/dev/null 2>&amp;1; then log "é”™è¯¯: å¤‡ä»½æ–‡ä»¶æŸå - $backup_file" return 1 fi return 0 } # åœæ­¢æœåŠ¡ stop_services() { log "åœæ­¢æ‰€æœ‰æœåŠ¡..." for service in "${SERVICES[@]}"; do if [ "$service" = "nginx" ]; then sudo systemctl stop nginx else pkill "$service" fi done # ç­‰å¾…æœåŠ¡å®Œå…¨åœæ­¢ sleep 5 } # æ¢å¤åšå®¢æœåŠ¡ restore_blog() { local backup_file="$BACKUP_DIR/blog_latest.tar.gz" if verify_backup "$backup_file"; then log "å¼€å§‹æ¢å¤åšå®¢æœåŠ¡..." # æ¸…ç†å½“å‰ç›®å½• rm -rf ~/myblog/* # è§£å‹å¤‡ä»½ tar -xzf "$backup_file" -C ~/myblog/ # é‡å»ºç«™ç‚¹ cd ~/myblog hugo --minify # æ¢å¤æƒé™ sudo chown -R www-data:www-data public/ log "åšå®¢æœåŠ¡æ¢å¤å®Œæˆ" else log "åšå®¢æœåŠ¡æ¢å¤å¤±è´¥" return 1 fi } # æ¢å¤ AI æœåŠ¡ restore_ai_service() { local backup_file="$BACKUP_DIR/llama_latest.tar.gz" if verify_backup "$backup_file"; then log "å¼€å§‹æ¢å¤ AI æœåŠ¡..." # æ¸…ç†å½“å‰ç›®å½• rm -rf ~/projects/llama.cpp/* # è§£å‹å¤‡ä»½ tar -xzf "$backup_file" -C ~/projects/llama.cpp/ # é‡æ–°ç¼–è¯‘ cd ~/projects/llama.cpp make clean LLAMA_METAL=1 make -j4 log "AI æœåŠ¡æ¢å¤å®Œæˆ" else log "AI æœåŠ¡æ¢å¤å¤±è´¥" return 1 fi } # æ¢å¤ç³»ç»Ÿé…ç½® restore_system_config() { local backup_file="$BACKUP_DIR/system_config_latest.tar.gz" if verify_backup "$backup_file"; then log "å¼€å§‹æ¢å¤ç³»ç»Ÿé…ç½®..." # è§£å‹ç³»ç»Ÿé…ç½® sudo tar -xzf "$backup_file" -C / # é‡æ–°åŠ è½½ç³»ç»Ÿé…ç½® sudo sysctl --system log "ç³»ç»Ÿé…ç½®æ¢å¤å®Œæˆ" else log "ç³»ç»Ÿé…ç½®æ¢å¤å¤±è´¥" return 1 fi } # å¯åŠ¨æœåŠ¡ start_services() { log "å¯åŠ¨æ‰€æœ‰æœåŠ¡..." # å¯åŠ¨ Nginx sudo systemctl start nginx # å¯åŠ¨ AI æœåŠ¡ ~/projects/llama.cpp/start-llama.sh # éªŒè¯æœåŠ¡çŠ¶æ€ sleep 10 verify_services } # éªŒè¯æœåŠ¡ verify_services() { local status=0 log "éªŒè¯æœåŠ¡çŠ¶æ€..." # æ£€æŸ¥ Nginx if ! systemctl is-active --quiet nginx; then log "è­¦å‘Š: Nginx æœåŠ¡æœªæ­£å¸¸è¿è¡Œ" status=1 fi # æ£€æŸ¥ AI æœåŠ¡ if ! pgrep -f llama-server > /dev/null; then log "è­¦å‘Š: AI æœåŠ¡æœªæ­£å¸¸è¿è¡Œ" status=1 fi return $status } # ä¸»å‡½æ•° main() { log "å¼€å§‹ç³»ç»Ÿæ¢å¤æµç¨‹..." # åœæ­¢æœåŠ¡ stop_services # æ‰§è¡Œæ¢å¤ if restore_system_config && restore_blog && restore_ai_service; then # å¯åŠ¨æœåŠ¡ start_services if verify_services; then log "ç³»ç»Ÿæ¢å¤æˆåŠŸå®Œæˆ" ~/send_notification.sh "ç³»ç»Ÿæ¢å¤æˆåŠŸå®Œæˆ" "normal" return 0 else log "ç³»ç»Ÿæ¢å¤å®Œæˆï¼Œä½†éƒ¨åˆ†æœåŠ¡å¯èƒ½æœªæ­£å¸¸è¿è¡Œ" ~/send_notification.sh "ç³»ç»Ÿæ¢å¤å®Œæˆï¼Œä½†éœ€è¦æ‰‹åŠ¨æ£€æŸ¥æœåŠ¡çŠ¶æ€" "high" return 1 fi else log "ç³»ç»Ÿæ¢å¤å¤±è´¥" ~/send_notification.sh "ç³»ç»Ÿæ¢å¤å¤±è´¥ï¼Œéœ€è¦æ‰‹åŠ¨å¹²é¢„" "high" return 1 fi } # æ‰§è¡Œæ¢å¤ main äºŒåäº”ã€æ–‡æ¡£ç®¡ç†ç³»ç»Ÿ 1. æ–‡æ¡£ç”Ÿæˆè„šæœ¬ # åˆ›å»ºæ–‡æ¡£ç”Ÿæˆè„šæœ¬ nano ~/generate_docs.sh #!/bin/bash # ~/generate_docs.sh # é…ç½® DOCS_DIR="/home/zhaoxiongzhou/documentation" SCRIPTS_DIR="/home/zhaoxiongzhou" CONFIG_DIR="/etc" LOG_FILE="/var/log/documentation.log" # ç¡®ä¿ç›®å½•å­˜åœ¨ mkdir -p "$DOCS_DIR"/{scripts,configs,logs,maintenance} # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # ç”Ÿæˆè„šæœ¬æ–‡æ¡£ generate_script_docs() { log "ç”Ÿæˆè„šæœ¬æ–‡æ¡£..." for script in "$SCRIPTS_DIR"/*.sh; do if [ -f "$script" ]; then script_name=$(basename "$script") output_file="$DOCS_DIR/scripts/${script_name%.sh}.md" { echo "# $script_name" echo "## è·¯å¾„: $script" echo "## æœ€åä¿®æ”¹: $(date -r "$script" &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo "## æƒé™: $(stat -c &#39;%a&#39; "$script")" echo "## æ‰€æœ‰è€…: $(stat -c &#39;%U:%G&#39; "$script")" echo echo "## åŠŸèƒ½æè¿°" grep -A 5 "^#.*åŠŸèƒ½:" "$script" 2>/dev/null || echo "æœªæä¾›åŠŸèƒ½æè¿°" echo echo "## è„šæœ¬å†…å®¹" echo &#39;```bash&#39; cat "$script" echo &#39;```&#39; echo echo "## ä¾èµ–é¡¹" grep "^[^#]*apt.*install" "$script" 2>/dev/null || echo "æœªæ‰¾åˆ°æ˜ç¡®çš„ä¾èµ–é¡¹" echo echo "## å®šæ—¶ä»»åŠ¡" crontab -l 2>/dev/null | grep "$script_name" || echo "æœªé…ç½®å®šæ—¶ä»»åŠ¡" } > "$output_file" fi done } # ç”Ÿæˆé…ç½®æ–‡æ¡£ generate_config_docs() { log "ç”Ÿæˆé…ç½®æ–‡æ¡£..." # Nginx é…ç½® { echo "# Nginx é…ç½®æ–‡æ¡£" echo "## ä¸»é…ç½®æ–‡ä»¶" echo &#39;```nginx&#39; cat /etc/nginx/nginx.conf echo &#39;```&#39; echo "## ç«™ç‚¹é…ç½®" echo &#39;```nginx&#39; cat /etc/nginx/sites-available/myblog echo &#39;```&#39; } > "$DOCS_DIR/configs/nginx_config.md" # ç³»ç»Ÿé…ç½® { echo "# ç³»ç»Ÿé…ç½®æ–‡æ¡£" echo "## Sysctl é…ç½®" echo &#39;```bash&#39; cat /etc/sysctl.d/99-custom.conf echo &#39;```&#39; echo "## æ ‘è“æ´¾é…ç½®" echo &#39;```bash&#39; cat /boot/config.txt echo &#39;```&#39; } > "$DOCS_DIR/configs/system_config.md" } # ç”Ÿæˆç»´æŠ¤æ–‡æ¡£ generate_maintenance_docs() { log "ç”Ÿæˆç»´æŠ¤æ–‡æ¡£..." { echo "# ç³»ç»Ÿç»´æŠ¤æ–‡æ¡£" echo "## å®šæ—¶ä»»åŠ¡" echo &#39;```bash&#39; crontab -l echo &#39;```&#39; echo "## æœåŠ¡çŠ¶æ€" echo &#39;```bash&#39; systemctl status nginx ps aux | grep llama-server echo &#39;```&#39; echo "## èµ„æºä½¿ç”¨" echo &#39;```bash&#39; df -h free -h top -bn1 echo &#39;```&#39; echo "## æœ€è¿‘æ—¥å¿—" echo &#39;```bash&#39; tail -n 50 /var/log/syslog echo &#39;```&#39; } > "$DOCS_DIR/maintenance/system_status.md" } # ç”Ÿæˆç´¢å¼• generate_index() { log "ç”Ÿæˆæ–‡æ¡£ç´¢å¼•..." { echo "# ç³»ç»Ÿæ–‡æ¡£ç´¢å¼•" echo "## ç”Ÿæˆæ—¶é—´: $(date &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo echo "## è„šæœ¬æ–‡æ¡£" for doc in "$DOCS_DIR/scripts"/*.md; do echo "- [$(basename "${doc%.md}")](scripts/$(basename "$doc"))" done echo echo "## é…ç½®æ–‡æ¡£" for doc in "$DOCS_DIR/configs"/*.md; do echo "- [$(basename "${doc%.md}")](configs/$(basename "$doc"))" done echo echo "## ç»´æŠ¤æ–‡æ¡£" for doc in "$DOCS_DIR/maintenance"/*.md; do echo "- [$(basename "${doc%.md}")](maintenance/$(basename "$doc"))" done } > "$DOCS_DIR/index.md" } # ä¸»å‡½æ•° main() { log "å¼€å§‹ç”Ÿæˆæ–‡æ¡£..." generate_script_docs generate_config_docs generate_maintenance_docs generate_index log "æ–‡æ¡£ç”Ÿæˆå®Œæˆ: $DOCS_DIR" } # æ‰§è¡Œæ–‡æ¡£ç”Ÿæˆ main äºŒåå…­ã€æ€§èƒ½æµ‹è¯•ä¸åŸºå‡†æµ‹è¯• 1. æ€§èƒ½æµ‹è¯•è„šæœ¬ # åˆ›å»ºæ€§èƒ½æµ‹è¯•è„šæœ¬ nano ~/benchmark.sh #!/bin/bash # ~/benchmark.sh # é…ç½® RESULTS_DIR="/home/zhaoxiongzhou/benchmark_results" LOG_FILE="/var/log/benchmark.log" DURATION=300 # æµ‹è¯•æŒç»­æ—¶é—´ï¼ˆç§’ï¼‰ CONCURRENT_USERS=10 # å¹¶å‘ç”¨æˆ·æ•° # ç¡®ä¿ç›®å½•å­˜åœ¨ mkdir -p "$RESULTS_DIR" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # CPU æ€§èƒ½æµ‹è¯• benchmark_cpu() { log "å¼€å§‹ CPU æ€§èƒ½æµ‹è¯•..." # ä½¿ç”¨ sysbench è¿›è¡Œ CPU æµ‹è¯• sysbench cpu --cpu-max-prime=20000 --threads=4 run > "$RESULTS_DIR/cpu_benchmark.txt" # è®°å½• CPU æ¸©åº¦ for i in $(seq 1 10); do vcgencmd measure_temp >> "$RESULTS_DIR/cpu_temp.txt" sleep 1 done } # å†…å­˜æ€§èƒ½æµ‹è¯• benchmark_memory() { log "å¼€å§‹å†…å­˜æ€§èƒ½æµ‹è¯•..." # ä½¿ç”¨ sysbench è¿›è¡Œå†…å­˜æµ‹è¯• sysbench memory --memory-block-size=1K --memory-total-size=10G run > "$RESULTS_DIR/memory_benchmark.txt" } # ç£ç›˜æ€§èƒ½æµ‹è¯• benchmark_disk() { log "å¼€å§‹ç£ç›˜æ€§èƒ½æµ‹è¯•..." # ä½¿ç”¨ dd æµ‹è¯•å†™å…¥é€Ÿåº¦ dd if=/dev/zero of=/tmp/test_file bs=1M count=1000 conv=fdatasync 2>> "$RESULTS_DIR/disk_write_benchmark.txt" # ä½¿ç”¨ dd æµ‹è¯•è¯»å–é€Ÿåº¦ dd if=/tmp/test_file of=/dev/null bs=1M count=1000 2>> "$RESULTS_DIR/disk_read_benchmark.txt" # æ¸…ç†æµ‹è¯•æ–‡ä»¶ rm /tmp/test_file } # ç½‘ç»œæ€§èƒ½æµ‹è¯• benchmark_network() { log "å¼€å§‹ç½‘ç»œæ€§èƒ½æµ‹è¯•..." # ä½¿ç”¨ iperf3 æµ‹è¯•ç½‘ç»œæ€§èƒ½ iperf3 -c iperf.he.net -t 30 > "$RESULTS_DIR/network_benchmark.txt" } # Web æœåŠ¡æ€§èƒ½æµ‹è¯• benchmark_web() { log "å¼€å§‹ Web æœåŠ¡æ€§èƒ½æµ‹è¯•..." # ä½¿ç”¨ ab æµ‹è¯• Web æœåŠ¡ ab -n 1000 -c "$CONCURRENT_USERS" http://localhost/ > "$RESULTS_DIR/web_benchmark.txt" } # AI æœåŠ¡æ€§èƒ½æµ‹è¯• benchmark_ai() { log "å¼€å§‹ AI æœåŠ¡æ€§èƒ½æµ‹è¯•..." # åˆ›å»ºæµ‹è¯•è¯·æ±‚ cat > /tmp/test_prompt.txt << EOF Hello, how are you? EOF # ä½¿ç”¨ curl æµ‹è¯• AI æœåŠ¡å“åº”æ—¶é—´ for i in $(seq 1 10); do time curl -X POST \ -H "Content-Type: application/json" \ -d @/tmp/test_prompt.txt \ http://localhost:8080/completion >> "$RESULTS_DIR/ai_benchmark.txt" 2>&amp;1 echo -e "\n---\n" >> "$RESULTS_DIR/ai_benchmark.txt" sleep 2 done } # ç”ŸæˆæŠ¥å‘Š generate_report() { log "ç”Ÿæˆæ€§èƒ½æµ‹è¯•æŠ¥å‘Š..." local report_file="$RESULTS_DIR/benchmark_report_$(date +%Y%m%d_%H%M%S).md" { echo "# æ€§èƒ½æµ‹è¯•æŠ¥å‘Š" echo "## æµ‹è¯•æ—¶é—´: $(date &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo echo "## ç³»ç»Ÿä¿¡æ¯" echo &#39;```&#39; uname -a echo &#39;```&#39; echo echo "## CPU æ€§èƒ½" echo &#39;```&#39; cat "$RESULTS_DIR/cpu_benchmark.txt" echo &#39;```&#39; echo echo "## å†…å­˜æ€§èƒ½" echo &#39;```&#39; cat "$RESULTS_DIR/memory_benchmark.txt" echo &#39;```&#39; echo echo "## ç£ç›˜æ€§èƒ½" echo &#39;```&#39; cat "$RESULTS_DIR/disk_write_benchmark.txt" cat "$RESULTS_DIR/disk_read_benchmark.txt" echo &#39;```&#39; echo echo "## ç½‘ç»œæ€§èƒ½" echo &#39;```&#39; cat "$RESULTS_DIR/network_benchmark.txt" echo &#39;```&#39; echo echo "## Web æœåŠ¡æ€§èƒ½" echo &#39;```&#39; cat "$RESULTS_DIR/web_benchmark.txt" echo &#39;```&#39; echo echo "## AI æœåŠ¡æ€§èƒ½" echo &#39;```&#39; cat "$RESULTS_DIR/ai_benchmark.txt" echo &#39;```&#39; } > "$report_file" log "æ€§èƒ½æµ‹è¯•æŠ¥å‘Šå·²ç”Ÿæˆ: $report_file" } # ä¸»å‡½æ•° main() { log "å¼€å§‹æ€§èƒ½æµ‹è¯•..." # å®‰è£…å¿…è¦çš„å·¥å…· sudo apt install -y sysbench apache2-utils iperf3 # æ‰§è¡Œå„é¡¹æµ‹è¯• benchmark_cpu benchmark_memory benchmark_disk benchmark_network benchmark_web benchmark_ai # ç”ŸæˆæŠ¥å‘Š generate_report log "æ€§èƒ½æµ‹è¯•å®Œæˆ" } # æ‰§è¡Œæµ‹è¯• main äºŒåä¸ƒã€å®‰å…¨å®¡è®¡ç³»ç»Ÿ 1. å®‰å…¨å®¡è®¡è„šæœ¬ # åˆ›å»ºå®‰å…¨å®¡è®¡è„šæœ¬ nano ~/security_audit.sh #!/bin/bash # ~/security_audit.sh # é…ç½® AUDIT_DIR="/home/zhaoxiongzhou/security_audits" REPORT_FILE="$AUDIT_DIR/security_report_$(date +%Y%m%d_%H%M%S).md" LOG_FILE="/var/log/security_audit.log" # ç¡®ä¿ç›®å½•å­˜åœ¨ mkdir -p "$AUDIT_DIR" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # æ£€æŸ¥ç³»ç»Ÿç”¨æˆ· audit_users() { log "æ£€æŸ¥ç³»ç»Ÿç”¨æˆ·..." { echo "## ç³»ç»Ÿç”¨æˆ·å®¡è®¡" echo "### ç‰¹æƒç”¨æˆ·" echo &#39;```&#39; awk -F: &#39;$3 == 0 {print $1}&#39; /etc/passwd echo &#39;```&#39; echo "### æœ€è¿‘çš„ç”¨æˆ·æ´»åŠ¨" echo &#39;```&#39; last | head -n 10 echo &#39;```&#39; echo "### å¤±è´¥çš„ç™»å½•å°è¯•" echo &#39;```&#39; grep "Failed password" /var/log/auth.log | tail -n 10 echo &#39;```&#39; } >> "$REPORT_FILE" } # æ£€æŸ¥ç½‘ç»œå®‰å…¨ audit_network() { log "æ£€æŸ¥ç½‘ç»œå®‰å…¨..." { echo "## ç½‘ç»œå®‰å…¨å®¡è®¡" echo "### å¼€æ”¾ç«¯å£" echo &#39;```&#39; netstat -tuln echo &#39;```&#39; echo "### æ´»åŠ¨è¿æ¥" echo &#39;```&#39; netstat -nat | grep ESTABLISHED echo &#39;```&#39; echo "### é˜²ç«å¢™è§„åˆ™" echo &#39;```&#39; sudo iptables -L -n echo &#39;```&#39; } >> "$REPORT_FILE" } # æ£€æŸ¥æ–‡ä»¶æƒé™ audit_permissions() { log "æ£€æŸ¥æ–‡ä»¶æƒé™..." { echo "## æ–‡ä»¶æƒé™å®¡è®¡" echo "### SUID æ–‡ä»¶" echo &#39;```&#39; sudo find / -type f -perm -4000 2>/dev/null echo &#39;```&#39; echo "### ä¸–ç•Œå¯å†™æ–‡ä»¶" echo &#39;```&#39; sudo find / -type f -perm -2 ! -path "/proc/*" ! -path "/sys/*" 2>/dev/null echo &#39;```&#39; echo "### æ•æ„Ÿç›®å½•æƒé™" echo &#39;```&#39; ls -la /etc/nginx/ ls -la ~/projects/llama.cpp/ ls -la ~/myblog/ echo &#39;```&#39; } >> "$REPORT_FILE" } # æ£€æŸ¥æœåŠ¡é…ç½® audit_services() { log "æ£€æŸ¥æœåŠ¡é…ç½®..." { echo "## æœåŠ¡é…ç½®å®¡è®¡" echo "### Nginx é…ç½®æ£€æŸ¥" echo &#39;```&#39; sudo nginx -t 2>&amp;1 echo &#39;```&#39; echo "### SSL é…ç½®" echo &#39;```&#39; openssl s_client -connect localhost:443 -servername localhost </dev/null 2>/dev/null | openssl x509 -text echo &#39;```&#39; echo "### æœåŠ¡çŠ¶æ€" echo &#39;```&#39; systemctl list-units --type=service --state=active echo &#39;```&#39; } >> "$REPORT_FILE" } # æ£€æŸ¥ç³»ç»Ÿæ›´æ–° audit_updates() { log "æ£€æŸ¥ç³»ç»Ÿæ›´æ–°..." { echo "## ç³»ç»Ÿæ›´æ–°å®¡è®¡" echo "### å¯ç”¨æ›´æ–°" echo &#39;```&#39; apt list --upgradable 2>/dev/null echo &#39;```&#39; echo "### å·²å®‰è£…åŒ…" echo &#39;```&#39; dpkg -l | grep "^ii" | wc -l echo &#39;```&#39; } >> "$REPORT_FILE" } # æ£€æŸ¥æ—¥å¿—å¼‚å¸¸ audit_logs() { log "æ£€æŸ¥æ—¥å¿—å¼‚å¸¸..." { echo "## æ—¥å¿—å®¡è®¡" echo "### ç³»ç»Ÿé”™è¯¯" echo &#39;```&#39; sudo journalctl -p 3 -xb --no-pager | tail -n 20 echo &#39;```&#39; echo "### å¼‚å¸¸è®¿é—®" echo &#39;```&#39; grep -i "error\|failed\|warning" /var/log/nginx/error.log | tail -n 20 echo &#39;```&#39; } >> "$REPORT_FILE" } # ç”Ÿæˆå®‰å…¨å»ºè®® generate_recommendations() { log "ç”Ÿæˆå®‰å…¨å»ºè®®..." { echo "## å®‰å…¨å»ºè®®" echo "### é«˜ä¼˜å…ˆçº§" # æ£€æŸ¥å¹¶ç”Ÿæˆå»ºè®® if grep -q "Failed password" /var/log/auth.log; then echo "- å»ºè®®ï¼šå¯ç”¨ fail2ban åŠ å¼º SSH é˜²æŠ¤" fi if [ $(find / -type f -perm -2 2>/dev/null | wc -l) -gt 0 ]; then echo "- å»ºè®®ï¼šæ£€æŸ¥å¹¶ä¿®å¤ä¸–ç•Œå¯å†™æ–‡ä»¶æƒé™" fi echo "### ä¸­ä¼˜å…ˆçº§" # æ·»åŠ å…¶ä»–å»ºè®® echo "- å®šæœŸæ›´æ–°ç³»ç»ŸåŒ…" echo "- æ£€æŸ¥å¹¶æ›´æ–° SSL è¯ä¹¦" echo "- å®šæœŸå®¡æŸ¥ç”¨æˆ·æƒé™" } >> "$REPORT_FILE" } # ä¸»å‡½æ•° main() { log "å¼€å§‹å®‰å…¨å®¡è®¡..." # åˆ›å»ºæŠ¥å‘Šå¤´éƒ¨ { echo "# å®‰å…¨å®¡è®¡æŠ¥å‘Š" echo "## ç”Ÿæˆæ—¶é—´: $(date &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo "## ç³»ç»Ÿä¿¡æ¯" echo &#39;```&#39; uname -a echo &#39;```&#39; echo } > "$REPORT_FILE" # æ‰§è¡Œå„é¡¹å®¡è®¡ audit_users audit_network audit_permissions audit_services audit_updates audit_logs generate_recommendations log "å®‰å…¨å®¡è®¡å®Œæˆï¼ŒæŠ¥å‘Šå·²ç”Ÿæˆ: $REPORT_FILE" # å‘é€é€šçŸ¥ ~/send_notification.sh "å®‰å…¨å®¡è®¡æŠ¥å‘Šå·²ç”Ÿæˆ" "normal" } # æ‰§è¡Œå®¡è®¡ main äºŒåå…«ã€èµ„æºé™åˆ¶ä¸æ§åˆ¶ 1. èµ„æºé™åˆ¶é…ç½®è„šæœ¬ # åˆ›å»ºèµ„æºé™åˆ¶é…ç½®è„šæœ¬ nano ~/resource_control.sh #!/bin/bash # ~/resource_control.sh # é…ç½® LOG_FILE="/var/log/resource_control.log" LIMITS_CONF="/etc/security/limits.conf" SYSTEMD_DIR="/etc/systemd/system" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # é…ç½®ç³»ç»Ÿèµ„æºé™åˆ¶ configure_system_limits() { log "é…ç½®ç³»ç»Ÿèµ„æºé™åˆ¶..." # å¤‡ä»½åŸå§‹é…ç½® sudo cp "$LIMITS_CONF" "${LIMITS_CONF}.backup" # æ·»åŠ èµ„æºé™åˆ¶é…ç½® sudo tee -a "$LIMITS_CONF" << EOF # ç”¨æˆ·èµ„æºé™åˆ¶ zhaoxiongzhou soft nofile 65535 zhaoxiongzhou hard nofile 65535 zhaoxiongzhou soft nproc 2048 zhaoxiongzhou hard nproc 4096 # ç³»ç»ŸæœåŠ¡èµ„æºé™åˆ¶ www-data soft nofile 65535 www-data hard nofile 65535 www-data soft nproc 1024 www-data hard nproc 2048 EOF } # é…ç½® AI æœåŠ¡èµ„æºé™åˆ¶ configure_ai_service() { log "é…ç½® AI æœåŠ¡èµ„æºé™åˆ¶..." # åˆ›å»º systemd æœåŠ¡æ–‡ä»¶ sudo tee "$SYSTEMD_DIR/llama-server.service" << EOF [Unit] Description=Llama AI Server After=network.target [Service] User=zhaoxiongzhou Group=zhaoxiongzhou WorkingDirectory=/home/zhaoxiongzhou/projects/llama.cpp ExecStart=/home/zhaoxiongzhou/projects/llama.cpp/start-llama.sh # èµ„æºé™åˆ¶ CPUQuota=80% MemoryLimit=2G TasksMax=128 LimitNOFILE=65535 # é‡å¯ç­–ç•¥ Restart=always RestartSec=10 [Install] WantedBy=multi-user.target EOF # é‡æ–°åŠ è½½ systemd é…ç½® sudo systemctl daemon-reload } # é…ç½® Nginx èµ„æºé™åˆ¶ configure_nginx() { log "é…ç½® Nginx èµ„æºé™åˆ¶..." # ä¿®æ”¹ Nginx é…ç½® sudo tee "/etc/nginx/conf.d/resource_limits.conf" << EOF # å·¥ä½œè¿›ç¨‹é™åˆ¶ worker_processes auto; worker_rlimit_nofile 65535; # è¿æ¥é™åˆ¶ events { worker_connections 1024; multi_accept on; } # å®¢æˆ·ç«¯é™åˆ¶ http { # è¯·æ±‚é™åˆ¶ limit_req_zone \$binary_remote_addr zone=one:10m rate=10r/s; # è¿æ¥é™åˆ¶ limit_conn_zone \$binary_remote_addr zone=addr:10m; server { # åº”ç”¨é™åˆ¶ location / { limit_req zone=one burst=5; limit_conn addr 10; } } } EOF } # é…ç½®ç³»ç»Ÿèµ„æºç›‘æ§ configure_monitoring() { log "é…ç½®èµ„æºç›‘æ§..." # åˆ›å»ºç›‘æ§è„šæœ¬ cat > ~/monitor_resources.sh << EOF #!/bin/bash while true; do # CPU ä½¿ç”¨ç‡ CPU_USAGE=\$(top -bn1 | grep "Cpu(s)" | awk &#39;{print \$2}&#39;) # å†…å­˜ä½¿ç”¨ç‡ MEM_USAGE=\$(free | grep Mem | awk &#39;{print \$3/\$2 * 100.0}&#39;) # è¿›ç¨‹æ•° PROCESS_COUNT=\$(ps aux | wc -l) # æ£€æŸ¥é™åˆ¶ if (( \$(echo "\$CPU_USAGE > 80" | bc -l) )); then ~/send_notification.sh "è­¦å‘Š: CPU ä½¿ç”¨ç‡è¿‡é«˜ (\${CPU_USAGE}%)" "high" fi if (( \$(echo "\$MEM_USAGE > 90" | bc -l) )); then ~/send_notification.sh "è­¦å‘Š: å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜ (\${MEM_USAGE}%)" "high" fi if [ "\$PROCESS_COUNT" -gt 200 ]; then ~/send_notification.sh "è­¦å‘Š: è¿›ç¨‹æ•°è¿‡å¤š (\$PROCESS_COUNT)" "high" fi sleep 60 done EOF chmod +x ~/monitor_resources.sh } # åº”ç”¨é…ç½® apply_configurations() { log "åº”ç”¨èµ„æºé™åˆ¶é…ç½®..." # é‡å¯æœåŠ¡ sudo systemctl restart nginx sudo systemctl restart llama-server # å¯åŠ¨ç›‘æ§ ~/monitor_resources.sh & # éªŒè¯é…ç½® log "éªŒè¯é…ç½®..." sudo nginx -t sudo systemctl status llama-server ulimit -a } # ä¸»å‡½æ•° main() { log "å¼€å§‹é…ç½®èµ„æºé™åˆ¶..." configure_system_limits configure_ai_service configure_nginx configure_monitoring apply_configurations log "èµ„æºé™åˆ¶é…ç½®å®Œæˆ" } # æ‰§è¡Œé…ç½® main äºŒåä¹ã€è‡ªåŠ¨åŒ–æµ‹è¯•ç³»ç»Ÿ 1. é›†æˆæµ‹è¯•è„šæœ¬ # åˆ›å»ºé›†æˆæµ‹è¯•è„šæœ¬ nano ~/integration_test.sh #!/bin/bash # ~/integration_test.sh # é…ç½® TEST_DIR="/home/zhaoxiongzhou/tests" REPORT_DIR="/home/zhaoxiongzhou/test_reports" LOG_FILE="/var/log/integration_test.log" # ç¡®ä¿ç›®å½•å­˜åœ¨ mkdir -p "$TEST_DIR" "$REPORT_DIR" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # æµ‹è¯• Web æœåŠ¡ test_web_service() { log "æµ‹è¯• Web æœåŠ¡..." local result=0 # æµ‹è¯•é¦–é¡µè®¿é—® if curl -s -o /dev/null -w "%{http_code}" http://localhost/ | grep -q "200"; then log "é¦–é¡µè®¿é—®æµ‹è¯•é€šè¿‡" else log "é”™è¯¯: é¦–é¡µè®¿é—®æµ‹è¯•å¤±è´¥" result=1 fi # æµ‹è¯•é™æ€èµ„æº if curl -s -o /dev/null -w "%{http_code}" http://localhost/css/main.css | grep -q "200"; then log "é™æ€èµ„æºæµ‹è¯•é€šè¿‡" else log "é”™è¯¯: é™æ€èµ„æºæµ‹è¯•å¤±è´¥" result=1 fi # æµ‹è¯• 404 é¡µé¢ if curl -s -o /dev/null -w "%{http_code}" http://localhost/nonexistent | grep -q "404"; then log "404 é¡µé¢æµ‹è¯•é€šè¿‡" else log "é”™è¯¯: 404 é¡µé¢æµ‹è¯•å¤±è´¥" result=1 fi return $result } # æµ‹è¯• AI æœåŠ¡ test_ai_service() { log "æµ‹è¯• AI æœåŠ¡..." local result=0 # æµ‹è¯•æœåŠ¡å¯ç”¨æ€§ if curl -s -o /dev/null -w "%{http_code}" http://localhost:8080/health | grep -q "200"; then log "AI æœåŠ¡å¥åº·æ£€æŸ¥é€šè¿‡" else log "é”™è¯¯: AI æœåŠ¡å¥åº·æ£€æŸ¥å¤±è´¥" result=1 fi # æµ‹è¯•æ¨¡å‹å“åº” local response=$(curl -s -X POST \ -H "Content-Type: application/json" \ -d &#39;{"prompt": "Hello", "max_tokens": 10}&#39; \ http://localhost:8080/completion) if echo "$response" | grep -q "text"; then log "AI æœåŠ¡å“åº”æµ‹è¯•é€šè¿‡" else log "é”™è¯¯: AI æœåŠ¡å“åº”æµ‹è¯•å¤±è´¥" result=1 fi return $result } # æµ‹è¯•ç³»ç»ŸæœåŠ¡ test_system_services() { log "æµ‹è¯•ç³»ç»ŸæœåŠ¡..." local result=0 # æµ‹è¯• Nginx çŠ¶æ€ if systemctl is-active --quiet nginx; then log "Nginx æœåŠ¡æµ‹è¯•é€šè¿‡" else log "é”™è¯¯: Nginx æœåŠ¡æµ‹è¯•å¤±è´¥" result=1 fi # æµ‹è¯•ç³»ç»Ÿèµ„æº local cpu_usage=$(top -bn1 | grep "Cpu(s)" | awk &#39;{print $2}&#39;) local mem_usage=$(free | grep Mem | awk &#39;{print $3/$2 * 100.0}&#39;) if [ $(echo "$cpu_usage < 90" | bc -l) -eq 1 ]; then log "CPU ä½¿ç”¨ç‡æ­£å¸¸" else log "è­¦å‘Š: CPU ä½¿ç”¨ç‡è¿‡é«˜" result=1 fi if [ $(echo "$mem_usage < 90" | bc -l) -eq 1 ]; then log "å†…å­˜ä½¿ç”¨ç‡æ­£å¸¸" else log "è­¦å‘Š: å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜" result=1 fi return $result } # ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š generate_report() { local web_result=$1 local ai_result=$2 local system_result=$3 local report_file="$REPORT_DIR/test_report_$(date +%Y%m%d_%H%M%S).md" { echo "# é›†æˆæµ‹è¯•æŠ¥å‘Š" echo "## æµ‹è¯•æ—¶é—´: $(date &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo echo "## æµ‹è¯•ç»“æœæ‘˜è¦" echo "- Web æœåŠ¡: $([ $web_result -eq 0 ] && echo &#39;é€šè¿‡ âœ…&#39; || echo &#39;å¤±è´¥ âŒ&#39;)" echo "- AI æœåŠ¡: $([ $ai_result -eq 0 ] && echo &#39;é€šè¿‡ âœ…&#39; || echo &#39;å¤±è´¥ âŒ&#39;)" echo "- ç³»ç»ŸæœåŠ¡: $([ $system_result -eq 0 ] && echo &#39;é€šè¿‡ âœ…&#39; || echo &#39;å¤±è´¥ âŒ&#39;)" echo echo "## è¯¦ç»†æ—¥å¿—" echo &#39;```&#39; tail -n 50 "$LOG_FILE" echo &#39;```&#39; } > "$report_file" log "æµ‹è¯•æŠ¥å‘Šå·²ç”Ÿæˆ: $report_file" } # ä¸»å‡½æ•° main() { log "å¼€å§‹é›†æˆæµ‹è¯•..." local web_result=0 local ai_result=0 local system_result=0 # æ‰§è¡Œæµ‹è¯• test_web_service web_result=$? test_ai_service ai_result=$? test_system_services system_result=$? # ç”ŸæˆæŠ¥å‘Š generate_report $web_result $ai_result $system_result # å‘é€é€šçŸ¥ if [ $web_result -eq 0 ] && [ $ai_result -eq 0 ] && [ $system_result -eq 0 ]; then ~/send_notification.sh "é›†æˆæµ‹è¯•å…¨éƒ¨é€šè¿‡" "normal" else ~/send_notification.sh "é›†æˆæµ‹è¯•å­˜åœ¨å¤±è´¥é¡¹ï¼Œè¯·æŸ¥çœ‹æŠ¥å‘Š" "high" fi # è¿”å›æ€»ä½“ç»“æœ return $(( web_result + ai_result + system_result )) } # æ‰§è¡Œæµ‹è¯• main ä¸‰åã€ç³»ç»ŸçŠ¶æ€ä»ªè¡¨æ¿ 1. çŠ¶æ€ç›‘æ§é¡µé¢ç”Ÿæˆè„šæœ¬ # åˆ›å»ºçŠ¶æ€é¡µé¢ç”Ÿæˆè„šæœ¬ nano ~/generate_dashboard.sh #!/bin/bash # ~/generate_dashboard.sh # é…ç½® DASHBOARD_DIR="/var/www/html/dashboard" REFRESH_INTERVAL=60 # é¡µé¢åˆ·æ–°é—´éš”ï¼ˆç§’ï¼‰ LOG_FILE="/var/log/dashboard.log" # ç¡®ä¿ç›®å½•å­˜åœ¨ sudo mkdir -p "$DASHBOARD_DIR" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # æ”¶é›†ç³»ç»ŸçŠ¶æ€æ•°æ® collect_system_data() { # CPU ä¿¡æ¯ CPU_USAGE=$(top -bn1 | grep "Cpu(s)" | awk &#39;{print $2}&#39;) CPU_TEMP=$(vcgencmd measure_temp | sed &#39;s/temp=//&#39; | sed &#39;s/&#39;"&#39;"&#39;C//&#39;) # å†…å­˜ä¿¡æ¯ MEM_TOTAL=$(free -m | awk &#39;/Mem:/ {print $2}&#39;) MEM_USED=$(free -m | awk &#39;/Mem:/ {print $3}&#39;) MEM_USAGE=$(awk "BEGIN {printf \"%.2f\", $MEM_USED/$MEM_TOTAL*100}") # ç£ç›˜ä¿¡æ¯ DISK_USAGE=$(df -h / | awk &#39;NR==2 {print $5}&#39; | sed &#39;s/%//&#39;) # ç³»ç»Ÿè´Ÿè½½ LOAD_AVG=$(uptime | awk -F&#39;load average:&#39; &#39;{print $2}&#39; | xargs) # è¿è¡Œæ—¶é—´ UPTIME=$(uptime -p) } # æ”¶é›†æœåŠ¡çŠ¶æ€ collect_service_data() { # Nginx çŠ¶æ€ if systemctl is-active --quiet nginx; then NGINX_STATUS="è¿è¡Œä¸­ âœ…" else NGINX_STATUS="å·²åœæ­¢ âŒ" fi # AI æœåŠ¡çŠ¶æ€ if pgrep -f llama-server > /dev/null; then AI_STATUS="è¿è¡Œä¸­ âœ…" else AI_STATUS="å·²åœæ­¢ âŒ" fi # è·å–æœ€è¿‘çš„æ—¥å¿— RECENT_LOGS=$(tail -n 10 /var/log/syslog | sed &#39;s/</\&amp;lt;/g&#39; | sed &#39;s/>/\&amp;gt;/g&#39;) } # ç”ŸæˆçŠ¶æ€é¡µé¢ generate_dashboard() { local timestamp=$(date &#39;+%Y-%m-%d %H:%M:%S&#39;) cat > "$DASHBOARD_DIR/index.html" << EOF <!DOCTYPE html> <html lang="zh"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>ç³»ç»ŸçŠ¶æ€ä»ªè¡¨æ¿</title> <meta http-equiv="refresh" content="$REFRESH_INTERVAL"> <style> body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; } .container { max-width: 1200px; margin: 0 auto; } .card { background: white; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); } .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; } .metric { text-align: center; padding: 15px; border-radius: 4px; background: #f8f9fa; } .metric h3 { margin: 0; color: #666; } .metric .value { font-size: 24px; font-weight: bold; margin: 10px 0; } .status { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee; } .logs { background: #2b2b2b; color: #fff; padding: 15px; border-radius: 4px; font-family: monospace; white-space: pre-wrap; } </style> </head> <body> <div class="container"> <h1>ç³»ç»ŸçŠ¶æ€ä»ªè¡¨æ¿</h1> <p>æœ€åæ›´æ–°: $timestamp</p> <div class="card"> <h2>ç³»ç»Ÿèµ„æº</h2> <div class="grid"> <div class="metric"> <h3>CPU ä½¿ç”¨ç‡</h3> <div class="value">$CPU_USAGE%</div> </div> <div class="metric"> <h3>CPU æ¸©åº¦</h3> <div class="value">$CPU_TEMP</div> </div> <div class="metric"> <h3>å†…å­˜ä½¿ç”¨ç‡</h3> <div class="value">$MEM_USAGE%</div> </div> <div class="metric"> <h3>ç£ç›˜ä½¿ç”¨ç‡</h3> <div class="value">$DISK_USAGE%</div> </div> </div> </div> <div class="card"> <h2>ç³»ç»Ÿä¿¡æ¯</h2> <div class="status"> <span>ç³»ç»Ÿè´Ÿè½½:</span> <span>$LOAD_AVG</span> </div> <div class="status"> <span>è¿è¡Œæ—¶é—´:</span> <span>$UPTIME</span> </div> </div> <div class="card"> <h2>æœåŠ¡çŠ¶æ€</h2> <div class="status"> <span>Nginx æœåŠ¡:</span> <span>$NGINX_STATUS</span> </div> <div class="status"> <span>AI æœåŠ¡:</span> <span>$AI_STATUS</span> </div> </div> <div class="card"> <h2>æœ€è¿‘æ—¥å¿—</h2> <div class="logs">$RECENT_LOGS</div> </div> </div> </body> </html> EOF # è®¾ç½®æƒé™ sudo chown www-data:www-data "$DASHBOARD_DIR/index.html" } # ä¸»å‡½æ•° main() { log "å¼€å§‹ç”ŸæˆçŠ¶æ€ä»ªè¡¨æ¿..." # æ”¶é›†æ•°æ® collect_system_data collect_service_data # ç”Ÿæˆé¡µé¢ generate_dashboard log "çŠ¶æ€ä»ªè¡¨æ¿å·²æ›´æ–°" } # æ‰§è¡Œç”Ÿæˆ main ä¸‰åä¸€ã€ç³»ç»Ÿå¤‡ä»½ä¸æ¢å¤å®Œæ•´æ–¹æ¡ˆ 1. å®Œæ•´å¤‡ä»½è„šæœ¬ # åˆ›å»ºå®Œæ•´å¤‡ä»½è„šæœ¬ nano ~/full_backup.sh #!/bin/bash # ~/full_backup.sh # é…ç½® BACKUP_ROOT="/mnt/backup_drive" BACKUP_DIR="$BACKUP_ROOT/system_backups" EXCLUDE_FILE="/home/zhaoxiongzhou/backup_exclude.txt" LOG_FILE="/var/log/backup.log" RETENTION_DAYS=30 COMPRESSION_LEVEL=6 # ç¡®ä¿å¤‡ä»½ç›®å½•å­˜åœ¨ mkdir -p "$BACKUP_DIR" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # æ£€æŸ¥å¤‡ä»½ç¯å¢ƒ check_environment() { log "æ£€æŸ¥å¤‡ä»½ç¯å¢ƒ..." # æ£€æŸ¥å¤‡ä»½ç›®æ ‡ç›®å½• if ! mountpoint -q "$BACKUP_ROOT"; then log "é”™è¯¯: å¤‡ä»½é©±åŠ¨å™¨æœªæŒ‚è½½" return 1 fi # æ£€æŸ¥å¯ç”¨ç©ºé—´ local available_space=$(df -BG "$BACKUP_ROOT" | awk &#39;NR==2 {print $4}&#39; | sed &#39;s/G//&#39;) if [ "$available_space" -lt 10 ]; then log "é”™è¯¯: å¤‡ä»½ç©ºé—´ä¸è¶³ï¼ˆå°äº 10GBï¼‰" return 1 fi # åˆ›å»ºæ’é™¤æ–‡ä»¶ cat > "$EXCLUDE_FILE" << EOF /proc/* /sys/* /tmp/* /run/* /mnt/* /media/* /lost+found /var/cache/* /var/tmp/* /var/log/* /home/*/Downloads/* /home/*/.cache/* EOF return 0 } # åœæ­¢æœåŠ¡ stop_services() { log "åœæ­¢æœåŠ¡..." # åœæ­¢ Nginx sudo systemctl stop nginx # åœæ­¢ AI æœåŠ¡ pkill llama-server # ç­‰å¾…æœåŠ¡å®Œå…¨åœæ­¢ sleep 5 } # å¯åŠ¨æœåŠ¡ start_services() { log "å¯åŠ¨æœåŠ¡..." # å¯åŠ¨ Nginx sudo systemctl start nginx # å¯åŠ¨ AI æœåŠ¡ ~/projects/llama.cpp/start-llama.sh # éªŒè¯æœåŠ¡çŠ¶æ€ sleep 10 if ! systemctl is-active --quiet nginx; then log "è­¦å‘Š: Nginx æœåŠ¡æœªèƒ½æ­£å¸¸å¯åŠ¨" fi if ! pgrep -f llama-server > /dev/null; then log "è­¦å‘Š: AI æœåŠ¡æœªèƒ½æ­£å¸¸å¯åŠ¨" fi } # åˆ›å»ºå®Œæ•´å¤‡ä»½ create_full_backup() { local backup_date=$(date +%Y%m%d_%H%M%S) local backup_file="$BACKUP_DIR/full_backup_${backup_date}.tar.gz" local manifest_file="$BACKUP_DIR/backup_manifest_${backup_date}.txt" log "å¼€å§‹åˆ›å»ºå®Œæ•´å¤‡ä»½..." # åˆ›å»ºæ–‡ä»¶æ¸…å• log "ç”Ÿæˆæ–‡ä»¶æ¸…å•..." find / -xdev -type f ! -path "$(cat $EXCLUDE_FILE | tr &#39;\n&#39; &#39;|&#39;)" > "$manifest_file" # åˆ›å»ºå¤‡ä»½ log "åˆ›å»ºç³»ç»Ÿå¤‡ä»½..." sudo tar -czf "$backup_file" \ --exclude-from="$EXCLUDE_FILE" \ --one-file-system \ --preserve-permissions \ --numeric-owner \ --checkpoint=1000 \ --checkpoint-action=dot \ -C / . # éªŒè¯å¤‡ä»½ if ! tar -tzf "$backup_file" >/dev/null 2>&amp;1; then log "é”™è¯¯: å¤‡ä»½æ–‡ä»¶éªŒè¯å¤±è´¥" return 1 fi # è®¡ç®—æ ¡éªŒå’Œ log "è®¡ç®—æ ¡éªŒå’Œ..." sha256sum "$backup_file" > "${backup_file}.sha256" # åˆ›å»ºå¤‡ä»½ä¿¡æ¯æ–‡ä»¶ cat > "${backup_file}.info" << EOF å¤‡ä»½æ—¶é—´: $(date) ç³»ç»Ÿç‰ˆæœ¬: $(cat /etc/os-release | grep PRETTY_NAME) å†…æ ¸ç‰ˆæœ¬: $(uname -r) å¤‡ä»½å¤§å°: $(du -h "$backup_file" | cut -f1) æ–‡ä»¶æ•°é‡: $(wc -l < "$manifest_file") æ’é™¤è§„åˆ™: $(cat "$EXCLUDE_FILE") EOF return 0 } # æ¸…ç†æ—§å¤‡ä»½ cleanup_old_backups() { log "æ¸…ç†æ—§å¤‡ä»½..." find "$BACKUP_DIR" -type f -name "full_backup_*" -mtime +$RETENTION_DAYS -delete find "$BACKUP_DIR" -type f -name "backup_manifest_*" -mtime +$RETENTION_DAYS -delete find "$BACKUP_DIR" -type f -name "*.sha256" -mtime +$RETENTION_DAYS -delete find "$BACKUP_DIR" -type f -name "*.info" -mtime +$RETENTION_DAYS -delete } # ä¸»å‡½æ•° main() { log "å¼€å§‹å®Œæ•´å¤‡ä»½æµç¨‹..." # æ£€æŸ¥ç¯å¢ƒ if ! check_environment; then log "å¤‡ä»½ç¯å¢ƒæ£€æŸ¥å¤±è´¥ï¼Œç»ˆæ­¢å¤‡ä»½" ~/send_notification.sh "ç³»ç»Ÿå¤‡ä»½å¤±è´¥ï¼šç¯å¢ƒæ£€æŸ¥æœªé€šè¿‡" "high" return 1 fi # åœæ­¢æœåŠ¡ stop_services # åˆ›å»ºå¤‡ä»½ if create_full_backup; then log "å¤‡ä»½åˆ›å»ºæˆåŠŸ" ~/send_notification.sh "ç³»ç»Ÿå®Œæ•´å¤‡ä»½å·²æˆåŠŸåˆ›å»º" "normal" else log "å¤‡ä»½åˆ›å»ºå¤±è´¥" ~/send_notification.sh "ç³»ç»Ÿå¤‡ä»½å¤±è´¥ï¼šå¤‡ä»½åˆ›å»ºè¿‡ç¨‹å‡ºé”™" "high" fi # å¯åŠ¨æœåŠ¡ start_services # æ¸…ç†æ—§å¤‡ä»½ cleanup_old_backups log "å¤‡ä»½æµç¨‹å®Œæˆ" } # æ‰§è¡Œå¤‡ä»½ main ä¸‰åäºŒã€ç³»ç»Ÿæ¢å¤è„šæœ¬ 1. ç³»ç»Ÿæ¢å¤è„šæœ¬ # åˆ›å»ºç³»ç»Ÿæ¢å¤è„šæœ¬ nano ~/system_restore.sh #!/bin/bash # ~/system_restore.sh # é…ç½® BACKUP_ROOT="/mnt/backup_drive" BACKUP_DIR="$BACKUP_ROOT/system_backups" LOG_FILE="/var/log/restore.log" TEMP_DIR="/tmp/restore_temp" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # éªŒè¯å¤‡ä»½æ–‡ä»¶ verify_backup() { local backup_file="$1" log "éªŒè¯å¤‡ä»½æ–‡ä»¶: $backup_file" # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ if [ ! -f "$backup_file" ]; then log "é”™è¯¯: å¤‡ä»½æ–‡ä»¶ä¸å­˜åœ¨" return 1 fi # æ£€æŸ¥æ ¡éªŒå’Œ local checksum_file="${backup_file}.sha256" if [ -f "$checksum_file" ]; then if ! sha256sum -c "$checksum_file"; then log "é”™è¯¯: å¤‡ä»½æ–‡ä»¶æ ¡éªŒå’ŒéªŒè¯å¤±è´¥" return 1 fi else log "è­¦å‘Š: æœªæ‰¾åˆ°æ ¡éªŒå’Œæ–‡ä»¶" fi # æµ‹è¯•å½’æ¡£å®Œæ•´æ€§ if ! tar -tzf "$backup_file" >/dev/null 2>&amp;1; then log "é”™è¯¯: å¤‡ä»½æ–‡ä»¶æŸå" return 1 fi return 0 } # å‡†å¤‡æ¢å¤ç¯å¢ƒ prepare_environment() { log "å‡†å¤‡æ¢å¤ç¯å¢ƒ..." # åˆ›å»ºä¸´æ—¶ç›®å½• mkdir -p "$TEMP_DIR" # åœæ­¢æ‰€æœ‰æœåŠ¡ log "åœæ­¢æœåŠ¡..." sudo systemctl stop nginx pkill llama-server # ç­‰å¾…æœåŠ¡åœæ­¢ sleep 5 # æ¸…ç†ç›®æ ‡ç›®å½• log "æ¸…ç†ç›®æ ‡ç›®å½•..." read -p "è­¦å‘Š: è¿™å°†æ¸…é™¤ç³»ç»Ÿæ–‡ä»¶ã€‚ç¡®å®šè¦ç»§ç»­å—ï¼Ÿ(y/n) " -n 1 -r echo if [[ ! $REPLY =~ ^[Yy]$ ]]; then log "ç”¨æˆ·å–æ¶ˆæ“ä½œ" return 1 fi return 0 } # æ‰§è¡Œæ¢å¤ perform_restore() { local backup_file="$1" log "å¼€å§‹æ¢å¤ç³»ç»Ÿ..." # åˆ›å»ºæ¢å¤å‰çš„å¿«ç…§ log "åˆ›å»ºå½“å‰ç³»ç»Ÿå¿«ç…§..." local snapshot_date=$(date +%Y%m%d_%H%M%S) local snapshot_file="$BACKUP_DIR/pre_restore_snapshot_${snapshot_date}.tar.gz" sudo tar -czf "$snapshot_file" \ --exclude-from="/home/zhaoxiongzhou/backup_exclude.txt" \ --one-file-system \ -C / . # è§£å‹å¤‡ä»½ log "è§£å‹å¤‡ä»½æ–‡ä»¶..." sudo tar -xzf "$backup_file" -C / \ --numeric-owner \ --preserve-permissions \ --checkpoint=1000 \ --checkpoint-action=dot # ä¿®å¤æƒé™ log "ä¿®å¤æ–‡ä»¶æƒé™..." sudo chown -R www-data:www-data /var/www/ sudo chown -R zhaoxiongzhou:zhaoxiongzhou /home/zhaoxiongzhou/ return 0 } # æ¢å¤æœåŠ¡é…ç½® restore_configurations() { log "æ¢å¤æœåŠ¡é…ç½®..." # é‡æ–°åŠ è½½ç³»ç»Ÿé…ç½® sudo systemctl daemon-reload sudo sysctl --system # é‡æ–°é…ç½®ç½‘ç»œ sudo systemctl restart networking # æ¢å¤é˜²ç«å¢™è§„åˆ™ sudo iptables-restore < /etc/iptables/rules.v4 return 0 } # éªŒè¯æ¢å¤ verify_restore() { log "éªŒè¯ç³»ç»Ÿæ¢å¤..." local status=0 # æ£€æŸ¥å…³é”®æ–‡ä»¶ for file in "/etc/nginx/nginx.conf" "/etc/systemd/system/llama-server.service"; do if [ ! -f "$file" ]; then log "é”™è¯¯: æœªæ‰¾åˆ°å…³é”®æ–‡ä»¶ $file" status=1 fi done # å¯åŠ¨æœåŠ¡ sudo systemctl start nginx ~/projects/llama.cpp/start-llama.sh # éªŒè¯æœåŠ¡çŠ¶æ€ sleep 10 if ! systemctl is-active --quiet nginx; then log "é”™è¯¯: Nginx æœåŠ¡æœªèƒ½æ­£å¸¸å¯åŠ¨" status=1 fi if ! pgrep -f llama-server > /dev/null; then log "é”™è¯¯: AI æœåŠ¡æœªèƒ½æ­£å¸¸å¯åŠ¨" status=1 fi return $status } # æ¸…ç†æ¢å¤ç¯å¢ƒ cleanup() { log "æ¸…ç†æ¢å¤ç¯å¢ƒ..." # åˆ é™¤ä¸´æ—¶æ–‡ä»¶ rm -rf "$TEMP_DIR" # æ¸…ç†æ—¥å¿— find /var/log -type f -name "*.gz" -delete return 0 } # ä¸»å‡½æ•° main() { local backup_file # åˆ—å‡ºå¯ç”¨å¤‡ä»½ echo "å¯ç”¨çš„å¤‡ä»½æ–‡ä»¶:" ls -lh "$BACKUP_DIR"/full_backup_*.tar.gz # é€‰æ‹©å¤‡ä»½æ–‡ä»¶ read -p "è¯·è¾“å…¥è¦æ¢å¤çš„å¤‡ä»½æ–‡ä»¶å®Œæ•´è·¯å¾„: " backup_file # éªŒè¯å¤‡ä»½ if ! verify_backup "$backup_file"; then log "å¤‡ä»½éªŒè¯å¤±è´¥ï¼Œç»ˆæ­¢æ¢å¤" return 1 fi # å‡†å¤‡ç¯å¢ƒ if ! prepare_environment; then log "ç¯å¢ƒå‡†å¤‡å¤±è´¥ï¼Œç»ˆæ­¢æ¢å¤" return 1 fi # æ‰§è¡Œæ¢å¤ if perform_restore "$backup_file" && \ restore_configurations && \ verify_restore; then log "ç³»ç»Ÿæ¢å¤æˆåŠŸå®Œæˆ" ~/send_notification.sh "ç³»ç»Ÿæ¢å¤æˆåŠŸå®Œæˆ" "normal" else log "ç³»ç»Ÿæ¢å¤å¤±è´¥" ~/send_notification.sh "ç³»ç»Ÿæ¢å¤å¤±è´¥ï¼Œéœ€è¦æ‰‹åŠ¨æ£€æŸ¥" "high" fi # æ¸…ç†ç¯å¢ƒ cleanup } # æ‰§è¡Œæ¢å¤ main ä¸‰åä¸‰ã€ç³»ç»Ÿè¿ç§»å·¥å…· 1. ç³»ç»Ÿè¿ç§»è„šæœ¬ # åˆ›å»ºç³»ç»Ÿè¿ç§»è„šæœ¬ nano ~/system_migration.sh #!/bin/bash # ~/system_migration.sh # é…ç½® SOURCE_HOST="old-raspberry.local" TARGET_HOST="new-raspberry.local" MIGRATION_DIR="/mnt/migration" LOG_FILE="/var/log/migration.log" SSH_KEY="~/.ssh/migration_key" RSYNC_OPTS="-avz --progress --delete" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # æ£€æŸ¥è¿ç§»ç¯å¢ƒ check_migration_env() { log "æ£€æŸ¥è¿ç§»ç¯å¢ƒ..." # æ£€æŸ¥ SSH å¯†é’¥ if [ ! -f "$SSH_KEY" ]; then log "ç”Ÿæˆ SSH å¯†é’¥..." ssh-keygen -t ed25519 -f "$SSH_KEY" -N "" # å¤åˆ¶å¯†é’¥åˆ°ç›®æ ‡ä¸»æœº ssh-copy-id -i "$SSH_KEY" "zhaoxiongzhou@$TARGET_HOST" fi # æ£€æŸ¥å¿…è¦å·¥å…· for tool in rsync ssh scp; do if ! command -v $tool &>/dev/null; then log "é”™è¯¯: æœªæ‰¾åˆ°å¿…è¦å·¥å…· $tool" return 1 fi done # æ£€æŸ¥ç›®æ ‡ä¸»æœºè¿æ¥ if ! ssh -i "$SSH_KEY" "zhaoxiongzhou@$TARGET_HOST" "echo &#39;Connection test&#39;" &>/dev/null; then log "é”™è¯¯: æ— æ³•è¿æ¥åˆ°ç›®æ ‡ä¸»æœº" return 1 fi return 0 } # è¿ç§»é…ç½®æ–‡ä»¶ migrate_configs() { log "è¿ç§»é…ç½®æ–‡ä»¶..." # åˆ›å»ºé…ç½®ç›®å½• ssh -i "$SSH_KEY" "zhaoxiongzhou@$TARGET_HOST" "mkdir -p ~/configs_backup" # è¿ç§» Nginx é…ç½® rsync $RSYNC_OPTS -e "ssh -i $SSH_KEY" \ /etc/nginx/ \ "zhaoxiongzhou@$TARGET_HOST:~/configs_backup/nginx/" # è¿ç§»ç³»ç»Ÿé…ç½® rsync $RSYNC_OPTS -e "ssh -i $SSH_KEY" \ /etc/sysctl.d/ \ "zhaoxiongzhou@$TARGET_HOST:~/configs_backup/sysctl/" # è¿ç§»æœåŠ¡é…ç½® rsync $RSYNC_OPTS -e "ssh -i $SSH_KEY" \ /etc/systemd/system/ \ "zhaoxiongzhou@$TARGET_HOST:~/configs_backup/systemd/" } # è¿ç§»æ•°æ® migrate_data() { log "è¿ç§»æ•°æ®..." # è¿ç§»åšå®¢æ•°æ® rsync $RSYNC_OPTS -e "ssh -i $SSH_KEY" \ ~/myblog/ \ "zhaoxiongzhou@$TARGET_HOST:~/myblog/" # è¿ç§» AI æœåŠ¡æ•°æ® rsync $RSYNC_OPTS -e "ssh -i $SSH_KEY" \ ~/projects/llama.cpp/ \ "zhaoxiongzhou@$TARGET_HOST:~/projects/llama.cpp/" # è¿ç§»ç”¨æˆ·è„šæœ¬ rsync $RSYNC_OPTS -e "ssh -i $SSH_KEY" \ ~/*.sh \ "zhaoxiongzhou@$TARGET_HOST:~/" } # è¿ç§»æ•°æ®åº“ migrate_database() { log "è¿ç§»æ•°æ®åº“..." # å¯¼å‡ºæ•°æ®åº“ local dump_file="/tmp/database_dump.sql" if [ -f "/var/lib/mysql" ]; then mysqldump --all-databases > "$dump_file" # ä¼ è¾“åˆ°ç›®æ ‡ä¸»æœº scp -i "$SSH_KEY" "$dump_file" "zhaoxiongzhou@$TARGET_HOST:/tmp/" # åœ¨ç›®æ ‡ä¸»æœºå¯¼å…¥æ•°æ®åº“ ssh -i "$SSH_KEY" "zhaoxiongzhou@$TARGET_HOST" \ "mysql < /tmp/database_dump.sql" fi } # é…ç½®ç›®æ ‡ç³»ç»Ÿ configure_target() { log "é…ç½®ç›®æ ‡ç³»ç»Ÿ..." ssh -i "$SSH_KEY" "zhaoxiongzhou@$TARGET_HOST" "bash -s" << &#39;EOF&#39; # å®‰è£…å¿…è¦è½¯ä»¶ sudo apt update sudo apt install -y nginx mysql-server python3 pip # æ¢å¤é…ç½® sudo cp -r ~/configs_backup/nginx/* /etc/nginx/ sudo cp -r ~/configs_backup/sysctl/* /etc/sysctl.d/ sudo cp -r ~/configs_backup/systemd/* /etc/systemd/system/ # è®¾ç½®æƒé™ sudo chown -R www-data:www-data /var/www/ sudo chmod +x ~/*.sh # é‡å¯æœåŠ¡ sudo systemctl daemon-reload sudo systemctl restart nginx EOF } # éªŒè¯è¿ç§» verify_migration() { log "éªŒè¯è¿ç§»..." local status=0 # æ£€æŸ¥æœåŠ¡çŠ¶æ€ ssh -i "$SSH_KEY" "zhaoxiongzhou@$TARGET_HOST" "bash -s" << &#39;EOF&#39; # æ£€æŸ¥ Nginx if ! systemctl is-active --quiet nginx; then echo "é”™è¯¯: Nginx æœåŠ¡æœªè¿è¡Œ" exit 1 fi # æ£€æŸ¥æ–‡ä»¶ for dir in "~/myblog" "~/projects/llama.cpp"; do if [ ! -d "$dir" ]; then echo "é”™è¯¯: ç›®å½• $dir ä¸å­˜åœ¨" exit 1 fi done # æ£€æŸ¥é…ç½® if ! nginx -t &>/dev/null; then echo "é”™è¯¯: Nginx é…ç½®æ— æ•ˆ" exit 1 fi EOF status=$? return $status } # ä¸»å‡½æ•° main() { log "å¼€å§‹ç³»ç»Ÿè¿ç§»..." # æ£€æŸ¥ç¯å¢ƒ if ! check_migration_env; then log "è¿ç§»ç¯å¢ƒæ£€æŸ¥å¤±è´¥" return 1 fi # æ‰§è¡Œè¿ç§» migrate_configs migrate_data migrate_database configure_target # éªŒè¯è¿ç§» if verify_migration; then log "ç³»ç»Ÿè¿ç§»æˆåŠŸå®Œæˆ" ~/send_notification.sh "ç³»ç»Ÿè¿ç§»æˆåŠŸå®Œæˆ" "normal" else log "ç³»ç»Ÿè¿ç§»å¤±è´¥" ~/send_notification.sh "ç³»ç»Ÿè¿ç§»å¤±è´¥ï¼Œéœ€è¦æ‰‹åŠ¨æ£€æŸ¥" "high" fi } # æ‰§è¡Œè¿ç§» main ä¸‰åå››ã€æ—¥å¿—åˆ†æå·¥å…· 1. æ—¥å¿—åˆ†æè„šæœ¬ # åˆ›å»ºæ—¥å¿—åˆ†æè„šæœ¬ nano ~/log_analyzer.sh #!/bin/bash # ~/log_analyzer.sh # é…ç½® LOG_DIRS=( "/var/log" "/var/log/nginx" "/home/zhaoxiongzhou/logs" ) REPORT_DIR="/home/zhaoxiongzhou/log_reports" LOG_FILE="/var/log/analyzer.log" ALERT_THRESHOLD=100 # é”™è¯¯æ—¥å¿—é˜ˆå€¼ RETENTION_DAYS=30 # æŠ¥å‘Šä¿ç•™å¤©æ•° # ç¡®ä¿ç›®å½•å­˜åœ¨ mkdir -p "$REPORT_DIR" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # åˆ†æç³»ç»Ÿæ—¥å¿— analyze_system_logs() { log "åˆ†æç³»ç»Ÿæ—¥å¿—..." local report_file="$REPORT_DIR/system_log_report_$(date +%Y%m%d).md" { echo "# ç³»ç»Ÿæ—¥å¿—åˆ†ææŠ¥å‘Š" echo "## ç”Ÿæˆæ—¶é—´: $(date &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo echo "## ç³»ç»Ÿé”™è¯¯ç»Ÿè®¡" echo "### ä¸¥é‡é”™è¯¯" echo &#39;```&#39; grep -i "error\|critical\|emergency" /var/log/syslog | \ tail -n 50 | sort | uniq -c | sort -nr echo &#39;```&#39; echo "### è®¤è¯å¤±è´¥" echo &#39;```&#39; grep "Failed password" /var/log/auth.log | \ awk &#39;{print $1,$2,$3,$11}&#39; | sort | uniq -c | sort -nr | head -n 10 echo &#39;```&#39; echo "### ç³»ç»Ÿé‡å¯è®°å½•" echo &#39;```&#39; last reboot | head -n 5 echo &#39;```&#39; } > "$report_file" } # åˆ†æ Nginx è®¿é—®æ—¥å¿— analyze_nginx_logs() { log "åˆ†æ Nginx è®¿é—®æ—¥å¿—..." local report_file="$REPORT_DIR/nginx_log_report_$(date +%Y%m%d).md" { echo "# Nginx è®¿é—®æ—¥å¿—åˆ†ææŠ¥å‘Š" echo "## ç”Ÿæˆæ—¶é—´: $(date &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo echo "## è®¿é—®ç»Ÿè®¡" echo "### è¯·æ±‚é‡æœ€å¤§çš„ IP" echo &#39;```&#39; awk &#39;{print $1}&#39; /var/log/nginx/access.log | sort | uniq -c | sort -nr | head -n 10 echo &#39;```&#39; echo "### è®¿é—®é‡æœ€å¤§çš„é¡µé¢" echo &#39;```&#39; awk &#39;{print $7}&#39; /var/log/nginx/access.log | sort | uniq -c | sort -nr | head -n 10 echo &#39;```&#39; echo "### HTTP çŠ¶æ€ç ç»Ÿè®¡" echo &#39;```&#39; awk &#39;{print $9}&#39; /var/log/nginx/access.log | sort | uniq -c | sort -nr echo &#39;```&#39; echo "### æ¯å°æ—¶è¯·æ±‚é‡ç»Ÿè®¡" echo &#39;```&#39; awk &#39;{print $4}&#39; /var/log/nginx/access.log | cut -c 14-15 | sort | uniq -c | \ awk &#39;{printf("%s:00 - %s è¯·æ±‚\n", $2, $1)}&#39; echo &#39;```&#39; } > "$report_file" } # åˆ†æ AI æœåŠ¡æ—¥å¿— analyze_ai_logs() { log "åˆ†æ AI æœåŠ¡æ—¥å¿—..." local report_file="$REPORT_DIR/ai_log_report_$(date +%Y%m%d).md" local ai_log="/home/zhaoxiongzhou/logs/llama.log" if [ -f "$ai_log" ]; then { echo "# AI æœåŠ¡æ—¥å¿—åˆ†ææŠ¥å‘Š" echo "## ç”Ÿæˆæ—¶é—´: $(date &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo echo "## æœåŠ¡ç»Ÿè®¡" echo "### é”™è¯¯ç»Ÿè®¡" echo &#39;```&#39; grep -i "error" "$ai_log" | tail -n 20 echo &#39;```&#39; echo "### æ€§èƒ½ç»Ÿè®¡" echo "#### å“åº”æ—¶é—´åˆ†å¸ƒ" echo &#39;```&#39; grep "response_time" "$ai_log" | \ awk &#39;{sum+=$NF; count++} END {print "å¹³å‡å“åº”æ—¶é—´:", sum/count, "ms"}&#39; echo &#39;```&#39; echo "#### å†…å­˜ä½¿ç”¨ç»Ÿè®¡" echo &#39;```&#39; grep "memory_usage" "$ai_log" | tail -n 10 echo &#39;```&#39; } > "$report_file" fi } # ç”Ÿæˆå®‰å…¨æŠ¥å‘Š generate_security_report() { log "ç”Ÿæˆå®‰å…¨æŠ¥å‘Š..." local report_file="$REPORT_DIR/security_report_$(date +%Y%m%d).md" { echo "# å®‰å…¨åˆ†ææŠ¥å‘Š" echo "## ç”Ÿæˆæ—¶é—´: $(date &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo echo "## å®‰å…¨äº‹ä»¶ç»Ÿè®¡" echo "### SSH æš´åŠ›ç ´è§£å°è¯•" echo &#39;```&#39; grep "Failed password" /var/log/auth.log | \ awk &#39;{print $11,$13}&#39; | sort | uniq -c | sort -nr | head -n 10 echo &#39;```&#39; echo "### å¯ç–‘ IP è®¿é—®" echo &#39;```&#39; grep -i "suspicious\|attack\|hack" /var/log/nginx/access.log | \ awk &#39;{print $1}&#39; | sort | uniq -c | sort -nr echo &#39;```&#39; echo "### æ–‡ä»¶æƒé™å˜æ›´" echo &#39;```&#39; find /etc -mtime -1 -type f -ls echo &#39;```&#39; } > "$report_file" } # æ¸…ç†æ—§æŠ¥å‘Š cleanup_old_reports() { log "æ¸…ç†æ—§æŠ¥å‘Š..." find "$REPORT_DIR" -type f -name "*.md" -mtime +$RETENTION_DAYS -delete } # ç”Ÿæˆæ‘˜è¦æŠ¥å‘Š generate_summary() { log "ç”Ÿæˆæ‘˜è¦æŠ¥å‘Š..." local summary_file="$REPORT_DIR/summary_$(date +%Y%m%d).md" { echo "# æ—¥å¿—åˆ†ææ‘˜è¦æŠ¥å‘Š" echo "## ç”Ÿæˆæ—¶é—´: $(date &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo echo "## å…³é”®æŒ‡æ ‡" # é”™è¯¯ç»Ÿè®¡ local error_count=$(grep -i "error" /var/log/syslog | wc -l) local nginx_error_count=$(grep -i "error" /var/log/nginx/error.log | wc -l) echo "- ç³»ç»Ÿé”™è¯¯æ•°: $error_count" echo "- Nginx é”™è¯¯æ•°: $nginx_error_count" # å®‰å…¨äº‹ä»¶ local ssh_fails=$(grep "Failed password" /var/log/auth.log | wc -l) echo "- SSH å¤±è´¥å°è¯•: $ssh_fails" # å‘Šè­¦åˆ¤æ–­ if [ $error_count -gt $ALERT_THRESHOLD ]; then ~/send_notification.sh "è­¦å‘Š: ç³»ç»Ÿé”™è¯¯æ•°è¶…è¿‡é˜ˆå€¼" "high" fi } > "$summary_file" } # ä¸»å‡½æ•° main() { log "å¼€å§‹æ—¥å¿—åˆ†æ..." # æ‰§è¡Œåˆ†æ analyze_system_logs analyze_nginx_logs analyze_ai_logs generate_security_report generate_summary # æ¸…ç†æ—§æŠ¥å‘Š cleanup_old_reports log "æ—¥å¿—åˆ†æå®Œæˆ" } # æ‰§è¡Œåˆ†æ main ä¸‰åäº”ã€ç³»ç»Ÿä¼˜åŒ–å·¥å…· 1. ç³»ç»Ÿä¼˜åŒ–è„šæœ¬ # åˆ›å»ºç³»ç»Ÿä¼˜åŒ–è„šæœ¬ nano ~/system_optimize.sh #!/bin/bash # ~/system_optimize.sh # é…ç½® LOG_FILE="/var/log/optimize.log" NGINX_CONF="/etc/nginx/nginx.conf" SYSCTL_CONF="/etc/sysctl.d/99-custom.conf" JOURNAL_CONF="/etc/systemd/journald.conf" # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # ä¼˜åŒ–ç³»ç»Ÿå‚æ•° optimize_system() { log "ä¼˜åŒ–ç³»ç»Ÿå‚æ•°..." # å¤‡ä»½åŸå§‹é…ç½® cp "$SYSCTL_CONF" "${SYSCTL_CONF}.backup" # é…ç½®ç³»ç»Ÿå‚æ•° cat > "$SYSCTL_CONF" << EOF # ç½‘ç»œä¼˜åŒ– net.core.somaxconn = 2048 net.core.netdev_max_backlog = 4096 net.ipv4.tcp_max_syn_backlog = 4096 net.ipv4.tcp_fin_timeout = 30 net.ipv4.tcp_keepalive_time = 1200 net.ipv4.tcp_max_tw_buckets = 5000 net.ipv4.tcp_fastopen = 3 net.ipv4.tcp_rmem = 4096 87380 16777216 net.ipv4.tcp_wmem = 4096 65536 16777216 # æ–‡ä»¶ç³»ç»Ÿä¼˜åŒ– fs.file-max = 100000 fs.inotify.max_user_watches = 524288 # å†…å­˜ä¼˜åŒ– vm.swappiness = 10 vm.dirty_ratio = 60 vm.dirty_background_ratio = 2 EOF # åº”ç”¨ç³»ç»Ÿå‚æ•° sysctl -p "$SYSCTL_CONF" } # ä¼˜åŒ– Nginx é…ç½® optimize_nginx() { log "ä¼˜åŒ– Nginx é…ç½®..." # å¤‡ä»½åŸå§‹é…ç½® cp "$NGINX_CONF" "${NGINX_CONF}.backup" # é…ç½® Nginx cat > "$NGINX_CONF" << EOF user www-data; worker_processes auto; worker_rlimit_nofile 100000; events { worker_connections 2048; multi_accept on; use epoll; } http { # åŸºç¡€è®¾ç½® sendfile on; tcp_nopush on; tcp_nodelay on; keepalive_timeout 65; types_hash_max_size 2048; server_tokens off; # MIME ç±»å‹ include /etc/nginx/mime.types; default_type application/octet-stream; # æ—¥å¿—æ ¼å¼ log_format main &#39;\$remote_addr - \$remote_user [\$time_local] "\$request" &#39; &#39;\$status \$body_bytes_sent "\$http_referer" &#39; &#39;"\$http_user_agent" "\$http_x_forwarded_for"&#39;; # ç¼“å†²åŒºè®¾ç½® client_body_buffer_size 128k; client_max_body_size 10m; client_header_buffer_size 1k; large_client_header_buffers 4 4k; # Gzip å‹ç¼© gzip on; gzip_vary on; gzip_proxied any; gzip_comp_level 6; gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript; # SSL ä¼˜åŒ– ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers on; ssl_session_cache shared:SSL:10m; ssl_session_timeout 10m; # åŒ…å«å…¶ä»–é…ç½® include /etc/nginx/conf.d/*.conf; include /etc/nginx/sites-enabled/*; } EOF # æµ‹è¯•é…ç½® nginx -t && systemctl restart nginx } # ä¼˜åŒ–ç³»ç»ŸæœåŠ¡ optimize_services() { log "ä¼˜åŒ–ç³»ç»ŸæœåŠ¡..." # ç¦ç”¨ä¸å¿…è¦çš„æœåŠ¡ local unnecessary_services=( "bluetooth" "cups" "avahi-daemon" ) for service in "${unnecessary_services[@]}"; do if systemctl is-active --quiet "$service"; then systemctl stop "$service" systemctl disable "$service" log "å·²ç¦ç”¨æœåŠ¡: $service" fi done # ä¼˜åŒ–æ—¥å¿—æœåŠ¡ cat > "$JOURNAL_CONF" << EOF [Journal] SystemMaxUse=100M SystemMaxFileSize=10M RuntimeMaxUse=50M RuntimeMaxFileSize=5M EOF # é‡å¯æ—¥å¿—æœåŠ¡ systemctl restart systemd-journald } # ä¼˜åŒ–æ–‡ä»¶ç³»ç»Ÿ optimize_filesystem() { log "ä¼˜åŒ–æ–‡ä»¶ç³»ç»Ÿ..." # æ¸…ç†ä¸´æ—¶æ–‡ä»¶ find /tmp -type f -atime +10 -delete find /var/tmp -type f -atime +10 -delete # æ¸…ç†æ—¥å¿— find /var/log -type f -name "*.gz" -delete find /var/log -type f -name "*.old" -delete # ä¼˜åŒ–æ—¥å¿—è½®è½¬ cat > /etc/logrotate.d/custom << EOF /var/log/custom/*.log { daily rotate 7 compress delaycompress missingok notifempty create 640 root adm } EOF } # ä¼˜åŒ–å†…å­˜ä½¿ç”¨ optimize_memory() { log "ä¼˜åŒ–å†…å­˜ä½¿ç”¨..." # æ¸…ç†ç¼“å­˜ sync; echo 3 > /proc/sys/vm/drop_caches # é…ç½® swap ä½¿ç”¨ if [ -f /swapfile ]; then swapoff /swapfile dd if=/dev/zero of=/swapfile bs=1M count=2048 chmod 600 /swapfile mkswap /swapfile swapon /swapfile fi } # éªŒè¯ä¼˜åŒ– verify_optimization() { log "éªŒè¯ç³»ç»Ÿä¼˜åŒ–..." local status=0 # æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½ local load=$(uptime | awk -F&#39;load average:&#39; &#39;{print $2}&#39; | cut -d, -f1) if [ $(echo "$load > 2" | bc -l) -eq 1 ]; then log "è­¦å‘Š: ç³»ç»Ÿè´Ÿè½½è¾ƒé«˜ ($load)" status=1 fi # æ£€æŸ¥å†…å­˜ä½¿ç”¨ local mem_usage=$(free | grep Mem | awk &#39;{print $3/$2 * 100.0}&#39;) if [ $(echo "$mem_usage > 90" | bc -l) -eq 1 ]; then log "è­¦å‘Š: å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜ ($mem_usage%)" status=1 fi # æ£€æŸ¥æœåŠ¡çŠ¶æ€ if ! systemctl is-active --quiet nginx; then log "é”™è¯¯: Nginx æœåŠ¡æœªæ­£å¸¸è¿è¡Œ" status=1 fi return $status } # ä¸»å‡½æ•° main() { log "å¼€å§‹ç³»ç»Ÿä¼˜åŒ–..." optimize_system optimize_nginx optimize_services optimize_filesystem optimize_memory if verify_optimization; then log "ç³»ç»Ÿä¼˜åŒ–æˆåŠŸå®Œæˆ" ~/send_notification.sh "ç³»ç»Ÿä¼˜åŒ–å·²å®Œæˆ" "normal" else log "ç³»ç»Ÿä¼˜åŒ–å®Œæˆï¼Œä½†å­˜åœ¨è­¦å‘Š" ~/send_notification.sh "ç³»ç»Ÿä¼˜åŒ–å®Œæˆï¼Œä½†éœ€è¦æ£€æŸ¥" "high" fi } # æ‰§è¡Œä¼˜åŒ– main ä¸‰åå…­ã€éƒ¨ç½²åæ£€æŸ¥æ¸…å• 1. éƒ¨ç½²æ£€æŸ¥è„šæœ¬ # åˆ›å»ºéƒ¨ç½²æ£€æŸ¥è„šæœ¬ nano ~/deployment_checklist.sh #!/bin/bash # ~/deployment_checklist.sh # é…ç½® LOG_FILE="/var/log/deployment_check.log" REPORT_FILE="/home/zhaoxiongzhou/deployment_report.md" CHECK_INTERVAL=300 # æ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰ # æ—¥å¿—å‡½æ•° log() { echo "[$(date &#39;+%Y-%m-%d %H:%M:%S&#39;)] $1" | tee -a "$LOG_FILE" } # æ£€æŸ¥ç³»ç»ŸåŸºç¡€é…ç½® check_system_basics() { log "æ£€æŸ¥ç³»ç»ŸåŸºç¡€é…ç½®..." local status=0 { echo "## ç³»ç»ŸåŸºç¡€æ£€æŸ¥" echo "### ç³»ç»Ÿä¿¡æ¯" echo "- ä¸»æœºå: $(hostname)" echo "- ç³»ç»Ÿç‰ˆæœ¬: $(cat /etc/os-release | grep PRETTY_NAME)" echo "- å†…æ ¸ç‰ˆæœ¬: $(uname -r)" echo "- è¿è¡Œæ—¶é—´: $(uptime -p)" echo echo "### èµ„æºä½¿ç”¨" echo "- CPU ä½¿ç”¨ç‡: $(top -bn1 | grep "Cpu(s)" | awk &#39;{print $2}&#39;)%" echo "- å†…å­˜ä½¿ç”¨ç‡: $(free | grep Mem | awk &#39;{print $3/$2 * 100.0}&#39;)%" echo "- ç£ç›˜ä½¿ç”¨ç‡: $(df -h / | awk &#39;NR==2 {print $5}&#39;)" echo } > "$REPORT_FILE" return $status } # æ£€æŸ¥ç½‘ç»œé…ç½® check_network() { log "æ£€æŸ¥ç½‘ç»œé…ç½®..." local status=0 { echo "### ç½‘ç»œé…ç½®" echo "#### IP é…ç½®" echo &#39;```&#39; ip addr show echo &#39;```&#39; echo "#### è·¯ç”±è¡¨" echo &#39;```&#39; ip route echo &#39;```&#39; echo "#### å¼€æ”¾ç«¯å£" echo &#39;```&#39; netstat -tuln echo &#39;```&#39; echo "#### DNS é…ç½®" echo &#39;```&#39; cat /etc/resolv.conf echo &#39;```&#39; } >> "$REPORT_FILE" return $status } # æ£€æŸ¥æœåŠ¡é…ç½® check_services() { log "æ£€æŸ¥æœåŠ¡é…ç½®..." local status=0 { echo "### æœåŠ¡çŠ¶æ€" echo "#### Nginx é…ç½®" echo &#39;```&#39; nginx -T echo &#39;```&#39; echo "#### æœåŠ¡è¿è¡ŒçŠ¶æ€" echo &#39;```&#39; systemctl status nginx systemctl status mysql ps aux | grep llama-server echo &#39;```&#39; echo "#### æœåŠ¡æ—¥å¿—æ£€æŸ¥" echo &#39;```&#39; tail -n 20 /var/log/nginx/error.log echo &#39;```&#39; } >> "$REPORT_FILE" return $status } # æ£€æŸ¥å®‰å…¨é…ç½® check_security() { log "æ£€æŸ¥å®‰å…¨é…ç½®..." local status=0 { echo "### å®‰å…¨æ£€æŸ¥" echo "#### é˜²ç«å¢™è§„åˆ™" echo &#39;```&#39; sudo iptables -L echo &#39;```&#39; echo "#### SSH é…ç½®" echo &#39;```&#39; grep -v &#39;^#&#39; /etc/ssh/sshd_config echo &#39;```&#39; echo "#### ç”¨æˆ·æƒé™" echo &#39;```&#39; ls -la /home/zhaoxiongzhou/ ls -la /var/www/ echo &#39;```&#39; echo "#### SSL è¯ä¹¦" echo &#39;```&#39; openssl x509 -in /etc/nginx/ssl/server.crt -text -noout echo &#39;```&#39; } >> "$REPORT_FILE" return $status } # æ£€æŸ¥å¤‡ä»½é…ç½® check_backups() { log "æ£€æŸ¥å¤‡ä»½é…ç½®..." local status=0 { echo "### å¤‡ä»½æ£€æŸ¥" echo "#### å¤‡ä»½é…ç½®" echo &#39;```&#39; ls -lh /mnt/backup_drive/system_backups/ echo &#39;```&#39; echo "#### æœ€è¿‘å¤‡ä»½çŠ¶æ€" echo &#39;```&#39; tail -n 20 /var/log/backup.log echo &#39;```&#39; } >> "$REPORT_FILE" return $status } # æ£€æŸ¥ç›‘æ§é…ç½® check_monitoring() { log "æ£€æŸ¥ç›‘æ§é…ç½®..." local status=0 { echo "### ç›‘æ§æ£€æŸ¥" echo "#### ç›‘æ§è„šæœ¬çŠ¶æ€" echo &#39;```&#39; ps aux | grep monitor echo &#39;```&#39; echo "#### å‘Šè­¦é…ç½®" echo &#39;```&#39; cat ~/send_notification.sh echo &#39;```&#39; } >> "$REPORT_FILE" return $status } # ç”Ÿæˆæ€»ç»“æŠ¥å‘Š generate_summary() { log "ç”Ÿæˆæ€»ç»“æŠ¥å‘Š..." { echo "## éƒ¨ç½²æ£€æŸ¥æ€»ç»“" echo "### æ£€æŸ¥æ—¶é—´: $(date &#39;+%Y-%m-%d %H:%M:%S&#39;)" echo echo "### ä¸»è¦å‘ç°" echo "1. ç³»ç»ŸçŠ¶æ€: $([ $system_status -eq 0 ] && echo &#39;æ­£å¸¸ âœ…&#39; || echo &#39;å¼‚å¸¸ âŒ&#39;)" echo "2. ç½‘ç»œé…ç½®: $([ $network_status -eq 0 ] && echo &#39;æ­£å¸¸ âœ…&#39; || echo &#39;å¼‚å¸¸ âŒ&#39;)" echo "3. æœåŠ¡çŠ¶æ€: $([ $services_status -eq 0 ] && echo &#39;æ­£å¸¸ âœ…&#39; || echo &#39;å¼‚å¸¸ âŒ&#39;)" echo "4. å®‰å…¨é…ç½®: $([ $security_status -eq 0 ] && echo &#39;æ­£å¸¸ âœ…&#39; || echo &#39;å¼‚å¸¸ âŒ&#39;)" echo "5. å¤‡ä»½çŠ¶æ€: $([ $backup_status -eq 0 ] && echo &#39;æ­£å¸¸ âœ…&#39; || echo &#39;å¼‚å¸¸ âŒ&#39;)" echo "6. ç›‘æ§çŠ¶æ€: $([ $monitoring_status -eq 0 ] && echo &#39;æ­£å¸¸ âœ…&#39; || echo &#39;å¼‚å¸¸ âŒ&#39;)" echo echo "### å»ºè®®æ“ä½œ" [ $system_status -ne 0 ] && echo "- æ£€æŸ¥ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ" [ $network_status -ne 0 ] && echo "- éªŒè¯ç½‘ç»œé…ç½®" [ $services_status -ne 0 ] && echo "- æ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€" [ $security_status -ne 0 ] && echo "- å®¡æŸ¥å®‰å…¨é…ç½®" [ $backup_status -ne 0 ] && echo "- ç¡®è®¤å¤‡ä»½æ˜¯å¦æ­£å¸¸" [ $monitoring_status -ne 0 ] && echo "- æ£€æŸ¥ç›‘æ§ç³»ç»Ÿ" } >> "$REPORT_FILE" } # ä¸»å‡½æ•° main() { log "å¼€å§‹éƒ¨ç½²åæ£€æŸ¥..." # æ‰§è¡Œæ£€æŸ¥ check_system_basics system_status=$? check_network network_status=$? check_services services_status=$? check_security security_status=$? check_backups backup_status=$? check_monitoring monitoring_status=$? # ç”Ÿæˆæ€»ç»“ generate_summary # å‘é€é€šçŸ¥ if [ $system_status -eq 0 ] && [ $network_status -eq 0 ] && \ [ $services_status -eq 0 ] && [ $security_status -eq 0 ] && \ [ $backup_status -eq 0 ] && [ $monitoring_status -eq 0 ]; then ~/send_notification.sh "éƒ¨ç½²æ£€æŸ¥å®Œæˆï¼šæ‰€æœ‰é¡¹ç›®æ­£å¸¸" "normal" else ~/send_notification.sh "éƒ¨ç½²æ£€æŸ¥å®Œæˆï¼šå­˜åœ¨éœ€è¦å…³æ³¨çš„é¡¹ç›®" "high" fi log "éƒ¨ç½²æ£€æŸ¥å®Œæˆï¼ŒæŠ¥å‘Šå·²ç”Ÿæˆ: $REPORT_FILE" } # æ‰§è¡Œæ£€æŸ¥ main ã€Šæ ‘è“æ´¾æœåŠ¡éƒ¨ç½²ä¸ç»´æŠ¤å®Œæ•´æŒ‡å—ã€‹æ€»å…±åŒ…å«äº† 36 ä¸ªéƒ¨åˆ†ï¼Œæ¶µç›–äº†ä»ç³»ç»Ÿéƒ¨ç½²åˆ°ç»´æŠ¤çš„å„ä¸ªæ–¹é¢ã€‚æ¯ä¸ªè„šæœ¬éƒ½ç»è¿‡ç²¾å¿ƒè®¾è®¡ï¼Œå¯ä»¥ç‹¬ç«‹è¿è¡Œï¼Œä¹Ÿå¯ä»¥äº’ç›¸é…åˆä½¿ç”¨ã€‚'><meta itemprop=datePublished content="2024-12-03T18:00:00+08:00"><meta itemprop=dateModified content="2024-12-03T18:00:00+08:00"><meta itemprop=wordCount content="9977"><meta itemprop=keywords content="RaspberryPi,Hugo,æ•™ç¨‹"><header><h1 itemprop=headline>æ ‘è“æ´¾æœåŠ¡éƒ¨ç½²ä¸ç»´æŠ¤å®Œæ•´æŒ‡å—</h1><p class=text-sm>æ˜ŸæœŸäºŒ, 12æœˆ 3, 2024
| <span>47åˆ†é’Ÿé˜…è¯»</span>
| <span>æ›´æ–°äº
æ˜ŸæœŸäºŒ, 12æœˆ 3, 2024</span></p><div class="flex justify-between"><div class="flex items-center"><span>@</span>
<span itemprop=author itemscope itemtype=https://schema.org/Person><span itemprop=name>èµµé›„å·</span></span></div><div class="flex items-center gap-2"><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="https://x.com/intent/post?text=%e6%a0%91%e8%8e%93%e6%b4%be%e6%9c%8d%e5%8a%a1%e9%83%a8%e7%bd%b2%e4%b8%8e%e7%bb%b4%e6%8a%a4%e5%ae%8c%e6%95%b4%e6%8c%87%e5%8d%97&amp;url=http://10.10.164.61/posts/guide/%E6%A0%91%E8%8E%93%E6%B4%BE%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2%E4%B8%8E%E7%BB%B4%E6%8A%A4%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/" target=_blank rel="noopener noreferrer" title="Share on X"><ion-icon class=group-hover:text-primary-content name=logo-x></ion-icon></a><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="https://facebook.com/sharer/sharer.php?u=http://10.10.164.61/posts/guide/%E6%A0%91%E8%8E%93%E6%B4%BE%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2%E4%B8%8E%E7%BB%B4%E6%8A%A4%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/" target=_blank rel="noopener noreferrer" title="Share on Facebook"><ion-icon class=group-hover:text-primary-content name=logo-facebook></ion-icon></a><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="https://wa.me/?text=%e6%a0%91%e8%8e%93%e6%b4%be%e6%9c%8d%e5%8a%a1%e9%83%a8%e7%bd%b2%e4%b8%8e%e7%bb%b4%e6%8a%a4%e5%ae%8c%e6%95%b4%e6%8c%87%e5%8d%97%20http://10.10.164.61/posts/guide/%E6%A0%91%E8%8E%93%E6%B4%BE%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2%E4%B8%8E%E7%BB%B4%E6%8A%A4%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/" target=_blank rel="noopener noreferrer" title="Share on WhatsApp"><ion-icon class=group-hover:text-primary-content name=logo-whatsapp></ion-icon></a></div></div></header><img src=/images/default3.jpg alt=æ ‘è“æ´¾æœåŠ¡éƒ¨ç½²ä¸ç»´æŠ¤å®Œæ•´æŒ‡å—><h1 id=æ ‘è“æ´¾æœåŠ¡éƒ¨ç½²ä¸ç»´æŠ¤å®Œæ•´æŒ‡å—>æ ‘è“æ´¾æœåŠ¡éƒ¨ç½²ä¸ç»´æŠ¤å®Œæ•´æŒ‡å—</h1><h2 id=ä¸€ç³»ç»Ÿæ¦‚å†µ>ä¸€ã€ç³»ç»Ÿæ¦‚å†µ</h2><h3 id=1-ç¡¬ä»¶èµ„æº>1. ç¡¬ä»¶èµ„æº</h3><ul><li><strong>å¤„ç†å™¨</strong>: ARM64 æ¶æ„</li><li><strong>æ€»å†…å­˜</strong>: 3.7GB</li><li><strong>å¯ç”¨å†…å­˜</strong>: ~2.5GB</li><li><strong>Swap</strong>: 512MB</li><li><strong>ç½‘ç»œ</strong>: wlan0 (IP: 10.40.110.47)</li></ul><h3 id=2-æœåŠ¡æ¦‚è§ˆ>2. æœåŠ¡æ¦‚è§ˆ</h3><ol><li><strong>AI æ™ºèƒ½åŠ©æ‰‹</strong><ul><li>ç«¯å£: 8080</li><li>åŸºäº: llama.cpp</li><li>æ¨¡å‹: Phi-3-mini-4k-instruct-q4.gguf</li><li>èµ„æºå ç”¨:<ul><li>CPU: ~300% (å¤šæ ¸)</li><li>å†…å­˜: ~3GB</li><li>Swap: 511Mi</li></ul></li></ul></li><li><strong>ä¸ªäººåšå®¢</strong><ul><li>ç«¯å£: 80</li><li>æ¡†æ¶: Hugo v0.139.3-extended</li><li>ä¸»é¢˜: Ananke</li><li>WebæœåŠ¡å™¨: Nginx</li><li>èµ„æºå ç”¨: è½»é‡çº§</li></ul></li></ol><h3 id=3-æœåŠ¡è®¿é—®>3. æœåŠ¡è®¿é—®</h3><ul><li>AI åŠ©æ‰‹: <code>http://10.40.110.47:8080</code></li><li>åšå®¢å¼€å‘: <code>http://10.40.110.47:1313</code></li><li>åšå®¢æ­£å¼: <code>http://10.40.110.47</code></li></ul><h2 id=äºŒai-æ™ºèƒ½åŠ©æ‰‹éƒ¨ç½²>äºŒã€AI æ™ºèƒ½åŠ©æ‰‹éƒ¨ç½²</h2><h3 id=1-ç¯å¢ƒå‡†å¤‡>1. ç¯å¢ƒå‡†å¤‡</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># æ›´æ–°ç³»ç»Ÿ</span>
</span></span><span style=display:flex><span>sudo apt update
</span></span><span style=display:flex><span>sudo apt upgrade -y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å®‰è£…ä¾èµ–</span>
</span></span><span style=display:flex><span>sudo apt install build-essential git cmake
</span></span></code></pre></div><h3 id=2-ç¼–è¯‘å®‰è£…>2. ç¼–è¯‘å®‰è£…</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># å…‹éš†ä»“åº“</span>
</span></span><span style=display:flex><span>git clone https://github.com/ggerganov/llama.cpp.git
</span></span><span style=display:flex><span>cd llama.cpp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç¼–è¯‘</span>
</span></span><span style=display:flex><span>make clean
</span></span><span style=display:flex><span>LLAMA_METAL<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> make -j4
</span></span></code></pre></div><h3 id=3-æ¨¡å‹é…ç½®>3. æ¨¡å‹é…ç½®</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºæ¨¡å‹ç›®å½•</span>
</span></span><span style=display:flex><span>mkdir models
</span></span><span style=display:flex><span>cd models
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ä¸‹è½½æ¨¡å‹æ–‡ä»¶</span>
</span></span><span style=display:flex><span>wget <span style=color:#f92672>[</span>æ¨¡å‹ä¸‹è½½åœ°å€<span style=color:#f92672>]</span>/Phi-3-mini-4k-instruct-q4.gguf
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># éªŒè¯æ¨¡å‹æ–‡ä»¶</span>
</span></span><span style=display:flex><span>sha256sum Phi-3-mini-4k-instruct-q4.gguf
</span></span></code></pre></div><h3 id=4-æœåŠ¡é…ç½®>4. æœåŠ¡é…ç½®</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºå¯åŠ¨è„šæœ¬</span>
</span></span><span style=display:flex><span>nano ~/projects/llama.cpp/start-llama.sh
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>cd ~/projects/llama.cpp
</span></span><span style=display:flex><span>nohup ./llama-server <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -m models/Phi-3-mini-4k-instruct-q4.gguf <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --host 0.0.0.0 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --port <span style=color:#ae81ff>8080</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --ctx-size <span style=color:#ae81ff>2048</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --threads <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --batch-size <span style=color:#ae81ff>256</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  &gt; llama.log 2&gt;&amp;<span style=color:#ae81ff>1</span> &amp;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># è®¾ç½®æ‰§è¡Œæƒé™</span>
</span></span><span style=display:flex><span>chmod +x start-llama.sh
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å¯åŠ¨æœåŠ¡</span>
</span></span><span style=display:flex><span>./start-llama.sh
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># éªŒè¯æœåŠ¡çŠ¶æ€</span>
</span></span><span style=display:flex><span>ps aux | grep llama-server
</span></span><span style=display:flex><span>netstat -tuln | grep <span style=color:#ae81ff>8080</span>
</span></span></code></pre></div><h2 id=ä¸‰ä¸ªäººåšå®¢éƒ¨ç½²>ä¸‰ã€ä¸ªäººåšå®¢éƒ¨ç½²</h2><h3 id=1-hugo-å®‰è£…>1. Hugo å®‰è£…</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># ä¸‹è½½ Hugo Extended ç‰ˆæœ¬</span>
</span></span><span style=display:flex><span>wget https://github.com/gohugoio/hugo/releases/download/v0.139.3/hugo_extended_0.139.3_linux-arm64.deb
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å®‰è£…</span>
</span></span><span style=display:flex><span>sudo dpkg -i hugo_extended_0.139.3_linux-arm64.deb
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># éªŒè¯å®‰è£…</span>
</span></span><span style=display:flex><span>hugo version
</span></span></code></pre></div><h3 id=2-åšå®¢åˆå§‹åŒ–>2. åšå®¢åˆå§‹åŒ–</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºç«™ç‚¹</span>
</span></span><span style=display:flex><span>cd ~
</span></span><span style=display:flex><span>hugo new site myblog
</span></span><span style=display:flex><span>cd myblog
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># åˆå§‹åŒ– Git</span>
</span></span><span style=display:flex><span>git init
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ·»åŠ ä¸»é¢˜</span>
</span></span><span style=display:flex><span>git submodule add https://github.com/theNewDynamic/gohugo-theme-ananke.git themes/ananke
</span></span></code></pre></div><h3 id=3-åšå®¢é…ç½®>3. åšå®¢é…ç½®</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># ç¼–è¾‘é…ç½®æ–‡ä»¶</span>
</span></span><span style=display:flex><span>nano config.toml
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#a6e22e>baseURL</span> = <span style=color:#e6db74>&#34;http://10.40.110.47/&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>languageCode</span> = <span style=color:#e6db74>&#34;zh-cn&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>title</span> = <span style=color:#e6db74>&#34;My Blog&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>theme</span> = <span style=color:#e6db74>&#34;ananke&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[<span style=color:#a6e22e>params</span>]
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>author</span> = <span style=color:#e6db74>&#34;Your Name&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;Welcome to my blog&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>dateFormat</span> = <span style=color:#e6db74>&#34;2006-01-02&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>background_color_class</span> = <span style=color:#e6db74>&#34;bg-black&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>recent_posts_number</span> = <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>mainSections</span> = [<span style=color:#e6db74>&#34;posts&#34;</span>]
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>featured_image</span> = <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[<span style=color:#a6e22e>menu</span>]
</span></span><span style=display:flex><span>  [[<span style=color:#a6e22e>menu</span>.<span style=color:#a6e22e>main</span>]]
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>identifier</span> = <span style=color:#e6db74>&#34;posts&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>name</span> = <span style=color:#e6db74>&#34;æ–‡ç« &#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>url</span> = <span style=color:#e6db74>&#34;/posts/&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>weight</span> = <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  [[<span style=color:#a6e22e>menu</span>.<span style=color:#a6e22e>main</span>]]
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>identifier</span> = <span style=color:#e6db74>&#34;about&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>name</span> = <span style=color:#e6db74>&#34;å…³äº&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>url</span> = <span style=color:#e6db74>&#34;/about/&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>weight</span> = <span style=color:#ae81ff>2</span>
</span></span></code></pre></div><h3 id=4-nginx-é…ç½®>4. Nginx é…ç½®</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># å®‰è£… Nginx</span>
</span></span><span style=display:flex><span>sudo apt install nginx
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºé…ç½®æ–‡ä»¶</span>
</span></span><span style=display:flex><span>sudo nano /etc/nginx/sites-available/myblog
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#ae81ff>10</span><span style=color:#e6db74>.40.110.47</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>root</span> <span style=color:#e6db74>/home/zhaoxiongzhou/myblog/public</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>index</span> <span style=color:#e6db74>index.html</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>try_files</span> $uri $uri/ =<span style=color:#ae81ff>404</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>access_log</span> <span style=color:#e6db74>/var/log/nginx/myblog_access.log</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>error_log</span> <span style=color:#e6db74>/var/log/nginx/myblog_error.log</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># å¯ç”¨é…ç½®</span>
</span></span><span style=display:flex><span>sudo ln -s /etc/nginx/sites-available/myblog /etc/nginx/sites-enabled/
</span></span><span style=display:flex><span>sudo rm /etc/nginx/sites-enabled/default
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æµ‹è¯•é…ç½®</span>
</span></span><span style=display:flex><span>sudo nginx -t
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é‡å¯ Nginx</span>
</span></span><span style=display:flex><span>sudo systemctl restart nginx
</span></span></code></pre></div><h2 id=å››æƒé™ä¸è‡ªåŠ¨åŒ–é…ç½®>å››ã€æƒé™ä¸è‡ªåŠ¨åŒ–é…ç½®</h2><h3 id=1-æƒé™è®¾ç½®>1. æƒé™è®¾ç½®</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># è®¾ç½®ç›®å½•æƒé™</span>
</span></span><span style=display:flex><span>sudo chmod <span style=color:#ae81ff>755</span> /home/zhaoxiongzhou
</span></span><span style=display:flex><span>sudo chmod -R <span style=color:#ae81ff>755</span> /home/zhaoxiongzhou/myblog
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># è®¾ç½®æ–‡ä»¶æ‰€æœ‰æƒ</span>
</span></span><span style=display:flex><span>sudo chown -R www-data:www-data /home/zhaoxiongzhou/myblog/public
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># éªŒè¯æƒé™</span>
</span></span><span style=display:flex><span>ls -la ~/myblog/public
</span></span><span style=display:flex><span>ls -la /home/zhaoxiongzhou
</span></span></code></pre></div><h3 id=2-è‡ªåŠ¨éƒ¨ç½²è„šæœ¬>2. è‡ªåŠ¨éƒ¨ç½²è„šæœ¬</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºåšå®¢éƒ¨ç½²è„šæœ¬</span>
</span></span><span style=display:flex><span>nano ~/deploy-blog.sh
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>cd ~/myblog
</span></span><span style=display:flex><span>hugo
</span></span><span style=display:flex><span>sudo chown -R www-data:www-data public/
</span></span><span style=display:flex><span>sudo systemctl restart nginx
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># è®¾ç½®æ‰§è¡Œæƒé™</span>
</span></span><span style=display:flex><span>chmod +x ~/deploy-blog.sh
</span></span></code></pre></div><h3 id=3-å¤‡ä»½è„šæœ¬>3. å¤‡ä»½è„šæœ¬</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºå¤‡ä»½è„šæœ¬</span>
</span></span><span style=display:flex><span>nano ~/backup-blog.sh
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>BACKUP_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/home/zhaoxiongzhou/backups&#34;</span>
</span></span><span style=display:flex><span>DATE<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>date +%Y%m%d<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºå¤‡ä»½ç›®å½•</span>
</span></span><span style=display:flex><span>mkdir -p $BACKUP_DIR
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å¤‡ä»½åšå®¢å†…å®¹</span>
</span></span><span style=display:flex><span>tar -czf $BACKUP_DIR/blog_$DATE.tar.gz ~/myblog/content
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å¤‡ä»½é…ç½®æ–‡ä»¶</span>
</span></span><span style=display:flex><span>cp ~/myblog/config.toml $BACKUP_DIR/config_$DATE.toml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># åˆ é™¤30å¤©å‰çš„å¤‡ä»½</span>
</span></span><span style=display:flex><span>find $BACKUP_DIR -name <span style=color:#e6db74>&#34;*.tar.gz&#34;</span> -mtime +30 -delete
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># è®¾ç½®æ‰§è¡Œæƒé™</span>
</span></span><span style=display:flex><span>chmod +x ~/backup-blog.sh
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é…ç½®å®šæ—¶ä»»åŠ¡</span>
</span></span><span style=display:flex><span>crontab -e
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼ˆæ¯å‘¨æ—¥å‡Œæ™¨2ç‚¹æ‰§è¡Œå¤‡ä»½ï¼‰</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span> <span style=color:#ae81ff>2</span> * * <span style=color:#ae81ff>0</span> /home/zhaoxiongzhou/backup-blog.sh
</span></span></code></pre></div><h2 id=äº”ç³»ç»Ÿç»´æŠ¤ä¸ç›‘æ§>äº”ã€ç³»ç»Ÿç»´æŠ¤ä¸ç›‘æ§</h2><h3 id=1-èµ„æºç›‘æ§å‘½ä»¤>1. èµ„æºç›‘æ§å‘½ä»¤</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># ç³»ç»Ÿèµ„æºç›‘æ§</span>
</span></span><span style=display:flex><span>htop
</span></span><span style=display:flex><span>top
</span></span><span style=display:flex><span>free -h
</span></span><span style=display:flex><span>vmstat <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç£ç›˜ä½¿ç”¨ç›‘æ§</span>
</span></span><span style=display:flex><span>df -h
</span></span><span style=display:flex><span>du -sh /*
</span></span><span style=display:flex><span>du -sh ~/myblog
</span></span><span style=display:flex><span>du -sh ~/projects/llama.cpp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ¸©åº¦ç›‘æ§</span>
</span></span><span style=display:flex><span>vcgencmd measure_temp
</span></span></code></pre></div><h3 id=2-æ€§èƒ½ä¼˜åŒ–>2. æ€§èƒ½ä¼˜åŒ–</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># æ¸…ç†ç³»ç»Ÿç¼“å­˜</span>
</span></span><span style=display:flex><span>sudo sync; echo <span style=color:#ae81ff>3</span> | sudo tee /proc/sys/vm/drop_caches
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># è°ƒæ•´ Swap è®¾ç½®</span>
</span></span><span style=display:flex><span>cat /proc/sys/vm/swappiness
</span></span><span style=display:flex><span>sudo sysctl vm.swappiness<span style=color:#f92672>=</span><span style=color:#ae81ff>60</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># CPU é¢‘ç‡è°ƒæ•´</span>
</span></span><span style=display:flex><span>sudo nano /boot/config.txt
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#75715e># CPU é…ç½®å‚æ•°</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>arm_freq</span>=<span style=color:#ae81ff>1800</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>over_voltage</span>=<span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>temp_limit</span>=<span style=color:#ae81ff>75</span>
</span></span></code></pre></div><h3 id=3-ç³»ç»Ÿç»´æŠ¤>3. ç³»ç»Ÿç»´æŠ¤</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># ç³»ç»Ÿæ›´æ–°</span>
</span></span><span style=display:flex><span>sudo apt update
</span></span><span style=display:flex><span>sudo apt upgrade -y
</span></span><span style=display:flex><span>sudo apt autoremove
</span></span><span style=display:flex><span>sudo apt clean
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ—¥å¿—æ¸…ç†</span>
</span></span><span style=display:flex><span>sudo find /var/log -type f -name <span style=color:#e6db74>&#34;*.log&#34;</span> -mtime +30 -delete
</span></span><span style=display:flex><span>sudo find /var/log -type f -name <span style=color:#e6db74>&#34;*.gz&#34;</span> -delete
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æœåŠ¡çŠ¶æ€æ£€æŸ¥</span>
</span></span><span style=display:flex><span>systemctl status nginx
</span></span><span style=display:flex><span>ps aux | grep llama-server
</span></span></code></pre></div><h2 id=å…­å®‰å…¨é…ç½®>å…­ã€å®‰å…¨é…ç½®</h2><h3 id=1-é˜²ç«å¢™è®¾ç½®>1. é˜²ç«å¢™è®¾ç½®</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># å®‰è£… UFW</span>
</span></span><span style=display:flex><span>sudo apt install ufw
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é…ç½®åŸºæœ¬è§„åˆ™</span>
</span></span><span style=display:flex><span>sudo ufw default deny incoming
</span></span><span style=display:flex><span>sudo ufw default allow outgoing
</span></span><span style=display:flex><span>sudo ufw allow <span style=color:#ae81ff>22</span>
</span></span><span style=display:flex><span>sudo ufw allow <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>sudo ufw allow <span style=color:#ae81ff>8080</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å¯ç”¨é˜²ç«å¢™</span>
</span></span><span style=display:flex><span>sudo ufw enable
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ£€æŸ¥çŠ¶æ€</span>
</span></span><span style=display:flex><span>sudo ufw status
</span></span></code></pre></div><h3 id=2-nginx-è®¿é—®æ§åˆ¶>2. Nginx è®¿é—®æ§åˆ¶</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># å®‰è£…è®¤è¯å·¥å…·</span>
</span></span><span style=display:flex><span>sudo apt install apache2-utils
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºç”¨æˆ·å¯†ç </span>
</span></span><span style=display:flex><span>sudo htpasswd -c /etc/nginx/.htpasswd username
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ä¿®æ”¹ Nginx é…ç½®</span>
</span></span><span style=display:flex><span>sudo nano /etc/nginx/sites-available/myblog
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#ae81ff>10</span><span style=color:#e6db74>.40.110.47</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>root</span> <span style=color:#e6db74>/home/zhaoxiongzhou/myblog/public</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>index</span> <span style=color:#e6db74>index.html</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ·»åŠ åŸºæœ¬è®¤è¯
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>auth_basic</span> <span style=color:#e6db74>&#34;Restricted</span> <span style=color:#e6db74>Access&#34;</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>auth_basic_user_file</span> <span style=color:#e6db74>/etc/nginx/.htpasswd</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>try_files</span> $uri $uri/ =<span style=color:#ae81ff>404</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ—¥å¿—é…ç½®
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>access_log</span> <span style=color:#e6db74>/var/log/nginx/myblog_access.log</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>error_log</span> <span style=color:#e6db74>/var/log/nginx/myblog_error.log</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=3-æ—¥å¿—ç›‘æ§>3. æ—¥å¿—ç›‘æ§</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># å®‰è£…æ—¥å¿—ç›‘æ§å·¥å…·</span>
</span></span><span style=display:flex><span>sudo apt install logwatch
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é…ç½®æ—¥å¿—ç›‘æ§</span>
</span></span><span style=display:flex><span>sudo nano /etc/logwatch/conf/logwatch.conf
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#75715e># é…ç½®æ¯æ—¥æ—¥å¿—æ£€æŸ¥</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Output</span> = <span style=color:#a6e22e>mail</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Format</span> = <span style=color:#a6e22e>html</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>MailTo</span> = <span style=color:#a6e22e>your-email</span><span style=color:#960050;background-color:#1e0010>@</span><span style=color:#a6e22e>domain</span>.<span style=color:#a6e22e>com</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Detail</span> = <span style=color:#a6e22e>High</span>
</span></span></code></pre></div><h2 id=ä¸ƒæ•…éšœæ’é™¤æŒ‡å—>ä¸ƒã€æ•…éšœæ’é™¤æŒ‡å—</h2><h4 id=å†…å­˜ç›¸å…³é—®é¢˜>å†…å­˜ç›¸å…³é—®é¢˜</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># æ£€æŸ¥å†…å­˜çŠ¶æ€</span>
</span></span><span style=display:flex><span>free -h
</span></span><span style=display:flex><span>ps aux --sort<span style=color:#f92672>=</span>-%mem | head
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å¦‚æœå†…å­˜ä¸è¶³ï¼Œè°ƒæ•´æœåŠ¡å‚æ•°</span>
</span></span><span style=display:flex><span>nano ~/projects/llama.cpp/start-llama.sh
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># é™ä½èµ„æºä½¿ç”¨çš„å‚æ•°ç¤ºä¾‹</span>
</span></span><span style=display:flex><span>--ctx-size <span style=color:#ae81ff>1024</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--batch-size <span style=color:#ae81ff>128</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--threads <span style=color:#ae81ff>1</span>
</span></span></code></pre></div><h4 id=æœåŠ¡æ— å“åº”>æœåŠ¡æ— å“åº”</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># æ£€æŸ¥è¿›ç¨‹</span>
</span></span><span style=display:flex><span>ps aux | grep llama-server
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ£€æŸ¥ç«¯å£</span>
</span></span><span style=display:flex><span>netstat -tuln | grep <span style=color:#ae81ff>8080</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é‡å¯æœåŠ¡</span>
</span></span><span style=display:flex><span>pkill llama-server
</span></span><span style=display:flex><span>./start-llama.sh
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ£€æŸ¥æ—¥å¿—</span>
</span></span><span style=display:flex><span>tail -f ~/projects/llama.cpp/llama.log
</span></span></code></pre></div><h3 id=2-åšå®¢æœåŠ¡æ•…éšœæ’é™¤>2. åšå®¢æœåŠ¡æ•…éšœæ’é™¤</h3><h4 id=nginx-é—®é¢˜>Nginx é—®é¢˜</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># æ£€æŸ¥é…ç½®è¯­æ³•</span>
</span></span><span style=display:flex><span>sudo nginx -t
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ£€æŸ¥æ—¥å¿—</span>
</span></span><span style=display:flex><span>sudo tail -f /var/log/nginx/error.log
</span></span><span style=display:flex><span>sudo tail -f /var/log/nginx/myblog_error.log
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ£€æŸ¥æœåŠ¡çŠ¶æ€</span>
</span></span><span style=display:flex><span>sudo systemctl status nginx
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é‡å¯æœåŠ¡</span>
</span></span><span style=display:flex><span>sudo systemctl restart nginx
</span></span></code></pre></div><h4 id=hugo-ç”Ÿæˆé—®é¢˜>Hugo ç”Ÿæˆé—®é¢˜</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># æ¸…ç†ç¼“å­˜</span>
</span></span><span style=display:flex><span>rm -rf ~/myblog/public
</span></span><span style=display:flex><span>rm -rf ~/myblog/resources
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ›´æ–°ä¸»é¢˜</span>
</span></span><span style=display:flex><span>git submodule update --init --recursive
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é‡æ–°ç”Ÿæˆï¼ˆè¯¦ç»†æ¨¡å¼ï¼‰</span>
</span></span><span style=display:flex><span>hugo --verbose
</span></span></code></pre></div><h2 id=å…«ç³»ç»Ÿçº§æ•…éšœæ’é™¤>å…«ã€ç³»ç»Ÿçº§æ•…éšœæ’é™¤</h2><h3 id=1-ç£ç›˜é—®é¢˜>1. ç£ç›˜é—®é¢˜</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># æ£€æŸ¥ç£ç›˜ä½¿ç”¨æƒ…å†µ</span>
</span></span><span style=display:flex><span>df -h
</span></span><span style=display:flex><span>du -sh /*
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æŸ¥æ‰¾å¤§æ–‡ä»¶</span>
</span></span><span style=display:flex><span>sudo find / -type f -size +100M
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ¸…ç†ç©ºé—´</span>
</span></span><span style=display:flex><span>sudo apt clean
</span></span><span style=display:flex><span>sudo apt autoremove
</span></span><span style=display:flex><span>sudo journalctl --vacuum-time<span style=color:#f92672>=</span>7d
</span></span></code></pre></div><h3 id=2-ç½‘ç»œé—®é¢˜>2. ç½‘ç»œé—®é¢˜</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># ç½‘ç»œçŠ¶æ€æ£€æŸ¥</span>
</span></span><span style=display:flex><span>ip addr show
</span></span><span style=display:flex><span>ping -c <span style=color:#ae81ff>4</span> 8.8.8.8
</span></span><span style=display:flex><span>netstat -tuln
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># DNS æ£€æŸ¥</span>
</span></span><span style=display:flex><span>cat /etc/resolv.conf
</span></span><span style=display:flex><span>nslookup google.com
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é‡å¯ç½‘ç»œæœåŠ¡</span>
</span></span><span style=display:flex><span>sudo systemctl restart networking
</span></span><span style=display:flex><span>sudo systemctl restart wpa_supplicant
</span></span></code></pre></div><h3 id=3-æ€§èƒ½é—®é¢˜>3. æ€§èƒ½é—®é¢˜</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># CPU æ¸©åº¦ç›‘æ§</span>
</span></span><span style=display:flex><span>vcgencmd measure_temp
</span></span><span style=display:flex><span>watch -n <span style=color:#ae81ff>1</span> vcgencmd measure_temp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># CPU é¢‘ç‡æ£€æŸ¥</span>
</span></span><span style=display:flex><span>vcgencmd measure_clock arm
</span></span><span style=display:flex><span>cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_cur_freq
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç³»ç»Ÿè´Ÿè½½æ£€æŸ¥</span>
</span></span><span style=display:flex><span>uptime
</span></span><span style=display:flex><span>cat /proc/loadavg
</span></span></code></pre></div><h2 id=ä¹ç»´æŠ¤æœ€ä½³å®è·µ>ä¹ã€ç»´æŠ¤æœ€ä½³å®è·µ</h2><h3 id=1-æ—¥å¸¸ç»´æŠ¤æ¸…å•>1. æ—¥å¸¸ç»´æŠ¤æ¸…å•</h3><ul><li>æ£€æŸ¥ç³»ç»Ÿæ—¥å¿—</li><li>ç›‘æ§èµ„æºä½¿ç”¨</li><li>éªŒè¯æœåŠ¡çŠ¶æ€</li><li>æ£€æŸ¥å¤‡ä»½çŠ¶æ€</li><li>æ›´æ–°ç³»ç»Ÿå®‰å…¨è¡¥ä¸</li></ul><h3 id=2-å‘¨æœŸæ€§ç»´æŠ¤ä»»åŠ¡>2. å‘¨æœŸæ€§ç»´æŠ¤ä»»åŠ¡</h3><ul><li>æ¸…ç†æ—§æ—¥å¿—å’Œä¸´æ—¶æ–‡ä»¶</li><li>éªŒè¯å¤‡ä»½å®Œæ•´æ€§</li><li>æ£€æŸ¥ç³»ç»Ÿæ›´æ–°</li><li>æ£€æŸ¥æœåŠ¡æ€§èƒ½</li><li>æ›´æ–°æ–‡æ¡£å’Œé…ç½®è¯´æ˜</li></ul><h3 id=3-åº”æ€¥é¢„æ¡ˆ>3. åº”æ€¥é¢„æ¡ˆ</h3><ul><li>ä¿å­˜æ‰€æœ‰é…ç½®æ–‡ä»¶çš„å¤‡ä»½</li><li>è®°å½•æ‰€æœ‰æœåŠ¡çš„é…ç½®æ­¥éª¤</li><li>ç»´æŠ¤é—®é¢˜è§£å†³æ–¹æ¡ˆæ–‡æ¡£</li><li>å»ºç«‹æœåŠ¡æ¢å¤æµç¨‹</li><li>ä¿æŒé‡è¦æ•°æ®çš„å¤šä»½å¤‡ä»½</li></ul><h2 id=åæ€§èƒ½ä¼˜åŒ–å»ºè®®>åã€æ€§èƒ½ä¼˜åŒ–å»ºè®®</h2><h3 id=1-ç³»ç»Ÿçº§ä¼˜åŒ–>1. ç³»ç»Ÿçº§ä¼˜åŒ–</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 1. è°ƒæ•´ SWAP è®¾ç½®</span>
</span></span><span style=display:flex><span>sudo nano /etc/sysctl.conf
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#75715e># æ·»åŠ æˆ–ä¿®æ”¹ä»¥ä¸‹å‚æ•°</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>vm</span>.<span style=color:#a6e22e>swappiness</span>=<span style=color:#ae81ff>60</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>vm</span>.<span style=color:#a6e22e>vfs_cache_pressure</span>=<span style=color:#ae81ff>50</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>vm</span>.<span style=color:#a6e22e>dirty_background_ratio</span>=<span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>vm</span>.<span style=color:#a6e22e>dirty_ratio</span>=<span style=color:#ae81ff>10</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 2. ä¼˜åŒ–æ–‡ä»¶ç³»ç»Ÿ</span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ£€æŸ¥å¹¶ä¼˜åŒ–æ–‡ä»¶ç³»ç»Ÿ</span>
</span></span><span style=display:flex><span>sudo tune2fs -o journal_data_writeback /dev/mmcblk0p2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 3. è°ƒæ•´ CPU æ€§èƒ½</span>
</span></span><span style=display:flex><span>sudo nano /boot/config.txt
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#75715e># æ·»åŠ ä»¥ä¸‹é…ç½®</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>arm_freq</span>=<span style=color:#ae81ff>1800</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>over_voltage</span>=<span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>gpu_freq</span>=<span style=color:#ae81ff>500</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>dtparam</span>=<span style=color:#a6e22e>audio</span>=<span style=color:#a6e22e>on</span>
</span></span></code></pre></div><h3 id=2-æœåŠ¡ä¼˜åŒ–>2. æœåŠ¡ä¼˜åŒ–</h3><h4 id=ai-æœåŠ¡ä¼˜åŒ–>AI æœåŠ¡ä¼˜åŒ–</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># è°ƒæ•´æœåŠ¡å‚æ•°</span>
</span></span><span style=display:flex><span>nano ~/projects/llama.cpp/start-llama.sh
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#75715e># ä¼˜åŒ–å‚æ•°ç¤ºä¾‹</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>--ctx-size</span> <span style=color:#ae81ff>2048</span> <span style=color:#960050;background-color:#1e0010>\</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>--threads</span> <span style=color:#ae81ff>2</span> <span style=color:#960050;background-color:#1e0010>\</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>--batch-size</span> <span style=color:#ae81ff>256</span> <span style=color:#960050;background-color:#1e0010>\</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>--keep-context</span> <span style=color:#960050;background-color:#1e0010>\</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>--mlock</span> <span style=color:#960050;background-color:#1e0010>\</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>--numa</span>
</span></span></code></pre></div><h4 id=nginx-ä¼˜åŒ–>Nginx ä¼˜åŒ–</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo nano /etc/nginx/nginx.conf
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#a6e22e>worker_processes</span> <span style=color:#a6e22e>auto</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>worker_rlimit_nofile</span> <span style=color:#ae81ff>65535</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>events</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>worker_connections</span> <span style=color:#ae81ff>1024</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>multi_accept</span> <span style=color:#a6e22e>on</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>use</span> <span style=color:#a6e22e>epoll</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>http</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>sendfile</span> <span style=color:#a6e22e>on</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>tcp_nopush</span> <span style=color:#a6e22e>on</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>tcp_nodelay</span> <span style=color:#a6e22e>on</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>keepalive_timeout</span> <span style=color:#ae81ff>65</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>types_hash_max_size</span> <span style=color:#ae81ff>2048</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>server_tokens</span> <span style=color:#a6e22e>off</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># ç¼“å­˜è®¾ç½®</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>open_file_cache</span> <span style=color:#a6e22e>max</span>=<span style=color:#ae81ff>1000</span> <span style=color:#a6e22e>inactive</span>=<span style=color:#ae81ff>20</span><span style=color:#a6e22e>s</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>open_file_cache_valid</span> <span style=color:#ae81ff>30</span><span style=color:#a6e22e>s</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>open_file_cache_min_uses</span> <span style=color:#ae81ff>2</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>open_file_cache_errors</span> <span style=color:#a6e22e>on</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=åä¸€ç›‘æ§ä¸æŠ¥è­¦ç³»ç»Ÿ>åä¸€ã€ç›‘æ§ä¸æŠ¥è­¦ç³»ç»Ÿ</h2><h3 id=1-ç³»ç»Ÿç›‘æ§é…ç½®>1. ç³»ç»Ÿç›‘æ§é…ç½®</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># å®‰è£…ç›‘æ§å·¥å…·</span>
</span></span><span style=display:flex><span>sudo apt install prometheus node-exporter grafana
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é…ç½® Prometheus</span>
</span></span><span style=display:flex><span>sudo nano /etc/prometheus/prometheus.yml
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#a6e22e>global</span><span style=color:#960050;background-color:#1e0010>:</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>scrape_interval</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#ae81ff>15</span><span style=color:#a6e22e>s</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>scrape_configs</span><span style=color:#960050;background-color:#1e0010>:</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>-</span> <span style=color:#a6e22e>job_name</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#39;node&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>static_configs</span><span style=color:#960050;background-color:#1e0010>:</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>-</span> <span style=color:#a6e22e>targets</span><span style=color:#960050;background-color:#1e0010>:</span> [<span style=color:#e6db74>&#39;localhost:9100&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>-</span> <span style=color:#a6e22e>job_name</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#39;nginx&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>static_configs</span><span style=color:#960050;background-color:#1e0010>:</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>-</span> <span style=color:#a6e22e>targets</span><span style=color:#960050;background-color:#1e0010>:</span> [<span style=color:#e6db74>&#39;localhost:9113&#39;</span>]
</span></span></code></pre></div><h3 id=2-è‡ªåŠ¨æŠ¥è­¦è„šæœ¬>2. è‡ªåŠ¨æŠ¥è­¦è„šæœ¬</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºç›‘æ§è„šæœ¬</span>
</span></span><span style=display:flex><span>nano ~/monitor.sh
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e># å®šä¹‰é˜ˆå€¼</span>
</span></span><span style=display:flex><span>MAX_CPU_USAGE<span style=color:#f92672>=</span><span style=color:#ae81ff>90</span>
</span></span><span style=display:flex><span>MAX_MEM_USAGE<span style=color:#f92672>=</span><span style=color:#ae81ff>90</span>
</span></span><span style=display:flex><span>MAX_DISK_USAGE<span style=color:#f92672>=</span><span style=color:#ae81ff>90</span>
</span></span><span style=display:flex><span>MAX_TEMP<span style=color:#f92672>=</span><span style=color:#ae81ff>75</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># è·å–ç³»ç»Ÿæ•°æ®</span>
</span></span><span style=display:flex><span>CPU_USAGE<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>top -bn1 | grep <span style=color:#e6db74>&#34;Cpu(s)&#34;</span> | awk <span style=color:#e6db74>&#39;{print $2}&#39;</span> | cut -d. -f1<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>MEM_USAGE<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>free | grep Mem | awk <span style=color:#e6db74>&#39;{print $3/$2 * 100.0}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>DISK_USAGE<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>df -h / | awk <span style=color:#e6db74>&#39;NR==2 {print $5}&#39;</span> | cut -d% -f1<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>TEMP<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>vcgencmd measure_temp | cut -d<span style=color:#f92672>=</span> -f2 | cut -d. -f1<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ£€æŸ¥æœåŠ¡çŠ¶æ€</span>
</span></span><span style=display:flex><span>check_services<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    services<span style=color:#f92672>=(</span><span style=color:#e6db74>&#34;nginx&#34;</span> <span style=color:#e6db74>&#34;llama-server&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> service in <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>services[@]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ! pgrep -x <span style=color:#e6db74>&#34;</span>$service<span style=color:#e6db74>&#34;</span> &gt; /dev/null; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            echo <span style=color:#e6db74>&#34;è­¦å‘Š: </span>$service<span style=color:#e6db74> æœåŠ¡æœªè¿è¡Œ!&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># å¯ä»¥æ·»åŠ é‡å¯æœåŠ¡çš„å‘½ä»¤</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å‘é€è­¦å‘Š</span>
</span></span><span style=display:flex><span>send_alert<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    message<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># è¿™é‡Œå¯ä»¥æ·»åŠ å‘é€é‚®ä»¶æˆ–å…¶ä»–é€šçŸ¥çš„å‘½ä»¤</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;</span>$message<span style=color:#e6db74>&#34;</span> &gt;&gt; /var/log/system_alerts.log
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ£€æŸ¥å„é¡¹æŒ‡æ ‡</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$CPU_USAGE<span style=color:#e6db74>&#34;</span> -gt <span style=color:#e6db74>&#34;</span>$MAX_CPU_USAGE<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    send_alert <span style=color:#e6db74>&#34;CPU ä½¿ç”¨ç‡è¿‡é«˜: </span>$CPU_USAGE<span style=color:#e6db74>%&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>MEM_USAGE%.*<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> -gt <span style=color:#e6db74>&#34;</span>$MAX_MEM_USAGE<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    send_alert <span style=color:#e6db74>&#34;å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜: </span>$MEM_USAGE<span style=color:#e6db74>%&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$DISK_USAGE<span style=color:#e6db74>&#34;</span> -gt <span style=color:#e6db74>&#34;</span>$MAX_DISK_USAGE<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    send_alert <span style=color:#e6db74>&#34;ç£ç›˜ä½¿ç”¨ç‡è¿‡é«˜: </span>$DISK_USAGE<span style=color:#e6db74>%&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$TEMP<span style=color:#e6db74>&#34;</span> -gt <span style=color:#e6db74>&#34;</span>$MAX_TEMP<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    send_alert <span style=color:#e6db74>&#34;ç³»ç»Ÿæ¸©åº¦è¿‡é«˜: </span>$TEMP<span style=color:#e6db74>Â°C&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ£€æŸ¥æœåŠ¡çŠ¶æ€</span>
</span></span><span style=display:flex><span>check_services
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># è®¾ç½®æ‰§è¡Œæƒé™</span>
</span></span><span style=display:flex><span>chmod +x ~/monitor.sh
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ·»åŠ åˆ° crontab</span>
</span></span><span style=display:flex><span>crontab -e
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># æ¯5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ç›‘æ§</span>
</span></span><span style=display:flex><span>*/5 * * * * /home/zhaoxiongzhou/monitor.sh
</span></span></code></pre></div><h2 id=åäºŒæ•°æ®å¤‡ä»½ä¸æ¢å¤>åäºŒã€æ•°æ®å¤‡ä»½ä¸æ¢å¤</h2><h3 id=1-å®Œæ•´å¤‡ä»½æ–¹æ¡ˆ>1. å®Œæ•´å¤‡ä»½æ–¹æ¡ˆ</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºå®Œæ•´å¤‡ä»½è„šæœ¬</span>
</span></span><span style=display:flex><span>nano ~/full-backup.sh
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>BACKUP_ROOT<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/home/zhaoxiongzhou/backups&#34;</span>
</span></span><span style=display:flex><span>DATE<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>date +%Y%m%d_%H%M%S<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>BACKUP_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$BACKUP_ROOT<span style=color:#e6db74>/</span>$DATE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºå¤‡ä»½ç›®å½•</span>
</span></span><span style=display:flex><span>mkdir -p <span style=color:#e6db74>&#34;</span>$BACKUP_DIR<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å¤‡ä»½åšå®¢å†…å®¹</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;å¤‡ä»½åšå®¢å†…å®¹...&#34;</span>
</span></span><span style=display:flex><span>tar -czf <span style=color:#e6db74>&#34;</span>$BACKUP_DIR<span style=color:#e6db74>/blog_content.tar.gz&#34;</span> ~/myblog/content
</span></span><span style=display:flex><span>tar -czf <span style=color:#e6db74>&#34;</span>$BACKUP_DIR<span style=color:#e6db74>/blog_config.tar.gz&#34;</span> ~/myblog/config.toml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å¤‡ä»½ AI æ¨¡å‹å’Œé…ç½®</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;å¤‡ä»½ AI æœåŠ¡...&#34;</span>
</span></span><span style=display:flex><span>tar -czf <span style=color:#e6db74>&#34;</span>$BACKUP_DIR<span style=color:#e6db74>/llama_models.tar.gz&#34;</span> ~/projects/llama.cpp/models
</span></span><span style=display:flex><span>tar -czf <span style=color:#e6db74>&#34;</span>$BACKUP_DIR<span style=color:#e6db74>/llama_config.tar.gz&#34;</span> ~/projects/llama.cpp/start-llama.sh
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å¤‡ä»½ Nginx é…ç½®</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;å¤‡ä»½ Nginx é…ç½®...&#34;</span>
</span></span><span style=display:flex><span>sudo tar -czf <span style=color:#e6db74>&#34;</span>$BACKUP_DIR<span style=color:#e6db74>/nginx_config.tar.gz&#34;</span> /etc/nginx/sites-available/myblog
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å¤‡ä»½ç³»ç»Ÿé…ç½®</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;å¤‡ä»½ç³»ç»Ÿé…ç½®...&#34;</span>
</span></span><span style=display:flex><span>sudo tar -czf <span style=color:#e6db74>&#34;</span>$BACKUP_DIR<span style=color:#e6db74>/system_config.tar.gz&#34;</span> /boot/config.txt /etc/fstab
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºå¤‡ä»½æ¸…å•</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;åˆ›å»ºå¤‡ä»½æ¸…å•...&#34;</span>
</span></span><span style=display:flex><span>find <span style=color:#e6db74>&#34;</span>$BACKUP_DIR<span style=color:#e6db74>&#34;</span> -type f -exec sha256sum <span style=color:#f92672>{}</span> <span style=color:#ae81ff>\;</span> &gt; <span style=color:#e6db74>&#34;</span>$BACKUP_DIR<span style=color:#e6db74>/checksum.txt&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ¸…ç†æ—§å¤‡ä»½ï¼ˆä¿ç•™æœ€è¿‘7ä»½ï¼‰</span>
</span></span><span style=display:flex><span>cd <span style=color:#e6db74>&#34;</span>$BACKUP_ROOT<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>ls -t | tail -n +8 | xargs -r rm -r
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;å¤‡ä»½å®Œæˆ: </span>$BACKUP_DIR<span style=color:#e6db74>&#34;</span>
</span></span></code></pre></div><h3 id=2-æ•°æ®æ¢å¤æµç¨‹>2. æ•°æ®æ¢å¤æµç¨‹</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºæ¢å¤è„šæœ¬</span>
</span></span><span style=display:flex><span>nano ~/restore.sh
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -z <span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;ä½¿ç”¨æ–¹æ³•: </span>$0<span style=color:#e6db74> &lt;å¤‡ä»½ç›®å½•&gt;&#34;</span>
</span></span><span style=display:flex><span>    exit <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>BACKUP_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># éªŒè¯å¤‡ä»½å®Œæ•´æ€§</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;éªŒè¯å¤‡ä»½å®Œæ•´æ€§...&#34;</span>
</span></span><span style=display:flex><span>cd <span style=color:#e6db74>&#34;</span>$BACKUP_DIR<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>sha256sum -c checksum.txt <span style=color:#f92672>||</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;å¤‡ä»½éªŒè¯å¤±è´¥ï¼&#34;</span>
</span></span><span style=display:flex><span>    exit <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ¢å¤åšå®¢å†…å®¹</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;æ¢å¤åšå®¢å†…å®¹...&#34;</span>
</span></span><span style=display:flex><span>tar -xzf <span style=color:#e6db74>&#34;</span>$BACKUP_DIR<span style=color:#e6db74>/blog_content.tar.gz&#34;</span> -C ~/myblog/
</span></span><span style=display:flex><span>tar -xzf <span style=color:#e6db74>&#34;</span>$BACKUP_DIR<span style=color:#e6db74>/blog_config.tar.gz&#34;</span> -C ~/myblog/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ¢å¤ AI æœåŠ¡</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;æ¢å¤ AI æœåŠ¡...&#34;</span>
</span></span><span style=display:flex><span>tar -xzf <span style=color:#e6db74>&#34;</span>$BACKUP_DIR<span style=color:#e6db74>/llama_models.tar.gz&#34;</span> -C ~/projects/llama.cpp/
</span></span><span style=display:flex><span>tar -xzf <span style=color:#e6db74>&#34;</span>$BACKUP_DIR<span style=color:#e6db74>/llama_config.tar.gz&#34;</span> -C ~/projects/llama.cpp/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ¢å¤ Nginx é…ç½®</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;æ¢å¤ Nginx é…ç½®...&#34;</span>
</span></span><span style=display:flex><span>sudo tar -xzf <span style=color:#e6db74>&#34;</span>$BACKUP_DIR<span style=color:#e6db74>/nginx_config.tar.gz&#34;</span> -C /etc/nginx/sites-available/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ¢å¤ç³»ç»Ÿé…ç½®</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;æ¢å¤ç³»ç»Ÿé…ç½®...&#34;</span>
</span></span><span style=display:flex><span>sudo tar -xzf <span style=color:#e6db74>&#34;</span>$BACKUP_DIR<span style=color:#e6db74>/system_config.tar.gz&#34;</span> -C /
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é‡å¯æœåŠ¡</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;é‡å¯æœåŠ¡...&#34;</span>
</span></span><span style=display:flex><span>sudo systemctl restart nginx
</span></span><span style=display:flex><span>pkill llama-server
</span></span><span style=display:flex><span>~/projects/llama.cpp/start-llama.sh
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;æ¢å¤å®Œæˆ&#34;</span>
</span></span></code></pre></div><h2 id=åä¸‰æœåŠ¡å‡çº§æŒ‡å—>åä¸‰ã€æœåŠ¡å‡çº§æŒ‡å—</h2><h3 id=1-hugo-åšå®¢å‡çº§>1. Hugo åšå®¢å‡çº§</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 1. å¤‡ä»½å½“å‰ç‰ˆæœ¬</span>
</span></span><span style=display:flex><span>cd ~
</span></span><span style=display:flex><span>tar -czf hugo_backup_<span style=color:#66d9ef>$(</span>date +%Y%m%d<span style=color:#66d9ef>)</span>.tar.gz myblog/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 2. æ£€æŸ¥å½“å‰ç‰ˆæœ¬</span>
</span></span><span style=display:flex><span>hugo version
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 3. ä¸‹è½½æ–°ç‰ˆæœ¬</span>
</span></span><span style=display:flex><span>wget https://github.com/gohugoio/hugo/releases/download/v<span style=color:#f92672>[</span>æ–°ç‰ˆæœ¬<span style=color:#f92672>]</span>/hugo_extended_<span style=color:#f92672>[</span>æ–°ç‰ˆæœ¬<span style=color:#f92672>]</span>_linux-arm64.deb
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 4. å®‰è£…æ–°ç‰ˆæœ¬</span>
</span></span><span style=display:flex><span>sudo dpkg -i hugo_extended_<span style=color:#f92672>[</span>æ–°ç‰ˆæœ¬<span style=color:#f92672>]</span>_linux-arm64.deb
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 5. æ›´æ–°ä¸»é¢˜</span>
</span></span><span style=display:flex><span>cd ~/myblog
</span></span><span style=display:flex><span>git submodule update --remote themes/ananke
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 6. æµ‹è¯•ç”Ÿæˆ</span>
</span></span><span style=display:flex><span>hugo --verbose
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 7. éƒ¨ç½²æ›´æ–°</span>
</span></span><span style=display:flex><span>./deploy-blog.sh
</span></span></code></pre></div><h3 id=2-ai-æœåŠ¡å‡çº§>2. AI æœåŠ¡å‡çº§</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 1. å¤‡ä»½å½“å‰ç‰ˆæœ¬</span>
</span></span><span style=display:flex><span>cd ~/projects
</span></span><span style=display:flex><span>tar -czf llama_backup_<span style=color:#66d9ef>$(</span>date +%Y%m%d<span style=color:#66d9ef>)</span>.tar.gz llama.cpp/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 2. æ›´æ–°æºç </span>
</span></span><span style=display:flex><span>cd llama.cpp
</span></span><span style=display:flex><span>git pull origin master
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 3. é‡æ–°ç¼–è¯‘</span>
</span></span><span style=display:flex><span>make clean
</span></span><span style=display:flex><span>LLAMA_METAL<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> make -j4
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 4. æµ‹è¯•æ–°ç‰ˆæœ¬</span>
</span></span><span style=display:flex><span>./llama-server -h
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 5. æ›´æ–°å¯åŠ¨è„šæœ¬</span>
</span></span><span style=display:flex><span>nano start-llama.sh
</span></span></code></pre></div><h3 id=3-ç³»ç»Ÿå‡çº§>3. ç³»ç»Ÿå‡çº§</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 1. æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨</span>
</span></span><span style=display:flex><span>sudo apt update
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 2. å‡çº§æ‰€æœ‰åŒ…</span>
</span></span><span style=display:flex><span>sudo apt upgrade -y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 3. å‡çº§ç³»ç»Ÿ</span>
</span></span><span style=display:flex><span>sudo apt dist-upgrade -y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 4. æ¸…ç†æ—§åŒ…</span>
</span></span><span style=display:flex><span>sudo apt autoremove -y
</span></span><span style=display:flex><span>sudo apt clean
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 5. æ£€æŸ¥å¯åŠ¨é¡¹</span>
</span></span><span style=display:flex><span>sudo systemctl list-unit-files --state<span style=color:#f92672>=</span>enabled
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 6. æ›´æ–°æ ‘è“æ´¾å›ºä»¶</span>
</span></span><span style=display:flex><span>sudo rpi-update
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 7. æ£€æŸ¥ç³»ç»ŸçŠ¶æ€</span>
</span></span><span style=display:flex><span>sudo systemctl --failed
</span></span><span style=display:flex><span>sudo journalctl -p <span style=color:#ae81ff>3</span> -xb
</span></span></code></pre></div><h2 id=åå››å®‰å…¨åŠ å›ºæŒ‡å—>åå››ã€å®‰å…¨åŠ å›ºæŒ‡å—</h2><h3 id=1-ç³»ç»Ÿå®‰å…¨é…ç½®>1. ç³»ç»Ÿå®‰å…¨é…ç½®</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 1. SSH å®‰å…¨é…ç½®</span>
</span></span><span style=display:flex><span>sudo nano /etc/ssh/sshd_config
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#75715e># SSH é…ç½®å»ºè®®</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Port</span> <span style=color:#ae81ff>22222</span>                    <span style=color:#75715e># ä¿®æ”¹é»˜è®¤ç«¯å£</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>PermitRootLogin</span> <span style=color:#a6e22e>no</span>           <span style=color:#75715e># ç¦æ­¢ root ç™»å½•</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>PasswordAuthentication</span> <span style=color:#a6e22e>no</span>    <span style=color:#75715e># ç¦ç”¨å¯†ç è®¤è¯</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>PubkeyAuthentication</span> <span style=color:#a6e22e>yes</span>    <span style=color:#75715e># å¯ç”¨å¯†é’¥è®¤è¯</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>AllowUsers</span> <span style=color:#a6e22e>zhaoxiongzhou</span>   <span style=color:#75715e># é™åˆ¶å…è®¸çš„ç”¨æˆ·</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 2. è®¾ç½®é˜²ç«å¢™è§„åˆ™</span>
</span></span><span style=display:flex><span>sudo apt install ufw fail2ban
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é…ç½® UFW</span>
</span></span><span style=display:flex><span>sudo ufw default deny incoming
</span></span><span style=display:flex><span>sudo ufw default allow outgoing
</span></span><span style=display:flex><span>sudo ufw allow 22222/tcp  <span style=color:#75715e># SSH</span>
</span></span><span style=display:flex><span>sudo ufw allow 80/tcp     <span style=color:#75715e># HTTP</span>
</span></span><span style=display:flex><span>sudo ufw allow 8080/tcp   <span style=color:#75715e># AI æœåŠ¡</span>
</span></span><span style=display:flex><span>sudo ufw enable
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é…ç½® fail2ban</span>
</span></span><span style=display:flex><span>sudo nano /etc/fail2ban/jail.local
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>sshd<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>enabled <span style=color:#f92672>=</span> true
</span></span><span style=display:flex><span>port <span style=color:#f92672>=</span> <span style=color:#ae81ff>22222</span>
</span></span><span style=display:flex><span>filter <span style=color:#f92672>=</span> sshd
</span></span><span style=display:flex><span>logpath <span style=color:#f92672>=</span> /var/log/auth.log
</span></span><span style=display:flex><span>maxretry <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>bantime <span style=color:#f92672>=</span> <span style=color:#ae81ff>3600</span>
</span></span></code></pre></div><h3 id=2-æœåŠ¡å®‰å…¨é…ç½®>2. æœåŠ¡å®‰å…¨é…ç½®</h3><h4 id=nginx-å®‰å…¨è®¾ç½®>Nginx å®‰å…¨è®¾ç½®</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 1. åˆ›å»º SSL è¯ä¹¦</span>
</span></span><span style=display:flex><span>sudo openssl req -x509 -nodes -days <span style=color:#ae81ff>365</span> -newkey rsa:2048 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>-keyout /etc/nginx/ssl/nginx.key <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>-out /etc/nginx/ssl/nginx.crt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 2. é…ç½® HTTPS</span>
</span></span><span style=display:flex><span>sudo nano /etc/nginx/sites-available/myblog
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#a6e22e>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>listen</span> <span style=color:#ae81ff>443</span> <span style=color:#a6e22e>ssl</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>server_name</span> <span style=color:#ae81ff>10.40</span>.<span style=color:#ae81ff>110.47</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ssl_certificate</span> <span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>etc</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>nginx</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>ssl</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>nginx</span>.<span style=color:#a6e22e>crt</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ssl_certificate_key</span> <span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>etc</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>nginx</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>ssl</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>nginx</span>.<span style=color:#a6e22e>key</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># SSL é…ç½®</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ssl_protocols</span> <span style=color:#a6e22e>TLSv1</span>.<span style=color:#ae81ff>2</span> <span style=color:#a6e22e>TLSv1</span>.<span style=color:#ae81ff>3</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ssl_prefer_server_ciphers</span> <span style=color:#a6e22e>on</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ssl_ciphers</span> <span style=color:#a6e22e>ECDHE-ECDSA-AES128-GCM-SHA256</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#a6e22e>ECDHE-RSA-AES128-GCM-SHA256</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># å®‰å…¨å¤´éƒ¨</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>add_header</span> <span style=color:#a6e22e>X-Frame-Options</span> <span style=color:#e6db74>&#34;SAMEORIGIN&#34;</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>add_header</span> <span style=color:#a6e22e>X-XSS-Protection</span> <span style=color:#e6db74>&#34;1; mode=block&#34;</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>add_header</span> <span style=color:#a6e22e>X-Content-Type-Options</span> <span style=color:#e6db74>&#34;nosniff&#34;</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>add_header</span> <span style=color:#a6e22e>Strict-Transport-Security</span> <span style=color:#e6db74>&#34;max-age=31536000&#34;</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># å…¶ä»–é…ç½®...</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=åäº”æ€§èƒ½ç›‘æ§ä¸åˆ†æ>åäº”ã€æ€§èƒ½ç›‘æ§ä¸åˆ†æ</h2><h3 id=1-ç›‘æ§è„šæœ¬é…ç½®>1. ç›‘æ§è„šæœ¬é…ç½®</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºç»¼åˆç›‘æ§è„šæœ¬</span>
</span></span><span style=display:flex><span>nano ~/system_monitor.sh
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>LOG_FILE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/var/log/system_monitor.log&#34;</span>
</span></span><span style=display:flex><span>ALERT_FILE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/var/log/system_alerts.log&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># è®°å½•æ—¶é—´æˆ³</span>
</span></span><span style=display:flex><span>timestamp<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    date <span style=color:#e6db74>&#34;+%Y-%m-%d %H:%M:%S&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç³»ç»Ÿèµ„æºç›‘æ§</span>
</span></span><span style=display:flex><span>monitor_resources<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;=== ç³»ç»Ÿèµ„æºç›‘æ§ </span><span style=color:#66d9ef>$(</span>timestamp<span style=color:#66d9ef>)</span><span style=color:#e6db74> ===&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># CPU ä½¿ç”¨ç‡</span>
</span></span><span style=display:flex><span>    CPU_USAGE<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>top -bn1 | grep <span style=color:#e6db74>&#34;Cpu(s)&#34;</span> | awk <span style=color:#e6db74>&#39;{print $2}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;CPU ä½¿ç”¨ç‡: </span>$CPU_USAGE<span style=color:#e6db74>%&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># å†…å­˜ä½¿ç”¨</span>
</span></span><span style=display:flex><span>    free -h | grep <span style=color:#e6db74>&#34;Mem:&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># ç£ç›˜ä½¿ç”¨</span>
</span></span><span style=display:flex><span>    df -h / &gt;&gt; <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># ç³»ç»Ÿè´Ÿè½½</span>
</span></span><span style=display:flex><span>    uptime &gt;&gt; <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># CPU æ¸©åº¦</span>
</span></span><span style=display:flex><span>    vcgencmd measure_temp &gt;&gt; <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æœåŠ¡çŠ¶æ€ç›‘æ§</span>
</span></span><span style=display:flex><span>monitor_services<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;=== æœåŠ¡çŠ¶æ€ç›‘æ§ </span><span style=color:#66d9ef>$(</span>timestamp<span style=color:#66d9ef>)</span><span style=color:#e6db74> ===&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># Nginx çŠ¶æ€</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> systemctl is-active nginx &gt;/dev/null 2&gt;&amp;1; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;Nginx: è¿è¡Œä¸­&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;è­¦å‘Š: Nginx æœªè¿è¡Œ!&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$ALERT_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># AI æœåŠ¡çŠ¶æ€</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> pgrep -f llama-server &gt;/dev/null; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;AI æœåŠ¡: è¿è¡Œä¸­&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;è­¦å‘Š: AI æœåŠ¡æœªè¿è¡Œ!&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$ALERT_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç½‘ç»œç›‘æ§</span>
</span></span><span style=display:flex><span>monitor_network<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;=== ç½‘ç»œç›‘æ§ </span><span style=color:#66d9ef>$(</span>timestamp<span style=color:#66d9ef>)</span><span style=color:#e6db74> ===&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># ç½‘ç»œè¿æ¥æ•°</span>
</span></span><span style=display:flex><span>    netstat -an | grep ESTABLISHED | wc -l &gt;&gt; <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># ç½‘ç»œæµé‡</span>
</span></span><span style=display:flex><span>    ifconfig wlan0 | grep bytes &gt;&gt; <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ä¸»å‡½æ•°</span>
</span></span><span style=display:flex><span>main<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    monitor_resources
</span></span><span style=display:flex><span>    monitor_services
</span></span><span style=display:flex><span>    monitor_network
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ£€æŸ¥æ˜¯å¦éœ€è¦å‘é€è­¦å‘Š</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -s <span style=color:#e6db74>&#34;</span>$ALERT_FILE<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># å¯ä»¥æ·»åŠ å‘é€è­¦å‘Šçš„å‘½ä»¤ï¼ˆå¦‚é‚®ä»¶é€šçŸ¥ï¼‰</span>
</span></span><span style=display:flex><span>        cat <span style=color:#e6db74>&#34;</span>$ALERT_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ‰§è¡Œç›‘æ§</span>
</span></span><span style=display:flex><span>main
</span></span></code></pre></div><h3 id=2-æ€§èƒ½åˆ†æå·¥å…·>2. æ€§èƒ½åˆ†æå·¥å…·</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># å®‰è£…æ€§èƒ½åˆ†æå·¥å…·</span>
</span></span><span style=display:flex><span>sudo apt install sysstat iotop htop
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºæ€§èƒ½æ•°æ®æ”¶é›†è„šæœ¬</span>
</span></span><span style=display:flex><span>nano ~/collect_performance.sh
</span></span></code></pre></div><h2 id=åå…­æ€§èƒ½æ•°æ®æ”¶é›†ä¸åˆ†æ>åå…­ã€æ€§èƒ½æ•°æ®æ”¶é›†ä¸åˆ†æ</h2><h3 id=1-æ€§èƒ½æ•°æ®æ”¶é›†è„šæœ¬>1. æ€§èƒ½æ•°æ®æ”¶é›†è„šæœ¬</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e># ~/collect_performance.sh</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PERF_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/home/zhaoxiongzhou/performance_data&#34;</span>
</span></span><span style=display:flex><span>DATE<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>date +%Y%m%d_%H%M%S<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºæ•°æ®ç›®å½•</span>
</span></span><span style=display:flex><span>mkdir -p <span style=color:#e6db74>&#34;</span>$PERF_DIR<span style=color:#e6db74>/</span>$DATE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># CPU æ€§èƒ½æ•°æ®</span>
</span></span><span style=display:flex><span>mpstat <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>60</span> &gt; <span style=color:#e6db74>&#34;</span>$PERF_DIR<span style=color:#e6db74>/</span>$DATE<span style=color:#e6db74>/cpu_stats.log&#34;</span> &amp;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å†…å­˜ä½¿ç”¨æ•°æ®</span>
</span></span><span style=display:flex><span>vmstat <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>60</span> &gt; <span style=color:#e6db74>&#34;</span>$PERF_DIR<span style=color:#e6db74>/</span>$DATE<span style=color:#e6db74>/memory_stats.log&#34;</span> &amp;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># IO æ€§èƒ½æ•°æ®</span>
</span></span><span style=display:flex><span>iostat -x <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>60</span> &gt; <span style=color:#e6db74>&#34;</span>$PERF_DIR<span style=color:#e6db74>/</span>$DATE<span style=color:#e6db74>/io_stats.log&#34;</span> &amp;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç½‘ç»œæ€§èƒ½æ•°æ®</span>
</span></span><span style=display:flex><span>sar -n DEV <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>60</span> &gt; <span style=color:#e6db74>&#34;</span>$PERF_DIR<span style=color:#e6db74>/</span>$DATE<span style=color:#e6db74>/network_stats.log&#34;</span> &amp;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># è¿›ç¨‹æ€§èƒ½æ•°æ®</span>
</span></span><span style=display:flex><span>ps aux --sort<span style=color:#f92672>=</span>-%cpu | head -n <span style=color:#ae81ff>20</span> &gt; <span style=color:#e6db74>&#34;</span>$PERF_DIR<span style=color:#e6db74>/</span>$DATE<span style=color:#e6db74>/top_processes.log&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç³»ç»Ÿè´Ÿè½½æ•°æ®</span>
</span></span><span style=display:flex><span>uptime &gt; <span style=color:#e6db74>&#34;</span>$PERF_DIR<span style=color:#e6db74>/</span>$DATE<span style=color:#e6db74>/load_average.log&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç­‰å¾…æ‰€æœ‰åå°è¿›ç¨‹å®Œæˆ</span>
</span></span><span style=display:flex><span>wait
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å‹ç¼©æ•°æ®</span>
</span></span><span style=display:flex><span>tar -czf <span style=color:#e6db74>&#34;</span>$PERF_DIR<span style=color:#e6db74>/performance_</span><span style=color:#e6db74>${</span>DATE<span style=color:#e6db74>}</span><span style=color:#e6db74>.tar.gz&#34;</span> <span style=color:#e6db74>&#34;</span>$PERF_DIR<span style=color:#e6db74>/</span>$DATE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>rm -rf <span style=color:#e6db74>&#34;</span>$PERF_DIR<span style=color:#e6db74>/</span>$DATE<span style=color:#e6db74>&#34;</span>
</span></span></code></pre></div><h3 id=2-æ€§èƒ½æ•°æ®åˆ†æè„šæœ¬>2. æ€§èƒ½æ•°æ®åˆ†æè„šæœ¬</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºåˆ†æè„šæœ¬</span>
</span></span><span style=display:flex><span>nano ~/analyze_performance.sh
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e># ~/analyze_performance.sh</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PERF_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/home/zhaoxiongzhou/performance_data&#34;</span>
</span></span><span style=display:flex><span>REPORT_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/home/zhaoxiongzhou/performance_reports&#34;</span>
</span></span><span style=display:flex><span>DATE<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>date +%Y%m%d<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mkdir -p <span style=color:#e6db74>&#34;</span>$REPORT_DIR<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>generate_report<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    local REPORT_FILE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$REPORT_DIR<span style=color:#e6db74>/report_</span><span style=color:#e6db74>${</span>DATE<span style=color:#e6db74>}</span><span style=color:#e6db74>.txt&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;æ€§èƒ½åˆ†ææŠ¥å‘Š - </span><span style=color:#66d9ef>$(</span>date<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> &gt; <span style=color:#e6db74>&#34;</span>$REPORT_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;===================&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$REPORT_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># CPU ä½¿ç”¨åˆ†æ</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\nCPU ä½¿ç”¨æƒ…å†µ:&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$REPORT_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    awk <span style=color:#e6db74>&#39;/all/ {total += $3; count++} END {print &#34;å¹³å‡CPUä½¿ç”¨ç‡: &#34; total/count &#34;%&#34;}&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        <span style=color:#e6db74>&#34;</span>$PERF_DIR<span style=color:#e6db74>/latest/cpu_stats.log&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$REPORT_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># å†…å­˜ä½¿ç”¨åˆ†æ</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\nå†…å­˜ä½¿ç”¨æƒ…å†µ:&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$REPORT_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    free -h | grep <span style=color:#e6db74>&#34;Mem:&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$REPORT_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># IO æ€§èƒ½åˆ†æ</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\nIO æ€§èƒ½:&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$REPORT_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    tail -n <span style=color:#ae81ff>10</span> <span style=color:#e6db74>&#34;</span>$PERF_DIR<span style=color:#e6db74>/latest/io_stats.log&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$REPORT_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># ç½‘ç»œæ€§èƒ½åˆ†æ</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\nç½‘ç»œæ€§èƒ½:&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$REPORT_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    tail -n <span style=color:#ae81ff>10</span> <span style=color:#e6db74>&#34;</span>$PERF_DIR<span style=color:#e6db74>/latest/network_stats.log&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$REPORT_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># è¿›ç¨‹åˆ†æ</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\nèµ„æºå ç”¨æœ€é«˜çš„è¿›ç¨‹:&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$REPORT_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    head -n <span style=color:#ae81ff>5</span> <span style=color:#e6db74>&#34;</span>$PERF_DIR<span style=color:#e6db74>/latest/top_processes.log&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$REPORT_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\nåˆ†æå®Œæˆã€‚æŠ¥å‘Šä¿å­˜åœ¨: </span>$REPORT_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç”ŸæˆæŠ¥å‘Š</span>
</span></span><span style=display:flex><span>generate_report
</span></span></code></pre></div><h2 id=åä¸ƒè‡ªåŠ¨åŒ–è¿ç»´è„šæœ¬>åä¸ƒã€è‡ªåŠ¨åŒ–è¿ç»´è„šæœ¬</h2><h3 id=1-æœåŠ¡å¥åº·æ£€æŸ¥ä¸è‡ªåŠ¨æ¢å¤>1. æœåŠ¡å¥åº·æ£€æŸ¥ä¸è‡ªåŠ¨æ¢å¤</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºæœåŠ¡ç›‘æ§è„šæœ¬</span>
</span></span><span style=display:flex><span>nano ~/service_health_check.sh
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e># ~/service_health_check.sh</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>LOG_FILE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/var/log/service_health.log&#34;</span>
</span></span><span style=display:flex><span>ALERT_SCRIPT<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/home/zhaoxiongzhou/send_alert.sh&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>log_message<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;[</span><span style=color:#66d9ef>$(</span>date <span style=color:#e6db74>&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>] </span>$1<span style=color:#e6db74>&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>check_and_restart_service<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    local service_name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    local process_pattern<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$2<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ! pgrep -f <span style=color:#e6db74>&#34;</span>$process_pattern<span style=color:#e6db74>&#34;</span> &gt; /dev/null; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log_message <span style=color:#e6db74>&#34;è­¦å‘Š: </span>$service_name<span style=color:#e6db74> æœåŠ¡æœªè¿è¡Œï¼Œå°è¯•é‡å¯&#34;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;</span>$service_name<span style=color:#e6db74>&#34;</span> in
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;nginx&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                sudo systemctl restart nginx
</span></span><span style=display:flex><span>                ;;
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;llama-server&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                cd ~/projects/llama.cpp
</span></span><span style=display:flex><span>                ./start-llama.sh
</span></span><span style=display:flex><span>                ;;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>esac</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># ç­‰å¾…æœåŠ¡å¯åŠ¨</span>
</span></span><span style=display:flex><span>        sleep <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># éªŒè¯æœåŠ¡æ˜¯å¦æˆåŠŸé‡å¯</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> pgrep -f <span style=color:#e6db74>&#34;</span>$process_pattern<span style=color:#e6db74>&#34;</span> &gt; /dev/null; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            log_message <span style=color:#e6db74>&#34;</span>$service_name<span style=color:#e6db74> æœåŠ¡å·²æˆåŠŸé‡å¯&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;</span>$ALERT_SCRIPT<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;</span>$service_name<span style=color:#e6db74> æœåŠ¡å·²è‡ªåŠ¨é‡å¯&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>            log_message <span style=color:#e6db74>&#34;é”™è¯¯: </span>$service_name<span style=color:#e6db74> æœåŠ¡é‡å¯å¤±è´¥&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;</span>$ALERT_SCRIPT<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;è­¦å‘Š: </span>$service_name<span style=color:#e6db74> æœåŠ¡é‡å¯å¤±è´¥ï¼Œéœ€è¦æ‰‹åŠ¨å¹²é¢„&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        log_message <span style=color:#e6db74>&#34;</span>$service_name<span style=color:#e6db74> æœåŠ¡è¿è¡Œæ­£å¸¸&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ£€æŸ¥å„ä¸ªæœåŠ¡</span>
</span></span><span style=display:flex><span>check_and_restart_service <span style=color:#e6db74>&#34;nginx&#34;</span> <span style=color:#e6db74>&#34;nginx&#34;</span>
</span></span><span style=display:flex><span>check_and_restart_service <span style=color:#e6db74>&#34;llama-server&#34;</span> <span style=color:#e6db74>&#34;llama-server&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ¸…ç†æ—§æ—¥å¿—</span>
</span></span><span style=display:flex><span>find <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span> -mtime +30 -delete
</span></span></code></pre></div><h3 id=2-è‡ªåŠ¨å¤‡ä»½ä¸æ¸…ç†>2. è‡ªåŠ¨å¤‡ä»½ä¸æ¸…ç†</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºè‡ªåŠ¨ç»´æŠ¤è„šæœ¬</span>
</span></span><span style=display:flex><span>nano ~/auto_maintenance.sh
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e># ~/auto_maintenance.sh</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>BACKUP_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/home/zhaoxiongzhou/backups&#34;</span>
</span></span><span style=display:flex><span>LOG_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/var/log&#34;</span>
</span></span><span style=display:flex><span>DATE<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>date +%Y%m%d<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºå¤‡ä»½</span>
</span></span><span style=display:flex><span>create_backups<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># åšå®¢å¤‡ä»½</span>
</span></span><span style=display:flex><span>    tar -czf <span style=color:#e6db74>&#34;</span>$BACKUP_DIR<span style=color:#e6db74>/blog_</span>$DATE<span style=color:#e6db74>.tar.gz&#34;</span> ~/myblog/content
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># AI æœåŠ¡é…ç½®å¤‡ä»½</span>
</span></span><span style=display:flex><span>    tar -czf <span style=color:#e6db74>&#34;</span>$BACKUP_DIR<span style=color:#e6db74>/llama_config_</span>$DATE<span style=color:#e6db74>.tar.gz&#34;</span> ~/projects/llama.cpp/start-llama.sh
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># Nginx é…ç½®å¤‡ä»½</span>
</span></span><span style=display:flex><span>    sudo tar -czf <span style=color:#e6db74>&#34;</span>$BACKUP_DIR<span style=color:#e6db74>/nginx_config_</span>$DATE<span style=color:#e6db74>.tar.gz&#34;</span> /etc/nginx/sites-available/
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ¸…ç†æ—§æ–‡ä»¶</span>
</span></span><span style=display:flex><span>cleanup_old_files<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># åˆ é™¤30å¤©å‰çš„å¤‡ä»½</span>
</span></span><span style=display:flex><span>    find <span style=color:#e6db74>&#34;</span>$BACKUP_DIR<span style=color:#e6db74>&#34;</span> -name <span style=color:#e6db74>&#34;*.tar.gz&#34;</span> -mtime +30 -delete
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ¸…ç†æ—¥å¿—</span>
</span></span><span style=display:flex><span>    sudo find <span style=color:#e6db74>&#34;</span>$LOG_DIR<span style=color:#e6db74>&#34;</span> -name <span style=color:#e6db74>&#34;*.log&#34;</span> -mtime +30 -delete
</span></span><span style=display:flex><span>    sudo find <span style=color:#e6db74>&#34;</span>$LOG_DIR<span style=color:#e6db74>&#34;</span> -name <span style=color:#e6db74>&#34;*.gz&#34;</span> -mtime +30 -delete
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ¸…ç†ç³»ç»Ÿä¸´æ—¶æ–‡ä»¶</span>
</span></span><span style=display:flex><span>    sudo rm -rf /tmp/*
</span></span><span style=display:flex><span>    sudo rm -rf /var/tmp/*
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ä¸»å‡½æ•°</span>
</span></span><span style=display:flex><span>main<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    create_backups
</span></span><span style=display:flex><span>    cleanup_old_files
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># å‹ç¼©æ—¥å¿—</span>
</span></span><span style=display:flex><span>    sudo logrotate -f /etc/logrotate.conf
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ¸…ç†åŒ…ç¼“å­˜</span>
</span></span><span style=display:flex><span>    sudo apt clean
</span></span><span style=display:flex><span>    sudo apt autoremove -y
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ‰§è¡Œç»´æŠ¤ä»»åŠ¡</span>
</span></span><span style=display:flex><span>main
</span></span></code></pre></div><h2 id=åå…«æ—¥å¿—ç®¡ç†ç³»ç»Ÿ>åå…«ã€æ—¥å¿—ç®¡ç†ç³»ç»Ÿ</h2><h3 id=1-é›†ä¸­å¼æ—¥å¿—é…ç½®>1. é›†ä¸­å¼æ—¥å¿—é…ç½®</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºæ—¥å¿—ç®¡ç†è„šæœ¬</span>
</span></span><span style=display:flex><span>nano ~/log_management.sh
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e># ~/log_management.sh</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>LOG_BASE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/var/log/services&#34;</span>
</span></span><span style=display:flex><span>ARCHIVE_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/home/zhaoxiongzhou/log_archives&#34;</span>
</span></span><span style=display:flex><span>DATE<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>date +%Y%m%d<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºæ—¥å¿—ç›®å½•</span>
</span></span><span style=display:flex><span>mkdir -p <span style=color:#e6db74>&#34;</span>$LOG_BASE<span style=color:#e6db74>&#34;</span>/<span style=color:#f92672>{</span>nginx,ai_service,system<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>mkdir -p <span style=color:#e6db74>&#34;</span>$ARCHIVE_DIR<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é…ç½®æ—¥å¿—è½®è½¬</span>
</span></span><span style=display:flex><span>sudo tee /etc/logrotate.d/custom_services <span style=color:#e6db74>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>$LOG_BASE/nginx/*.log {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    daily
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    missingok
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    rotate 14
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    compress
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    delaycompress
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    notifempty
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    create 0640 www-data adm
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    sharedscripts
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    postrotate
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        [ -f /var/run/nginx.pid ] &amp;&amp; kill -USR1 \$(cat /var/run/nginx.pid)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    endscript
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>$LOG_BASE/ai_service/*.log {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    daily
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    missingok
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    rotate 14
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    compress
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    delaycompress
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    notifempty
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    create 0640 zhaoxiongzhou adm
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>$LOG_BASE/system/*.log {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    daily
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    missingok
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    rotate 30
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    compress
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    delaycompress
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    notifempty
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    create 0640 root adm
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ—¥å¿—åˆ†æå‡½æ•°</span>
</span></span><span style=display:flex><span>analyze_logs<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    local log_file<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    local output_file<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$2<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;=== æ—¥å¿—åˆ†ææŠ¥å‘Š </span><span style=color:#66d9ef>$(</span>date<span style=color:#66d9ef>)</span><span style=color:#e6db74> ===&#34;</span> &gt; <span style=color:#e6db74>&#34;</span>$output_file<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># é”™è¯¯ç»Ÿè®¡</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\né”™è¯¯ç»Ÿè®¡:&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$output_file<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    grep -i <span style=color:#e6db74>&#34;error&#34;</span> <span style=color:#e6db74>&#34;</span>$log_file<span style=color:#e6db74>&#34;</span> | sort | uniq -c | sort -nr &gt;&gt; <span style=color:#e6db74>&#34;</span>$output_file<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># è­¦å‘Šç»Ÿè®¡</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\nè­¦å‘Šç»Ÿè®¡:&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$output_file<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    grep -i <span style=color:#e6db74>&#34;warning&#34;</span> <span style=color:#e6db74>&#34;</span>$log_file<span style=color:#e6db74>&#34;</span> | sort | uniq -c | sort -nr &gt;&gt; <span style=color:#e6db74>&#34;</span>$output_file<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># è®¿é—®ç»Ÿè®¡ï¼ˆé’ˆå¯¹ Nginx è®¿é—®æ—¥å¿—ï¼‰</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> <span style=color:#e6db74>&#34;</span>$log_file<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>==</span> *<span style=color:#e6db74>&#34;nginx/access&#34;</span>* <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        echo -e <span style=color:#e6db74>&#34;\nè®¿é—®é‡ç»Ÿè®¡:&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$output_file<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        awk <span style=color:#e6db74>&#39;{print $1}&#39;</span> <span style=color:#e6db74>&#34;</span>$log_file<span style=color:#e6db74>&#34;</span> | sort | uniq -c | sort -nr | head -n <span style=color:#ae81ff>10</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$output_file<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ—¥å¿—å½’æ¡£å‡½æ•°</span>
</span></span><span style=display:flex><span>archive_logs<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    local source_dir<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    local archive_name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;logs_</span><span style=color:#e6db74>${</span>DATE<span style=color:#e6db74>}</span><span style=color:#e6db74>.tar.gz&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    find <span style=color:#e6db74>&#34;</span>$source_dir<span style=color:#e6db74>&#34;</span> -name <span style=color:#e6db74>&#34;*.log.*&#34;</span> -mtime +14 -exec tar -czf <span style=color:#e6db74>&#34;</span>$ARCHIVE_DIR<span style=color:#e6db74>/</span>$archive_name<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>{}</span> +
</span></span><span style=display:flex><span>    find <span style=color:#e6db74>&#34;</span>$source_dir<span style=color:#e6db74>&#34;</span> -name <span style=color:#e6db74>&#34;*.log.*&#34;</span> -mtime +14 -delete
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=2-æ—¥å¿—ç›‘æ§å‘Šè­¦>2. æ—¥å¿—ç›‘æ§å‘Šè­¦</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºæ—¥å¿—ç›‘æ§è„šæœ¬</span>
</span></span><span style=display:flex><span>nano ~/log_monitor.sh
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e># ~/log_monitor.sh</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ALERT_THRESHOLD<span style=color:#f92672>=</span><span style=color:#ae81ff>10</span>  <span style=color:#75715e># é”™è¯¯é˜ˆå€¼</span>
</span></span><span style=display:flex><span>ALERT_SCRIPT<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/home/zhaoxiongzhou/send_alert.sh&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç›‘æ§ç‰¹å®šå…³é”®è¯</span>
</span></span><span style=display:flex><span>monitor_keywords<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    local log_file<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    local keywords<span style=color:#f92672>=(</span><span style=color:#e6db74>&#34;error&#34;</span> <span style=color:#e6db74>&#34;critical&#34;</span> <span style=color:#e6db74>&#34;failed&#34;</span> <span style=color:#e6db74>&#34;timeout&#34;</span> <span style=color:#e6db74>&#34;exception&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> keyword in <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>keywords[@]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>        count<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>grep -i <span style=color:#e6db74>&#34;</span>$keyword<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;</span>$log_file<span style=color:#e6db74>&#34;</span> | wc -l<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$count<span style=color:#e6db74>&#34;</span> -gt <span style=color:#e6db74>&#34;</span>$ALERT_THRESHOLD<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;</span>$ALERT_SCRIPT<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;è­¦å‘Š: </span>$log_file<span style=color:#e6db74> ä¸­å‘ç°å¤§é‡ </span>$keyword<span style=color:#e6db74> (</span>$count<span style=color:#e6db74> æ¬¡)&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç›‘æ§æ—¥å¿—å¤§å°</span>
</span></span><span style=display:flex><span>check_log_size<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    local log_file<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    local max_size<span style=color:#f92672>=</span><span style=color:#66d9ef>$((</span><span style=color:#ae81ff>100</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>1024</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>1024</span><span style=color:#66d9ef>))</span>  <span style=color:#75715e># 100MB</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    size<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>stat -f%z <span style=color:#e6db74>&#34;</span>$log_file<span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$size<span style=color:#e6db74>&#34;</span> -gt <span style=color:#e6db74>&#34;</span>$max_size<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;</span>$ALERT_SCRIPT<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;è­¦å‘Š: </span>$log_file<span style=color:#e6db74> å¤§å°è¶…è¿‡ 100MB&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ä¸»ç›‘æ§å¾ªç¯</span>
</span></span><span style=display:flex><span>main<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> true; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> log_file in <span style=color:#e6db74>&#34;</span>$LOG_BASE<span style=color:#e6db74>&#34;</span>/**/*.log; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>            monitor_keywords <span style=color:#e6db74>&#34;</span>$log_file<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>            check_log_size <span style=color:#e6db74>&#34;</span>$log_file<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>        sleep <span style=color:#ae81ff>300</span>  <span style=color:#75715e># æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>main &amp;
</span></span></code></pre></div><h2 id=åä¹ç³»ç»Ÿä¼˜åŒ–ä¸è°ƒä¼˜>åä¹ã€ç³»ç»Ÿä¼˜åŒ–ä¸è°ƒä¼˜</h2><h3 id=1-ç³»ç»Ÿå‚æ•°ä¼˜åŒ–>1. ç³»ç»Ÿå‚æ•°ä¼˜åŒ–</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºç³»ç»Ÿä¼˜åŒ–è„šæœ¬</span>
</span></span><span style=display:flex><span>nano ~/system_optimize.sh
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e># ~/system_optimize.sh</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç³»ç»Ÿå‚æ•°ä¼˜åŒ–</span>
</span></span><span style=display:flex><span>optimize_sysctl<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    sudo tee /etc/sysctl.d/99-custom.conf <span style=color:#e6db74>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74># å†…å­˜ç®¡ç†ä¼˜åŒ–
</span></span></span><span style=display:flex><span><span style=color:#e6db74>vm.swappiness = 60
</span></span></span><span style=display:flex><span><span style=color:#e6db74>vm.vfs_cache_pressure = 50
</span></span></span><span style=display:flex><span><span style=color:#e6db74>vm.dirty_background_ratio = 5
</span></span></span><span style=display:flex><span><span style=color:#e6db74>vm.dirty_ratio = 10
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74># ç½‘ç»œä¼˜åŒ–
</span></span></span><span style=display:flex><span><span style=color:#e6db74>net.core.somaxconn = 1024
</span></span></span><span style=display:flex><span><span style=color:#e6db74>net.core.netdev_max_backlog = 5000
</span></span></span><span style=display:flex><span><span style=color:#e6db74>net.ipv4.tcp_max_syn_backlog = 2048
</span></span></span><span style=display:flex><span><span style=color:#e6db74>net.ipv4.tcp_fin_timeout = 20
</span></span></span><span style=display:flex><span><span style=color:#e6db74>net.ipv4.tcp_keepalive_time = 1200
</span></span></span><span style=display:flex><span><span style=color:#e6db74>net.ipv4.tcp_keepalive_intvl = 15
</span></span></span><span style=display:flex><span><span style=color:#e6db74>net.ipv4.tcp_keepalive_probes = 5
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74># æ–‡ä»¶ç³»ç»Ÿä¼˜åŒ–
</span></span></span><span style=display:flex><span><span style=color:#e6db74>fs.file-max = 65535
</span></span></span><span style=display:flex><span><span style=color:#e6db74>fs.inotify.max_user_watches = 524288
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># åº”ç”¨æ–°çš„ç³»ç»Ÿå‚æ•°</span>
</span></span><span style=display:flex><span>    sudo sysctl -p /etc/sysctl.d/99-custom.conf
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># CPU é¢‘ç‡ä¼˜åŒ–</span>
</span></span><span style=display:flex><span>optimize_cpu<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    sudo tee /boot/config.txt <span style=color:#e6db74>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74># CPU è®¾ç½®
</span></span></span><span style=display:flex><span><span style=color:#e6db74>arm_freq=1800
</span></span></span><span style=display:flex><span><span style=color:#e6db74>over_voltage=6
</span></span></span><span style=display:flex><span><span style=color:#e6db74>gpu_freq=500
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74># æ¸©åº¦æ§åˆ¶
</span></span></span><span style=display:flex><span><span style=color:#e6db74>temp_limit=75
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æœåŠ¡ä¼˜åŒ–</span>
</span></span><span style=display:flex><span>optimize_services<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># ç¦ç”¨ä¸å¿…è¦çš„æœåŠ¡</span>
</span></span><span style=display:flex><span>    UNNECESSARY_SERVICES<span style=color:#f92672>=(</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;bluetooth&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;cups&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;avahi-daemon&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> service in <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>UNNECESSARY_SERVICES[@]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> systemctl is-enabled <span style=color:#e6db74>&#34;</span>$service<span style=color:#e6db74>&#34;</span> &amp;&gt;/dev/null; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            sudo systemctl disable <span style=color:#e6db74>&#34;</span>$service<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>            sudo systemctl stop <span style=color:#e6db74>&#34;</span>$service<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å†…å­˜ä¼˜åŒ–</span>
</span></span><span style=display:flex><span>optimize_memory<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># è°ƒæ•´ ZRAM</span>
</span></span><span style=display:flex><span>    sudo tee /etc/default/zramswap <span style=color:#e6db74>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ALGO=lz4
</span></span></span><span style=display:flex><span><span style=color:#e6db74>PERCENT=50
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># é‡å¯ ZRAM æœåŠ¡</span>
</span></span><span style=display:flex><span>    sudo systemctl restart zramswap
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=2-æœåŠ¡ä¼˜åŒ–é…ç½®>2. æœåŠ¡ä¼˜åŒ–é…ç½®</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Nginx ä¼˜åŒ–é…ç½®</span>
</span></span><span style=display:flex><span>sudo nano /etc/nginx/nginx.conf
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#a6e22e>user</span> <span style=color:#a6e22e>www-data</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>worker_processes</span> <span style=color:#a6e22e>auto</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>worker_rlimit_nofile</span> <span style=color:#ae81ff>65535</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>events</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>worker_connections</span> <span style=color:#ae81ff>1024</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>multi_accept</span> <span style=color:#a6e22e>on</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>use</span> <span style=color:#a6e22e>epoll</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>http</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e># åŸºç¡€è®¾ç½®</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>sendfile</span> <span style=color:#a6e22e>on</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>tcp_nopush</span> <span style=color:#a6e22e>on</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>tcp_nodelay</span> <span style=color:#a6e22e>on</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>keepalive_timeout</span> <span style=color:#ae81ff>65</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>types_hash_max_size</span> <span style=color:#ae81ff>2048</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>server_tokens</span> <span style=color:#a6e22e>off</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># MIME ç±»å‹</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>include</span> <span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>etc</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>nginx</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>mime</span>.<span style=color:#a6e22e>types</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>default_type</span> <span style=color:#a6e22e>application</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>octet-stream</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ—¥å¿—æ ¼å¼</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>log_format</span> <span style=color:#a6e22e>main</span> <span style=color:#e6db74>&#39;$remote_addr - $remote_user [$time_local] &#34;$request&#34; &#39;</span>
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;$status $body_bytes_sent &#34;$http_referer&#34; &#39;</span>
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;&#34;$http_user_agent&#34; &#34;$http_x_forwarded_for&#34;&#39;</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># ç¼“å†²åŒºè®¾ç½®</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>client_body_buffer_size</span> <span style=color:#ae81ff>10</span><span style=color:#a6e22e>K</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>client_header_buffer_size</span> <span style=color:#ae81ff>1</span><span style=color:#a6e22e>k</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>client_max_body_size</span> <span style=color:#ae81ff>8</span><span style=color:#a6e22e>m</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>large_client_header_buffers</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>1</span><span style=color:#a6e22e>k</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># è¶…æ—¶è®¾ç½®</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>client_body_timeout</span> <span style=color:#ae81ff>12</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>client_header_timeout</span> <span style=color:#ae81ff>12</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>send_timeout</span> <span style=color:#ae81ff>10</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># ç¼“å­˜è®¾ç½®</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>open_file_cache</span> <span style=color:#a6e22e>max</span>=<span style=color:#ae81ff>1000</span> <span style=color:#a6e22e>inactive</span>=<span style=color:#ae81ff>20</span><span style=color:#a6e22e>s</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>open_file_cache_valid</span> <span style=color:#ae81ff>30</span><span style=color:#a6e22e>s</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>open_file_cache_min_uses</span> <span style=color:#ae81ff>2</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>open_file_cache_errors</span> <span style=color:#a6e22e>on</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Gzip å‹ç¼©</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>gzip</span> <span style=color:#a6e22e>on</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>gzip_vary</span> <span style=color:#a6e22e>on</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>gzip_proxied</span> <span style=color:#a6e22e>any</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>gzip_comp_level</span> <span style=color:#ae81ff>6</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>gzip_types</span> <span style=color:#a6e22e>text</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>plain</span> <span style=color:#a6e22e>text</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>css</span> <span style=color:#a6e22e>text</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>xml</span> <span style=color:#a6e22e>application</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>json</span> <span style=color:#a6e22e>application</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>javascript</span> <span style=color:#a6e22e>application</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>xml</span><span style=color:#960050;background-color:#1e0010>+</span><span style=color:#a6e22e>rss</span> <span style=color:#a6e22e>application</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>atom</span><span style=color:#960050;background-color:#1e0010>+</span><span style=color:#a6e22e>xml</span> <span style=color:#a6e22e>image</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>svg</span><span style=color:#960050;background-color:#1e0010>+</span><span style=color:#a6e22e>xml</span><span style=color:#960050;background-color:#1e0010>;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=äºŒåæœåŠ¡ç›‘æ§é¢æ¿é…ç½®>äºŒåã€æœåŠ¡ç›‘æ§é¢æ¿é…ç½®</h2><h3 id=1-grafana-ç›‘æ§ç³»ç»Ÿé…ç½®>1. Grafana ç›‘æ§ç³»ç»Ÿé…ç½®</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># å®‰è£… Grafana</span>
</span></span><span style=display:flex><span>sudo apt-get install -y apt-transport-https
</span></span><span style=display:flex><span>sudo apt-get install -y software-properties-common wget
</span></span><span style=display:flex><span>wget -q -O - https://packages.grafana.com/gpg.key | sudo apt-key add -
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;deb https://packages.grafana.com/oss/deb stable main&#34;</span> | sudo tee -a /etc/apt/sources.list.d/grafana.list
</span></span><span style=display:flex><span>sudo apt-get update
</span></span><span style=display:flex><span>sudo apt-get install -y grafana
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># é…ç½® Grafana</span>
</span></span><span style=display:flex><span>sudo nano /etc/grafana/grafana.ini
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span>[<span style=color:#a6e22e>server</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>http_addr</span> = <span style=color:#ae81ff>0.0</span>.<span style=color:#ae81ff>0.0</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>http_port</span> = <span style=color:#ae81ff>3000</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[<span style=color:#a6e22e>security</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>admin_user</span> = <span style=color:#a6e22e>admin</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>admin_password</span> = <span style=color:#a6e22e>your_secure_password</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[<span style=color:#a6e22e>auth</span>.<span style=color:#a6e22e>anonymous</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>enabled</span> = <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[<span style=color:#a6e22e>paths</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>data</span> = <span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>var</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>lib</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>grafana</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>logs</span> = <span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>var</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>log</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>grafana</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>plugins</span> = <span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>var</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>lib</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>grafana</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>plugins</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[<span style=color:#a6e22e>dashboards</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>versions_to_keep</span> = <span style=color:#ae81ff>20</span>
</span></span></code></pre></div><h3 id=2-prometheus-é…ç½®>2. Prometheus é…ç½®</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># å®‰è£… Prometheus</span>
</span></span><span style=display:flex><span>sudo apt-get install -y prometheus
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é…ç½® Prometheus</span>
</span></span><span style=display:flex><span>sudo nano /etc/prometheus/prometheus.yml
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>global</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>scrape_interval</span>: <span style=color:#ae81ff>15s</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>evaluation_interval</span>: <span style=color:#ae81ff>15s</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>scrape_configs</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>job_name</span>: <span style=color:#e6db74>&#39;node&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>static_configs</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>targets</span>: [<span style=color:#e6db74>&#39;localhost:9100&#39;</span>]
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>  - <span style=color:#f92672>job_name</span>: <span style=color:#e6db74>&#39;nginx&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>static_configs</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>targets</span>: [<span style=color:#e6db74>&#39;localhost:9113&#39;</span>]
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>  - <span style=color:#f92672>job_name</span>: <span style=color:#e6db74>&#39;system&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>static_configs</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>targets</span>: [<span style=color:#e6db74>&#39;localhost:9090&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>job_name</span>: <span style=color:#e6db74>&#39;process&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>static_configs</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>targets</span>: [<span style=color:#e6db74>&#39;localhost:9256&#39;</span>]
</span></span></code></pre></div><h3 id=3-node-exporter-é…ç½®>3. Node Exporter é…ç½®</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># å®‰è£… Node Exporter</span>
</span></span><span style=display:flex><span>sudo apt-get install -y prometheus-node-exporter
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºè‡ªå®šä¹‰æŒ‡æ ‡æ”¶é›†è„šæœ¬</span>
</span></span><span style=display:flex><span>nano ~/custom_metrics.sh
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e># ~/custom_metrics.sh</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºæŒ‡æ ‡æ–‡ä»¶</span>
</span></span><span style=display:flex><span>METRICS_FILE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/var/lib/node_exporter/custom_metrics.prom&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> true; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># CPU æ¸©åº¦</span>
</span></span><span style=display:flex><span>    CPU_TEMP<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>vcgencmd measure_temp | sed <span style=color:#e6db74>&#39;s/temp=//&#39;</span> | sed <span style=color:#e6db74>&#39;s/&#39;</span><span style=color:#e6db74>&#34;&#39;&#34;</span><span style=color:#e6db74>&#39;C//&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;raspberry_pi_cpu_temperature </span>$CPU_TEMP<span style=color:#e6db74>&#34;</span> &gt; <span style=color:#e6db74>&#34;</span>$METRICS_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># AI æœåŠ¡çŠ¶æ€</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> pgrep -f llama-server &gt; /dev/null; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;ai_service_status 1&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$METRICS_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;ai_service_status 0&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$METRICS_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># åšå®¢æœåŠ¡çŠ¶æ€</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> systemctl is-active nginx &gt; /dev/null; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;blog_service_status 1&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$METRICS_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;blog_service_status 0&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$METRICS_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># å†…å­˜ä½¿ç”¨</span>
</span></span><span style=display:flex><span>    FREE_MEM<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>free | grep Mem | awk <span style=color:#e6db74>&#39;{print $4}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;system_free_memory_bytes </span>$FREE_MEM<span style=color:#e6db74>&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$METRICS_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    sleep <span style=color:#ae81ff>15</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span></code></pre></div><h2 id=äºŒåä¸€è‡ªåŠ¨åŒ–éƒ¨ç½²ä¸æ›´æ–°>äºŒåä¸€ã€è‡ªåŠ¨åŒ–éƒ¨ç½²ä¸æ›´æ–°</h2><h3 id=1-è‡ªåŠ¨éƒ¨ç½²é…ç½®è„šæœ¬>1. è‡ªåŠ¨éƒ¨ç½²é…ç½®è„šæœ¬</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºè‡ªåŠ¨éƒ¨ç½²è„šæœ¬</span>
</span></span><span style=display:flex><span>nano ~/auto_deploy.sh
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e># ~/auto_deploy.sh</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é…ç½®</span>
</span></span><span style=display:flex><span>BLOG_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/home/zhaoxiongzhou/myblog&#34;</span>
</span></span><span style=display:flex><span>LLAMA_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/home/zhaoxiongzhou/projects/llama.cpp&#34;</span>
</span></span><span style=display:flex><span>BACKUP_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/home/zhaoxiongzhou/backups&#34;</span>
</span></span><span style=display:flex><span>LOG_FILE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/var/log/auto_deploy.log&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ—¥å¿—å‡½æ•°</span>
</span></span><span style=display:flex><span>log<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;[</span><span style=color:#66d9ef>$(</span>date <span style=color:#e6db74>&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>] </span>$1<span style=color:#e6db74>&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å¤‡ä»½å½“å‰ç‰ˆæœ¬</span>
</span></span><span style=display:flex><span>backup_current<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;å¼€å§‹å¤‡ä»½å½“å‰ç‰ˆæœ¬&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># åšå®¢å¤‡ä»½</span>
</span></span><span style=display:flex><span>    tar -czf <span style=color:#e6db74>&#34;</span>$BACKUP_DIR<span style=color:#e6db74>/blog_</span><span style=color:#66d9ef>$(</span>date +%Y%m%d_%H%M%S<span style=color:#66d9ef>)</span><span style=color:#e6db74>.tar.gz&#34;</span> <span style=color:#e6db74>&#34;</span>$BLOG_DIR<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># AI æœåŠ¡å¤‡ä»½</span>
</span></span><span style=display:flex><span>    tar -czf <span style=color:#e6db74>&#34;</span>$BACKUP_DIR<span style=color:#e6db74>/llama_</span><span style=color:#66d9ef>$(</span>date +%Y%m%d_%H%M%S<span style=color:#66d9ef>)</span><span style=color:#e6db74>.tar.gz&#34;</span> <span style=color:#e6db74>&#34;</span>$LLAMA_DIR<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;å¤‡ä»½å®Œæˆ&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ›´æ–°åšå®¢</span>
</span></span><span style=display:flex><span>update_blog<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;å¼€å§‹æ›´æ–°åšå®¢&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    cd <span style=color:#e6db74>&#34;</span>$BLOG_DIR<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>||</span> exit <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ‹‰å–æœ€æ–°ä»£ç </span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> git pull origin master; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># æ›´æ–°ä¸»é¢˜</span>
</span></span><span style=display:flex><span>        git submodule update --remote themes/ananke
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># æ„å»ºç«™ç‚¹</span>
</span></span><span style=display:flex><span>        hugo --minify
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># æ›´æ–°æƒé™</span>
</span></span><span style=display:flex><span>        sudo chown -R www-data:www-data public/
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># é‡å¯ Nginx</span>
</span></span><span style=display:flex><span>        sudo systemctl restart nginx
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;åšå®¢æ›´æ–°æˆåŠŸ&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;é”™è¯¯: åšå®¢æ›´æ–°å¤±è´¥&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ›´æ–° AI æœåŠ¡</span>
</span></span><span style=display:flex><span>update_ai_service<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;å¼€å§‹æ›´æ–° AI æœåŠ¡&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    cd <span style=color:#e6db74>&#34;</span>$LLAMA_DIR<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>||</span> exit <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># åœæ­¢å½“å‰æœåŠ¡</span>
</span></span><span style=display:flex><span>    pkill llama-server
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ‹‰å–æœ€æ–°ä»£ç </span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> git pull origin master; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># é‡æ–°ç¼–è¯‘</span>
</span></span><span style=display:flex><span>        make clean
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> LLAMA_METAL<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> make -j4; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># å¯åŠ¨æœåŠ¡</span>
</span></span><span style=display:flex><span>            ./start-llama.sh
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e># éªŒè¯æœåŠ¡</span>
</span></span><span style=display:flex><span>            sleep <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> pgrep -f llama-server &gt; /dev/null; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>                log <span style=color:#e6db74>&#34;AI æœåŠ¡æ›´æ–°æˆåŠŸ&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>                log <span style=color:#e6db74>&#34;é”™è¯¯: AI æœåŠ¡å¯åŠ¨å¤±è´¥&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>            log <span style=color:#e6db74>&#34;é”™è¯¯: AI æœåŠ¡ç¼–è¯‘å¤±è´¥&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;é”™è¯¯: AI æœåŠ¡ä»£ç æ›´æ–°å¤±è´¥&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ä¸»å‡½æ•°</span>
</span></span><span style=display:flex><span>main<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;å¼€å§‹è‡ªåŠ¨éƒ¨ç½²æµç¨‹&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># åˆ›å»ºå¤‡ä»½</span>
</span></span><span style=display:flex><span>    backup_current
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ›´æ–°æœåŠ¡</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> update_blog <span style=color:#f92672>&amp;&amp;</span> update_ai_service; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;éƒ¨ç½²å®Œæˆ&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;éƒ¨ç½²å¤±è´¥&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ‰§è¡Œéƒ¨ç½²</span>
</span></span><span style=display:flex><span>main
</span></span></code></pre></div><h3 id=2-è‡ªåŠ¨æ›´æ–°æ£€æŸ¥è„šæœ¬>2. è‡ªåŠ¨æ›´æ–°æ£€æŸ¥è„šæœ¬</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºæ›´æ–°æ£€æŸ¥è„šæœ¬</span>
</span></span><span style=display:flex><span>nano ~/check_updates.sh
</span></span></code></pre></div><h2 id=äºŒåä¸€è‡ªåŠ¨æ›´æ–°æ£€æŸ¥ä¸é€šçŸ¥ç³»ç»Ÿ>äºŒåä¸€ã€è‡ªåŠ¨æ›´æ–°æ£€æŸ¥ä¸é€šçŸ¥ç³»ç»Ÿ</h2><h3 id=1-æ›´æ–°æ£€æŸ¥è„šæœ¬>1. æ›´æ–°æ£€æŸ¥è„šæœ¬</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e># ~/check_updates.sh</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é…ç½®</span>
</span></span><span style=display:flex><span>NOTIFY_SCRIPT<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/home/zhaoxiongzhou/send_notification.sh&#34;</span>
</span></span><span style=display:flex><span>LOG_FILE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/var/log/update_check.log&#34;</span>
</span></span><span style=display:flex><span>GITHUB_API<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://api.github.com&#34;</span>
</span></span><span style=display:flex><span>LLAMA_REPO<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;ggerganov/llama.cpp&#34;</span>
</span></span><span style=display:flex><span>HUGO_REPO<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;gohugoio/hugo&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ—¥å¿—å‡½æ•°</span>
</span></span><span style=display:flex><span>log<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;[</span><span style=color:#66d9ef>$(</span>date <span style=color:#e6db74>&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>] </span>$1<span style=color:#e6db74>&#34;</span> | tee -a <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ£€æŸ¥ GitHub ä»“åº“æ›´æ–°</span>
</span></span><span style=display:flex><span>check_github_updates<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    local repo<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    local current_version<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$2<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># è·å–æœ€æ–°ç‰ˆæœ¬</span>
</span></span><span style=display:flex><span>    latest_version<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>curl -s <span style=color:#e6db74>&#34;</span>$GITHUB_API<span style=color:#e6db74>/repos/</span>$repo<span style=color:#e6db74>/releases/latest&#34;</span> | grep -Po <span style=color:#e6db74>&#39;&#34;tag_name&#34;: &#34;\K.*?(?=&#34;)&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$latest_version<span style=color:#e6db74>&#34;</span> !<span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span>$current_version<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;å‘ç°æ–°ç‰ˆæœ¬: </span>$repo<span style=color:#e6db74> (</span>$current_version<span style=color:#e6db74> -&gt; </span>$latest_version<span style=color:#e6db74>)&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;å½“å‰ç‰ˆæœ¬å·²æ˜¯æœ€æ–°: </span>$repo<span style=color:#e6db74> (</span>$current_version<span style=color:#e6db74>)&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ£€æŸ¥ç³»ç»Ÿæ›´æ–°</span>
</span></span><span style=display:flex><span>check_system_updates<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    sudo apt update &gt; /dev/null 2&gt;&amp;<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    updates<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>sudo apt list --upgradable 2&gt;/dev/null | grep -c <span style=color:#e6db74>&#34;upgradable&#34;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$updates<span style=color:#e6db74>&#34;</span> -gt <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;å‘ç° </span>$updates<span style=color:#e6db74> ä¸ªç³»ç»Ÿæ›´æ–°&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;ç³»ç»Ÿå·²æ˜¯æœ€æ–°&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ£€æŸ¥æœåŠ¡çŠ¶æ€</span>
</span></span><span style=display:flex><span>check_services<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    local services<span style=color:#f92672>=(</span><span style=color:#e6db74>&#34;nginx&#34;</span> <span style=color:#e6db74>&#34;llama-server&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    local status<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> service in <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>services[@]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$service<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;nginx&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> ! systemctl is-active --quiet nginx; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>                log <span style=color:#e6db74>&#34;è­¦å‘Š: Nginx æœåŠ¡æœªè¿è¡Œ&#34;</span>
</span></span><span style=display:flex><span>                status<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$service<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;llama-server&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> ! pgrep -f llama-server &gt; /dev/null; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>                log <span style=color:#e6db74>&#34;è­¦å‘Š: AI æœåŠ¡æœªè¿è¡Œ&#34;</span>
</span></span><span style=display:flex><span>                status<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> $status
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å‘é€é€šçŸ¥</span>
</span></span><span style=display:flex><span>send_notification<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    local message<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    local priority<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$2<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -x <span style=color:#e6db74>&#34;</span>$NOTIFY_SCRIPT<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;</span>$NOTIFY_SCRIPT<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;</span>$message<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;</span>$priority<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;é€šçŸ¥è„šæœ¬ä¸å­˜åœ¨æˆ–ä¸å¯æ‰§è¡Œ&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ä¸»å‡½æ•°</span>
</span></span><span style=display:flex><span>main<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;å¼€å§‹æ£€æŸ¥æ›´æ–°&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># è·å–å½“å‰ç‰ˆæœ¬</span>
</span></span><span style=display:flex><span>    current_llama_version<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>cd ~/projects/llama.cpp <span style=color:#f92672>&amp;&amp;</span> git describe --tags<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    current_hugo_version<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>hugo version | grep -Po <span style=color:#e6db74>&#34;v\d+\.\d+\.\d+&#34;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ£€æŸ¥æ›´æ–°</span>
</span></span><span style=display:flex><span>    updates_found<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> check_github_updates <span style=color:#e6db74>&#34;</span>$LLAMA_REPO<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;</span>$current_llama_version<span style=color:#e6db74>&#34;</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        send_notification <span style=color:#e6db74>&#34;llama.cpp æœ‰æ–°ç‰ˆæœ¬å¯ç”¨&#34;</span> <span style=color:#e6db74>&#34;normal&#34;</span>
</span></span><span style=display:flex><span>        updates_found<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> check_github_updates <span style=color:#e6db74>&#34;</span>$HUGO_REPO<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;</span>$current_hugo_version<span style=color:#e6db74>&#34;</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        send_notification <span style=color:#e6db74>&#34;Hugo æœ‰æ–°ç‰ˆæœ¬å¯ç”¨&#34;</span> <span style=color:#e6db74>&#34;normal&#34;</span>
</span></span><span style=display:flex><span>        updates_found<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> check_system_updates; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        send_notification <span style=color:#e6db74>&#34;ç³»ç»Ÿæœ‰æ›´æ–°å¯ç”¨&#34;</span> <span style=color:#e6db74>&#34;normal&#34;</span>
</span></span><span style=display:flex><span>        updates_found<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ! check_services; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        send_notification <span style=color:#e6db74>&#34;æœåŠ¡çŠ¶æ€å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥&#34;</span> <span style=color:#e6db74>&#34;high&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$updates_found<span style=color:#e6db74>&#34;</span> -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;æ‰€æœ‰ç»„ä»¶å‡ä¸ºæœ€æ–°ç‰ˆæœ¬&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ‰§è¡Œæ£€æŸ¥</span>
</span></span><span style=display:flex><span>main
</span></span></code></pre></div><h2 id=äºŒåäºŒé€šçŸ¥ç³»ç»Ÿé…ç½®>äºŒåäºŒã€é€šçŸ¥ç³»ç»Ÿé…ç½®</h2><h3 id=1-é€šçŸ¥å‘é€è„šæœ¬>1. é€šçŸ¥å‘é€è„šæœ¬</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºé€šçŸ¥å‘é€è„šæœ¬</span>
</span></span><span style=display:flex><span>nano ~/send_notification.sh
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e># ~/send_notification.sh</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é…ç½®</span>
</span></span><span style=display:flex><span>TELEGRAM_BOT_TOKEN<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;your_bot_token&#34;</span>
</span></span><span style=display:flex><span>TELEGRAM_CHAT_ID<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;your_chat_id&#34;</span>
</span></span><span style=display:flex><span>EMAIL_ADDRESS<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;your_email@domain.com&#34;</span>
</span></span><span style=display:flex><span>DISCORD_WEBHOOK_URL<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;your_discord_webhook_url&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ—¥å¿—é…ç½®</span>
</span></span><span style=display:flex><span>LOG_FILE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/var/log/notifications.log&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ—¥å¿—å‡½æ•°</span>
</span></span><span style=display:flex><span>log<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;[</span><span style=color:#66d9ef>$(</span>date <span style=color:#e6db74>&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>] </span>$1<span style=color:#e6db74>&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Telegram é€šçŸ¥</span>
</span></span><span style=display:flex><span>send_telegram<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    local message<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    local priority<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$2<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ ¹æ®ä¼˜å…ˆçº§æ·»åŠ è¡¨æƒ…ç¬¦å·</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;</span>$priority<span style=color:#e6db74>&#34;</span> in
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;high&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>            message<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;ğŸš¨ ç´§æ€¥: </span>$message<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>            ;;
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;normal&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>            message<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;â„¹ï¸ é€šçŸ¥: </span>$message<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>            ;;
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;low&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>            message<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;ğŸ“ ä¿¡æ¯: </span>$message<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>            ;;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>esac</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># å‘é€æ¶ˆæ¯</span>
</span></span><span style=display:flex><span>    curl -s -X POST <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        <span style=color:#e6db74>&#34;https://api.telegram.org/bot</span>$TELEGRAM_BOT_TOKEN<span style=color:#e6db74>/sendMessage&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        -d <span style=color:#e6db74>&#34;chat_id=</span>$TELEGRAM_CHAT_ID<span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        -d <span style=color:#e6db74>&#34;text=</span>$message<span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        -d <span style=color:#e6db74>&#34;parse_mode=HTML&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;Telegram é€šçŸ¥å·²å‘é€: </span>$message<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é‚®ä»¶é€šçŸ¥</span>
</span></span><span style=display:flex><span>send_email<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    local message<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    local priority<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$2<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    local subject
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;</span>$priority<span style=color:#e6db74>&#34;</span> in
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;high&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>            subject<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;[ç´§æ€¥] æ ‘è“æ´¾æœåŠ¡è­¦å‘Š&#34;</span>
</span></span><span style=display:flex><span>            ;;
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;normal&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>            subject<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;[é€šçŸ¥] æ ‘è“æ´¾æœåŠ¡æ›´æ–°&#34;</span>
</span></span><span style=display:flex><span>            ;;
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;low&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>            subject<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;[ä¿¡æ¯] æ ‘è“æ´¾æœåŠ¡çŠ¶æ€&#34;</span>
</span></span><span style=display:flex><span>            ;;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>esac</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;</span>$message<span style=color:#e6db74>&#34;</span> | mail -s <span style=color:#e6db74>&#34;</span>$subject<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;</span>$EMAIL_ADDRESS<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;é‚®ä»¶é€šçŸ¥å·²å‘é€: </span>$subject<span style=color:#e6db74> - </span>$message<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Discord é€šçŸ¥</span>
</span></span><span style=display:flex><span>send_discord<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    local message<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    local priority<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$2<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    local color
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;</span>$priority<span style=color:#e6db74>&#34;</span> in
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;high&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>            color<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;16711680&#34;</span>  <span style=color:#75715e># çº¢è‰²</span>
</span></span><span style=display:flex><span>            ;;
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;normal&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>            color<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;65280&#34;</span>     <span style=color:#75715e># ç»¿è‰²</span>
</span></span><span style=display:flex><span>            ;;
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;low&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>            color<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;255&#34;</span>       <span style=color:#75715e># è“è‰²</span>
</span></span><span style=display:flex><span>            ;;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>esac</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    curl -H <span style=color:#e6db74>&#34;Content-Type: application/json&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        -X POST <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        -d <span style=color:#e6db74>&#34;{\&#34;embeds\&#34;: [{\&#34;description\&#34;: \&#34;</span>$message<span style=color:#e6db74>\&#34;, \&#34;color\&#34;: </span>$color<span style=color:#e6db74>}]}&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        <span style=color:#e6db74>&#34;</span>$DISCORD_WEBHOOK_URL<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;Discord é€šçŸ¥å·²å‘é€: </span>$message<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ä¸»å‡½æ•°</span>
</span></span><span style=display:flex><span>main<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    local message<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    local priority<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>2<span style=color:#66d9ef>:-</span>normal<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>  <span style=color:#75715e># é»˜è®¤ä¼˜å…ˆçº§ä¸º normal</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ£€æŸ¥å¿…è¦å‚æ•°</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -z <span style=color:#e6db74>&#34;</span>$message<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;é”™è¯¯: æ¶ˆæ¯å†…å®¹ä¸èƒ½ä¸ºç©º&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ·»åŠ ç³»ç»Ÿä¿¡æ¯</span>
</span></span><span style=display:flex><span>    local hostname<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>hostname<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    local timestamp<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>date <span style=color:#e6db74>&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    message<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;[</span>$hostname<span style=color:#e6db74>] [</span>$timestamp<span style=color:#e6db74>] </span>$message<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># å‘é€æ‰€æœ‰é€šçŸ¥</span>
</span></span><span style=display:flex><span>    send_telegram <span style=color:#e6db74>&#34;</span>$message<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;</span>$priority<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    send_email <span style=color:#e6db74>&#34;</span>$message<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;</span>$priority<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    send_discord <span style=color:#e6db74>&#34;</span>$message<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;</span>$priority<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;æ‰€æœ‰é€šçŸ¥æ¸ é“å¤„ç†å®Œæˆ&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ‰§è¡Œé€šçŸ¥å‘é€</span>
</span></span><span style=display:flex><span>main <span style=color:#e6db74>&#34;</span>$@<span style=color:#e6db74>&#34;</span>
</span></span></code></pre></div><h2 id=äºŒåä¸‰å®šæ—¶ä»»åŠ¡é…ç½®>äºŒåä¸‰ã€å®šæ—¶ä»»åŠ¡é…ç½®</h2><h3 id=1-crontab-é…ç½®>1. Crontab é…ç½®</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># ç¼–è¾‘ crontab</span>
</span></span><span style=display:flex><span>crontab -e
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># ç³»ç»Ÿç»´æŠ¤ä»»åŠ¡</span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ¯å¤©å‡Œæ™¨ 2 ç‚¹æ‰§è¡Œç³»ç»Ÿæ›´æ–°æ£€æŸ¥</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span> <span style=color:#ae81ff>2</span> * * * ~/check_updates.sh &gt; /dev/null 2&gt;&amp;<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ¯ 6 å°æ—¶æ‰§è¡Œä¸€æ¬¡æœåŠ¡å¥åº·æ£€æŸ¥</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span> */6 * * * ~/service_health_check.sh &gt; /dev/null 2&gt;&amp;<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ¯å‘¨æ—¥å‡Œæ™¨ 3 ç‚¹æ‰§è¡Œç³»ç»Ÿä¼˜åŒ–</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span> <span style=color:#ae81ff>3</span> * * <span style=color:#ae81ff>0</span> ~/system_optimize.sh &gt; /dev/null 2&gt;&amp;<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ¯å¤©å‡Œæ™¨ 4 ç‚¹æ‰§è¡Œæ—¥å¿—ç®¡ç†</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span> <span style=color:#ae81ff>4</span> * * * ~/log_management.sh &gt; /dev/null 2&gt;&amp;<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ¯å°æ—¶æ‰§è¡Œæ€§èƒ½æ•°æ®æ”¶é›†</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span> * * * * ~/collect_performance.sh &gt; /dev/null 2&gt;&amp;<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ¯ 5 åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡å…³é”®æœåŠ¡çŠ¶æ€</span>
</span></span><span style=display:flex><span>*/5 * * * * ~/monitor.sh &gt; /dev/null 2&gt;&amp;<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ¯å¤©æ™šä¸Š 11 ç‚¹æ‰§è¡Œå¤‡ä»½</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span> <span style=color:#ae81ff>23</span> * * * ~/auto_backup.sh &gt; /dev/null 2&gt;&amp;<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ¯æœˆ 1 å·æ‰§è¡Œå®Œæ•´ç³»ç»Ÿæ£€æŸ¥</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>1</span> * * ~/full_system_check.sh &gt; /dev/null 2&gt;&amp;<span style=color:#ae81ff>1</span>
</span></span></code></pre></div><h3 id=2-å®Œæ•´ç³»ç»Ÿæ£€æŸ¥è„šæœ¬>2. å®Œæ•´ç³»ç»Ÿæ£€æŸ¥è„šæœ¬</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºå®Œæ•´ç³»ç»Ÿæ£€æŸ¥è„šæœ¬</span>
</span></span><span style=display:flex><span>nano ~/full_system_check.sh
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e># ~/full_system_check.sh</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>LOG_FILE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/var/log/system_check.log&#34;</span>
</span></span><span style=display:flex><span>REPORT_FILE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/home/zhaoxiongzhou/reports/monthly_report_</span><span style=color:#66d9ef>$(</span>date +%Y%m<span style=color:#66d9ef>)</span><span style=color:#e6db74>.txt&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç¡®ä¿ç›®å½•å­˜åœ¨</span>
</span></span><span style=display:flex><span>mkdir -p <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>dirname <span style=color:#e6db74>&#34;</span>$REPORT_FILE<span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ—¥å¿—å‡½æ•°</span>
</span></span><span style=display:flex><span>log<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;[</span><span style=color:#66d9ef>$(</span>date <span style=color:#e6db74>&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>] </span>$1<span style=color:#e6db74>&#34;</span> | tee -a <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;</span>$REPORT_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç³»ç»Ÿä¿¡æ¯æ£€æŸ¥</span>
</span></span><span style=display:flex><span>check_system_info<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;=== ç³»ç»Ÿä¿¡æ¯ ===&#34;</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;ç³»ç»Ÿç‰ˆæœ¬: </span><span style=color:#66d9ef>$(</span>cat /etc/os-release | grep PRETTY_NAME<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;å†…æ ¸ç‰ˆæœ¬: </span><span style=color:#66d9ef>$(</span>uname -r<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;è¿è¡Œæ—¶é—´: </span><span style=color:#66d9ef>$(</span>uptime -p<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;æœ€åå¯åŠ¨: </span><span style=color:#66d9ef>$(</span>who -b | awk <span style=color:#e6db74>&#39;{print $3,$4}&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># èµ„æºä½¿ç”¨æ£€æŸ¥</span>
</span></span><span style=display:flex><span>check_resources<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;=== èµ„æºä½¿ç”¨æƒ…å†µ ===&#34;</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;CPU ä½¿ç”¨ç‡: </span><span style=color:#66d9ef>$(</span>top -bn1 | grep <span style=color:#e6db74>&#34;Cpu(s)&#34;</span> | awk <span style=color:#e6db74>&#39;{print $2}&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>%&#34;</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;å†…å­˜ä½¿ç”¨æƒ…å†µ:&#34;</span>
</span></span><span style=display:flex><span>    free -h | tee -a <span style=color:#e6db74>&#34;</span>$REPORT_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;ç£ç›˜ä½¿ç”¨æƒ…å†µ:&#34;</span>
</span></span><span style=display:flex><span>    df -h | tee -a <span style=color:#e6db74>&#34;</span>$REPORT_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æœåŠ¡çŠ¶æ€æ£€æŸ¥</span>
</span></span><span style=display:flex><span>check_services<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;=== æœåŠ¡çŠ¶æ€ ===&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ£€æŸ¥ Nginx</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> systemctl is-active --quiet nginx; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;Nginx: è¿è¡Œæ­£å¸¸&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;Nginx: æœªè¿è¡Œ&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ£€æŸ¥ AI æœåŠ¡</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> pgrep -f llama-server &gt; /dev/null; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;AI æœåŠ¡: è¿è¡Œæ­£å¸¸&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;AI æœåŠ¡: æœªè¿è¡Œ&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å®‰å…¨æ£€æŸ¥</span>
</span></span><span style=display:flex><span>check_security<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;=== å®‰å…¨æ£€æŸ¥ ===&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ£€æŸ¥å¤±è´¥çš„ç™»å½•å°è¯•</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;å¤±è´¥çš„ç™»å½•å°è¯•:&#34;</span>
</span></span><span style=display:flex><span>    grep <span style=color:#e6db74>&#34;Failed password&#34;</span> /var/log/auth.log | tail -n <span style=color:#ae81ff>5</span> | tee -a <span style=color:#e6db74>&#34;</span>$REPORT_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ£€æŸ¥å¼€æ”¾çš„ç«¯å£</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;å¼€æ”¾çš„ç«¯å£:&#34;</span>
</span></span><span style=display:flex><span>    netstat -tuln | grep LISTEN | tee -a <span style=color:#e6db74>&#34;</span>$REPORT_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ€§èƒ½åˆ†æ</span>
</span></span><span style=display:flex><span>analyze_performance<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;=== æ€§èƒ½åˆ†æ ===&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># åˆ†æ CPU ä½¿ç”¨æƒ…å†µ</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;CPU å¯†é›†è¿›ç¨‹:&#34;</span>
</span></span><span style=display:flex><span>    ps aux --sort<span style=color:#f92672>=</span>-%cpu | head -n <span style=color:#ae81ff>5</span> | tee -a <span style=color:#e6db74>&#34;</span>$REPORT_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># åˆ†æå†…å­˜ä½¿ç”¨æƒ…å†µ</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;å†…å­˜å¯†é›†è¿›ç¨‹:&#34;</span>
</span></span><span style=display:flex><span>    ps aux --sort<span style=color:#f92672>=</span>-%mem | head -n <span style=color:#ae81ff>5</span> | tee -a <span style=color:#e6db74>&#34;</span>$REPORT_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ä¸»å‡½æ•°</span>
</span></span><span style=display:flex><span>main<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;å¼€å§‹æœˆåº¦ç³»ç»Ÿæ£€æŸ¥ - </span><span style=color:#66d9ef>$(</span>date<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    check_system_info
</span></span><span style=display:flex><span>    check_resources
</span></span><span style=display:flex><span>    check_services
</span></span><span style=display:flex><span>    check_security
</span></span><span style=display:flex><span>    analyze_performance
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;ç³»ç»Ÿæ£€æŸ¥å®Œæˆ&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># å‘é€æŠ¥å‘Š</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -f <span style=color:#e6db74>&#34;</span>$REPORT_FILE<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        ~/send_notification.sh <span style=color:#e6db74>&#34;æœˆåº¦ç³»ç»Ÿæ£€æŸ¥æŠ¥å‘Šå·²ç”Ÿæˆ&#34;</span> <span style=color:#e6db74>&#34;normal&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ‰§è¡Œæ£€æŸ¥</span>
</span></span><span style=display:flex><span>main
</span></span></code></pre></div><h2 id=äºŒåå››ç¾éš¾æ¢å¤è®¡åˆ’>äºŒåå››ã€ç¾éš¾æ¢å¤è®¡åˆ’</h2><h3 id=1-ç³»ç»Ÿæ¢å¤è„šæœ¬>1. ç³»ç»Ÿæ¢å¤è„šæœ¬</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºç³»ç»Ÿæ¢å¤è„šæœ¬</span>
</span></span><span style=display:flex><span>nano ~/disaster_recovery.sh
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e># ~/disaster_recovery.sh</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é…ç½®</span>
</span></span><span style=display:flex><span>BACKUP_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/home/zhaoxiongzhou/backups&#34;</span>
</span></span><span style=display:flex><span>RECOVERY_LOG<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/var/log/recovery.log&#34;</span>
</span></span><span style=display:flex><span>SERVICES<span style=color:#f92672>=(</span><span style=color:#e6db74>&#34;nginx&#34;</span> <span style=color:#e6db74>&#34;llama-server&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ—¥å¿—å‡½æ•°</span>
</span></span><span style=display:flex><span>log<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;[</span><span style=color:#66d9ef>$(</span>date <span style=color:#e6db74>&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>] </span>$1<span style=color:#e6db74>&#34;</span> | tee -a <span style=color:#e6db74>&#34;</span>$RECOVERY_LOG<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># éªŒè¯å¤‡ä»½</span>
</span></span><span style=display:flex><span>verify_backup<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    local backup_file<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> ! -f <span style=color:#e6db74>&#34;</span>$backup_file<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;é”™è¯¯: å¤‡ä»½æ–‡ä»¶ä¸å­˜åœ¨ - </span>$backup_file<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ! tar -tzf <span style=color:#e6db74>&#34;</span>$backup_file<span style=color:#e6db74>&#34;</span> &gt;/dev/null 2&gt;&amp;1; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;é”™è¯¯: å¤‡ä»½æ–‡ä»¶æŸå - </span>$backup_file<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># åœæ­¢æœåŠ¡</span>
</span></span><span style=display:flex><span>stop_services<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;åœæ­¢æ‰€æœ‰æœåŠ¡...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> service in <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>SERVICES[@]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$service<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;nginx&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            sudo systemctl stop nginx
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>            pkill <span style=color:#e6db74>&#34;</span>$service<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># ç­‰å¾…æœåŠ¡å®Œå…¨åœæ­¢</span>
</span></span><span style=display:flex><span>    sleep <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ¢å¤åšå®¢æœåŠ¡</span>
</span></span><span style=display:flex><span>restore_blog<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    local backup_file<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$BACKUP_DIR<span style=color:#e6db74>/blog_latest.tar.gz&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> verify_backup <span style=color:#e6db74>&#34;</span>$backup_file<span style=color:#e6db74>&#34;</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;å¼€å§‹æ¢å¤åšå®¢æœåŠ¡...&#34;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># æ¸…ç†å½“å‰ç›®å½•</span>
</span></span><span style=display:flex><span>        rm -rf ~/myblog/*
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># è§£å‹å¤‡ä»½</span>
</span></span><span style=display:flex><span>        tar -xzf <span style=color:#e6db74>&#34;</span>$backup_file<span style=color:#e6db74>&#34;</span> -C ~/myblog/
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># é‡å»ºç«™ç‚¹</span>
</span></span><span style=display:flex><span>        cd ~/myblog
</span></span><span style=display:flex><span>        hugo --minify
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># æ¢å¤æƒé™</span>
</span></span><span style=display:flex><span>        sudo chown -R www-data:www-data public/
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;åšå®¢æœåŠ¡æ¢å¤å®Œæˆ&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;åšå®¢æœåŠ¡æ¢å¤å¤±è´¥&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ¢å¤ AI æœåŠ¡</span>
</span></span><span style=display:flex><span>restore_ai_service<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    local backup_file<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$BACKUP_DIR<span style=color:#e6db74>/llama_latest.tar.gz&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> verify_backup <span style=color:#e6db74>&#34;</span>$backup_file<span style=color:#e6db74>&#34;</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;å¼€å§‹æ¢å¤ AI æœåŠ¡...&#34;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># æ¸…ç†å½“å‰ç›®å½•</span>
</span></span><span style=display:flex><span>        rm -rf ~/projects/llama.cpp/*
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># è§£å‹å¤‡ä»½</span>
</span></span><span style=display:flex><span>        tar -xzf <span style=color:#e6db74>&#34;</span>$backup_file<span style=color:#e6db74>&#34;</span> -C ~/projects/llama.cpp/
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># é‡æ–°ç¼–è¯‘</span>
</span></span><span style=display:flex><span>        cd ~/projects/llama.cpp
</span></span><span style=display:flex><span>        make clean
</span></span><span style=display:flex><span>        LLAMA_METAL<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> make -j4
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;AI æœåŠ¡æ¢å¤å®Œæˆ&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;AI æœåŠ¡æ¢å¤å¤±è´¥&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ¢å¤ç³»ç»Ÿé…ç½®</span>
</span></span><span style=display:flex><span>restore_system_config<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    local backup_file<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$BACKUP_DIR<span style=color:#e6db74>/system_config_latest.tar.gz&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> verify_backup <span style=color:#e6db74>&#34;</span>$backup_file<span style=color:#e6db74>&#34;</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;å¼€å§‹æ¢å¤ç³»ç»Ÿé…ç½®...&#34;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># è§£å‹ç³»ç»Ÿé…ç½®</span>
</span></span><span style=display:flex><span>        sudo tar -xzf <span style=color:#e6db74>&#34;</span>$backup_file<span style=color:#e6db74>&#34;</span> -C /
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># é‡æ–°åŠ è½½ç³»ç»Ÿé…ç½®</span>
</span></span><span style=display:flex><span>        sudo sysctl --system
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;ç³»ç»Ÿé…ç½®æ¢å¤å®Œæˆ&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;ç³»ç»Ÿé…ç½®æ¢å¤å¤±è´¥&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å¯åŠ¨æœåŠ¡</span>
</span></span><span style=display:flex><span>start_services<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;å¯åŠ¨æ‰€æœ‰æœåŠ¡...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># å¯åŠ¨ Nginx</span>
</span></span><span style=display:flex><span>    sudo systemctl start nginx
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># å¯åŠ¨ AI æœåŠ¡</span>
</span></span><span style=display:flex><span>    ~/projects/llama.cpp/start-llama.sh
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># éªŒè¯æœåŠ¡çŠ¶æ€</span>
</span></span><span style=display:flex><span>    sleep <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>    verify_services
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># éªŒè¯æœåŠ¡</span>
</span></span><span style=display:flex><span>verify_services<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    local status<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;éªŒè¯æœåŠ¡çŠ¶æ€...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ£€æŸ¥ Nginx</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ! systemctl is-active --quiet nginx; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;è­¦å‘Š: Nginx æœåŠ¡æœªæ­£å¸¸è¿è¡Œ&#34;</span>
</span></span><span style=display:flex><span>        status<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ£€æŸ¥ AI æœåŠ¡</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ! pgrep -f llama-server &gt; /dev/null; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;è­¦å‘Š: AI æœåŠ¡æœªæ­£å¸¸è¿è¡Œ&#34;</span>
</span></span><span style=display:flex><span>        status<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> $status
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ä¸»å‡½æ•°</span>
</span></span><span style=display:flex><span>main<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;å¼€å§‹ç³»ç»Ÿæ¢å¤æµç¨‹...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># åœæ­¢æœåŠ¡</span>
</span></span><span style=display:flex><span>    stop_services
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ‰§è¡Œæ¢å¤</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> restore_system_config <span style=color:#f92672>&amp;&amp;</span> restore_blog <span style=color:#f92672>&amp;&amp;</span> restore_ai_service; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># å¯åŠ¨æœåŠ¡</span>
</span></span><span style=display:flex><span>        start_services
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> verify_services; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            log <span style=color:#e6db74>&#34;ç³»ç»Ÿæ¢å¤æˆåŠŸå®Œæˆ&#34;</span>
</span></span><span style=display:flex><span>            ~/send_notification.sh <span style=color:#e6db74>&#34;ç³»ç»Ÿæ¢å¤æˆåŠŸå®Œæˆ&#34;</span> <span style=color:#e6db74>&#34;normal&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>            log <span style=color:#e6db74>&#34;ç³»ç»Ÿæ¢å¤å®Œæˆï¼Œä½†éƒ¨åˆ†æœåŠ¡å¯èƒ½æœªæ­£å¸¸è¿è¡Œ&#34;</span>
</span></span><span style=display:flex><span>            ~/send_notification.sh <span style=color:#e6db74>&#34;ç³»ç»Ÿæ¢å¤å®Œæˆï¼Œä½†éœ€è¦æ‰‹åŠ¨æ£€æŸ¥æœåŠ¡çŠ¶æ€&#34;</span> <span style=color:#e6db74>&#34;high&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;ç³»ç»Ÿæ¢å¤å¤±è´¥&#34;</span>
</span></span><span style=display:flex><span>        ~/send_notification.sh <span style=color:#e6db74>&#34;ç³»ç»Ÿæ¢å¤å¤±è´¥ï¼Œéœ€è¦æ‰‹åŠ¨å¹²é¢„&#34;</span> <span style=color:#e6db74>&#34;high&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ‰§è¡Œæ¢å¤</span>
</span></span><span style=display:flex><span>main
</span></span></code></pre></div><h2 id=äºŒåäº”æ–‡æ¡£ç®¡ç†ç³»ç»Ÿ>äºŒåäº”ã€æ–‡æ¡£ç®¡ç†ç³»ç»Ÿ</h2><h3 id=1-æ–‡æ¡£ç”Ÿæˆè„šæœ¬>1. æ–‡æ¡£ç”Ÿæˆè„šæœ¬</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºæ–‡æ¡£ç”Ÿæˆè„šæœ¬</span>
</span></span><span style=display:flex><span>nano ~/generate_docs.sh
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e># ~/generate_docs.sh</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é…ç½®</span>
</span></span><span style=display:flex><span>DOCS_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/home/zhaoxiongzhou/documentation&#34;</span>
</span></span><span style=display:flex><span>SCRIPTS_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/home/zhaoxiongzhou&#34;</span>
</span></span><span style=display:flex><span>CONFIG_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/etc&#34;</span>
</span></span><span style=display:flex><span>LOG_FILE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/var/log/documentation.log&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç¡®ä¿ç›®å½•å­˜åœ¨</span>
</span></span><span style=display:flex><span>mkdir -p <span style=color:#e6db74>&#34;</span>$DOCS_DIR<span style=color:#e6db74>&#34;</span>/<span style=color:#f92672>{</span>scripts,configs,logs,maintenance<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ—¥å¿—å‡½æ•°</span>
</span></span><span style=display:flex><span>log<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;[</span><span style=color:#66d9ef>$(</span>date <span style=color:#e6db74>&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>] </span>$1<span style=color:#e6db74>&#34;</span> | tee -a <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç”Ÿæˆè„šæœ¬æ–‡æ¡£</span>
</span></span><span style=display:flex><span>generate_script_docs<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;ç”Ÿæˆè„šæœ¬æ–‡æ¡£...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> script in <span style=color:#e6db74>&#34;</span>$SCRIPTS_DIR<span style=color:#e6db74>&#34;</span>/*.sh; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -f <span style=color:#e6db74>&#34;</span>$script<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            script_name<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>basename <span style=color:#e6db74>&#34;</span>$script<span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>            output_file<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$DOCS_DIR<span style=color:#e6db74>/scripts/</span><span style=color:#e6db74>${</span>script_name%.sh<span style=color:#e6db74>}</span><span style=color:#e6db74>.md&#34;</span>
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                echo <span style=color:#e6db74>&#34;# </span>$script_name<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>                echo <span style=color:#e6db74>&#34;## è·¯å¾„: </span>$script<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>                echo <span style=color:#e6db74>&#34;## æœ€åä¿®æ”¹: </span><span style=color:#66d9ef>$(</span>date -r <span style=color:#e6db74>&#34;</span>$script<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>                echo <span style=color:#e6db74>&#34;## æƒé™: </span><span style=color:#66d9ef>$(</span>stat -c <span style=color:#e6db74>&#39;%a&#39;</span> <span style=color:#e6db74>&#34;</span>$script<span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>                echo <span style=color:#e6db74>&#34;## æ‰€æœ‰è€…: </span><span style=color:#66d9ef>$(</span>stat -c <span style=color:#e6db74>&#39;%U:%G&#39;</span> <span style=color:#e6db74>&#34;</span>$script<span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>                echo
</span></span><span style=display:flex><span>                echo <span style=color:#e6db74>&#34;## åŠŸèƒ½æè¿°&#34;</span>
</span></span><span style=display:flex><span>                grep -A <span style=color:#ae81ff>5</span> <span style=color:#e6db74>&#34;^#.*åŠŸèƒ½:&#34;</span> <span style=color:#e6db74>&#34;</span>$script<span style=color:#e6db74>&#34;</span> 2&gt;/dev/null <span style=color:#f92672>||</span> echo <span style=color:#e6db74>&#34;æœªæä¾›åŠŸèƒ½æè¿°&#34;</span>
</span></span><span style=display:flex><span>                echo
</span></span><span style=display:flex><span>                echo <span style=color:#e6db74>&#34;## è„šæœ¬å†…å®¹&#34;</span>
</span></span><span style=display:flex><span>                echo <span style=color:#e6db74>&#39;```bash&#39;</span>
</span></span><span style=display:flex><span>                cat <span style=color:#e6db74>&#34;</span>$script<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>                echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>                echo
</span></span><span style=display:flex><span>                echo <span style=color:#e6db74>&#34;## ä¾èµ–é¡¹&#34;</span>
</span></span><span style=display:flex><span>                grep <span style=color:#e6db74>&#34;^[^#]*apt.*install&#34;</span> <span style=color:#e6db74>&#34;</span>$script<span style=color:#e6db74>&#34;</span> 2&gt;/dev/null <span style=color:#f92672>||</span> echo <span style=color:#e6db74>&#34;æœªæ‰¾åˆ°æ˜ç¡®çš„ä¾èµ–é¡¹&#34;</span>
</span></span><span style=display:flex><span>                echo
</span></span><span style=display:flex><span>                echo <span style=color:#e6db74>&#34;## å®šæ—¶ä»»åŠ¡&#34;</span>
</span></span><span style=display:flex><span>                crontab -l 2&gt;/dev/null | grep <span style=color:#e6db74>&#34;</span>$script_name<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>||</span> echo <span style=color:#e6db74>&#34;æœªé…ç½®å®šæ—¶ä»»åŠ¡&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span> &gt; <span style=color:#e6db74>&#34;</span>$output_file<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç”Ÿæˆé…ç½®æ–‡æ¡£</span>
</span></span><span style=display:flex><span>generate_config_docs<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;ç”Ÿæˆé…ç½®æ–‡æ¡£...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># Nginx é…ç½®</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;# Nginx é…ç½®æ–‡æ¡£&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## ä¸»é…ç½®æ–‡ä»¶&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```nginx&#39;</span>
</span></span><span style=display:flex><span>        cat /etc/nginx/nginx.conf
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## ç«™ç‚¹é…ç½®&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```nginx&#39;</span>
</span></span><span style=display:flex><span>        cat /etc/nginx/sites-available/myblog
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span> &gt; <span style=color:#e6db74>&#34;</span>$DOCS_DIR<span style=color:#e6db74>/configs/nginx_config.md&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># ç³»ç»Ÿé…ç½®</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;# ç³»ç»Ÿé…ç½®æ–‡æ¡£&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## Sysctl é…ç½®&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```bash&#39;</span>
</span></span><span style=display:flex><span>        cat /etc/sysctl.d/99-custom.conf
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## æ ‘è“æ´¾é…ç½®&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```bash&#39;</span>
</span></span><span style=display:flex><span>        cat /boot/config.txt
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span> &gt; <span style=color:#e6db74>&#34;</span>$DOCS_DIR<span style=color:#e6db74>/configs/system_config.md&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç”Ÿæˆç»´æŠ¤æ–‡æ¡£</span>
</span></span><span style=display:flex><span>generate_maintenance_docs<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;ç”Ÿæˆç»´æŠ¤æ–‡æ¡£...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;# ç³»ç»Ÿç»´æŠ¤æ–‡æ¡£&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## å®šæ—¶ä»»åŠ¡&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```bash&#39;</span>
</span></span><span style=display:flex><span>        crontab -l
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## æœåŠ¡çŠ¶æ€&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```bash&#39;</span>
</span></span><span style=display:flex><span>        systemctl status nginx
</span></span><span style=display:flex><span>        ps aux | grep llama-server
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## èµ„æºä½¿ç”¨&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```bash&#39;</span>
</span></span><span style=display:flex><span>        df -h
</span></span><span style=display:flex><span>        free -h
</span></span><span style=display:flex><span>        top -bn1
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## æœ€è¿‘æ—¥å¿—&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```bash&#39;</span>
</span></span><span style=display:flex><span>        tail -n <span style=color:#ae81ff>50</span> /var/log/syslog
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span> &gt; <span style=color:#e6db74>&#34;</span>$DOCS_DIR<span style=color:#e6db74>/maintenance/system_status.md&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç”Ÿæˆç´¢å¼•</span>
</span></span><span style=display:flex><span>generate_index<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;ç”Ÿæˆæ–‡æ¡£ç´¢å¼•...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;# ç³»ç»Ÿæ–‡æ¡£ç´¢å¼•&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## ç”Ÿæˆæ—¶é—´: </span><span style=color:#66d9ef>$(</span>date <span style=color:#e6db74>&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        echo
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## è„šæœ¬æ–‡æ¡£&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> doc in <span style=color:#e6db74>&#34;</span>$DOCS_DIR<span style=color:#e6db74>/scripts&#34;</span>/*.md; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>            echo <span style=color:#e6db74>&#34;- [</span><span style=color:#66d9ef>$(</span>basename <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>doc%.md<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>](scripts/</span><span style=color:#66d9ef>$(</span>basename <span style=color:#e6db74>&#34;</span>$doc<span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>)&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>        echo
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## é…ç½®æ–‡æ¡£&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> doc in <span style=color:#e6db74>&#34;</span>$DOCS_DIR<span style=color:#e6db74>/configs&#34;</span>/*.md; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>            echo <span style=color:#e6db74>&#34;- [</span><span style=color:#66d9ef>$(</span>basename <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>doc%.md<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>](configs/</span><span style=color:#66d9ef>$(</span>basename <span style=color:#e6db74>&#34;</span>$doc<span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>)&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>        echo
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## ç»´æŠ¤æ–‡æ¡£&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> doc in <span style=color:#e6db74>&#34;</span>$DOCS_DIR<span style=color:#e6db74>/maintenance&#34;</span>/*.md; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>            echo <span style=color:#e6db74>&#34;- [</span><span style=color:#66d9ef>$(</span>basename <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>doc%.md<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>](maintenance/</span><span style=color:#66d9ef>$(</span>basename <span style=color:#e6db74>&#34;</span>$doc<span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>)&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span> &gt; <span style=color:#e6db74>&#34;</span>$DOCS_DIR<span style=color:#e6db74>/index.md&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ä¸»å‡½æ•°</span>
</span></span><span style=display:flex><span>main<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;å¼€å§‹ç”Ÿæˆæ–‡æ¡£...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    generate_script_docs
</span></span><span style=display:flex><span>    generate_config_docs
</span></span><span style=display:flex><span>    generate_maintenance_docs
</span></span><span style=display:flex><span>    generate_index
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;æ–‡æ¡£ç”Ÿæˆå®Œæˆ: </span>$DOCS_DIR<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ‰§è¡Œæ–‡æ¡£ç”Ÿæˆ</span>
</span></span><span style=display:flex><span>main
</span></span></code></pre></div><h2 id=äºŒåå…­æ€§èƒ½æµ‹è¯•ä¸åŸºå‡†æµ‹è¯•>äºŒåå…­ã€æ€§èƒ½æµ‹è¯•ä¸åŸºå‡†æµ‹è¯•</h2><h3 id=1-æ€§èƒ½æµ‹è¯•è„šæœ¬>1. æ€§èƒ½æµ‹è¯•è„šæœ¬</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºæ€§èƒ½æµ‹è¯•è„šæœ¬</span>
</span></span><span style=display:flex><span>nano ~/benchmark.sh
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e># ~/benchmark.sh</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é…ç½®</span>
</span></span><span style=display:flex><span>RESULTS_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/home/zhaoxiongzhou/benchmark_results&#34;</span>
</span></span><span style=display:flex><span>LOG_FILE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/var/log/benchmark.log&#34;</span>
</span></span><span style=display:flex><span>DURATION<span style=color:#f92672>=</span><span style=color:#ae81ff>300</span>  <span style=color:#75715e># æµ‹è¯•æŒç»­æ—¶é—´ï¼ˆç§’ï¼‰</span>
</span></span><span style=display:flex><span>CONCURRENT_USERS<span style=color:#f92672>=</span><span style=color:#ae81ff>10</span>  <span style=color:#75715e># å¹¶å‘ç”¨æˆ·æ•°</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç¡®ä¿ç›®å½•å­˜åœ¨</span>
</span></span><span style=display:flex><span>mkdir -p <span style=color:#e6db74>&#34;</span>$RESULTS_DIR<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ—¥å¿—å‡½æ•°</span>
</span></span><span style=display:flex><span>log<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;[</span><span style=color:#66d9ef>$(</span>date <span style=color:#e6db74>&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>] </span>$1<span style=color:#e6db74>&#34;</span> | tee -a <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># CPU æ€§èƒ½æµ‹è¯•</span>
</span></span><span style=display:flex><span>benchmark_cpu<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;å¼€å§‹ CPU æ€§èƒ½æµ‹è¯•...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># ä½¿ç”¨ sysbench è¿›è¡Œ CPU æµ‹è¯•</span>
</span></span><span style=display:flex><span>    sysbench cpu --cpu-max-prime<span style=color:#f92672>=</span><span style=color:#ae81ff>20000</span> --threads<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span> run &gt; <span style=color:#e6db74>&#34;</span>$RESULTS_DIR<span style=color:#e6db74>/cpu_benchmark.txt&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># è®°å½• CPU æ¸©åº¦</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i in <span style=color:#66d9ef>$(</span>seq <span style=color:#ae81ff>1</span> 10<span style=color:#66d9ef>)</span>; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>        vcgencmd measure_temp &gt;&gt; <span style=color:#e6db74>&#34;</span>$RESULTS_DIR<span style=color:#e6db74>/cpu_temp.txt&#34;</span>
</span></span><span style=display:flex><span>        sleep <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å†…å­˜æ€§èƒ½æµ‹è¯•</span>
</span></span><span style=display:flex><span>benchmark_memory<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;å¼€å§‹å†…å­˜æ€§èƒ½æµ‹è¯•...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># ä½¿ç”¨ sysbench è¿›è¡Œå†…å­˜æµ‹è¯•</span>
</span></span><span style=display:flex><span>    sysbench memory --memory-block-size<span style=color:#f92672>=</span>1K --memory-total-size<span style=color:#f92672>=</span>10G run &gt; <span style=color:#e6db74>&#34;</span>$RESULTS_DIR<span style=color:#e6db74>/memory_benchmark.txt&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç£ç›˜æ€§èƒ½æµ‹è¯•</span>
</span></span><span style=display:flex><span>benchmark_disk<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;å¼€å§‹ç£ç›˜æ€§èƒ½æµ‹è¯•...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># ä½¿ç”¨ dd æµ‹è¯•å†™å…¥é€Ÿåº¦</span>
</span></span><span style=display:flex><span>    dd <span style=color:#66d9ef>if</span><span style=color:#f92672>=</span>/dev/zero of<span style=color:#f92672>=</span>/tmp/test_file bs<span style=color:#f92672>=</span>1M count<span style=color:#f92672>=</span><span style=color:#ae81ff>1000</span> conv<span style=color:#f92672>=</span>fdatasync 2&gt;&gt; <span style=color:#e6db74>&#34;</span>$RESULTS_DIR<span style=color:#e6db74>/disk_write_benchmark.txt&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># ä½¿ç”¨ dd æµ‹è¯•è¯»å–é€Ÿåº¦</span>
</span></span><span style=display:flex><span>    dd <span style=color:#66d9ef>if</span><span style=color:#f92672>=</span>/tmp/test_file of<span style=color:#f92672>=</span>/dev/null bs<span style=color:#f92672>=</span>1M count<span style=color:#f92672>=</span><span style=color:#ae81ff>1000</span> 2&gt;&gt; <span style=color:#e6db74>&#34;</span>$RESULTS_DIR<span style=color:#e6db74>/disk_read_benchmark.txt&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ¸…ç†æµ‹è¯•æ–‡ä»¶</span>
</span></span><span style=display:flex><span>    rm /tmp/test_file
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç½‘ç»œæ€§èƒ½æµ‹è¯•</span>
</span></span><span style=display:flex><span>benchmark_network<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;å¼€å§‹ç½‘ç»œæ€§èƒ½æµ‹è¯•...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># ä½¿ç”¨ iperf3 æµ‹è¯•ç½‘ç»œæ€§èƒ½</span>
</span></span><span style=display:flex><span>    iperf3 -c iperf.he.net -t <span style=color:#ae81ff>30</span> &gt; <span style=color:#e6db74>&#34;</span>$RESULTS_DIR<span style=color:#e6db74>/network_benchmark.txt&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Web æœåŠ¡æ€§èƒ½æµ‹è¯•</span>
</span></span><span style=display:flex><span>benchmark_web<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;å¼€å§‹ Web æœåŠ¡æ€§èƒ½æµ‹è¯•...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># ä½¿ç”¨ ab æµ‹è¯• Web æœåŠ¡</span>
</span></span><span style=display:flex><span>    ab -n <span style=color:#ae81ff>1000</span> -c <span style=color:#e6db74>&#34;</span>$CONCURRENT_USERS<span style=color:#e6db74>&#34;</span> http://localhost/ &gt; <span style=color:#e6db74>&#34;</span>$RESULTS_DIR<span style=color:#e6db74>/web_benchmark.txt&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># AI æœåŠ¡æ€§èƒ½æµ‹è¯•</span>
</span></span><span style=display:flex><span>benchmark_ai<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;å¼€å§‹ AI æœåŠ¡æ€§èƒ½æµ‹è¯•...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># åˆ›å»ºæµ‹è¯•è¯·æ±‚</span>
</span></span><span style=display:flex><span>    cat &gt; /tmp/test_prompt.txt <span style=color:#e6db74>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Hello, how are you?
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># ä½¿ç”¨ curl æµ‹è¯• AI æœåŠ¡å“åº”æ—¶é—´</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i in <span style=color:#66d9ef>$(</span>seq <span style=color:#ae81ff>1</span> 10<span style=color:#66d9ef>)</span>; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>        time curl -X POST <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>             -H <span style=color:#e6db74>&#34;Content-Type: application/json&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>             -d @/tmp/test_prompt.txt <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>             http://localhost:8080/completion &gt;&gt; <span style=color:#e6db74>&#34;</span>$RESULTS_DIR<span style=color:#e6db74>/ai_benchmark.txt&#34;</span> 2&gt;&amp;<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        echo -e <span style=color:#e6db74>&#34;\n---\n&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$RESULTS_DIR<span style=color:#e6db74>/ai_benchmark.txt&#34;</span>
</span></span><span style=display:flex><span>        sleep <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç”ŸæˆæŠ¥å‘Š</span>
</span></span><span style=display:flex><span>generate_report<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;ç”Ÿæˆæ€§èƒ½æµ‹è¯•æŠ¥å‘Š...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    local report_file<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$RESULTS_DIR<span style=color:#e6db74>/benchmark_report_</span><span style=color:#66d9ef>$(</span>date +%Y%m%d_%H%M%S<span style=color:#66d9ef>)</span><span style=color:#e6db74>.md&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;# æ€§èƒ½æµ‹è¯•æŠ¥å‘Š&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## æµ‹è¯•æ—¶é—´: </span><span style=color:#66d9ef>$(</span>date <span style=color:#e6db74>&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        echo
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## ç³»ç»Ÿä¿¡æ¯&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        uname -a
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        echo
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## CPU æ€§èƒ½&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        cat <span style=color:#e6db74>&#34;</span>$RESULTS_DIR<span style=color:#e6db74>/cpu_benchmark.txt&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        echo
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## å†…å­˜æ€§èƒ½&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        cat <span style=color:#e6db74>&#34;</span>$RESULTS_DIR<span style=color:#e6db74>/memory_benchmark.txt&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        echo
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## ç£ç›˜æ€§èƒ½&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        cat <span style=color:#e6db74>&#34;</span>$RESULTS_DIR<span style=color:#e6db74>/disk_write_benchmark.txt&#34;</span>
</span></span><span style=display:flex><span>        cat <span style=color:#e6db74>&#34;</span>$RESULTS_DIR<span style=color:#e6db74>/disk_read_benchmark.txt&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        echo
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## ç½‘ç»œæ€§èƒ½&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        cat <span style=color:#e6db74>&#34;</span>$RESULTS_DIR<span style=color:#e6db74>/network_benchmark.txt&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        echo
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## Web æœåŠ¡æ€§èƒ½&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        cat <span style=color:#e6db74>&#34;</span>$RESULTS_DIR<span style=color:#e6db74>/web_benchmark.txt&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        echo
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## AI æœåŠ¡æ€§èƒ½&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        cat <span style=color:#e6db74>&#34;</span>$RESULTS_DIR<span style=color:#e6db74>/ai_benchmark.txt&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span> &gt; <span style=color:#e6db74>&#34;</span>$report_file<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;æ€§èƒ½æµ‹è¯•æŠ¥å‘Šå·²ç”Ÿæˆ: </span>$report_file<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ä¸»å‡½æ•°</span>
</span></span><span style=display:flex><span>main<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;å¼€å§‹æ€§èƒ½æµ‹è¯•...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># å®‰è£…å¿…è¦çš„å·¥å…·</span>
</span></span><span style=display:flex><span>    sudo apt install -y sysbench apache2-utils iperf3
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ‰§è¡Œå„é¡¹æµ‹è¯•</span>
</span></span><span style=display:flex><span>    benchmark_cpu
</span></span><span style=display:flex><span>    benchmark_memory
</span></span><span style=display:flex><span>    benchmark_disk
</span></span><span style=display:flex><span>    benchmark_network
</span></span><span style=display:flex><span>    benchmark_web
</span></span><span style=display:flex><span>    benchmark_ai
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># ç”ŸæˆæŠ¥å‘Š</span>
</span></span><span style=display:flex><span>    generate_report
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;æ€§èƒ½æµ‹è¯•å®Œæˆ&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ‰§è¡Œæµ‹è¯•</span>
</span></span><span style=display:flex><span>main
</span></span></code></pre></div><h2 id=äºŒåä¸ƒå®‰å…¨å®¡è®¡ç³»ç»Ÿ>äºŒåä¸ƒã€å®‰å…¨å®¡è®¡ç³»ç»Ÿ</h2><h3 id=1-å®‰å…¨å®¡è®¡è„šæœ¬>1. å®‰å…¨å®¡è®¡è„šæœ¬</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºå®‰å…¨å®¡è®¡è„šæœ¬</span>
</span></span><span style=display:flex><span>nano ~/security_audit.sh
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e># ~/security_audit.sh</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é…ç½®</span>
</span></span><span style=display:flex><span>AUDIT_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/home/zhaoxiongzhou/security_audits&#34;</span>
</span></span><span style=display:flex><span>REPORT_FILE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$AUDIT_DIR<span style=color:#e6db74>/security_report_</span><span style=color:#66d9ef>$(</span>date +%Y%m%d_%H%M%S<span style=color:#66d9ef>)</span><span style=color:#e6db74>.md&#34;</span>
</span></span><span style=display:flex><span>LOG_FILE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/var/log/security_audit.log&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç¡®ä¿ç›®å½•å­˜åœ¨</span>
</span></span><span style=display:flex><span>mkdir -p <span style=color:#e6db74>&#34;</span>$AUDIT_DIR<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ—¥å¿—å‡½æ•°</span>
</span></span><span style=display:flex><span>log<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;[</span><span style=color:#66d9ef>$(</span>date <span style=color:#e6db74>&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>] </span>$1<span style=color:#e6db74>&#34;</span> | tee -a <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ£€æŸ¥ç³»ç»Ÿç”¨æˆ·</span>
</span></span><span style=display:flex><span>audit_users<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;æ£€æŸ¥ç³»ç»Ÿç”¨æˆ·...&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## ç³»ç»Ÿç”¨æˆ·å®¡è®¡&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;### ç‰¹æƒç”¨æˆ·&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        awk -F: <span style=color:#e6db74>&#39;$3 == 0 {print $1}&#39;</span> /etc/passwd
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;### æœ€è¿‘çš„ç”¨æˆ·æ´»åŠ¨&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        last | head -n <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;### å¤±è´¥çš„ç™»å½•å°è¯•&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        grep <span style=color:#e6db74>&#34;Failed password&#34;</span> /var/log/auth.log | tail -n <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$REPORT_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ£€æŸ¥ç½‘ç»œå®‰å…¨</span>
</span></span><span style=display:flex><span>audit_network<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;æ£€æŸ¥ç½‘ç»œå®‰å…¨...&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## ç½‘ç»œå®‰å…¨å®¡è®¡&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;### å¼€æ”¾ç«¯å£&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        netstat -tuln
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;### æ´»åŠ¨è¿æ¥&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        netstat -nat | grep ESTABLISHED
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;### é˜²ç«å¢™è§„åˆ™&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        sudo iptables -L -n
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$REPORT_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ£€æŸ¥æ–‡ä»¶æƒé™</span>
</span></span><span style=display:flex><span>audit_permissions<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;æ£€æŸ¥æ–‡ä»¶æƒé™...&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## æ–‡ä»¶æƒé™å®¡è®¡&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;### SUID æ–‡ä»¶&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        sudo find / -type f -perm -4000 2&gt;/dev/null
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;### ä¸–ç•Œå¯å†™æ–‡ä»¶&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        sudo find / -type f -perm -2 ! -path <span style=color:#e6db74>&#34;/proc/*&#34;</span> ! -path <span style=color:#e6db74>&#34;/sys/*&#34;</span> 2&gt;/dev/null
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;### æ•æ„Ÿç›®å½•æƒé™&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        ls -la /etc/nginx/
</span></span><span style=display:flex><span>        ls -la ~/projects/llama.cpp/
</span></span><span style=display:flex><span>        ls -la ~/myblog/
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$REPORT_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ£€æŸ¥æœåŠ¡é…ç½®</span>
</span></span><span style=display:flex><span>audit_services<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;æ£€æŸ¥æœåŠ¡é…ç½®...&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## æœåŠ¡é…ç½®å®¡è®¡&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;### Nginx é…ç½®æ£€æŸ¥&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        sudo nginx -t 2&gt;&amp;<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;### SSL é…ç½®&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        openssl s_client -connect localhost:443 -servername localhost &lt;/dev/null 2&gt;/dev/null | openssl x509 -text
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;### æœåŠ¡çŠ¶æ€&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        systemctl list-units --type<span style=color:#f92672>=</span>service --state<span style=color:#f92672>=</span>active
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$REPORT_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ£€æŸ¥ç³»ç»Ÿæ›´æ–°</span>
</span></span><span style=display:flex><span>audit_updates<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;æ£€æŸ¥ç³»ç»Ÿæ›´æ–°...&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## ç³»ç»Ÿæ›´æ–°å®¡è®¡&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;### å¯ç”¨æ›´æ–°&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        apt list --upgradable 2&gt;/dev/null
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;### å·²å®‰è£…åŒ…&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        dpkg -l | grep <span style=color:#e6db74>&#34;^ii&#34;</span> | wc -l
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$REPORT_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ£€æŸ¥æ—¥å¿—å¼‚å¸¸</span>
</span></span><span style=display:flex><span>audit_logs<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;æ£€æŸ¥æ—¥å¿—å¼‚å¸¸...&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## æ—¥å¿—å®¡è®¡&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;### ç³»ç»Ÿé”™è¯¯&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        sudo journalctl -p <span style=color:#ae81ff>3</span> -xb --no-pager | tail -n <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;### å¼‚å¸¸è®¿é—®&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        grep -i <span style=color:#e6db74>&#34;error\|failed\|warning&#34;</span> /var/log/nginx/error.log | tail -n <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$REPORT_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç”Ÿæˆå®‰å…¨å»ºè®®</span>
</span></span><span style=display:flex><span>generate_recommendations<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;ç”Ÿæˆå®‰å…¨å»ºè®®...&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## å®‰å…¨å»ºè®®&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;### é«˜ä¼˜å…ˆçº§&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># æ£€æŸ¥å¹¶ç”Ÿæˆå»ºè®®</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> grep -q <span style=color:#e6db74>&#34;Failed password&#34;</span> /var/log/auth.log; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            echo <span style=color:#e6db74>&#34;- å»ºè®®ï¼šå¯ç”¨ fail2ban åŠ å¼º SSH é˜²æŠ¤&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#66d9ef>$(</span>find / -type f -perm -2 2&gt;/dev/null | wc -l<span style=color:#66d9ef>)</span> -gt <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            echo <span style=color:#e6db74>&#34;- å»ºè®®ï¼šæ£€æŸ¥å¹¶ä¿®å¤ä¸–ç•Œå¯å†™æ–‡ä»¶æƒé™&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;### ä¸­ä¼˜å…ˆçº§&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># æ·»åŠ å…¶ä»–å»ºè®®</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;- å®šæœŸæ›´æ–°ç³»ç»ŸåŒ…&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;- æ£€æŸ¥å¹¶æ›´æ–° SSL è¯ä¹¦&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;- å®šæœŸå®¡æŸ¥ç”¨æˆ·æƒé™&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$REPORT_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ä¸»å‡½æ•°</span>
</span></span><span style=display:flex><span>main<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;å¼€å§‹å®‰å…¨å®¡è®¡...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># åˆ›å»ºæŠ¥å‘Šå¤´éƒ¨</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;# å®‰å…¨å®¡è®¡æŠ¥å‘Š&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## ç”Ÿæˆæ—¶é—´: </span><span style=color:#66d9ef>$(</span>date <span style=color:#e6db74>&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## ç³»ç»Ÿä¿¡æ¯&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        uname -a
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        echo
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span> &gt; <span style=color:#e6db74>&#34;</span>$REPORT_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ‰§è¡Œå„é¡¹å®¡è®¡</span>
</span></span><span style=display:flex><span>    audit_users
</span></span><span style=display:flex><span>    audit_network
</span></span><span style=display:flex><span>    audit_permissions
</span></span><span style=display:flex><span>    audit_services
</span></span><span style=display:flex><span>    audit_updates
</span></span><span style=display:flex><span>    audit_logs
</span></span><span style=display:flex><span>    generate_recommendations
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;å®‰å…¨å®¡è®¡å®Œæˆï¼ŒæŠ¥å‘Šå·²ç”Ÿæˆ: </span>$REPORT_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># å‘é€é€šçŸ¥</span>
</span></span><span style=display:flex><span>    ~/send_notification.sh <span style=color:#e6db74>&#34;å®‰å…¨å®¡è®¡æŠ¥å‘Šå·²ç”Ÿæˆ&#34;</span> <span style=color:#e6db74>&#34;normal&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ‰§è¡Œå®¡è®¡</span>
</span></span><span style=display:flex><span>main
</span></span></code></pre></div><h2 id=äºŒåå…«èµ„æºé™åˆ¶ä¸æ§åˆ¶>äºŒåå…«ã€èµ„æºé™åˆ¶ä¸æ§åˆ¶</h2><h3 id=1-èµ„æºé™åˆ¶é…ç½®è„šæœ¬>1. èµ„æºé™åˆ¶é…ç½®è„šæœ¬</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºèµ„æºé™åˆ¶é…ç½®è„šæœ¬</span>
</span></span><span style=display:flex><span>nano ~/resource_control.sh
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e># ~/resource_control.sh</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é…ç½®</span>
</span></span><span style=display:flex><span>LOG_FILE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/var/log/resource_control.log&#34;</span>
</span></span><span style=display:flex><span>LIMITS_CONF<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/etc/security/limits.conf&#34;</span>
</span></span><span style=display:flex><span>SYSTEMD_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/etc/systemd/system&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ—¥å¿—å‡½æ•°</span>
</span></span><span style=display:flex><span>log<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;[</span><span style=color:#66d9ef>$(</span>date <span style=color:#e6db74>&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>] </span>$1<span style=color:#e6db74>&#34;</span> | tee -a <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é…ç½®ç³»ç»Ÿèµ„æºé™åˆ¶</span>
</span></span><span style=display:flex><span>configure_system_limits<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;é…ç½®ç³»ç»Ÿèµ„æºé™åˆ¶...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># å¤‡ä»½åŸå§‹é…ç½®</span>
</span></span><span style=display:flex><span>    sudo cp <span style=color:#e6db74>&#34;</span>$LIMITS_CONF<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>LIMITS_CONF<span style=color:#e6db74>}</span><span style=color:#e6db74>.backup&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ·»åŠ èµ„æºé™åˆ¶é…ç½®</span>
</span></span><span style=display:flex><span>    sudo tee -a <span style=color:#e6db74>&#34;</span>$LIMITS_CONF<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74># ç”¨æˆ·èµ„æºé™åˆ¶
</span></span></span><span style=display:flex><span><span style=color:#e6db74>zhaoxiongzhou soft nofile 65535
</span></span></span><span style=display:flex><span><span style=color:#e6db74>zhaoxiongzhou hard nofile 65535
</span></span></span><span style=display:flex><span><span style=color:#e6db74>zhaoxiongzhou soft nproc 2048
</span></span></span><span style=display:flex><span><span style=color:#e6db74>zhaoxiongzhou hard nproc 4096
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74># ç³»ç»ŸæœåŠ¡èµ„æºé™åˆ¶
</span></span></span><span style=display:flex><span><span style=color:#e6db74>www-data soft nofile 65535
</span></span></span><span style=display:flex><span><span style=color:#e6db74>www-data hard nofile 65535
</span></span></span><span style=display:flex><span><span style=color:#e6db74>www-data soft nproc 1024
</span></span></span><span style=display:flex><span><span style=color:#e6db74>www-data hard nproc 2048
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é…ç½® AI æœåŠ¡èµ„æºé™åˆ¶</span>
</span></span><span style=display:flex><span>configure_ai_service<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;é…ç½® AI æœåŠ¡èµ„æºé™åˆ¶...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># åˆ›å»º systemd æœåŠ¡æ–‡ä»¶</span>
</span></span><span style=display:flex><span>    sudo tee <span style=color:#e6db74>&#34;</span>$SYSTEMD_DIR<span style=color:#e6db74>/llama-server.service&#34;</span> <span style=color:#e6db74>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[Unit]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Description=Llama AI Server
</span></span></span><span style=display:flex><span><span style=color:#e6db74>After=network.target
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[Service]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>User=zhaoxiongzhou
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Group=zhaoxiongzhou
</span></span></span><span style=display:flex><span><span style=color:#e6db74>WorkingDirectory=/home/zhaoxiongzhou/projects/llama.cpp
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ExecStart=/home/zhaoxiongzhou/projects/llama.cpp/start-llama.sh
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74># èµ„æºé™åˆ¶
</span></span></span><span style=display:flex><span><span style=color:#e6db74>CPUQuota=80%
</span></span></span><span style=display:flex><span><span style=color:#e6db74>MemoryLimit=2G
</span></span></span><span style=display:flex><span><span style=color:#e6db74>TasksMax=128
</span></span></span><span style=display:flex><span><span style=color:#e6db74>LimitNOFILE=65535
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74># é‡å¯ç­–ç•¥
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Restart=always
</span></span></span><span style=display:flex><span><span style=color:#e6db74>RestartSec=10
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[Install]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>WantedBy=multi-user.target
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># é‡æ–°åŠ è½½ systemd é…ç½®</span>
</span></span><span style=display:flex><span>    sudo systemctl daemon-reload
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é…ç½® Nginx èµ„æºé™åˆ¶</span>
</span></span><span style=display:flex><span>configure_nginx<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;é…ç½® Nginx èµ„æºé™åˆ¶...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># ä¿®æ”¹ Nginx é…ç½®</span>
</span></span><span style=display:flex><span>    sudo tee <span style=color:#e6db74>&#34;/etc/nginx/conf.d/resource_limits.conf&#34;</span> <span style=color:#e6db74>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74># å·¥ä½œè¿›ç¨‹é™åˆ¶
</span></span></span><span style=display:flex><span><span style=color:#e6db74>worker_processes auto;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>worker_rlimit_nofile 65535;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74># è¿æ¥é™åˆ¶
</span></span></span><span style=display:flex><span><span style=color:#e6db74>events {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    worker_connections 1024;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    multi_accept on;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74># å®¢æˆ·ç«¯é™åˆ¶
</span></span></span><span style=display:flex><span><span style=color:#e6db74>http {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    # è¯·æ±‚é™åˆ¶
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    limit_req_zone \$binary_remote_addr zone=one:10m rate=10r/s;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    # è¿æ¥é™åˆ¶
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    limit_conn_zone \$binary_remote_addr zone=addr:10m;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    server {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        # åº”ç”¨é™åˆ¶
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        location / {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            limit_req zone=one burst=5;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            limit_conn addr 10;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é…ç½®ç³»ç»Ÿèµ„æºç›‘æ§</span>
</span></span><span style=display:flex><span>configure_monitoring<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;é…ç½®èµ„æºç›‘æ§...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># åˆ›å»ºç›‘æ§è„šæœ¬</span>
</span></span><span style=display:flex><span>    cat &gt; ~/monitor_resources.sh <span style=color:#e6db74>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>while true; do
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    # CPU ä½¿ç”¨ç‡
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    CPU_USAGE=\$(top -bn1 | grep &#34;Cpu(s)&#34; | awk &#39;{print \$2}&#39;)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    # å†…å­˜ä½¿ç”¨ç‡
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    MEM_USAGE=\$(free | grep Mem | awk &#39;{print \$3/\$2 * 100.0}&#39;)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    # è¿›ç¨‹æ•°
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    PROCESS_COUNT=\$(ps aux | wc -l)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    # æ£€æŸ¥é™åˆ¶
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    if (( \$(echo &#34;\$CPU_USAGE &gt; 80&#34; | bc -l) )); then
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        ~/send_notification.sh &#34;è­¦å‘Š: CPU ä½¿ç”¨ç‡è¿‡é«˜ (\${CPU_USAGE}%)&#34; &#34;high&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    fi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    if (( \$(echo &#34;\$MEM_USAGE &gt; 90&#34; | bc -l) )); then
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        ~/send_notification.sh &#34;è­¦å‘Š: å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜ (\${MEM_USAGE}%)&#34; &#34;high&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    fi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    if [ &#34;\$PROCESS_COUNT&#34; -gt 200 ]; then
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        ~/send_notification.sh &#34;è­¦å‘Š: è¿›ç¨‹æ•°è¿‡å¤š (\$PROCESS_COUNT)&#34; &#34;high&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    fi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    sleep 60
</span></span></span><span style=display:flex><span><span style=color:#e6db74>done
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    chmod +x ~/monitor_resources.sh
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># åº”ç”¨é…ç½®</span>
</span></span><span style=display:flex><span>apply_configurations<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;åº”ç”¨èµ„æºé™åˆ¶é…ç½®...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># é‡å¯æœåŠ¡</span>
</span></span><span style=display:flex><span>    sudo systemctl restart nginx
</span></span><span style=display:flex><span>    sudo systemctl restart llama-server
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># å¯åŠ¨ç›‘æ§</span>
</span></span><span style=display:flex><span>    ~/monitor_resources.sh &amp;
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># éªŒè¯é…ç½®</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;éªŒè¯é…ç½®...&#34;</span>
</span></span><span style=display:flex><span>    sudo nginx -t
</span></span><span style=display:flex><span>    sudo systemctl status llama-server
</span></span><span style=display:flex><span>    ulimit -a
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ä¸»å‡½æ•°</span>
</span></span><span style=display:flex><span>main<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;å¼€å§‹é…ç½®èµ„æºé™åˆ¶...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    configure_system_limits
</span></span><span style=display:flex><span>    configure_ai_service
</span></span><span style=display:flex><span>    configure_nginx
</span></span><span style=display:flex><span>    configure_monitoring
</span></span><span style=display:flex><span>    apply_configurations
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;èµ„æºé™åˆ¶é…ç½®å®Œæˆ&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ‰§è¡Œé…ç½®</span>
</span></span><span style=display:flex><span>main
</span></span></code></pre></div><h2 id=äºŒåä¹è‡ªåŠ¨åŒ–æµ‹è¯•ç³»ç»Ÿ>äºŒåä¹ã€è‡ªåŠ¨åŒ–æµ‹è¯•ç³»ç»Ÿ</h2><h3 id=1-é›†æˆæµ‹è¯•è„šæœ¬>1. é›†æˆæµ‹è¯•è„šæœ¬</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºé›†æˆæµ‹è¯•è„šæœ¬</span>
</span></span><span style=display:flex><span>nano ~/integration_test.sh
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e># ~/integration_test.sh</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é…ç½®</span>
</span></span><span style=display:flex><span>TEST_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/home/zhaoxiongzhou/tests&#34;</span>
</span></span><span style=display:flex><span>REPORT_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/home/zhaoxiongzhou/test_reports&#34;</span>
</span></span><span style=display:flex><span>LOG_FILE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/var/log/integration_test.log&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç¡®ä¿ç›®å½•å­˜åœ¨</span>
</span></span><span style=display:flex><span>mkdir -p <span style=color:#e6db74>&#34;</span>$TEST_DIR<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;</span>$REPORT_DIR<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ—¥å¿—å‡½æ•°</span>
</span></span><span style=display:flex><span>log<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;[</span><span style=color:#66d9ef>$(</span>date <span style=color:#e6db74>&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>] </span>$1<span style=color:#e6db74>&#34;</span> | tee -a <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æµ‹è¯• Web æœåŠ¡</span>
</span></span><span style=display:flex><span>test_web_service<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;æµ‹è¯• Web æœåŠ¡...&#34;</span>
</span></span><span style=display:flex><span>    local result<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æµ‹è¯•é¦–é¡µè®¿é—®</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> curl -s -o /dev/null -w <span style=color:#e6db74>&#34;%{http_code}&#34;</span> http://localhost/ | grep -q <span style=color:#e6db74>&#34;200&#34;</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;é¦–é¡µè®¿é—®æµ‹è¯•é€šè¿‡&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;é”™è¯¯: é¦–é¡µè®¿é—®æµ‹è¯•å¤±è´¥&#34;</span>
</span></span><span style=display:flex><span>        result<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æµ‹è¯•é™æ€èµ„æº</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> curl -s -o /dev/null -w <span style=color:#e6db74>&#34;%{http_code}&#34;</span> http://localhost/css/main.css | grep -q <span style=color:#e6db74>&#34;200&#34;</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;é™æ€èµ„æºæµ‹è¯•é€šè¿‡&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;é”™è¯¯: é™æ€èµ„æºæµ‹è¯•å¤±è´¥&#34;</span>
</span></span><span style=display:flex><span>        result<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æµ‹è¯• 404 é¡µé¢</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> curl -s -o /dev/null -w <span style=color:#e6db74>&#34;%{http_code}&#34;</span> http://localhost/nonexistent | grep -q <span style=color:#e6db74>&#34;404&#34;</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;404 é¡µé¢æµ‹è¯•é€šè¿‡&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;é”™è¯¯: 404 é¡µé¢æµ‹è¯•å¤±è´¥&#34;</span>
</span></span><span style=display:flex><span>        result<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> $result
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æµ‹è¯• AI æœåŠ¡</span>
</span></span><span style=display:flex><span>test_ai_service<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;æµ‹è¯• AI æœåŠ¡...&#34;</span>
</span></span><span style=display:flex><span>    local result<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æµ‹è¯•æœåŠ¡å¯ç”¨æ€§</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> curl -s -o /dev/null -w <span style=color:#e6db74>&#34;%{http_code}&#34;</span> http://localhost:8080/health | grep -q <span style=color:#e6db74>&#34;200&#34;</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;AI æœåŠ¡å¥åº·æ£€æŸ¥é€šè¿‡&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;é”™è¯¯: AI æœåŠ¡å¥åº·æ£€æŸ¥å¤±è´¥&#34;</span>
</span></span><span style=display:flex><span>        result<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æµ‹è¯•æ¨¡å‹å“åº”</span>
</span></span><span style=display:flex><span>    local response<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>curl -s -X POST <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        -H <span style=color:#e6db74>&#34;Content-Type: application/json&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        -d <span style=color:#e6db74>&#39;{&#34;prompt&#34;: &#34;Hello&#34;, &#34;max_tokens&#34;: 10}&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        http://localhost:8080/completion<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> echo <span style=color:#e6db74>&#34;</span>$response<span style=color:#e6db74>&#34;</span> | grep -q <span style=color:#e6db74>&#34;text&#34;</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;AI æœåŠ¡å“åº”æµ‹è¯•é€šè¿‡&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;é”™è¯¯: AI æœåŠ¡å“åº”æµ‹è¯•å¤±è´¥&#34;</span>
</span></span><span style=display:flex><span>        result<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> $result
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æµ‹è¯•ç³»ç»ŸæœåŠ¡</span>
</span></span><span style=display:flex><span>test_system_services<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;æµ‹è¯•ç³»ç»ŸæœåŠ¡...&#34;</span>
</span></span><span style=display:flex><span>    local result<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æµ‹è¯• Nginx çŠ¶æ€</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> systemctl is-active --quiet nginx; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;Nginx æœåŠ¡æµ‹è¯•é€šè¿‡&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;é”™è¯¯: Nginx æœåŠ¡æµ‹è¯•å¤±è´¥&#34;</span>
</span></span><span style=display:flex><span>        result<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æµ‹è¯•ç³»ç»Ÿèµ„æº</span>
</span></span><span style=display:flex><span>    local cpu_usage<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>top -bn1 | grep <span style=color:#e6db74>&#34;Cpu(s)&#34;</span> | awk <span style=color:#e6db74>&#39;{print $2}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    local mem_usage<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>free | grep Mem | awk <span style=color:#e6db74>&#39;{print $3/$2 * 100.0}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;</span>$cpu_usage<span style=color:#e6db74> &lt; 90&#34;</span> | bc -l<span style=color:#66d9ef>)</span> -eq <span style=color:#ae81ff>1</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;CPU ä½¿ç”¨ç‡æ­£å¸¸&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;è­¦å‘Š: CPU ä½¿ç”¨ç‡è¿‡é«˜&#34;</span>
</span></span><span style=display:flex><span>        result<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;</span>$mem_usage<span style=color:#e6db74> &lt; 90&#34;</span> | bc -l<span style=color:#66d9ef>)</span> -eq <span style=color:#ae81ff>1</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;å†…å­˜ä½¿ç”¨ç‡æ­£å¸¸&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;è­¦å‘Š: å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜&#34;</span>
</span></span><span style=display:flex><span>        result<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> $result
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š</span>
</span></span><span style=display:flex><span>generate_report<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    local web_result<span style=color:#f92672>=</span>$1
</span></span><span style=display:flex><span>    local ai_result<span style=color:#f92672>=</span>$2
</span></span><span style=display:flex><span>    local system_result<span style=color:#f92672>=</span>$3
</span></span><span style=display:flex><span>    local report_file<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$REPORT_DIR<span style=color:#e6db74>/test_report_</span><span style=color:#66d9ef>$(</span>date +%Y%m%d_%H%M%S<span style=color:#66d9ef>)</span><span style=color:#e6db74>.md&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;# é›†æˆæµ‹è¯•æŠ¥å‘Š&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## æµ‹è¯•æ—¶é—´: </span><span style=color:#66d9ef>$(</span>date <span style=color:#e6db74>&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        echo
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## æµ‹è¯•ç»“æœæ‘˜è¦&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;- Web æœåŠ¡: </span><span style=color:#66d9ef>$(</span><span style=color:#f92672>[</span> $web_result -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> echo <span style=color:#e6db74>&#39;é€šè¿‡ âœ…&#39;</span> <span style=color:#f92672>||</span> echo <span style=color:#e6db74>&#39;å¤±è´¥ âŒ&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;- AI æœåŠ¡: </span><span style=color:#66d9ef>$(</span><span style=color:#f92672>[</span> $ai_result -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> echo <span style=color:#e6db74>&#39;é€šè¿‡ âœ…&#39;</span> <span style=color:#f92672>||</span> echo <span style=color:#e6db74>&#39;å¤±è´¥ âŒ&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;- ç³»ç»ŸæœåŠ¡: </span><span style=color:#66d9ef>$(</span><span style=color:#f92672>[</span> $system_result -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> echo <span style=color:#e6db74>&#39;é€šè¿‡ âœ…&#39;</span> <span style=color:#f92672>||</span> echo <span style=color:#e6db74>&#39;å¤±è´¥ âŒ&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        echo
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## è¯¦ç»†æ—¥å¿—&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        tail -n <span style=color:#ae81ff>50</span> <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span> &gt; <span style=color:#e6db74>&#34;</span>$report_file<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;æµ‹è¯•æŠ¥å‘Šå·²ç”Ÿæˆ: </span>$report_file<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ä¸»å‡½æ•°</span>
</span></span><span style=display:flex><span>main<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;å¼€å§‹é›†æˆæµ‹è¯•...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    local web_result<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    local ai_result<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    local system_result<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ‰§è¡Œæµ‹è¯•</span>
</span></span><span style=display:flex><span>    test_web_service
</span></span><span style=display:flex><span>    web_result<span style=color:#f92672>=</span>$?
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    test_ai_service
</span></span><span style=display:flex><span>    ai_result<span style=color:#f92672>=</span>$?
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    test_system_services
</span></span><span style=display:flex><span>    system_result<span style=color:#f92672>=</span>$?
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># ç”ŸæˆæŠ¥å‘Š</span>
</span></span><span style=display:flex><span>    generate_report $web_result $ai_result $system_result
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># å‘é€é€šçŸ¥</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> $web_result -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>[</span> $ai_result -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>[</span> $system_result -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        ~/send_notification.sh <span style=color:#e6db74>&#34;é›†æˆæµ‹è¯•å…¨éƒ¨é€šè¿‡&#34;</span> <span style=color:#e6db74>&#34;normal&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        ~/send_notification.sh <span style=color:#e6db74>&#34;é›†æˆæµ‹è¯•å­˜åœ¨å¤±è´¥é¡¹ï¼Œè¯·æŸ¥çœ‹æŠ¥å‘Š&#34;</span> <span style=color:#e6db74>&#34;high&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># è¿”å›æ€»ä½“ç»“æœ</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>$((</span> web_result <span style=color:#f92672>+</span> ai_result <span style=color:#f92672>+</span> system_result <span style=color:#66d9ef>))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ‰§è¡Œæµ‹è¯•</span>
</span></span><span style=display:flex><span>main
</span></span></code></pre></div><h2 id=ä¸‰åç³»ç»ŸçŠ¶æ€ä»ªè¡¨æ¿>ä¸‰åã€ç³»ç»ŸçŠ¶æ€ä»ªè¡¨æ¿</h2><h3 id=1-çŠ¶æ€ç›‘æ§é¡µé¢ç”Ÿæˆè„šæœ¬>1. çŠ¶æ€ç›‘æ§é¡µé¢ç”Ÿæˆè„šæœ¬</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºçŠ¶æ€é¡µé¢ç”Ÿæˆè„šæœ¬</span>
</span></span><span style=display:flex><span>nano ~/generate_dashboard.sh
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e># ~/generate_dashboard.sh</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é…ç½®</span>
</span></span><span style=display:flex><span>DASHBOARD_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/var/www/html/dashboard&#34;</span>
</span></span><span style=display:flex><span>REFRESH_INTERVAL<span style=color:#f92672>=</span><span style=color:#ae81ff>60</span>  <span style=color:#75715e># é¡µé¢åˆ·æ–°é—´éš”ï¼ˆç§’ï¼‰</span>
</span></span><span style=display:flex><span>LOG_FILE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/var/log/dashboard.log&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç¡®ä¿ç›®å½•å­˜åœ¨</span>
</span></span><span style=display:flex><span>sudo mkdir -p <span style=color:#e6db74>&#34;</span>$DASHBOARD_DIR<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ—¥å¿—å‡½æ•°</span>
</span></span><span style=display:flex><span>log<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;[</span><span style=color:#66d9ef>$(</span>date <span style=color:#e6db74>&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>] </span>$1<span style=color:#e6db74>&#34;</span> | tee -a <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ”¶é›†ç³»ç»ŸçŠ¶æ€æ•°æ®</span>
</span></span><span style=display:flex><span>collect_system_data<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># CPU ä¿¡æ¯</span>
</span></span><span style=display:flex><span>    CPU_USAGE<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>top -bn1 | grep <span style=color:#e6db74>&#34;Cpu(s)&#34;</span> | awk <span style=color:#e6db74>&#39;{print $2}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    CPU_TEMP<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>vcgencmd measure_temp | sed <span style=color:#e6db74>&#39;s/temp=//&#39;</span> | sed <span style=color:#e6db74>&#39;s/&#39;</span><span style=color:#e6db74>&#34;&#39;&#34;</span><span style=color:#e6db74>&#39;C//&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># å†…å­˜ä¿¡æ¯</span>
</span></span><span style=display:flex><span>    MEM_TOTAL<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>free -m | awk <span style=color:#e6db74>&#39;/Mem:/ {print $2}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    MEM_USED<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>free -m | awk <span style=color:#e6db74>&#39;/Mem:/ {print $3}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    MEM_USAGE<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>awk <span style=color:#e6db74>&#34;BEGIN {printf \&#34;%.2f\&#34;, </span>$MEM_USED<span style=color:#e6db74>/</span>$MEM_TOTAL<span style=color:#e6db74>*100}&#34;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># ç£ç›˜ä¿¡æ¯</span>
</span></span><span style=display:flex><span>    DISK_USAGE<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>df -h / | awk <span style=color:#e6db74>&#39;NR==2 {print $5}&#39;</span> | sed <span style=color:#e6db74>&#39;s/%//&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># ç³»ç»Ÿè´Ÿè½½</span>
</span></span><span style=display:flex><span>    LOAD_AVG<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>uptime | awk -F<span style=color:#e6db74>&#39;load average:&#39;</span> <span style=color:#e6db74>&#39;{print $2}&#39;</span> | xargs<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># è¿è¡Œæ—¶é—´</span>
</span></span><span style=display:flex><span>    UPTIME<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>uptime -p<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ”¶é›†æœåŠ¡çŠ¶æ€</span>
</span></span><span style=display:flex><span>collect_service_data<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Nginx çŠ¶æ€</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> systemctl is-active --quiet nginx; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        NGINX_STATUS<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;è¿è¡Œä¸­ âœ…&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        NGINX_STATUS<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;å·²åœæ­¢ âŒ&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># AI æœåŠ¡çŠ¶æ€</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> pgrep -f llama-server &gt; /dev/null; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        AI_STATUS<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;è¿è¡Œä¸­ âœ…&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        AI_STATUS<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;å·²åœæ­¢ âŒ&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># è·å–æœ€è¿‘çš„æ—¥å¿—</span>
</span></span><span style=display:flex><span>    RECENT_LOGS<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>tail -n <span style=color:#ae81ff>10</span> /var/log/syslog | sed <span style=color:#e6db74>&#39;s/&lt;/\&amp;lt;/g&#39;</span> | sed <span style=color:#e6db74>&#39;s/&gt;/\&amp;gt;/g&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç”ŸæˆçŠ¶æ€é¡µé¢</span>
</span></span><span style=display:flex><span>generate_dashboard<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    local timestamp<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>date <span style=color:#e6db74>&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    cat &gt; <span style=color:#e6db74>&#34;</span>$DASHBOARD_DIR<span style=color:#e6db74>/index.html&#34;</span> <span style=color:#e6db74>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&lt;!DOCTYPE html&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&lt;html lang=&#34;zh&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&lt;head&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;meta charset=&#34;UTF-8&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;meta name=&#34;viewport&#34; content=&#34;width=device-width, initial-scale=1.0&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;title&gt;ç³»ç»ŸçŠ¶æ€ä»ªè¡¨æ¿&lt;/title&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;meta http-equiv=&#34;refresh&#34; content=&#34;$REFRESH_INTERVAL&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;style&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        body {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            font-family: Arial, sans-serif;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            margin: 20px;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            background-color: #f5f5f5;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        .container {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            max-width: 1200px;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            margin: 0 auto;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        .card {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            background: white;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            border-radius: 8px;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            padding: 20px;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            margin-bottom: 20px;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        .grid {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            display: grid;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            gap: 20px;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        .metric {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            text-align: center;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            padding: 15px;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            border-radius: 4px;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            background: #f8f9fa;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        .metric h3 {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            margin: 0;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            color: #666;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        .metric .value {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            font-size: 24px;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            font-weight: bold;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            margin: 10px 0;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        .status {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            display: flex;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            justify-content: space-between;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            align-items: center;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            padding: 10px;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            border-bottom: 1px solid #eee;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        .logs {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            background: #2b2b2b;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            color: #fff;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            padding: 15px;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            border-radius: 4px;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            font-family: monospace;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            white-space: pre-wrap;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;/style&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&lt;/head&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&lt;body&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;div class=&#34;container&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;h1&gt;ç³»ç»ŸçŠ¶æ€ä»ªè¡¨æ¿&lt;/h1&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;p&gt;æœ€åæ›´æ–°: $timestamp&lt;/p&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;div class=&#34;card&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;h2&gt;ç³»ç»Ÿèµ„æº&lt;/h2&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;div class=&#34;grid&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &lt;div class=&#34;metric&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    &lt;h3&gt;CPU ä½¿ç”¨ç‡&lt;/h3&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    &lt;div class=&#34;value&#34;&gt;$CPU_USAGE%&lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &lt;div class=&#34;metric&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    &lt;h3&gt;CPU æ¸©åº¦&lt;/h3&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    &lt;div class=&#34;value&#34;&gt;$CPU_TEMP&lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &lt;div class=&#34;metric&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    &lt;h3&gt;å†…å­˜ä½¿ç”¨ç‡&lt;/h3&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    &lt;div class=&#34;value&#34;&gt;$MEM_USAGE%&lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &lt;div class=&#34;metric&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    &lt;h3&gt;ç£ç›˜ä½¿ç”¨ç‡&lt;/h3&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    &lt;div class=&#34;value&#34;&gt;$DISK_USAGE%&lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;div class=&#34;card&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;h2&gt;ç³»ç»Ÿä¿¡æ¯&lt;/h2&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;div class=&#34;status&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &lt;span&gt;ç³»ç»Ÿè´Ÿè½½:&lt;/span&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &lt;span&gt;$LOAD_AVG&lt;/span&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;div class=&#34;status&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &lt;span&gt;è¿è¡Œæ—¶é—´:&lt;/span&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &lt;span&gt;$UPTIME&lt;/span&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;div class=&#34;card&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;h2&gt;æœåŠ¡çŠ¶æ€&lt;/h2&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;div class=&#34;status&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &lt;span&gt;Nginx æœåŠ¡:&lt;/span&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &lt;span&gt;$NGINX_STATUS&lt;/span&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;div class=&#34;status&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &lt;span&gt;AI æœåŠ¡:&lt;/span&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &lt;span&gt;$AI_STATUS&lt;/span&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;div class=&#34;card&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;h2&gt;æœ€è¿‘æ—¥å¿—&lt;/h2&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;div class=&#34;logs&#34;&gt;$RECENT_LOGS&lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&lt;/body&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&lt;/html&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># è®¾ç½®æƒé™</span>
</span></span><span style=display:flex><span>    sudo chown www-data:www-data <span style=color:#e6db74>&#34;</span>$DASHBOARD_DIR<span style=color:#e6db74>/index.html&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ä¸»å‡½æ•°</span>
</span></span><span style=display:flex><span>main<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;å¼€å§‹ç”ŸæˆçŠ¶æ€ä»ªè¡¨æ¿...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ”¶é›†æ•°æ®</span>
</span></span><span style=display:flex><span>    collect_system_data
</span></span><span style=display:flex><span>    collect_service_data
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># ç”Ÿæˆé¡µé¢</span>
</span></span><span style=display:flex><span>    generate_dashboard
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;çŠ¶æ€ä»ªè¡¨æ¿å·²æ›´æ–°&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ‰§è¡Œç”Ÿæˆ</span>
</span></span><span style=display:flex><span>main
</span></span></code></pre></div><h2 id=ä¸‰åä¸€ç³»ç»Ÿå¤‡ä»½ä¸æ¢å¤å®Œæ•´æ–¹æ¡ˆ>ä¸‰åä¸€ã€ç³»ç»Ÿå¤‡ä»½ä¸æ¢å¤å®Œæ•´æ–¹æ¡ˆ</h2><h3 id=1-å®Œæ•´å¤‡ä»½è„šæœ¬>1. å®Œæ•´å¤‡ä»½è„šæœ¬</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºå®Œæ•´å¤‡ä»½è„šæœ¬</span>
</span></span><span style=display:flex><span>nano ~/full_backup.sh
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e># ~/full_backup.sh</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é…ç½®</span>
</span></span><span style=display:flex><span>BACKUP_ROOT<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/mnt/backup_drive&#34;</span>
</span></span><span style=display:flex><span>BACKUP_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$BACKUP_ROOT<span style=color:#e6db74>/system_backups&#34;</span>
</span></span><span style=display:flex><span>EXCLUDE_FILE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/home/zhaoxiongzhou/backup_exclude.txt&#34;</span>
</span></span><span style=display:flex><span>LOG_FILE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/var/log/backup.log&#34;</span>
</span></span><span style=display:flex><span>RETENTION_DAYS<span style=color:#f92672>=</span><span style=color:#ae81ff>30</span>
</span></span><span style=display:flex><span>COMPRESSION_LEVEL<span style=color:#f92672>=</span><span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç¡®ä¿å¤‡ä»½ç›®å½•å­˜åœ¨</span>
</span></span><span style=display:flex><span>mkdir -p <span style=color:#e6db74>&#34;</span>$BACKUP_DIR<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ—¥å¿—å‡½æ•°</span>
</span></span><span style=display:flex><span>log<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;[</span><span style=color:#66d9ef>$(</span>date <span style=color:#e6db74>&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>] </span>$1<span style=color:#e6db74>&#34;</span> | tee -a <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ£€æŸ¥å¤‡ä»½ç¯å¢ƒ</span>
</span></span><span style=display:flex><span>check_environment<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;æ£€æŸ¥å¤‡ä»½ç¯å¢ƒ...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ£€æŸ¥å¤‡ä»½ç›®æ ‡ç›®å½•</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ! mountpoint -q <span style=color:#e6db74>&#34;</span>$BACKUP_ROOT<span style=color:#e6db74>&#34;</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;é”™è¯¯: å¤‡ä»½é©±åŠ¨å™¨æœªæŒ‚è½½&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ£€æŸ¥å¯ç”¨ç©ºé—´</span>
</span></span><span style=display:flex><span>    local available_space<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>df -BG <span style=color:#e6db74>&#34;</span>$BACKUP_ROOT<span style=color:#e6db74>&#34;</span> | awk <span style=color:#e6db74>&#39;NR==2 {print $4}&#39;</span> | sed <span style=color:#e6db74>&#39;s/G//&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$available_space<span style=color:#e6db74>&#34;</span> -lt <span style=color:#ae81ff>10</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;é”™è¯¯: å¤‡ä»½ç©ºé—´ä¸è¶³ï¼ˆå°äº 10GBï¼‰&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># åˆ›å»ºæ’é™¤æ–‡ä»¶</span>
</span></span><span style=display:flex><span>    cat &gt; <span style=color:#e6db74>&#34;</span>$EXCLUDE_FILE<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>/proc/*
</span></span></span><span style=display:flex><span><span style=color:#e6db74>/sys/*
</span></span></span><span style=display:flex><span><span style=color:#e6db74>/tmp/*
</span></span></span><span style=display:flex><span><span style=color:#e6db74>/run/*
</span></span></span><span style=display:flex><span><span style=color:#e6db74>/mnt/*
</span></span></span><span style=display:flex><span><span style=color:#e6db74>/media/*
</span></span></span><span style=display:flex><span><span style=color:#e6db74>/lost+found
</span></span></span><span style=display:flex><span><span style=color:#e6db74>/var/cache/*
</span></span></span><span style=display:flex><span><span style=color:#e6db74>/var/tmp/*
</span></span></span><span style=display:flex><span><span style=color:#e6db74>/var/log/*
</span></span></span><span style=display:flex><span><span style=color:#e6db74>/home/*/Downloads/*
</span></span></span><span style=display:flex><span><span style=color:#e6db74>/home/*/.cache/*
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># åœæ­¢æœåŠ¡</span>
</span></span><span style=display:flex><span>stop_services<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;åœæ­¢æœåŠ¡...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># åœæ­¢ Nginx</span>
</span></span><span style=display:flex><span>    sudo systemctl stop nginx
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># åœæ­¢ AI æœåŠ¡</span>
</span></span><span style=display:flex><span>    pkill llama-server
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># ç­‰å¾…æœåŠ¡å®Œå…¨åœæ­¢</span>
</span></span><span style=display:flex><span>    sleep <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å¯åŠ¨æœåŠ¡</span>
</span></span><span style=display:flex><span>start_services<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;å¯åŠ¨æœåŠ¡...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># å¯åŠ¨ Nginx</span>
</span></span><span style=display:flex><span>    sudo systemctl start nginx
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># å¯åŠ¨ AI æœåŠ¡</span>
</span></span><span style=display:flex><span>    ~/projects/llama.cpp/start-llama.sh
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># éªŒè¯æœåŠ¡çŠ¶æ€</span>
</span></span><span style=display:flex><span>    sleep <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ! systemctl is-active --quiet nginx; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;è­¦å‘Š: Nginx æœåŠ¡æœªèƒ½æ­£å¸¸å¯åŠ¨&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ! pgrep -f llama-server &gt; /dev/null; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;è­¦å‘Š: AI æœåŠ¡æœªèƒ½æ­£å¸¸å¯åŠ¨&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºå®Œæ•´å¤‡ä»½</span>
</span></span><span style=display:flex><span>create_full_backup<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    local backup_date<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>date +%Y%m%d_%H%M%S<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    local backup_file<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$BACKUP_DIR<span style=color:#e6db74>/full_backup_</span><span style=color:#e6db74>${</span>backup_date<span style=color:#e6db74>}</span><span style=color:#e6db74>.tar.gz&#34;</span>
</span></span><span style=display:flex><span>    local manifest_file<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$BACKUP_DIR<span style=color:#e6db74>/backup_manifest_</span><span style=color:#e6db74>${</span>backup_date<span style=color:#e6db74>}</span><span style=color:#e6db74>.txt&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;å¼€å§‹åˆ›å»ºå®Œæ•´å¤‡ä»½...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># åˆ›å»ºæ–‡ä»¶æ¸…å•</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;ç”Ÿæˆæ–‡ä»¶æ¸…å•...&#34;</span>
</span></span><span style=display:flex><span>    find / -xdev -type f ! -path <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>cat $EXCLUDE_FILE | tr <span style=color:#e6db74>&#39;\n&#39;</span> <span style=color:#e6db74>&#39;|&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> &gt; <span style=color:#e6db74>&#34;</span>$manifest_file<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># åˆ›å»ºå¤‡ä»½</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;åˆ›å»ºç³»ç»Ÿå¤‡ä»½...&#34;</span>
</span></span><span style=display:flex><span>    sudo tar -czf <span style=color:#e6db74>&#34;</span>$backup_file<span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        --exclude-from<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$EXCLUDE_FILE<span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        --one-file-system <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        --preserve-permissions <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        --numeric-owner <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        --checkpoint<span style=color:#f92672>=</span><span style=color:#ae81ff>1000</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        --checkpoint-action<span style=color:#f92672>=</span>dot <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        -C / .
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># éªŒè¯å¤‡ä»½</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ! tar -tzf <span style=color:#e6db74>&#34;</span>$backup_file<span style=color:#e6db74>&#34;</span> &gt;/dev/null 2&gt;&amp;1; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;é”™è¯¯: å¤‡ä»½æ–‡ä»¶éªŒè¯å¤±è´¥&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># è®¡ç®—æ ¡éªŒå’Œ</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;è®¡ç®—æ ¡éªŒå’Œ...&#34;</span>
</span></span><span style=display:flex><span>    sha256sum <span style=color:#e6db74>&#34;</span>$backup_file<span style=color:#e6db74>&#34;</span> &gt; <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>backup_file<span style=color:#e6db74>}</span><span style=color:#e6db74>.sha256&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># åˆ›å»ºå¤‡ä»½ä¿¡æ¯æ–‡ä»¶</span>
</span></span><span style=display:flex><span>    cat &gt; <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>backup_file<span style=color:#e6db74>}</span><span style=color:#e6db74>.info&#34;</span> <span style=color:#e6db74>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>å¤‡ä»½æ—¶é—´: $(date)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ç³»ç»Ÿç‰ˆæœ¬: $(cat /etc/os-release | grep PRETTY_NAME)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>å†…æ ¸ç‰ˆæœ¬: $(uname -r)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>å¤‡ä»½å¤§å°: $(du -h &#34;$backup_file&#34; | cut -f1)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>æ–‡ä»¶æ•°é‡: $(wc -l &lt; &#34;$manifest_file&#34;)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>æ’é™¤è§„åˆ™: $(cat &#34;$EXCLUDE_FILE&#34;)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ¸…ç†æ—§å¤‡ä»½</span>
</span></span><span style=display:flex><span>cleanup_old_backups<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;æ¸…ç†æ—§å¤‡ä»½...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    find <span style=color:#e6db74>&#34;</span>$BACKUP_DIR<span style=color:#e6db74>&#34;</span> -type f -name <span style=color:#e6db74>&#34;full_backup_*&#34;</span> -mtime +$RETENTION_DAYS -delete
</span></span><span style=display:flex><span>    find <span style=color:#e6db74>&#34;</span>$BACKUP_DIR<span style=color:#e6db74>&#34;</span> -type f -name <span style=color:#e6db74>&#34;backup_manifest_*&#34;</span> -mtime +$RETENTION_DAYS -delete
</span></span><span style=display:flex><span>    find <span style=color:#e6db74>&#34;</span>$BACKUP_DIR<span style=color:#e6db74>&#34;</span> -type f -name <span style=color:#e6db74>&#34;*.sha256&#34;</span> -mtime +$RETENTION_DAYS -delete
</span></span><span style=display:flex><span>    find <span style=color:#e6db74>&#34;</span>$BACKUP_DIR<span style=color:#e6db74>&#34;</span> -type f -name <span style=color:#e6db74>&#34;*.info&#34;</span> -mtime +$RETENTION_DAYS -delete
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ä¸»å‡½æ•°</span>
</span></span><span style=display:flex><span>main<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;å¼€å§‹å®Œæ•´å¤‡ä»½æµç¨‹...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ£€æŸ¥ç¯å¢ƒ</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ! check_environment; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;å¤‡ä»½ç¯å¢ƒæ£€æŸ¥å¤±è´¥ï¼Œç»ˆæ­¢å¤‡ä»½&#34;</span>
</span></span><span style=display:flex><span>        ~/send_notification.sh <span style=color:#e6db74>&#34;ç³»ç»Ÿå¤‡ä»½å¤±è´¥ï¼šç¯å¢ƒæ£€æŸ¥æœªé€šè¿‡&#34;</span> <span style=color:#e6db74>&#34;high&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># åœæ­¢æœåŠ¡</span>
</span></span><span style=display:flex><span>    stop_services
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># åˆ›å»ºå¤‡ä»½</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> create_full_backup; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;å¤‡ä»½åˆ›å»ºæˆåŠŸ&#34;</span>
</span></span><span style=display:flex><span>        ~/send_notification.sh <span style=color:#e6db74>&#34;ç³»ç»Ÿå®Œæ•´å¤‡ä»½å·²æˆåŠŸåˆ›å»º&#34;</span> <span style=color:#e6db74>&#34;normal&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;å¤‡ä»½åˆ›å»ºå¤±è´¥&#34;</span>
</span></span><span style=display:flex><span>        ~/send_notification.sh <span style=color:#e6db74>&#34;ç³»ç»Ÿå¤‡ä»½å¤±è´¥ï¼šå¤‡ä»½åˆ›å»ºè¿‡ç¨‹å‡ºé”™&#34;</span> <span style=color:#e6db74>&#34;high&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># å¯åŠ¨æœåŠ¡</span>
</span></span><span style=display:flex><span>    start_services
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ¸…ç†æ—§å¤‡ä»½</span>
</span></span><span style=display:flex><span>    cleanup_old_backups
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;å¤‡ä»½æµç¨‹å®Œæˆ&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ‰§è¡Œå¤‡ä»½</span>
</span></span><span style=display:flex><span>main
</span></span></code></pre></div><h2 id=ä¸‰åäºŒç³»ç»Ÿæ¢å¤è„šæœ¬>ä¸‰åäºŒã€ç³»ç»Ÿæ¢å¤è„šæœ¬</h2><h3 id=1-ç³»ç»Ÿæ¢å¤è„šæœ¬-1>1. ç³»ç»Ÿæ¢å¤è„šæœ¬</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºç³»ç»Ÿæ¢å¤è„šæœ¬</span>
</span></span><span style=display:flex><span>nano ~/system_restore.sh
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e># ~/system_restore.sh</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é…ç½®</span>
</span></span><span style=display:flex><span>BACKUP_ROOT<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/mnt/backup_drive&#34;</span>
</span></span><span style=display:flex><span>BACKUP_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$BACKUP_ROOT<span style=color:#e6db74>/system_backups&#34;</span>
</span></span><span style=display:flex><span>LOG_FILE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/var/log/restore.log&#34;</span>
</span></span><span style=display:flex><span>TEMP_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/tmp/restore_temp&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ—¥å¿—å‡½æ•°</span>
</span></span><span style=display:flex><span>log<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;[</span><span style=color:#66d9ef>$(</span>date <span style=color:#e6db74>&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>] </span>$1<span style=color:#e6db74>&#34;</span> | tee -a <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># éªŒè¯å¤‡ä»½æ–‡ä»¶</span>
</span></span><span style=display:flex><span>verify_backup<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    local backup_file<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;éªŒè¯å¤‡ä»½æ–‡ä»¶: </span>$backup_file<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> ! -f <span style=color:#e6db74>&#34;</span>$backup_file<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;é”™è¯¯: å¤‡ä»½æ–‡ä»¶ä¸å­˜åœ¨&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ£€æŸ¥æ ¡éªŒå’Œ</span>
</span></span><span style=display:flex><span>    local checksum_file<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>backup_file<span style=color:#e6db74>}</span><span style=color:#e6db74>.sha256&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -f <span style=color:#e6db74>&#34;</span>$checksum_file<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ! sha256sum -c <span style=color:#e6db74>&#34;</span>$checksum_file<span style=color:#e6db74>&#34;</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            log <span style=color:#e6db74>&#34;é”™è¯¯: å¤‡ä»½æ–‡ä»¶æ ¡éªŒå’ŒéªŒè¯å¤±è´¥&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;è­¦å‘Š: æœªæ‰¾åˆ°æ ¡éªŒå’Œæ–‡ä»¶&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æµ‹è¯•å½’æ¡£å®Œæ•´æ€§</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ! tar -tzf <span style=color:#e6db74>&#34;</span>$backup_file<span style=color:#e6db74>&#34;</span> &gt;/dev/null 2&gt;&amp;1; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;é”™è¯¯: å¤‡ä»½æ–‡ä»¶æŸå&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å‡†å¤‡æ¢å¤ç¯å¢ƒ</span>
</span></span><span style=display:flex><span>prepare_environment<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;å‡†å¤‡æ¢å¤ç¯å¢ƒ...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># åˆ›å»ºä¸´æ—¶ç›®å½•</span>
</span></span><span style=display:flex><span>    mkdir -p <span style=color:#e6db74>&#34;</span>$TEMP_DIR<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># åœæ­¢æ‰€æœ‰æœåŠ¡</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;åœæ­¢æœåŠ¡...&#34;</span>
</span></span><span style=display:flex><span>    sudo systemctl stop nginx
</span></span><span style=display:flex><span>    pkill llama-server
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># ç­‰å¾…æœåŠ¡åœæ­¢</span>
</span></span><span style=display:flex><span>    sleep <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ¸…ç†ç›®æ ‡ç›®å½•</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;æ¸…ç†ç›®æ ‡ç›®å½•...&#34;</span>
</span></span><span style=display:flex><span>    read -p <span style=color:#e6db74>&#34;è­¦å‘Š: è¿™å°†æ¸…é™¤ç³»ç»Ÿæ–‡ä»¶ã€‚ç¡®å®šè¦ç»§ç»­å—ï¼Ÿ(y/n) &#34;</span> -n <span style=color:#ae81ff>1</span> -r
</span></span><span style=display:flex><span>    echo
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> ! $REPLY <span style=color:#f92672>=</span>~ ^<span style=color:#f92672>[</span>Yy<span style=color:#f92672>]</span>$ <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;ç”¨æˆ·å–æ¶ˆæ“ä½œ&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ‰§è¡Œæ¢å¤</span>
</span></span><span style=display:flex><span>perform_restore<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    local backup_file<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;å¼€å§‹æ¢å¤ç³»ç»Ÿ...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># åˆ›å»ºæ¢å¤å‰çš„å¿«ç…§</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;åˆ›å»ºå½“å‰ç³»ç»Ÿå¿«ç…§...&#34;</span>
</span></span><span style=display:flex><span>    local snapshot_date<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>date +%Y%m%d_%H%M%S<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    local snapshot_file<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$BACKUP_DIR<span style=color:#e6db74>/pre_restore_snapshot_</span><span style=color:#e6db74>${</span>snapshot_date<span style=color:#e6db74>}</span><span style=color:#e6db74>.tar.gz&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    sudo tar -czf <span style=color:#e6db74>&#34;</span>$snapshot_file<span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        --exclude-from<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/home/zhaoxiongzhou/backup_exclude.txt&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        --one-file-system <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        -C / .
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># è§£å‹å¤‡ä»½</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;è§£å‹å¤‡ä»½æ–‡ä»¶...&#34;</span>
</span></span><span style=display:flex><span>    sudo tar -xzf <span style=color:#e6db74>&#34;</span>$backup_file<span style=color:#e6db74>&#34;</span> -C / <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        --numeric-owner <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        --preserve-permissions <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        --checkpoint<span style=color:#f92672>=</span><span style=color:#ae81ff>1000</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        --checkpoint-action<span style=color:#f92672>=</span>dot
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># ä¿®å¤æƒé™</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;ä¿®å¤æ–‡ä»¶æƒé™...&#34;</span>
</span></span><span style=display:flex><span>    sudo chown -R www-data:www-data /var/www/
</span></span><span style=display:flex><span>    sudo chown -R zhaoxiongzhou:zhaoxiongzhou /home/zhaoxiongzhou/
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ¢å¤æœåŠ¡é…ç½®</span>
</span></span><span style=display:flex><span>restore_configurations<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;æ¢å¤æœåŠ¡é…ç½®...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># é‡æ–°åŠ è½½ç³»ç»Ÿé…ç½®</span>
</span></span><span style=display:flex><span>    sudo systemctl daemon-reload
</span></span><span style=display:flex><span>    sudo sysctl --system
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># é‡æ–°é…ç½®ç½‘ç»œ</span>
</span></span><span style=display:flex><span>    sudo systemctl restart networking
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ¢å¤é˜²ç«å¢™è§„åˆ™</span>
</span></span><span style=display:flex><span>    sudo iptables-restore &lt; /etc/iptables/rules.v4
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># éªŒè¯æ¢å¤</span>
</span></span><span style=display:flex><span>verify_restore<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;éªŒè¯ç³»ç»Ÿæ¢å¤...&#34;</span>
</span></span><span style=display:flex><span>    local status<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ£€æŸ¥å…³é”®æ–‡ä»¶</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> file in <span style=color:#e6db74>&#34;/etc/nginx/nginx.conf&#34;</span> <span style=color:#e6db74>&#34;/etc/systemd/system/llama-server.service&#34;</span>; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> ! -f <span style=color:#e6db74>&#34;</span>$file<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            log <span style=color:#e6db74>&#34;é”™è¯¯: æœªæ‰¾åˆ°å…³é”®æ–‡ä»¶ </span>$file<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>            status<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># å¯åŠ¨æœåŠ¡</span>
</span></span><span style=display:flex><span>    sudo systemctl start nginx
</span></span><span style=display:flex><span>    ~/projects/llama.cpp/start-llama.sh
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># éªŒè¯æœåŠ¡çŠ¶æ€</span>
</span></span><span style=display:flex><span>    sleep <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ! systemctl is-active --quiet nginx; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;é”™è¯¯: Nginx æœåŠ¡æœªèƒ½æ­£å¸¸å¯åŠ¨&#34;</span>
</span></span><span style=display:flex><span>        status<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ! pgrep -f llama-server &gt; /dev/null; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;é”™è¯¯: AI æœåŠ¡æœªèƒ½æ­£å¸¸å¯åŠ¨&#34;</span>
</span></span><span style=display:flex><span>        status<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> $status
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ¸…ç†æ¢å¤ç¯å¢ƒ</span>
</span></span><span style=display:flex><span>cleanup<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;æ¸…ç†æ¢å¤ç¯å¢ƒ...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># åˆ é™¤ä¸´æ—¶æ–‡ä»¶</span>
</span></span><span style=display:flex><span>    rm -rf <span style=color:#e6db74>&#34;</span>$TEMP_DIR<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ¸…ç†æ—¥å¿—</span>
</span></span><span style=display:flex><span>    find /var/log -type f -name <span style=color:#e6db74>&#34;*.gz&#34;</span> -delete
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ä¸»å‡½æ•°</span>
</span></span><span style=display:flex><span>main<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    local backup_file
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># åˆ—å‡ºå¯ç”¨å¤‡ä»½</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;å¯ç”¨çš„å¤‡ä»½æ–‡ä»¶:&#34;</span>
</span></span><span style=display:flex><span>    ls -lh <span style=color:#e6db74>&#34;</span>$BACKUP_DIR<span style=color:#e6db74>&#34;</span>/full_backup_*.tar.gz
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># é€‰æ‹©å¤‡ä»½æ–‡ä»¶</span>
</span></span><span style=display:flex><span>    read -p <span style=color:#e6db74>&#34;è¯·è¾“å…¥è¦æ¢å¤çš„å¤‡ä»½æ–‡ä»¶å®Œæ•´è·¯å¾„: &#34;</span> backup_file
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># éªŒè¯å¤‡ä»½</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ! verify_backup <span style=color:#e6db74>&#34;</span>$backup_file<span style=color:#e6db74>&#34;</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;å¤‡ä»½éªŒè¯å¤±è´¥ï¼Œç»ˆæ­¢æ¢å¤&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># å‡†å¤‡ç¯å¢ƒ</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ! prepare_environment; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;ç¯å¢ƒå‡†å¤‡å¤±è´¥ï¼Œç»ˆæ­¢æ¢å¤&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ‰§è¡Œæ¢å¤</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> perform_restore <span style=color:#e6db74>&#34;</span>$backup_file<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>       restore_configurations <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>       verify_restore; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;ç³»ç»Ÿæ¢å¤æˆåŠŸå®Œæˆ&#34;</span>
</span></span><span style=display:flex><span>        ~/send_notification.sh <span style=color:#e6db74>&#34;ç³»ç»Ÿæ¢å¤æˆåŠŸå®Œæˆ&#34;</span> <span style=color:#e6db74>&#34;normal&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;ç³»ç»Ÿæ¢å¤å¤±è´¥&#34;</span>
</span></span><span style=display:flex><span>        ~/send_notification.sh <span style=color:#e6db74>&#34;ç³»ç»Ÿæ¢å¤å¤±è´¥ï¼Œéœ€è¦æ‰‹åŠ¨æ£€æŸ¥&#34;</span> <span style=color:#e6db74>&#34;high&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ¸…ç†ç¯å¢ƒ</span>
</span></span><span style=display:flex><span>    cleanup
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ‰§è¡Œæ¢å¤</span>
</span></span><span style=display:flex><span>main
</span></span></code></pre></div><h2 id=ä¸‰åä¸‰ç³»ç»Ÿè¿ç§»å·¥å…·>ä¸‰åä¸‰ã€ç³»ç»Ÿè¿ç§»å·¥å…·</h2><h3 id=1-ç³»ç»Ÿè¿ç§»è„šæœ¬>1. ç³»ç»Ÿè¿ç§»è„šæœ¬</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºç³»ç»Ÿè¿ç§»è„šæœ¬</span>
</span></span><span style=display:flex><span>nano ~/system_migration.sh
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e># ~/system_migration.sh</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é…ç½®</span>
</span></span><span style=display:flex><span>SOURCE_HOST<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;old-raspberry.local&#34;</span>
</span></span><span style=display:flex><span>TARGET_HOST<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;new-raspberry.local&#34;</span>
</span></span><span style=display:flex><span>MIGRATION_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/mnt/migration&#34;</span>
</span></span><span style=display:flex><span>LOG_FILE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/var/log/migration.log&#34;</span>
</span></span><span style=display:flex><span>SSH_KEY<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;~/.ssh/migration_key&#34;</span>
</span></span><span style=display:flex><span>RSYNC_OPTS<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;-avz --progress --delete&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ—¥å¿—å‡½æ•°</span>
</span></span><span style=display:flex><span>log<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;[</span><span style=color:#66d9ef>$(</span>date <span style=color:#e6db74>&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>] </span>$1<span style=color:#e6db74>&#34;</span> | tee -a <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ£€æŸ¥è¿ç§»ç¯å¢ƒ</span>
</span></span><span style=display:flex><span>check_migration_env<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;æ£€æŸ¥è¿ç§»ç¯å¢ƒ...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ£€æŸ¥ SSH å¯†é’¥</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> ! -f <span style=color:#e6db74>&#34;</span>$SSH_KEY<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;ç”Ÿæˆ SSH å¯†é’¥...&#34;</span>
</span></span><span style=display:flex><span>        ssh-keygen -t ed25519 -f <span style=color:#e6db74>&#34;</span>$SSH_KEY<span style=color:#e6db74>&#34;</span> -N <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># å¤åˆ¶å¯†é’¥åˆ°ç›®æ ‡ä¸»æœº</span>
</span></span><span style=display:flex><span>        ssh-copy-id -i <span style=color:#e6db74>&#34;</span>$SSH_KEY<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;zhaoxiongzhou@</span>$TARGET_HOST<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ£€æŸ¥å¿…è¦å·¥å…·</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> tool in rsync ssh scp; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ! command -v $tool &amp;&gt;/dev/null; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            log <span style=color:#e6db74>&#34;é”™è¯¯: æœªæ‰¾åˆ°å¿…è¦å·¥å…· </span>$tool<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ£€æŸ¥ç›®æ ‡ä¸»æœºè¿æ¥</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ! ssh -i <span style=color:#e6db74>&#34;</span>$SSH_KEY<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;zhaoxiongzhou@</span>$TARGET_HOST<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;echo &#39;Connection test&#39;&#34;</span> &amp;&gt;/dev/null; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;é”™è¯¯: æ— æ³•è¿æ¥åˆ°ç›®æ ‡ä¸»æœº&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># è¿ç§»é…ç½®æ–‡ä»¶</span>
</span></span><span style=display:flex><span>migrate_configs<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;è¿ç§»é…ç½®æ–‡ä»¶...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># åˆ›å»ºé…ç½®ç›®å½•</span>
</span></span><span style=display:flex><span>    ssh -i <span style=color:#e6db74>&#34;</span>$SSH_KEY<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;zhaoxiongzhou@</span>$TARGET_HOST<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;mkdir -p ~/configs_backup&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># è¿ç§» Nginx é…ç½®</span>
</span></span><span style=display:flex><span>    rsync $RSYNC_OPTS -e <span style=color:#e6db74>&#34;ssh -i </span>$SSH_KEY<span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        /etc/nginx/ <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        <span style=color:#e6db74>&#34;zhaoxiongzhou@</span>$TARGET_HOST<span style=color:#e6db74>:~/configs_backup/nginx/&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># è¿ç§»ç³»ç»Ÿé…ç½®</span>
</span></span><span style=display:flex><span>    rsync $RSYNC_OPTS -e <span style=color:#e6db74>&#34;ssh -i </span>$SSH_KEY<span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        /etc/sysctl.d/ <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        <span style=color:#e6db74>&#34;zhaoxiongzhou@</span>$TARGET_HOST<span style=color:#e6db74>:~/configs_backup/sysctl/&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># è¿ç§»æœåŠ¡é…ç½®</span>
</span></span><span style=display:flex><span>    rsync $RSYNC_OPTS -e <span style=color:#e6db74>&#34;ssh -i </span>$SSH_KEY<span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        /etc/systemd/system/ <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        <span style=color:#e6db74>&#34;zhaoxiongzhou@</span>$TARGET_HOST<span style=color:#e6db74>:~/configs_backup/systemd/&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># è¿ç§»æ•°æ®</span>
</span></span><span style=display:flex><span>migrate_data<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;è¿ç§»æ•°æ®...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># è¿ç§»åšå®¢æ•°æ®</span>
</span></span><span style=display:flex><span>    rsync $RSYNC_OPTS -e <span style=color:#e6db74>&#34;ssh -i </span>$SSH_KEY<span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        ~/myblog/ <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        <span style=color:#e6db74>&#34;zhaoxiongzhou@</span>$TARGET_HOST<span style=color:#e6db74>:~/myblog/&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># è¿ç§» AI æœåŠ¡æ•°æ®</span>
</span></span><span style=display:flex><span>    rsync $RSYNC_OPTS -e <span style=color:#e6db74>&#34;ssh -i </span>$SSH_KEY<span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        ~/projects/llama.cpp/ <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        <span style=color:#e6db74>&#34;zhaoxiongzhou@</span>$TARGET_HOST<span style=color:#e6db74>:~/projects/llama.cpp/&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># è¿ç§»ç”¨æˆ·è„šæœ¬</span>
</span></span><span style=display:flex><span>    rsync $RSYNC_OPTS -e <span style=color:#e6db74>&#34;ssh -i </span>$SSH_KEY<span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        ~/*.sh <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        <span style=color:#e6db74>&#34;zhaoxiongzhou@</span>$TARGET_HOST<span style=color:#e6db74>:~/&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># è¿ç§»æ•°æ®åº“</span>
</span></span><span style=display:flex><span>migrate_database<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;è¿ç§»æ•°æ®åº“...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># å¯¼å‡ºæ•°æ®åº“</span>
</span></span><span style=display:flex><span>    local dump_file<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/tmp/database_dump.sql&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -f <span style=color:#e6db74>&#34;/var/lib/mysql&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        mysqldump --all-databases &gt; <span style=color:#e6db74>&#34;</span>$dump_file<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># ä¼ è¾“åˆ°ç›®æ ‡ä¸»æœº</span>
</span></span><span style=display:flex><span>        scp -i <span style=color:#e6db74>&#34;</span>$SSH_KEY<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;</span>$dump_file<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;zhaoxiongzhou@</span>$TARGET_HOST<span style=color:#e6db74>:/tmp/&#34;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># åœ¨ç›®æ ‡ä¸»æœºå¯¼å…¥æ•°æ®åº“</span>
</span></span><span style=display:flex><span>        ssh -i <span style=color:#e6db74>&#34;</span>$SSH_KEY<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;zhaoxiongzhou@</span>$TARGET_HOST<span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>            <span style=color:#e6db74>&#34;mysql &lt; /tmp/database_dump.sql&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é…ç½®ç›®æ ‡ç³»ç»Ÿ</span>
</span></span><span style=display:flex><span>configure_target<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;é…ç½®ç›®æ ‡ç³»ç»Ÿ...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    ssh -i <span style=color:#e6db74>&#34;</span>$SSH_KEY<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;zhaoxiongzhou@</span>$TARGET_HOST<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;bash -s&#34;</span> <span style=color:#e6db74>&lt;&lt; &#39;EOF&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        # å®‰è£…å¿…è¦è½¯ä»¶
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        sudo apt update
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        sudo apt install -y nginx mysql-server python3 pip
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        # æ¢å¤é…ç½®
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        sudo cp -r ~/configs_backup/nginx/* /etc/nginx/
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        sudo cp -r ~/configs_backup/sysctl/* /etc/sysctl.d/
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        sudo cp -r ~/configs_backup/systemd/* /etc/systemd/system/
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        # è®¾ç½®æƒé™
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        sudo chown -R www-data:www-data /var/www/
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        sudo chmod +x ~/*.sh
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        # é‡å¯æœåŠ¡
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        sudo systemctl daemon-reload
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        sudo systemctl restart nginx
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># éªŒè¯è¿ç§»</span>
</span></span><span style=display:flex><span>verify_migration<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;éªŒè¯è¿ç§»...&#34;</span>
</span></span><span style=display:flex><span>    local status<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ£€æŸ¥æœåŠ¡çŠ¶æ€</span>
</span></span><span style=display:flex><span>    ssh -i <span style=color:#e6db74>&#34;</span>$SSH_KEY<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;zhaoxiongzhou@</span>$TARGET_HOST<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;bash -s&#34;</span> <span style=color:#e6db74>&lt;&lt; &#39;EOF&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        # æ£€æŸ¥ Nginx
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        if ! systemctl is-active --quiet nginx; then
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            echo &#34;é”™è¯¯: Nginx æœåŠ¡æœªè¿è¡Œ&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            exit 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        fi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        # æ£€æŸ¥æ–‡ä»¶
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        for dir in &#34;~/myblog&#34; &#34;~/projects/llama.cpp&#34;; do
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            if [ ! -d &#34;$dir&#34; ]; then
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                echo &#34;é”™è¯¯: ç›®å½• $dir ä¸å­˜åœ¨&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                exit 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            fi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        done
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        # æ£€æŸ¥é…ç½®
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        if ! nginx -t &amp;&gt;/dev/null; then
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            echo &#34;é”™è¯¯: Nginx é…ç½®æ— æ•ˆ&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            exit 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        fi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    status<span style=color:#f92672>=</span>$?
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> $status
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ä¸»å‡½æ•°</span>
</span></span><span style=display:flex><span>main<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;å¼€å§‹ç³»ç»Ÿè¿ç§»...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ£€æŸ¥ç¯å¢ƒ</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ! check_migration_env; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;è¿ç§»ç¯å¢ƒæ£€æŸ¥å¤±è´¥&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ‰§è¡Œè¿ç§»</span>
</span></span><span style=display:flex><span>    migrate_configs
</span></span><span style=display:flex><span>    migrate_data
</span></span><span style=display:flex><span>    migrate_database
</span></span><span style=display:flex><span>    configure_target
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># éªŒè¯è¿ç§»</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> verify_migration; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;ç³»ç»Ÿè¿ç§»æˆåŠŸå®Œæˆ&#34;</span>
</span></span><span style=display:flex><span>        ~/send_notification.sh <span style=color:#e6db74>&#34;ç³»ç»Ÿè¿ç§»æˆåŠŸå®Œæˆ&#34;</span> <span style=color:#e6db74>&#34;normal&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;ç³»ç»Ÿè¿ç§»å¤±è´¥&#34;</span>
</span></span><span style=display:flex><span>        ~/send_notification.sh <span style=color:#e6db74>&#34;ç³»ç»Ÿè¿ç§»å¤±è´¥ï¼Œéœ€è¦æ‰‹åŠ¨æ£€æŸ¥&#34;</span> <span style=color:#e6db74>&#34;high&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ‰§è¡Œè¿ç§»</span>
</span></span><span style=display:flex><span>main
</span></span></code></pre></div><h2 id=ä¸‰åå››æ—¥å¿—åˆ†æå·¥å…·>ä¸‰åå››ã€æ—¥å¿—åˆ†æå·¥å…·</h2><h3 id=1-æ—¥å¿—åˆ†æè„šæœ¬>1. æ—¥å¿—åˆ†æè„šæœ¬</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºæ—¥å¿—åˆ†æè„šæœ¬</span>
</span></span><span style=display:flex><span>nano ~/log_analyzer.sh
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e># ~/log_analyzer.sh</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é…ç½®</span>
</span></span><span style=display:flex><span>LOG_DIRS<span style=color:#f92672>=(</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;/var/log&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;/var/log/nginx&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;/home/zhaoxiongzhou/logs&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>REPORT_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/home/zhaoxiongzhou/log_reports&#34;</span>
</span></span><span style=display:flex><span>LOG_FILE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/var/log/analyzer.log&#34;</span>
</span></span><span style=display:flex><span>ALERT_THRESHOLD<span style=color:#f92672>=</span><span style=color:#ae81ff>100</span>  <span style=color:#75715e># é”™è¯¯æ—¥å¿—é˜ˆå€¼</span>
</span></span><span style=display:flex><span>RETENTION_DAYS<span style=color:#f92672>=</span><span style=color:#ae81ff>30</span>    <span style=color:#75715e># æŠ¥å‘Šä¿ç•™å¤©æ•°</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç¡®ä¿ç›®å½•å­˜åœ¨</span>
</span></span><span style=display:flex><span>mkdir -p <span style=color:#e6db74>&#34;</span>$REPORT_DIR<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ—¥å¿—å‡½æ•°</span>
</span></span><span style=display:flex><span>log<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;[</span><span style=color:#66d9ef>$(</span>date <span style=color:#e6db74>&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>] </span>$1<span style=color:#e6db74>&#34;</span> | tee -a <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># åˆ†æç³»ç»Ÿæ—¥å¿—</span>
</span></span><span style=display:flex><span>analyze_system_logs<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;åˆ†æç³»ç»Ÿæ—¥å¿—...&#34;</span>
</span></span><span style=display:flex><span>    local report_file<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$REPORT_DIR<span style=color:#e6db74>/system_log_report_</span><span style=color:#66d9ef>$(</span>date +%Y%m%d<span style=color:#66d9ef>)</span><span style=color:#e6db74>.md&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;# ç³»ç»Ÿæ—¥å¿—åˆ†ææŠ¥å‘Š&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## ç”Ÿæˆæ—¶é—´: </span><span style=color:#66d9ef>$(</span>date <span style=color:#e6db74>&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        echo
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## ç³»ç»Ÿé”™è¯¯ç»Ÿè®¡&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;### ä¸¥é‡é”™è¯¯&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        grep -i <span style=color:#e6db74>&#34;error\|critical\|emergency&#34;</span> /var/log/syslog | <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>            tail -n <span style=color:#ae81ff>50</span> | sort | uniq -c | sort -nr
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;### è®¤è¯å¤±è´¥&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        grep <span style=color:#e6db74>&#34;Failed password&#34;</span> /var/log/auth.log | <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>            awk <span style=color:#e6db74>&#39;{print $1,$2,$3,$11}&#39;</span> | sort | uniq -c | sort -nr | head -n <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;### ç³»ç»Ÿé‡å¯è®°å½•&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        last reboot | head -n <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span> &gt; <span style=color:#e6db74>&#34;</span>$report_file<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># åˆ†æ Nginx è®¿é—®æ—¥å¿—</span>
</span></span><span style=display:flex><span>analyze_nginx_logs<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;åˆ†æ Nginx è®¿é—®æ—¥å¿—...&#34;</span>
</span></span><span style=display:flex><span>    local report_file<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$REPORT_DIR<span style=color:#e6db74>/nginx_log_report_</span><span style=color:#66d9ef>$(</span>date +%Y%m%d<span style=color:#66d9ef>)</span><span style=color:#e6db74>.md&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;# Nginx è®¿é—®æ—¥å¿—åˆ†ææŠ¥å‘Š&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## ç”Ÿæˆæ—¶é—´: </span><span style=color:#66d9ef>$(</span>date <span style=color:#e6db74>&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        echo
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## è®¿é—®ç»Ÿè®¡&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;### è¯·æ±‚é‡æœ€å¤§çš„ IP&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        awk <span style=color:#e6db74>&#39;{print $1}&#39;</span> /var/log/nginx/access.log | sort | uniq -c | sort -nr | head -n <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;### è®¿é—®é‡æœ€å¤§çš„é¡µé¢&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        awk <span style=color:#e6db74>&#39;{print $7}&#39;</span> /var/log/nginx/access.log | sort | uniq -c | sort -nr | head -n <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;### HTTP çŠ¶æ€ç ç»Ÿè®¡&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        awk <span style=color:#e6db74>&#39;{print $9}&#39;</span> /var/log/nginx/access.log | sort | uniq -c | sort -nr
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;### æ¯å°æ—¶è¯·æ±‚é‡ç»Ÿè®¡&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        awk <span style=color:#e6db74>&#39;{print $4}&#39;</span> /var/log/nginx/access.log | cut -c 14-15 | sort | uniq -c | <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>            awk <span style=color:#e6db74>&#39;{printf(&#34;%s:00 - %s è¯·æ±‚\n&#34;, $2, $1)}&#39;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span> &gt; <span style=color:#e6db74>&#34;</span>$report_file<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># åˆ†æ AI æœåŠ¡æ—¥å¿—</span>
</span></span><span style=display:flex><span>analyze_ai_logs<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;åˆ†æ AI æœåŠ¡æ—¥å¿—...&#34;</span>
</span></span><span style=display:flex><span>    local report_file<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$REPORT_DIR<span style=color:#e6db74>/ai_log_report_</span><span style=color:#66d9ef>$(</span>date +%Y%m%d<span style=color:#66d9ef>)</span><span style=color:#e6db74>.md&#34;</span>
</span></span><span style=display:flex><span>    local ai_log<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/home/zhaoxiongzhou/logs/llama.log&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -f <span style=color:#e6db74>&#34;</span>$ai_log<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            echo <span style=color:#e6db74>&#34;# AI æœåŠ¡æ—¥å¿—åˆ†ææŠ¥å‘Š&#34;</span>
</span></span><span style=display:flex><span>            echo <span style=color:#e6db74>&#34;## ç”Ÿæˆæ—¶é—´: </span><span style=color:#66d9ef>$(</span>date <span style=color:#e6db74>&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>            echo
</span></span><span style=display:flex><span>            echo <span style=color:#e6db74>&#34;## æœåŠ¡ç»Ÿè®¡&#34;</span>
</span></span><span style=display:flex><span>            echo <span style=color:#e6db74>&#34;### é”™è¯¯ç»Ÿè®¡&#34;</span>
</span></span><span style=display:flex><span>            echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>            grep -i <span style=color:#e6db74>&#34;error&#34;</span> <span style=color:#e6db74>&#34;</span>$ai_log<span style=color:#e6db74>&#34;</span> | tail -n <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>            echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            echo <span style=color:#e6db74>&#34;### æ€§èƒ½ç»Ÿè®¡&#34;</span>
</span></span><span style=display:flex><span>            echo <span style=color:#e6db74>&#34;#### å“åº”æ—¶é—´åˆ†å¸ƒ&#34;</span>
</span></span><span style=display:flex><span>            echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>            grep <span style=color:#e6db74>&#34;response_time&#34;</span> <span style=color:#e6db74>&#34;</span>$ai_log<span style=color:#e6db74>&#34;</span> | <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>                awk <span style=color:#e6db74>&#39;{sum+=$NF; count++} END {print &#34;å¹³å‡å“åº”æ—¶é—´:&#34;, sum/count, &#34;ms&#34;}&#39;</span>
</span></span><span style=display:flex><span>            echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            echo <span style=color:#e6db74>&#34;#### å†…å­˜ä½¿ç”¨ç»Ÿè®¡&#34;</span>
</span></span><span style=display:flex><span>            echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>            grep <span style=color:#e6db74>&#34;memory_usage&#34;</span> <span style=color:#e6db74>&#34;</span>$ai_log<span style=color:#e6db74>&#34;</span> | tail -n <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>            echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> &gt; <span style=color:#e6db74>&#34;</span>$report_file<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç”Ÿæˆå®‰å…¨æŠ¥å‘Š</span>
</span></span><span style=display:flex><span>generate_security_report<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;ç”Ÿæˆå®‰å…¨æŠ¥å‘Š...&#34;</span>
</span></span><span style=display:flex><span>    local report_file<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$REPORT_DIR<span style=color:#e6db74>/security_report_</span><span style=color:#66d9ef>$(</span>date +%Y%m%d<span style=color:#66d9ef>)</span><span style=color:#e6db74>.md&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;# å®‰å…¨åˆ†ææŠ¥å‘Š&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## ç”Ÿæˆæ—¶é—´: </span><span style=color:#66d9ef>$(</span>date <span style=color:#e6db74>&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        echo
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## å®‰å…¨äº‹ä»¶ç»Ÿè®¡&#34;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;### SSH æš´åŠ›ç ´è§£å°è¯•&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        grep <span style=color:#e6db74>&#34;Failed password&#34;</span> /var/log/auth.log | <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>            awk <span style=color:#e6db74>&#39;{print $11,$13}&#39;</span> | sort | uniq -c | sort -nr | head -n <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;### å¯ç–‘ IP è®¿é—®&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        grep -i <span style=color:#e6db74>&#34;suspicious\|attack\|hack&#34;</span> /var/log/nginx/access.log | <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>            awk <span style=color:#e6db74>&#39;{print $1}&#39;</span> | sort | uniq -c | sort -nr
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;### æ–‡ä»¶æƒé™å˜æ›´&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        find /etc -mtime -1 -type f -ls
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span> &gt; <span style=color:#e6db74>&#34;</span>$report_file<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ¸…ç†æ—§æŠ¥å‘Š</span>
</span></span><span style=display:flex><span>cleanup_old_reports<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;æ¸…ç†æ—§æŠ¥å‘Š...&#34;</span>
</span></span><span style=display:flex><span>    find <span style=color:#e6db74>&#34;</span>$REPORT_DIR<span style=color:#e6db74>&#34;</span> -type f -name <span style=color:#e6db74>&#34;*.md&#34;</span> -mtime +$RETENTION_DAYS -delete
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç”Ÿæˆæ‘˜è¦æŠ¥å‘Š</span>
</span></span><span style=display:flex><span>generate_summary<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;ç”Ÿæˆæ‘˜è¦æŠ¥å‘Š...&#34;</span>
</span></span><span style=display:flex><span>    local summary_file<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$REPORT_DIR<span style=color:#e6db74>/summary_</span><span style=color:#66d9ef>$(</span>date +%Y%m%d<span style=color:#66d9ef>)</span><span style=color:#e6db74>.md&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;# æ—¥å¿—åˆ†ææ‘˜è¦æŠ¥å‘Š&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## ç”Ÿæˆæ—¶é—´: </span><span style=color:#66d9ef>$(</span>date <span style=color:#e6db74>&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        echo
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## å…³é”®æŒ‡æ ‡&#34;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># é”™è¯¯ç»Ÿè®¡</span>
</span></span><span style=display:flex><span>        local error_count<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>grep -i <span style=color:#e6db74>&#34;error&#34;</span> /var/log/syslog | wc -l<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>        local nginx_error_count<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>grep -i <span style=color:#e6db74>&#34;error&#34;</span> /var/log/nginx/error.log | wc -l<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;- ç³»ç»Ÿé”™è¯¯æ•°: </span>$error_count<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;- Nginx é”™è¯¯æ•°: </span>$nginx_error_count<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># å®‰å…¨äº‹ä»¶</span>
</span></span><span style=display:flex><span>        local ssh_fails<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>grep <span style=color:#e6db74>&#34;Failed password&#34;</span> /var/log/auth.log | wc -l<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;- SSH å¤±è´¥å°è¯•: </span>$ssh_fails<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># å‘Šè­¦åˆ¤æ–­</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> $error_count -gt $ALERT_THRESHOLD <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            ~/send_notification.sh <span style=color:#e6db74>&#34;è­¦å‘Š: ç³»ç»Ÿé”™è¯¯æ•°è¶…è¿‡é˜ˆå€¼&#34;</span> <span style=color:#e6db74>&#34;high&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span> &gt; <span style=color:#e6db74>&#34;</span>$summary_file<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ä¸»å‡½æ•°</span>
</span></span><span style=display:flex><span>main<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;å¼€å§‹æ—¥å¿—åˆ†æ...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ‰§è¡Œåˆ†æ</span>
</span></span><span style=display:flex><span>    analyze_system_logs
</span></span><span style=display:flex><span>    analyze_nginx_logs
</span></span><span style=display:flex><span>    analyze_ai_logs
</span></span><span style=display:flex><span>    generate_security_report
</span></span><span style=display:flex><span>    generate_summary
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ¸…ç†æ—§æŠ¥å‘Š</span>
</span></span><span style=display:flex><span>    cleanup_old_reports
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;æ—¥å¿—åˆ†æå®Œæˆ&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ‰§è¡Œåˆ†æ</span>
</span></span><span style=display:flex><span>main
</span></span></code></pre></div><h2 id=ä¸‰åäº”ç³»ç»Ÿä¼˜åŒ–å·¥å…·>ä¸‰åäº”ã€ç³»ç»Ÿä¼˜åŒ–å·¥å…·</h2><h3 id=1-ç³»ç»Ÿä¼˜åŒ–è„šæœ¬>1. ç³»ç»Ÿä¼˜åŒ–è„šæœ¬</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºç³»ç»Ÿä¼˜åŒ–è„šæœ¬</span>
</span></span><span style=display:flex><span>nano ~/system_optimize.sh
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e># ~/system_optimize.sh</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é…ç½®</span>
</span></span><span style=display:flex><span>LOG_FILE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/var/log/optimize.log&#34;</span>
</span></span><span style=display:flex><span>NGINX_CONF<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/etc/nginx/nginx.conf&#34;</span>
</span></span><span style=display:flex><span>SYSCTL_CONF<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/etc/sysctl.d/99-custom.conf&#34;</span>
</span></span><span style=display:flex><span>JOURNAL_CONF<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/etc/systemd/journald.conf&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ—¥å¿—å‡½æ•°</span>
</span></span><span style=display:flex><span>log<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;[</span><span style=color:#66d9ef>$(</span>date <span style=color:#e6db74>&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>] </span>$1<span style=color:#e6db74>&#34;</span> | tee -a <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ä¼˜åŒ–ç³»ç»Ÿå‚æ•°</span>
</span></span><span style=display:flex><span>optimize_system<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;ä¼˜åŒ–ç³»ç»Ÿå‚æ•°...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># å¤‡ä»½åŸå§‹é…ç½®</span>
</span></span><span style=display:flex><span>    cp <span style=color:#e6db74>&#34;</span>$SYSCTL_CONF<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>SYSCTL_CONF<span style=color:#e6db74>}</span><span style=color:#e6db74>.backup&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># é…ç½®ç³»ç»Ÿå‚æ•°</span>
</span></span><span style=display:flex><span>    cat &gt; <span style=color:#e6db74>&#34;</span>$SYSCTL_CONF<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74># ç½‘ç»œä¼˜åŒ–
</span></span></span><span style=display:flex><span><span style=color:#e6db74>net.core.somaxconn = 2048
</span></span></span><span style=display:flex><span><span style=color:#e6db74>net.core.netdev_max_backlog = 4096
</span></span></span><span style=display:flex><span><span style=color:#e6db74>net.ipv4.tcp_max_syn_backlog = 4096
</span></span></span><span style=display:flex><span><span style=color:#e6db74>net.ipv4.tcp_fin_timeout = 30
</span></span></span><span style=display:flex><span><span style=color:#e6db74>net.ipv4.tcp_keepalive_time = 1200
</span></span></span><span style=display:flex><span><span style=color:#e6db74>net.ipv4.tcp_max_tw_buckets = 5000
</span></span></span><span style=display:flex><span><span style=color:#e6db74>net.ipv4.tcp_fastopen = 3
</span></span></span><span style=display:flex><span><span style=color:#e6db74>net.ipv4.tcp_rmem = 4096 87380 16777216
</span></span></span><span style=display:flex><span><span style=color:#e6db74>net.ipv4.tcp_wmem = 4096 65536 16777216
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74># æ–‡ä»¶ç³»ç»Ÿä¼˜åŒ–
</span></span></span><span style=display:flex><span><span style=color:#e6db74>fs.file-max = 100000
</span></span></span><span style=display:flex><span><span style=color:#e6db74>fs.inotify.max_user_watches = 524288
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74># å†…å­˜ä¼˜åŒ–
</span></span></span><span style=display:flex><span><span style=color:#e6db74>vm.swappiness = 10
</span></span></span><span style=display:flex><span><span style=color:#e6db74>vm.dirty_ratio = 60
</span></span></span><span style=display:flex><span><span style=color:#e6db74>vm.dirty_background_ratio = 2
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># åº”ç”¨ç³»ç»Ÿå‚æ•°</span>
</span></span><span style=display:flex><span>    sysctl -p <span style=color:#e6db74>&#34;</span>$SYSCTL_CONF<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ä¼˜åŒ– Nginx é…ç½®</span>
</span></span><span style=display:flex><span>optimize_nginx<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;ä¼˜åŒ– Nginx é…ç½®...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># å¤‡ä»½åŸå§‹é…ç½®</span>
</span></span><span style=display:flex><span>    cp <span style=color:#e6db74>&#34;</span>$NGINX_CONF<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>NGINX_CONF<span style=color:#e6db74>}</span><span style=color:#e6db74>.backup&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># é…ç½® Nginx</span>
</span></span><span style=display:flex><span>    cat &gt; <span style=color:#e6db74>&#34;</span>$NGINX_CONF<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>user www-data;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>worker_processes auto;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>worker_rlimit_nofile 100000;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>events {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    worker_connections 2048;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    multi_accept on;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    use epoll;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>http {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    # åŸºç¡€è®¾ç½®
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    sendfile on;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    tcp_nopush on;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    tcp_nodelay on;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    keepalive_timeout 65;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    types_hash_max_size 2048;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    server_tokens off;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    # MIME ç±»å‹
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    include /etc/nginx/mime.types;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    default_type application/octet-stream;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    # æ—¥å¿—æ ¼å¼
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    log_format main &#39;\$remote_addr - \$remote_user [\$time_local] &#34;\$request&#34; &#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    &#39;\$status \$body_bytes_sent &#34;\$http_referer&#34; &#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    &#39;&#34;\$http_user_agent&#34; &#34;\$http_x_forwarded_for&#34;&#39;;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    # ç¼“å†²åŒºè®¾ç½®
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    client_body_buffer_size 128k;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    client_max_body_size 10m;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    client_header_buffer_size 1k;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    large_client_header_buffers 4 4k;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    # Gzip å‹ç¼©
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    gzip on;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    gzip_vary on;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    gzip_proxied any;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    gzip_comp_level 6;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    # SSL ä¼˜åŒ–
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    ssl_protocols TLSv1.2 TLSv1.3;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    ssl_prefer_server_ciphers on;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    ssl_session_cache shared:SSL:10m;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    ssl_session_timeout 10m;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    # åŒ…å«å…¶ä»–é…ç½®
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    include /etc/nginx/conf.d/*.conf;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    include /etc/nginx/sites-enabled/*;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># æµ‹è¯•é…ç½®</span>
</span></span><span style=display:flex><span>    nginx -t <span style=color:#f92672>&amp;&amp;</span> systemctl restart nginx
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ä¼˜åŒ–ç³»ç»ŸæœåŠ¡</span>
</span></span><span style=display:flex><span>optimize_services<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;ä¼˜åŒ–ç³»ç»ŸæœåŠ¡...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># ç¦ç”¨ä¸å¿…è¦çš„æœåŠ¡</span>
</span></span><span style=display:flex><span>    local unnecessary_services<span style=color:#f92672>=(</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;bluetooth&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;cups&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;avahi-daemon&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> service in <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>unnecessary_services[@]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> systemctl is-active --quiet <span style=color:#e6db74>&#34;</span>$service<span style=color:#e6db74>&#34;</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            systemctl stop <span style=color:#e6db74>&#34;</span>$service<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>            systemctl disable <span style=color:#e6db74>&#34;</span>$service<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>            log <span style=color:#e6db74>&#34;å·²ç¦ç”¨æœåŠ¡: </span>$service<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># ä¼˜åŒ–æ—¥å¿—æœåŠ¡</span>
</span></span><span style=display:flex><span>    cat &gt; <span style=color:#e6db74>&#34;</span>$JOURNAL_CONF<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[Journal]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SystemMaxUse=100M
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SystemMaxFileSize=10M
</span></span></span><span style=display:flex><span><span style=color:#e6db74>RuntimeMaxUse=50M
</span></span></span><span style=display:flex><span><span style=color:#e6db74>RuntimeMaxFileSize=5M
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># é‡å¯æ—¥å¿—æœåŠ¡</span>
</span></span><span style=display:flex><span>    systemctl restart systemd-journald
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ä¼˜åŒ–æ–‡ä»¶ç³»ç»Ÿ</span>
</span></span><span style=display:flex><span>optimize_filesystem<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;ä¼˜åŒ–æ–‡ä»¶ç³»ç»Ÿ...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ¸…ç†ä¸´æ—¶æ–‡ä»¶</span>
</span></span><span style=display:flex><span>    find /tmp -type f -atime +10 -delete
</span></span><span style=display:flex><span>    find /var/tmp -type f -atime +10 -delete
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ¸…ç†æ—¥å¿—</span>
</span></span><span style=display:flex><span>    find /var/log -type f -name <span style=color:#e6db74>&#34;*.gz&#34;</span> -delete
</span></span><span style=display:flex><span>    find /var/log -type f -name <span style=color:#e6db74>&#34;*.old&#34;</span> -delete
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># ä¼˜åŒ–æ—¥å¿—è½®è½¬</span>
</span></span><span style=display:flex><span>    cat &gt; /etc/logrotate.d/custom <span style=color:#e6db74>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>/var/log/custom/*.log {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    daily
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    rotate 7
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    compress
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    delaycompress
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    missingok
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    notifempty
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    create 640 root adm
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ä¼˜åŒ–å†…å­˜ä½¿ç”¨</span>
</span></span><span style=display:flex><span>optimize_memory<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;ä¼˜åŒ–å†…å­˜ä½¿ç”¨...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ¸…ç†ç¼“å­˜</span>
</span></span><span style=display:flex><span>    sync; echo <span style=color:#ae81ff>3</span> &gt; /proc/sys/vm/drop_caches
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># é…ç½® swap ä½¿ç”¨</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -f /swapfile <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        swapoff /swapfile
</span></span><span style=display:flex><span>        dd <span style=color:#66d9ef>if</span><span style=color:#f92672>=</span>/dev/zero of<span style=color:#f92672>=</span>/swapfile bs<span style=color:#f92672>=</span>1M count<span style=color:#f92672>=</span><span style=color:#ae81ff>2048</span>
</span></span><span style=display:flex><span>        chmod <span style=color:#ae81ff>600</span> /swapfile
</span></span><span style=display:flex><span>        mkswap /swapfile
</span></span><span style=display:flex><span>        swapon /swapfile
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># éªŒè¯ä¼˜åŒ–</span>
</span></span><span style=display:flex><span>verify_optimization<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;éªŒè¯ç³»ç»Ÿä¼˜åŒ–...&#34;</span>
</span></span><span style=display:flex><span>    local status<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½</span>
</span></span><span style=display:flex><span>    local load<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>uptime | awk -F<span style=color:#e6db74>&#39;load average:&#39;</span> <span style=color:#e6db74>&#39;{print $2}&#39;</span> | cut -d, -f1<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;</span>$load<span style=color:#e6db74> &gt; 2&#34;</span> | bc -l<span style=color:#66d9ef>)</span> -eq <span style=color:#ae81ff>1</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;è­¦å‘Š: ç³»ç»Ÿè´Ÿè½½è¾ƒé«˜ (</span>$load<span style=color:#e6db74>)&#34;</span>
</span></span><span style=display:flex><span>        status<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ£€æŸ¥å†…å­˜ä½¿ç”¨</span>
</span></span><span style=display:flex><span>    local mem_usage<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>free | grep Mem | awk <span style=color:#e6db74>&#39;{print $3/$2 * 100.0}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;</span>$mem_usage<span style=color:#e6db74> &gt; 90&#34;</span> | bc -l<span style=color:#66d9ef>)</span> -eq <span style=color:#ae81ff>1</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;è­¦å‘Š: å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜ (</span>$mem_usage<span style=color:#e6db74>%)&#34;</span>
</span></span><span style=display:flex><span>        status<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ£€æŸ¥æœåŠ¡çŠ¶æ€</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ! systemctl is-active --quiet nginx; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;é”™è¯¯: Nginx æœåŠ¡æœªæ­£å¸¸è¿è¡Œ&#34;</span>
</span></span><span style=display:flex><span>        status<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> $status
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ä¸»å‡½æ•°</span>
</span></span><span style=display:flex><span>main<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;å¼€å§‹ç³»ç»Ÿä¼˜åŒ–...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    optimize_system
</span></span><span style=display:flex><span>    optimize_nginx
</span></span><span style=display:flex><span>    optimize_services
</span></span><span style=display:flex><span>    optimize_filesystem
</span></span><span style=display:flex><span>    optimize_memory
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> verify_optimization; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;ç³»ç»Ÿä¼˜åŒ–æˆåŠŸå®Œæˆ&#34;</span>
</span></span><span style=display:flex><span>        ~/send_notification.sh <span style=color:#e6db74>&#34;ç³»ç»Ÿä¼˜åŒ–å·²å®Œæˆ&#34;</span> <span style=color:#e6db74>&#34;normal&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        log <span style=color:#e6db74>&#34;ç³»ç»Ÿä¼˜åŒ–å®Œæˆï¼Œä½†å­˜åœ¨è­¦å‘Š&#34;</span>
</span></span><span style=display:flex><span>        ~/send_notification.sh <span style=color:#e6db74>&#34;ç³»ç»Ÿä¼˜åŒ–å®Œæˆï¼Œä½†éœ€è¦æ£€æŸ¥&#34;</span> <span style=color:#e6db74>&#34;high&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ‰§è¡Œä¼˜åŒ–</span>
</span></span><span style=display:flex><span>main
</span></span></code></pre></div><h2 id=ä¸‰åå…­éƒ¨ç½²åæ£€æŸ¥æ¸…å•>ä¸‰åå…­ã€éƒ¨ç½²åæ£€æŸ¥æ¸…å•</h2><h3 id=1-éƒ¨ç½²æ£€æŸ¥è„šæœ¬>1. éƒ¨ç½²æ£€æŸ¥è„šæœ¬</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºéƒ¨ç½²æ£€æŸ¥è„šæœ¬</span>
</span></span><span style=display:flex><span>nano ~/deployment_checklist.sh
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e># ~/deployment_checklist.sh</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é…ç½®</span>
</span></span><span style=display:flex><span>LOG_FILE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/var/log/deployment_check.log&#34;</span>
</span></span><span style=display:flex><span>REPORT_FILE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/home/zhaoxiongzhou/deployment_report.md&#34;</span>
</span></span><span style=display:flex><span>CHECK_INTERVAL<span style=color:#f92672>=</span><span style=color:#ae81ff>300</span>  <span style=color:#75715e># æ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ—¥å¿—å‡½æ•°</span>
</span></span><span style=display:flex><span>log<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;[</span><span style=color:#66d9ef>$(</span>date <span style=color:#e6db74>&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>] </span>$1<span style=color:#e6db74>&#34;</span> | tee -a <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ£€æŸ¥ç³»ç»ŸåŸºç¡€é…ç½®</span>
</span></span><span style=display:flex><span>check_system_basics<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;æ£€æŸ¥ç³»ç»ŸåŸºç¡€é…ç½®...&#34;</span>
</span></span><span style=display:flex><span>    local status<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## ç³»ç»ŸåŸºç¡€æ£€æŸ¥&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;### ç³»ç»Ÿä¿¡æ¯&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;- ä¸»æœºå: </span><span style=color:#66d9ef>$(</span>hostname<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;- ç³»ç»Ÿç‰ˆæœ¬: </span><span style=color:#66d9ef>$(</span>cat /etc/os-release | grep PRETTY_NAME<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;- å†…æ ¸ç‰ˆæœ¬: </span><span style=color:#66d9ef>$(</span>uname -r<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;- è¿è¡Œæ—¶é—´: </span><span style=color:#66d9ef>$(</span>uptime -p<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        echo
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;### èµ„æºä½¿ç”¨&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;- CPU ä½¿ç”¨ç‡: </span><span style=color:#66d9ef>$(</span>top -bn1 | grep <span style=color:#e6db74>&#34;Cpu(s)&#34;</span> | awk <span style=color:#e6db74>&#39;{print $2}&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>%&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;- å†…å­˜ä½¿ç”¨ç‡: </span><span style=color:#66d9ef>$(</span>free | grep Mem | awk <span style=color:#e6db74>&#39;{print $3/$2 * 100.0}&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>%&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;- ç£ç›˜ä½¿ç”¨ç‡: </span><span style=color:#66d9ef>$(</span>df -h / | awk <span style=color:#e6db74>&#39;NR==2 {print $5}&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        echo
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span> &gt; <span style=color:#e6db74>&#34;</span>$REPORT_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> $status
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ£€æŸ¥ç½‘ç»œé…ç½®</span>
</span></span><span style=display:flex><span>check_network<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;æ£€æŸ¥ç½‘ç»œé…ç½®...&#34;</span>
</span></span><span style=display:flex><span>    local status<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;### ç½‘ç»œé…ç½®&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;#### IP é…ç½®&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        ip addr show
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;#### è·¯ç”±è¡¨&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        ip route
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;#### å¼€æ”¾ç«¯å£&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        netstat -tuln
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;#### DNS é…ç½®&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        cat /etc/resolv.conf
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$REPORT_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> $status
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ£€æŸ¥æœåŠ¡é…ç½®</span>
</span></span><span style=display:flex><span>check_services<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;æ£€æŸ¥æœåŠ¡é…ç½®...&#34;</span>
</span></span><span style=display:flex><span>    local status<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;### æœåŠ¡çŠ¶æ€&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;#### Nginx é…ç½®&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        nginx -T
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;#### æœåŠ¡è¿è¡ŒçŠ¶æ€&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        systemctl status nginx
</span></span><span style=display:flex><span>        systemctl status mysql
</span></span><span style=display:flex><span>        ps aux | grep llama-server
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;#### æœåŠ¡æ—¥å¿—æ£€æŸ¥&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        tail -n <span style=color:#ae81ff>20</span> /var/log/nginx/error.log
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$REPORT_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> $status
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ£€æŸ¥å®‰å…¨é…ç½®</span>
</span></span><span style=display:flex><span>check_security<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;æ£€æŸ¥å®‰å…¨é…ç½®...&#34;</span>
</span></span><span style=display:flex><span>    local status<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;### å®‰å…¨æ£€æŸ¥&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;#### é˜²ç«å¢™è§„åˆ™&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        sudo iptables -L
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;#### SSH é…ç½®&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        grep -v <span style=color:#e6db74>&#39;^#&#39;</span> /etc/ssh/sshd_config
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;#### ç”¨æˆ·æƒé™&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        ls -la /home/zhaoxiongzhou/
</span></span><span style=display:flex><span>        ls -la /var/www/
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;#### SSL è¯ä¹¦&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        openssl x509 -in /etc/nginx/ssl/server.crt -text -noout
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$REPORT_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> $status
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ£€æŸ¥å¤‡ä»½é…ç½®</span>
</span></span><span style=display:flex><span>check_backups<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;æ£€æŸ¥å¤‡ä»½é…ç½®...&#34;</span>
</span></span><span style=display:flex><span>    local status<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;### å¤‡ä»½æ£€æŸ¥&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;#### å¤‡ä»½é…ç½®&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        ls -lh /mnt/backup_drive/system_backups/
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;#### æœ€è¿‘å¤‡ä»½çŠ¶æ€&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        tail -n <span style=color:#ae81ff>20</span> /var/log/backup.log
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$REPORT_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> $status
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ£€æŸ¥ç›‘æ§é…ç½®</span>
</span></span><span style=display:flex><span>check_monitoring<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;æ£€æŸ¥ç›‘æ§é…ç½®...&#34;</span>
</span></span><span style=display:flex><span>    local status<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;### ç›‘æ§æ£€æŸ¥&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;#### ç›‘æ§è„šæœ¬çŠ¶æ€&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        ps aux | grep monitor
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;#### å‘Šè­¦é…ç½®&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>        cat ~/send_notification.sh
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#39;```&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$REPORT_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> $status
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç”Ÿæˆæ€»ç»“æŠ¥å‘Š</span>
</span></span><span style=display:flex><span>generate_summary<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;ç”Ÿæˆæ€»ç»“æŠ¥å‘Š...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;## éƒ¨ç½²æ£€æŸ¥æ€»ç»“&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;### æ£€æŸ¥æ—¶é—´: </span><span style=color:#66d9ef>$(</span>date <span style=color:#e6db74>&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        echo
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;### ä¸»è¦å‘ç°&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;1. ç³»ç»ŸçŠ¶æ€: </span><span style=color:#66d9ef>$(</span><span style=color:#f92672>[</span> $system_status -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> echo <span style=color:#e6db74>&#39;æ­£å¸¸ âœ…&#39;</span> <span style=color:#f92672>||</span> echo <span style=color:#e6db74>&#39;å¼‚å¸¸ âŒ&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;2. ç½‘ç»œé…ç½®: </span><span style=color:#66d9ef>$(</span><span style=color:#f92672>[</span> $network_status -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> echo <span style=color:#e6db74>&#39;æ­£å¸¸ âœ…&#39;</span> <span style=color:#f92672>||</span> echo <span style=color:#e6db74>&#39;å¼‚å¸¸ âŒ&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;3. æœåŠ¡çŠ¶æ€: </span><span style=color:#66d9ef>$(</span><span style=color:#f92672>[</span> $services_status -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> echo <span style=color:#e6db74>&#39;æ­£å¸¸ âœ…&#39;</span> <span style=color:#f92672>||</span> echo <span style=color:#e6db74>&#39;å¼‚å¸¸ âŒ&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;4. å®‰å…¨é…ç½®: </span><span style=color:#66d9ef>$(</span><span style=color:#f92672>[</span> $security_status -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> echo <span style=color:#e6db74>&#39;æ­£å¸¸ âœ…&#39;</span> <span style=color:#f92672>||</span> echo <span style=color:#e6db74>&#39;å¼‚å¸¸ âŒ&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;5. å¤‡ä»½çŠ¶æ€: </span><span style=color:#66d9ef>$(</span><span style=color:#f92672>[</span> $backup_status -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> echo <span style=color:#e6db74>&#39;æ­£å¸¸ âœ…&#39;</span> <span style=color:#f92672>||</span> echo <span style=color:#e6db74>&#39;å¼‚å¸¸ âŒ&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;6. ç›‘æ§çŠ¶æ€: </span><span style=color:#66d9ef>$(</span><span style=color:#f92672>[</span> $monitoring_status -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> echo <span style=color:#e6db74>&#39;æ­£å¸¸ âœ…&#39;</span> <span style=color:#f92672>||</span> echo <span style=color:#e6db74>&#39;å¼‚å¸¸ âŒ&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        echo
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;### å»ºè®®æ“ä½œ&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>[</span> $system_status -ne <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> echo <span style=color:#e6db74>&#34;- æ£€æŸ¥ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>[</span> $network_status -ne <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> echo <span style=color:#e6db74>&#34;- éªŒè¯ç½‘ç»œé…ç½®&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>[</span> $services_status -ne <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> echo <span style=color:#e6db74>&#34;- æ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>[</span> $security_status -ne <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> echo <span style=color:#e6db74>&#34;- å®¡æŸ¥å®‰å…¨é…ç½®&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>[</span> $backup_status -ne <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> echo <span style=color:#e6db74>&#34;- ç¡®è®¤å¤‡ä»½æ˜¯å¦æ­£å¸¸&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>[</span> $monitoring_status -ne <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> echo <span style=color:#e6db74>&#34;- æ£€æŸ¥ç›‘æ§ç³»ç»Ÿ&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$REPORT_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ä¸»å‡½æ•°</span>
</span></span><span style=display:flex><span>main<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;å¼€å§‹éƒ¨ç½²åæ£€æŸ¥...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ‰§è¡Œæ£€æŸ¥</span>
</span></span><span style=display:flex><span>    check_system_basics
</span></span><span style=display:flex><span>    system_status<span style=color:#f92672>=</span>$?
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    check_network
</span></span><span style=display:flex><span>    network_status<span style=color:#f92672>=</span>$?
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    check_services
</span></span><span style=display:flex><span>    services_status<span style=color:#f92672>=</span>$?
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    check_security
</span></span><span style=display:flex><span>    security_status<span style=color:#f92672>=</span>$?
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    check_backups
</span></span><span style=display:flex><span>    backup_status<span style=color:#f92672>=</span>$?
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    check_monitoring
</span></span><span style=display:flex><span>    monitoring_status<span style=color:#f92672>=</span>$?
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># ç”Ÿæˆæ€»ç»“</span>
</span></span><span style=display:flex><span>    generate_summary
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># å‘é€é€šçŸ¥</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> $system_status -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>[</span> $network_status -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>       <span style=color:#f92672>[</span> $services_status -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>[</span> $security_status -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>       <span style=color:#f92672>[</span> $backup_status -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>[</span> $monitoring_status -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        ~/send_notification.sh <span style=color:#e6db74>&#34;éƒ¨ç½²æ£€æŸ¥å®Œæˆï¼šæ‰€æœ‰é¡¹ç›®æ­£å¸¸&#34;</span> <span style=color:#e6db74>&#34;normal&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        ~/send_notification.sh <span style=color:#e6db74>&#34;éƒ¨ç½²æ£€æŸ¥å®Œæˆï¼šå­˜åœ¨éœ€è¦å…³æ³¨çš„é¡¹ç›®&#34;</span> <span style=color:#e6db74>&#34;high&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    log <span style=color:#e6db74>&#34;éƒ¨ç½²æ£€æŸ¥å®Œæˆï¼ŒæŠ¥å‘Šå·²ç”Ÿæˆ: </span>$REPORT_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ‰§è¡Œæ£€æŸ¥</span>
</span></span><span style=display:flex><span>main
</span></span></code></pre></div><p>ã€Šæ ‘è“æ´¾æœåŠ¡éƒ¨ç½²ä¸ç»´æŠ¤å®Œæ•´æŒ‡å—ã€‹æ€»å…±åŒ…å«äº† 36 ä¸ªéƒ¨åˆ†ï¼Œæ¶µç›–äº†ä»ç³»ç»Ÿéƒ¨ç½²åˆ°ç»´æŠ¤çš„å„ä¸ªæ–¹é¢ã€‚æ¯ä¸ªè„šæœ¬éƒ½ç»è¿‡ç²¾å¿ƒè®¾è®¡ï¼Œå¯ä»¥ç‹¬ç«‹è¿è¡Œï¼Œä¹Ÿå¯ä»¥äº’ç›¸é…åˆä½¿ç”¨ã€‚</p></article></div></div><footer class="flex justify-between items-center gap-2 px-4 py-12"><div><p>Â© 2024 - 2025 èµµé›„å·çš„åšå®¢</p><p class=text-sm>ğŸŒ±
<span class=text-base-content/60>Powered by <a class=hover:underline href=https://gohugo.io/ target=_blank>Hugo</a> with theme
<a class=hover:underline href=https://github.com/g1eny0ung/hugo-theme-dream target=_blank>Dream</a>.</span></p></div><div x-data="{ icons: [
    { name: 'moon', status: 'y' },
    { name: 'sunny', status: 'n' },
    { name: 'desktop', status: 'auto' }
  ] }" class="flex items-center h-[32px] px-2 gap-2 border border-base-content/30 rounded-full"><template x-for="icon in icons"><div role=button tabindex=0 :aria-label="'Select ' + icon.name + ' mode'" class="group inline-flex justify-center items-center p-1 rounded-full cursor-pointer hover:bg-primary" :class="$store.darkMode.icon() === icon.name && 'bg-primary'" @click=$store.darkMode.toggle(icon.status)><ion-icon :name="`${icon.name}-outline`" class=group-hover:text-primary-content :class="$store.darkMode.icon() === icon.name && 'text-primary-content'"></ion-icon></div></template></div></footer></div></div><div class=back><div class=container><div class="dream-grid dream-grid-about"><div class="w-full md:w-1/2 lg:w-1/3 xl:w-1/4 p-4 dream-column"><article class="card card-compact bg-base-100 hover:bg-base-content/10 shadow-xl dark:border dark:border-base-content/30"><div class=card-body><div class=card-title>About Me</div><div class="prose dark:prose-invert"><p>Hi, my name is Your Name.
This is my blog.</p></div></div></article></div></div><footer class="flex justify-between items-center gap-2 px-4 py-12"><div><p>Â© 2024 - 2025 èµµé›„å·çš„åšå®¢</p><p class=text-sm>ğŸŒ±
<span class=text-base-content/60>Powered by <a class=hover:underline href=https://gohugo.io/ target=_blank>Hugo</a> with theme
<a class=hover:underline href=https://github.com/g1eny0ung/hugo-theme-dream target=_blank>Dream</a>.</span></p></div><div x-data="{ icons: [
    { name: 'moon', status: 'y' },
    { name: 'sunny', status: 'n' },
    { name: 'desktop', status: 'auto' }
  ] }" class="flex items-center h-[32px] px-2 gap-2 border border-base-content/30 rounded-full"><template x-for="icon in icons"><div role=button tabindex=0 :aria-label="'Select ' + icon.name + ' mode'" class="group inline-flex justify-center items-center p-1 rounded-full cursor-pointer hover:bg-primary" :class="$store.darkMode.icon() === icon.name && 'bg-primary'" @click=$store.darkMode.toggle(icon.status)><ion-icon :name="`${icon.name}-outline`" class=group-hover:text-primary-content :class="$store.darkMode.icon() === icon.name && 'text-primary-content'"></ion-icon></div></template></div></footer></div></div></div></div><script>window.lightTheme=null,window.darkTheme=null</script><script src=https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin=anonymous></script><script src=/js/grid.min.js></script><script src=/js/main.min.js></script><script type=module src=https://unpkg.com/ionicons@7.4.0/dist/ionicons/ionicons.esm.js></script><script nomodule src=https://unpkg.com/ionicons@7.4.0/dist/ionicons/ionicons.js></script></body></html>